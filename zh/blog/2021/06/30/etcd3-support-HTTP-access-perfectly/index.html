<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<meta name="robots" content="noindex, nofollow">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache APISIXâ„¢ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache APISIXâ„¢ Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIXâ„¢" href="/zh/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh/events/rss.xml" title="Apache APISIXâ„¢ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/events/atom.xml" title="Apache APISIXâ„¢ Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">å·®ä¹‹æ¯«å˜ï¼šetcd 3 å®Œç¾æ”¯æŒ HTTP è®¿é—®ï¼Ÿ | Apache APISIXâ„¢</title><meta data-react-helmet="true" property="og:title" content="å·®ä¹‹æ¯«å˜ï¼šetcd 3 å®Œç¾æ”¯æŒ HTTP è®¿é—®ï¼Ÿ | Apache APISIXâ„¢"><meta data-react-helmet="true" property="og:description" content="@spacewander, Core developer of Apache APISIX from Shenzhen Zhiliu Technology Co."><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org//zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="description" content="Apache APISIX is a dynamic, real-time, high-performance Cloud-Native API gateway, based on the Nginx library and etcd."><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org//zh/img/favicon.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org//zh/img/favicon.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org//zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//blog/2021/06/30/etcd3-support-HTTP-access-perfectly" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//blog/2021/06/30/etcd3-support-HTTP-access-perfectly" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.ce1f515f.css">
<link rel="preload" href="/zh/assets/js/runtime~main.1d357cd0.js" as="script">
<link rel="preload" href="/zh/assets/js/main.5f273786.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo2.svg" alt="Apache APISIXâ„¢" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logo2.svg" alt="Apache APISIXâ„¢" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Apache APISIXâ„¢</strong></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/zh/docs">æ–‡æ¡£</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/apisix/getting-started">APISIXâ„¢ï¸</a></li><li><a class="dropdown__link" href="/zh/docs/dashboard/USER_GUIDE">APISIXâ„¢ï¸ Dashboard</a></li><li><a class="dropdown__link" href="/zh/docs/ingress-controller/getting-started/">APISIXâ„¢ï¸ Ingress Controller</a></li><li><a class="dropdown__link" href="/zh/docs/helm-chart/apisix/">Apacheâ„¢ï¸ APISIX Helm Charts</a></li><li><a class="dropdown__link" href="/zh/docs/docker/build/">Apacheâ„¢ï¸ APISIX Docker</a></li><li><a class="dropdown__link" href="/zh/docs/java-plugin-runner/development/">Apacheâ„¢ï¸ APISIX Java Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/go-plugin-runner/getting-started/">Apacheâ„¢ï¸ APISIX Go Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/general/security">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog">åšå®¢</a><a class="navbar__item navbar__link" href="/zh/events">Events</a><a class="navbar__item navbar__link" href="/zh/downloads">ä¸‹è½½</a><a class="navbar__item navbar__link" href="/zh/team">å›¢é˜Ÿ</a><a class="navbar__item navbar__link" href="/zh/help">Help</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/06/30/etcd3-support-HTTP-access-perfectly" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo2.svg" alt="Apache APISIXâ„¢" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logo2.svg" alt="Apache APISIXâ„¢" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Apache APISIXâ„¢</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/zh/docs">æ–‡æ¡£</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/zh/docs/apisix/getting-started">APISIXâ„¢ï¸</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/dashboard/USER_GUIDE">APISIXâ„¢ï¸ Dashboard</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/ingress-controller/getting-started/">APISIXâ„¢ï¸ Ingress Controller</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/helm-chart/apisix/">Apacheâ„¢ï¸ APISIX Helm Charts</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/docker/build/">Apacheâ„¢ï¸ APISIX Docker</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/java-plugin-runner/development/">Apacheâ„¢ï¸ APISIX Java Plugin Runner</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/go-plugin-runner/getting-started/">Apacheâ„¢ï¸ APISIX Go Plugin Runner</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/docs/general/security">General</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/zh/blog">åšå®¢</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/events">Events</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/downloads">ä¸‹è½½</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/team">å›¢é˜Ÿ</a></li><li class="menu__list-item"><a class="menu__link" href="/zh/help">Help</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2021/06/30/etcd3-support-HTTP-access-perfectly" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2021/07/16/Analyze-Apache-APISIX-Mesh-Agent-deeply">æ·±åº¦å‰–æ Apache APISIX Mesh Agent</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX">åŸºäº Apache APISIXï¼Œæ–°æµªå¾®åš API ç½‘å…³çš„å®šåˆ¶åŒ–å¼€å‘ä¹‹è·¯</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2021/07/06/celebrate-200-contributors">Apache APISIX has over 200 contributors in GitHub main repo! </a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/zh/blog/2021/06/30/etcd3-support-HTTP-access-perfectly">å·®ä¹‹æ¯«å˜ï¼šetcd 3 å®Œç¾æ”¯æŒ HTTP è®¿é—®ï¼Ÿ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/2021/06/29/release-apache-apisix-2.7-en">Release Apache APISIX 2.7.0</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">å·®ä¹‹æ¯«å˜ï¼šetcd 3 å®Œç¾æ”¯æŒ HTTP è®¿é—®ï¼Ÿ</h1><div class="margin-vert--md"><time datetime="2021-06-30T00:00:00.000Z" class="blogPostDate_fNvV">June 30, 2021 Â· One min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/spacewander" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/4161644?v=4" alt="spacewander"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/spacewander" target="_blank" rel="noopener noreferrer">spacewander</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><blockquote><p><a href="https://github.com/spacewander" target="_blank" rel="noopener noreferrer">@spacewander</a>, Core developer of Apache APISIX from <a href="https://www.apiseven.com/" target="_blank" rel="noopener noreferrer">Shenzhen Zhiliu Technology Co.</a></p></blockquote><p>etcd å‡çº§åˆ° 3.x ç‰ˆæœ¬åï¼Œå…¶å¯¹å¤– API çš„åè®®ä»æ™®é€šçš„ HTTP1 åˆ‡æ¢åˆ°äº† gRPCã€‚ä¸ºäº†å…¼é¡¾é‚£äº›ä¸èƒ½ä½¿ç”¨ gRPC çš„ç‰¹æ®Šç¾¤ä½“ï¼Œetcd é€šè¿‡ gRPC-gateway çš„æ–¹å¼ä»£ç† HTTP1 è¯·æ±‚ï¼Œä»¥ gRPC å½¢å¼å»è®¿é—®æ–°çš„ gRPC APIã€‚ï¼ˆç”±äº HTTP1 å¿µèµ·æ¥å¤ªè¿‡æ‹—å£ï¼Œä»¥ä¸‹å°†ä¹‹ç®€åŒ–æˆ HTTPï¼Œæ­£å¥½å’Œ gRPC èƒ½å¤Ÿå¯¹åº”ã€‚è¯·ä¸è¦çº ç»“ gRPC ä¹Ÿæ˜¯ HTTP è¯·æ±‚çš„è¿™ç§é—®é¢˜ã€‚ï¼‰</p><p>Apache APISIX å¼€å§‹ç”¨ etcd çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ etcd v2 çš„ APIã€‚ä» Apache APISIX 2.0 ç‰ˆæœ¬èµ·ï¼Œæˆ‘ä»¬æŠŠä¾èµ–çš„ etcd ç‰ˆæœ¬å‡çº§åˆ° 3.xã€‚ç”±äº Lua ç”Ÿæ€åœˆé‡Œé¢æ²¡æœ‰ gRPC åº“ï¼Œæ‰€ä»¥ etcd å¯¹ HTTP çš„å…¼å®¹å¸®äº†æˆ‘ä»¬å¾ˆå¤§çš„å¿™ï¼Œè¿™æ ·å°±ä¸ç”¨èŠ±å¾ˆå¤§å¿ƒæ€å»è¡¥è¿™ä¸ªçŸ­æ¿äº†ã€‚</p><p>ä»å»å¹´ 10 æœˆå‘å¸ƒ Apache APISIX 2.0 ç‰ˆæœ¬ä»¥æ¥ï¼Œç°åœ¨å·²ç»è¿‡å»äº† 8 ä¸ªæœˆã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°äº† etcd çš„ HTTP API çš„ä¸€äº›è·Ÿ gRPC API äº¤äº’çš„é—®é¢˜ã€‚äº‹å®ä¸Šï¼Œæ‹¥æœ‰ gRPC-gateway å¹¶ä¸æ„å‘³ç€èƒ½å¤Ÿå®Œç¾æ”¯æŒ HTTP è®¿é—®ï¼Œè¿™é‡Œè¿˜æ˜¯æœ‰äº›ç»†å¾®çš„å·®åˆ«ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="æ‰“ç ´-grpc-çš„é»˜è®¤é™åˆ¶"></a>æ‰“ç ´ gRPC çš„é»˜è®¤é™åˆ¶<a class="hash-link" href="#æ‰“ç ´-grpc-çš„é»˜è®¤é™åˆ¶" title="Direct link to heading">#</a></h3><p>å°±åœ¨å‡ å¤©å‰ï¼Œetcd å‘å¸ƒäº† v3.5.0 ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒï¼Œäº†å´å›°æ‰°æˆ‘ä»¬å¾ˆé•¿æ—¶é—´çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><p>è·Ÿ HTTP ä¸åŒçš„æ˜¯ï¼ŒgRPC é»˜è®¤é™åˆ¶äº†ä¸€æ¬¡è¯·æ±‚å¯ä»¥è¯»å–çš„æ•°æ®å¤§å°ã€‚è¿™ä¸ªé™åˆ¶å«åš â€œMaxCallRecvMsgSizeâ€ï¼Œé»˜è®¤æ˜¯ 4MiBã€‚å½“ Apache APISIX å…¨é‡åŒæ­¥ etcd æ•°æ®æ—¶ï¼Œå‡å¦‚é…ç½®å¤Ÿå¤šï¼Œå°±ä¼šè§¦å‘è¿™ä¸€ä¸Šé™ï¼ŒæŠ¥é”™ â€œgrpc: received message larger than maxâ€ã€‚</p><p>ç¥å¥‡çš„æ˜¯ï¼Œå¦‚æœä½ ç”¨ etcdctl å»è®¿é—®ï¼Œè¿™æ—¶å€™å´ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºè¿™ä¸ªé™åˆ¶æ˜¯å¯ä»¥åœ¨è·Ÿ gRPC server å»ºç«‹è¿æ¥æ—¶åŠ¨æ€è®¾ç½®çš„ï¼Œetcdctl ç»™è¿™ä¸ªé™åˆ¶è®¾ç½®äº†ä¸€ä¸ªå¾ˆå¤§çš„æ•´æ•°ï¼Œç›¸å½“äºå»æ‰äº†è¿™ä¸€é™åˆ¶ã€‚</p><p>ç”±äºä¸å°‘ç”¨æˆ·ç¢°åˆ°è¿‡åŒæ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ›¾ç»è®¨è®ºè¿‡å¯¹ç­–ã€‚</p><p>ä¸€ä¸ªæƒ³æ³•æ˜¯ç”¨å¢é‡åŒæ­¥æ¨¡æ‹Ÿå…¨é‡åŒæ­¥ï¼Œè¿™ä¹ˆåšæœ‰ä¸¤ä¸ªå¼Šç«¯ï¼š</p><ol><li>å®ç°èµ·æ¥å¤æ‚ï¼Œè¦æ”¹ä¸å°‘ä»£ç </li><li>ä¼šå»¶é•¿åŒæ­¥æ‰€éœ€çš„æ—¶é—´</li></ol><p>å¦ä¸€ä¸ªæƒ³æ³•æ˜¯ä¿®æ”¹ etcdã€‚æ—¢ç„¶èƒ½å¤Ÿåœ¨ etcdctl é‡Œé¢å»é™¤é™åˆ¶ï¼Œä¸ºä»€ä¹ˆä¸å¯¹ gRPC-gateway ä¸€è§†åŒä»å‘¢ï¼ŸåŒæ ·çš„æ”¹åŠ¨å¯ä»¥ä½œç”¨åœ¨ gRPC-gateway ä¸Šã€‚</p><p>æˆ‘ä»¬é‡‡ç”¨äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼Œç»™ etcd æäº†ä¸ª PRï¼š<a href="https://github.com/etcd-io/etcd/pull/13077" target="_blank" rel="noopener noreferrer">https://github.com/etcd-io/etcd/pull/13077</a></p><p><img alt="2021-06-30-1" src="/zh/assets/images/2021-06-30-1-6eae65298ae03e3aafbcafffa6464321.png"></p><p>æœ€æ–°å‘å¸ƒçš„ v3.5.0 ç‰ˆæœ¬å°±åŒ…å«äº†æˆ‘ä»¬è´¡çŒ®çš„è¿™ä¸ªæ”¹åŠ¨ã€‚å¦‚æœä½ é‡åˆ° â€œgrpc: received message larger than maxâ€ï¼Œä¸å¦¨è¯•ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬ã€‚è¿™ä¸€æ”¹åŠ¨ä¹Ÿè¢« etcd å¼€å‘è€… backport åˆ° 3.4 åˆ†æ”¯ä¸Šäº†ã€‚3.4 åˆ†æ”¯çš„ä¸‹ä¸€ä¸ªå‘å¸ƒï¼Œä¹Ÿä¼šå¸¦ä¸Šè¿™ä¸ªæ”¹åŠ¨ã€‚</p><p>è¿™ä»¶äº‹ä¹Ÿè¯´æ˜ gRPC-gateway å¹¶éç™¾è¯•ç™¾çµã€‚å³ä½¿ç”¨äº†å®ƒï¼Œä¹Ÿä¸èƒ½ä¿è¯ HTTP è®¿é—®èƒ½å¤Ÿè·Ÿ gRPC è®¿é—®æœ‰ä¸€æ ·çš„ä½“éªŒã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="å¯¹æœåŠ¡ç«¯è¯ä¹¦çš„æœ‰è¶£ç”¨æ³•"></a>å¯¹æœåŠ¡ç«¯è¯ä¹¦çš„æœ‰è¶£ç”¨æ³•<a class="hash-link" href="#å¯¹æœåŠ¡ç«¯è¯ä¹¦çš„æœ‰è¶£ç”¨æ³•" title="Direct link to heading">#</a></h3><p>Apache APISIX å¢åŠ äº†å¯¹ etcd mTLS çš„æ”¯æŒåï¼Œæœ‰ç”¨æˆ·åé¦ˆä¸€ç›´æ²¡æ³•å®Œæˆæ ¡éªŒï¼Œè€Œç”¨ etcdctl è®¿é—®åˆ™æ˜¯æˆåŠŸçš„ã€‚åœ¨è·Ÿç”¨æˆ·äº¤æµåï¼Œæˆ‘å†³å®šæ‹¿ä»–çš„è¯ä¹¦æ¥å¤ç°ä¸‹ã€‚</p><p>åœ¨å¤ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ³¨æ„åˆ° etcd æ—¥å¿—é‡Œé¢æœ‰è¿™æ ·çš„æŠ¥é”™ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><div tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">2021-06-09 11:10:13.022735 I | embed: rejected connection from &quot;127.0.0.1:50898&quot; (error &quot;tls: failed to verify client&#x27;s certificate: x509: certificate specifies an incompatible key usage&quot;, ServerName &quot;&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">WARNING: 2021/06/09 11:10:13 grpc: addrConn.createTransport failed to connect to {127.0.0.1:12379 0 }. Err :connection error: desc = &quot;transport: authentication handshake failed: remote error: tls: bad certificate&quot;. Reconnecting...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>â€œbad certificateâ€ é”™è¯¯ä¿¡æ¯ï¼Œåˆçœ‹åƒæ˜¯å› ä¸ºæˆ‘ä»¬å‘ç»™ etcd çš„å®¢æˆ·ç«¯è¯ä¹¦ä¸å¯¹ã€‚ä½†ä»”ç»†ç§ç§ï¼Œä¼šå‘ç°è¿™ä¸ªæŠ¥é”™æ˜¯åœ¨ gRPC server é‡Œé¢æŠ¥çš„ã€‚</p><p>gRPC-gateway åœ¨ etcd é‡Œé¢èµ·åˆ°ä¸€ä¸ªä»£ç†çš„ä½œç”¨ï¼ŒæŠŠå¤–é¢çš„ HTTP è¯·æ±‚å˜æˆ gRPC server èƒ½å¤„ç†çš„ gRPC è¯·æ±‚ã€‚</p><p>å¤§ä½“æ¶æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><div tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">etcdctl ----&gt; gRPC server</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Apache APISIX ---&gt; gRPC-gateway ---&gt; gRPC server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ä¸ºä»€ä¹ˆ etcdctl ç›´è¿ gRPC server èƒ½é€šï¼Œè€Œä¸­é—´åŠ ä¸€å±‚ gRPC-gateway å°±ä¸è¡Œï¼Ÿ</p><p>åŸæ¥å½“ etcd å¯ç”¨äº†å®¢æˆ·ç«¯è¯ä¹¦æ ¡éªŒä¹‹åï¼Œç”¨ gRPC-gateway è¿æ¥ gRPC server å°±éœ€è¦æä¾›ä¸€ä¸ªå®¢æˆ·ç«¯è¯ä¹¦ã€‚çŒœçŒœè¿™ä¸ªè¯ä¹¦ä»å“ªæ¥ï¼Ÿ</p><p>etcd æŠŠé…ç½®çš„æœåŠ¡ç«¯è¯ä¹¦ç›´æ¥ä½œä¸ºè¿™é‡Œçš„å®¢æˆ·ç«¯è¯ä¹¦ç”¨äº†ã€‚</p><p>ä¸€ä¸ªè¯ä¹¦æ—¢åœ¨æœåŠ¡ç«¯ä¸Šæä¾›éªŒè¯ï¼Œåˆåœ¨å®¢æˆ·ç«¯ä¸Šè¡¨æ˜èº«ä»½ï¼Œçœ‹ä¸Šå»ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚é™¤éâ€¦â€¦</p><p>é™¤éè¯ä¹¦ä¸Šå¯ç”¨äº† server auth çš„æ‹“å±•ï¼Œä½†æ˜¯æ²¡æœ‰å¯ç”¨ client authã€‚</p><p>å¯¹æœ‰é—®é¢˜çš„è¯ä¹¦æ‰§è¡Œ<code>openssl x509 -text -noout -in /tmp/bad.crt</code></p><p>ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><div tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">X509v3 extensions:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X509v3 Key Usage: critical</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Digital Signature, Key Encipherment</span></div><div class="token-line" style="color:#393A34"><span class="token plain">X509v3 Extended Key Usage:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">TLS Web Server Authentication</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>æ³¨æ„è¿™é‡Œçš„ â€œTLS Web Server Authenticationâ€ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒæ”¹æˆ â€œTLS Web Server Authentication, TLS Web Client Authenticationâ€ï¼ŒæŠ‘æˆ–ä¸åŠ è¿™ä¸ªæ‹“å±•ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†ã€‚</p><p>etcd ä¸Šä¹Ÿæœ‰å…³äºè¿™ä¸ªé—®é¢˜çš„ issueï¼š<a href="https://github.com/etcd-io/etcd/issues/9785" target="_blank" rel="noopener noreferrer">https://github.com/etcd-io/etcd/issues/9785</a></p><p><img alt="2021-06-30-2" src="/zh/assets/images/2021-06-30-2-4b6100e6ec8760dbc1d75da8fe87f8af.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ç»“è¯­"></a>ç»“è¯­<a class="hash-link" href="#ç»“è¯­" title="Direct link to heading">#</a></h3><p>è™½ç„¶æˆ‘ä»¬åœ¨ä¸Šæ–‡åˆ—å‡ºäº†å‡ ç‚¹å°é—®é¢˜ï¼Œä½†æ˜¯ç‘•ä¸æ©ç‘œï¼Œetcd å¯¹ HTTP è®¿é—®çš„æ”¯æŒè¿˜æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚</p><p>æ„Ÿè°¢ Apache APISIX çš„ç”¨æˆ·ä»¬ï¼Œæ­£æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰ç€å¹¿é˜”çš„ç”¨æˆ·ç¾¤ï¼Œæ‰èƒ½å‘ç° etcd çš„è¿™äº›ç»†èŠ‚ä¸Šçš„é—®é¢˜ã€‚æˆ‘ä»¬ä½œä¸º etcd çš„ä¸€å¤§ç”¨æˆ·ï¼Œåœ¨ä¹‹åçš„æ—¥å­é‡Œä¹Ÿå°†ä¸€å¦‚æ—¢å¾€åœ°è·Ÿ etcd çš„å¼€å‘è€…å¤šå¤šäº¤æµã€‚</p></div></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/blog/2021/07/06/celebrate-200-contributors"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Apache APISIX has over 200 contributors in GitHub main repo! </div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/blog/2021/06/29/release-apache-apisix-2.7-en"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Release Apache APISIX 2.7.0 Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#æ‰“ç ´-grpc-çš„é»˜è®¤é™åˆ¶" class="table-of-contents__link">æ‰“ç ´ gRPC çš„é»˜è®¤é™åˆ¶</a></li><li><a href="#å¯¹æœåŠ¡ç«¯è¯ä¹¦çš„æœ‰è¶£ç”¨æ³•" class="table-of-contents__link">å¯¹æœåŠ¡ç«¯è¯ä¹¦çš„æœ‰è¶£ç”¨æ³•</a></li><li><a href="#ç»“è¯­" class="table-of-contents__link">ç»“è¯­</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">ASF</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-nggtva4i-hDCsW1S35MuZ2g_2DgVDGg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/zh/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/zh/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2019-2021 The Apache Software Foundation. Apache APISIX, APISIXâ„¢, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.1d357cd0.js"></script>
<script src="/zh/assets/js/main.5f273786.js"></script>
</body>
</html>