<!doctype html>
<html class="docs-version-2.11" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX® -- Cloud-Native API Gateway" href="/zh/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh/releases/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/releases/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/zh/articles/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/articles/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">Admin API | Apache APISIX® -- Cloud-Native API Gateway</title><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org/zh/img/apache-apisix.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org/zh/img/apache-apisix.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/zh/docs/apisix/admin-api"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="2.11"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-apisix-2.11"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Admin API | Apache APISIX® -- Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/zh/docs/apisix/admin-api"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/apisix/admin-api" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/docs/apisix/admin-api" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/apisix/admin-api" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/zh/assets/css/styles.4ccf253e.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/zh/assets/js/runtime~main.96d5d87d.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/zh/assets/js/main.3d0d5e50.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">🤔 Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ">join #apisix channel</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIX®</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh/docs">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/apisix/getting-started">Apache APISIX®️</a></li><li><a class="dropdown__link" href="/zh/docs/dashboard/USER_GUIDE">Apache APISIX®️ Dashboard</a></li><li><a class="dropdown__link" href="/zh/docs/ingress-controller/getting-started/">Apache APISIX®️ Ingress Controller</a></li><li><a class="dropdown__link" href="/zh/docs/helm-chart/apisix/">Apache APISIX®️ Helm Charts</a></li><li><a class="dropdown__link" href="/zh/docs/docker/build/">Apache APISIX®️ Docker</a></li><li><a class="dropdown__link" href="/zh/docs/java-plugin-runner/development/">Apache APISIX®️ Java Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/go-plugin-runner/getting-started/">Apache APISIX®️ Go Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/python-plugin-runner/getting-started/">Apache APISIX®️ Python Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/general/security">General</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">FAQ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/apisix/FAQ/">Apache APISIX®</a></li><li><a class="dropdown__link" href="/zh/docs/dashboard/FAQ/">Apache APISIX® Dashboard</a></li><li><a class="dropdown__link" href="/zh/docs/ingress-controller/FAQ/">Apache APISIX® Ingress Controller</a></li><li><a class="dropdown__link" href="/zh/docs/helm-chart/FAQ/">Apache APISIX® Helm Chart</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/blog">博客</a><a class="navbar__item navbar__link" href="/zh/downloads">下载</a><a class="navbar__item navbar__link" href="/zh/team">团队</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/general/community">Community</a></li><li><a class="dropdown__link" href="/zh/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/zh/releases">Releases</a></li><li><a class="dropdown__link" href="/zh/help">Help</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/showcase">使用案例</a><a class="navbar__item navbar__link" href="/zh/contribute">Contribute</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/apisix/admin-api" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/apisix/admin-api" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3AUJ"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_2LAn"><div class="sidebar_3jCp sidebarWithHideableNavbar_Uxjr"><a tabindex="-1" class="sidebarLogo_8bKs" href="/zh/"><img src="/zh/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--dark_hz6m"><b>Apache APISIX®</b></a><div class="sidebarVersionSwitch_m-Df">Version:<div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/zh/docs/apisix/architecture-design/apisix">2.11</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/apisix/next/admin-api">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/docs/apisix/admin-api">2.11</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.10/admin-api">2.10</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.9/admin-api">2.9</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.8/admin-api">2.8</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.7/admin-api">2.7</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.6/admin-api">2.6</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.5/admin-api">2.5</a></li><li><a class="dropdown__link" href="/zh/docs/apisix/2.4/admin-api">2.4</a></li></ul></div></div><nav class="menu thin-scrollbar menu_1DcY menuWithAnnouncementBar_3IKd"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture Design</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/zh/docs/apisix/getting-started">快速入门指南</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/zh/docs/apisix/how-to-build">如何构建 Apache APISIX</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Plugins</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">API</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/apisix/admin-api">Admin API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/apisix/control-api">Control API</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/zh/docs/apisix/FAQ">常见问题</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Others</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a href="https://github.com/apache/apisix/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="menu__link"><span>CHANGELOG<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_3okl"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_1LB5"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_2AUC"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.11</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Admin API</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="目录"></a>目录<a class="hash-link" href="#目录" title="Direct link to heading">#</a></h2><ul><li><a href="#description">Description</a></li><li><a href="#route">Route</a></li><li><a href="#service">Service</a></li><li><a href="#consumer">Consumer</a></li><li><a href="#upstream">Upstream</a></li><li><a href="#ssl">SSL</a></li><li><a href="#global-rule">Global Rule</a></li><li><a href="#plugin-config">Plugin Config</a></li><li><a href="#plugin-metadata">Plugin Metadata</a></li><li><a href="#plugin">Plugin</a></li><li><a href="#stream-route">Stream Route</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="description"></a>Description<a class="hash-link" href="#description" title="Direct link to heading">#</a></h2><p>Admin API 是为 Apache APISIX 服务的一组 API，我们可以将参数传递给 Admin API 以控制 APISIX 节点。更好地了解其工作原理，请参阅 <a href="/zh/docs/apisix/architecture-design/apisix">architecture-design</a> 中的文档。</p><p>启动 Apache APISIX 时，默认情况下 Admin API 将监听 <code>9080</code> 端口（HTTPS 的 <code>9443</code> 端口）。您可以通过修改 <a href="https://github.com/apache/apisix/blob/master/conf/config.yaml" target="_blank" rel="noopener noreferrer">conf/config.yaml</a> 文件来改变默认监听的端口。</p><p>在下面出现的 <code>X-API-KEY</code> 指的是 <code>conf/config.yaml</code> 文件中的 <code>apisix.admin_key.key</code>，它是 Admin API 的访问 token。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="route"></a>Route<a class="hash-link" href="#route" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/routes/{id}?ttl=0</p><p><em>说明</em>：Route 字面意思就是路由，通过定义一些规则来匹配客户端的请求，然后根据匹配结果加载并执行相应的
插件，并把请求转发给到指定 Upstream。</p><p>注意：在启用 <code>Admin API</code> 时，它会占用前缀为 <code>/apisix/admin</code> 的 API。因此，为了避免您设计 API 与 <code>/apisix/admin</code> 冲突，建议为 Admin API 使用其他端口，您可以在 <code>conf/config.yaml</code> 中通过 <code>port_admin</code> 进行自定义 Admin API 端口。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法"></a>请求方法<a class="hash-link" href="#请求方法" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/routes</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/routes/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/routes/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>POST</td><td>/apisix/admin/routes</td><td>{...}</td><td>创建资源，id 由后台服务自动生成</td></tr><tr><td>DELETE</td><td>/apisix/admin/routes/{id}</td><td>无</td><td>删除资源</td></tr><tr><td>PATCH</td><td>/apisix/admin/routes/{id}</td><td>{...}</td><td>标准 PATCH ，修改已有 Route 的部分属性，其他不涉及的属性会原样保留；如果你要删除某个属性，将该属性的值设置为 null 即可删除；特别地，当需要修改属性的值为数组时，该属性将全量更新</td></tr><tr><td>PATCH</td><td>/apisix/admin/routes/{id}/{path}</td><td>{...}</td><td>SubPath PATCH，通过 {path} 指定 Route 要更新的属性，全量更新该属性的数据，其他不涉及的属性会原样保留。两种 PATCH 的区别可以参考后面的示例</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="url-请求参数"></a>URL 请求参数<a class="hash-link" href="#url-请求参数" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>ttl</td><td>可选</td><td>辅助</td><td>超过这个时间会被自动删除，单位：秒</td><td>ttl=1</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数"></a>body 请求参数<a class="hash-link" href="#body-请求参数" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>uri</td><td>必选，不能与 <code>uris</code> 一起使用</td><td>匹配规则</td><td>除了如 <code>/foo/bar</code>、<code>/foo/gloo</code> 这种全量匹配外，使用不同 <a href="/zh/docs/apisix/architecture-design/router">Router</a> 还允许更高级匹配，更多见 <a href="/zh/docs/apisix/architecture-design/router">Router</a>。</td><td>&quot;/hello&quot;</td></tr><tr><td>uris</td><td>必选，不能与 <code>uri</code> 一起使用</td><td>匹配规则</td><td>非空数组形式，可以匹配多个 <code>uri</code></td><td>[&quot;/hello&quot;, &quot;/world&quot;]</td></tr><tr><td>plugins</td><td>可选</td><td>Plugin</td><td>详见 <a href="/zh/docs/apisix/architecture-design/plugin">Plugin</a></td><td></td></tr><tr><td>script</td><td>可选</td><td>Script</td><td>详见 <a href="/zh/docs/apisix/architecture-design/script">Script</a></td><td></td></tr><tr><td>upstream</td><td>可选</td><td>Upstream</td><td>启用的 Upstream 配置，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr><tr><td>upstream_id</td><td>可选</td><td>Upstream</td><td>启用的 upstream id，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr><tr><td>service_id</td><td>可选</td><td>Service</td><td>绑定的 Service 配置，详见 <a href="/zh/docs/apisix/architecture-design/service">Service</a></td><td></td></tr><tr><td>plugin_config_id</td><td>可选，无法跟 script 一起配置</td><td>Plugin</td><td>绑定的 Plugin config 配置，详见 <a href="/zh/docs/apisix/architecture-design/plugin-config">Plugin config</a></td><td></td></tr><tr><td>name</td><td>可选</td><td>辅助</td><td>标识路由名称</td><td>route-xxxx</td></tr><tr><td>desc</td><td>可选</td><td>辅助</td><td>标识描述、使用场景等。</td><td>路由 xxxx</td></tr><tr><td>host</td><td>可选，不能与 <code>hosts</code> 一起使用</td><td>匹配规则</td><td>当前请求域名，比如 <code>foo.com</code>；也支持泛域名，比如 <code>*.foo.com</code>。</td><td>&quot;foo.com&quot;</td></tr><tr><td>hosts</td><td>可选，不能与 <code>host</code> 一起使用</td><td>匹配规则</td><td>非空列表形态的 <code>host</code>，表示允许有多个不同 <code>host</code>，匹配其中任意一个即可。</td><td>[&quot;foo.com&quot;, &quot;*.bar.com&quot;]</td></tr><tr><td>remote_addr</td><td>可选，不能与 <code>remote_addrs</code> 一起使用</td><td>匹配规则</td><td>客户端请求 IP 地址: <code>192.168.1.101</code>、<code>192.168.1.102</code> 以及 CIDR 格式的支持 <code>192.168.1.0/24</code>。特别的，APISIX 也完整支持 IPv6 地址匹配：<code>::1</code>，<code>fe80::1</code>, <code>fe80::1/64</code> 等。</td><td>&quot;192.168.1.0/24&quot;</td></tr><tr><td>remote_addrs</td><td>可选，不能与 <code>remote_addr</code> 一起使用</td><td>匹配规则</td><td>非空列表形态的 <code>remote_addr</code>，表示允许有多个不同 IP 地址，符合其中任意一个即可。</td><td>[&quot;127.0.0.1&quot;, &quot;192.0.0.0/8&quot;, &quot;::1&quot;]</td></tr><tr><td>methods</td><td>可选</td><td>匹配规则</td><td>如果为空或没有该选项，代表没有任何 <code>method</code> 限制，也可以是一个或多个的组合：<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>PATCH</code>, <code>HEAD</code>, <code>OPTIONS</code>，<code>CONNECT</code>，<code>TRACE</code>。</td><td>[&quot;GET&quot;, &quot;POST&quot;]</td></tr><tr><td>priority</td><td>可选</td><td>匹配规则</td><td>如果不同路由包含相同 <code>uri</code>，根据属性 <code>priority</code> 确定哪个 <code>route</code> 被优先匹配，值越大优先级越高，默认值为 0。</td><td>priority = 10</td></tr><tr><td>vars</td><td>可选</td><td>匹配规则</td><td>由一个或多个<code>[var, operator, val]</code>元素组成的列表，类似这样：<code>[[var, operator, val], [var, operator, val], ...]]</code>。例如：<code>[&quot;arg_name&quot;, &quot;==&quot;, &quot;json&quot;]</code>，表示当前请求参数 <code>name</code> 是 <code>json</code>。这里的 <code>var</code> 与 Nginx 内部自身变量命名是保持一致，所以也可以使用 <code>request_uri</code>、<code>host</code> 等。更多细节请参考<a href="https://github.com/api7/lua-resty-expr" target="_blank" rel="noopener noreferrer">lua-resty-expr</a></td><td>[[&quot;arg_name&quot;, &quot;==&quot;, &quot;json&quot;], [&quot;arg_age&quot;, &quot;&gt;&quot;, 18]]</td></tr><tr><td>filter_func</td><td>可选</td><td>匹配规则</td><td>用户自定义的过滤函数。可以使用它来实现特殊场景的匹配要求实现。该函数默认接受一个名为 vars 的输入参数，可以用它来获取 Nginx 变量。</td><td>function(vars) return vars[&quot;arg_name&quot;] == &quot;json&quot; end</td></tr><tr><td>labels</td><td>可选</td><td>匹配规则</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>timeout</td><td>可选</td><td>辅助</td><td>为 route 设置 upstream 的连接、发送消息、接收消息的超时时间。这个配置将会覆盖在 upstream 中 配置的 <a href="#upstream">timeout</a> 选项</td><td>{&quot;connect&quot;: 3, &quot;send&quot;: 3, &quot;read&quot;: 3}</td></tr><tr><td>enable_websocket</td><td>可选</td><td>辅助</td><td>是否启用 <code>websocket</code>(boolean), 缺省 <code>false</code>.</td><td></td></tr><tr><td>status</td><td>可选</td><td>辅助</td><td>是否启用此路由, 缺省 <code>1</code>。</td><td><code>1</code> 表示启用，<code>0</code> 表示禁用</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr></tbody></table><p>有两点需要特别注意：</p><ul><li>对于同一类参数比如 <code>uri</code>与 <code>uris</code>，<code>upstream</code> 与 <code>upstream_id</code>，<code>host</code> 与 <code>hosts</code>，<code>remote_addr</code> 与 <code>remote_addrs</code> 等，是不能同时存在，二者只能选择其一。如果同时启用，接口会报错。</li><li>在 <code>vars</code> 中，当获取 cookie 的值时，cookie name 是<strong>区分大小写字母</strong>的。例如：<code>var</code> 等于 &quot;cookie_x_foo&quot; 与 <code>var</code> 等于 &quot;cookie_X_Foo&quot; 表示不同的 <code>cookie</code>。</li></ul><p>route 对象 json 配置内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">,                  </span><span class="token comment" style="color:#999988;font-style:italic"># id，非必填</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;uris&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/a&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;/b&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,        </span><span class="token comment" style="color:#999988;font-style:italic"># 一组 URL 路径</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;methods&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,  </span><span class="token comment" style="color:#999988;font-style:italic"># 可以填多个方法</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;hosts&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;a.com&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;b.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token comment" style="color:#999988;font-style:italic"># 一组 host 域名</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;plugins&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,              </span><span class="token comment" style="color:#999988;font-style:italic"># 指定 route 绑定的插件</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;priority&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,              </span><span class="token comment" style="color:#999988;font-style:italic"># apisix 支持多种匹配方式，可能会在一次匹配中同时匹配到多条路由，此时优先级高的优先匹配中</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;路由xxx&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;remote_addrs&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,  </span><span class="token comment" style="color:#999988;font-style:italic"># 一组客户端请求 IP 地址</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;vars&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;http_user&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;==&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;ios&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token comment" style="color:#999988;font-style:italic"># 由一个或多个 [var, operator, val] 元素组成的列表</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;upstream_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">,         </span><span class="token comment" style="color:#999988;font-style:italic"># upstream 对象在 etcd 中的 id ，建议使用此值</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;upstream&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,             </span><span class="token comment" style="color:#999988;font-style:italic"># upstream 信息对象，建议尽量不要使用</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;timeout&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 为 route 设置 upstream 的连接、发送消息、接收消息的超时时间。</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;connect&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;send&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;filter_func&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">,          </span><span class="token comment" style="color:#999988;font-style:italic"># 用户自定义的过滤函数，非必填</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>具体示例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建一个路由</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/index.html&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;hosts&quot;: [&quot;foo.com&quot;, &quot;*.bar.com&quot;],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;remote_addrs&quot;: [&quot;127.0.0.0/8&quot;],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;methods&quot;: [&quot;PUT&quot;, &quot;GET&quot;],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;enable_websocket&quot;: true,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.215:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Sat, </span><span class="token number" style="color:#36acaa">31</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> 01:17:15 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建一个有效期为 60 秒的路由，过期后自动删除</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/2?ttl</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/aa/index.html&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.215:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Sat, </span><span class="token number" style="color:#36acaa">31</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> 01:17:15 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给路由增加一个 upstream node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.216:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给路由更新一个 upstream node 的权重</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.216:80&quot;: 10</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给路由删除一个 upstream node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.215:80&quot;: null</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 替换路由的 methods -- 数组</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;methods&quot;: [&quot;GET&quot;, &quot;POST&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，methods 将不保留原来的数据，整个更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 替换路由的 upstream nodes -- sub path</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1/upstream/nodes -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;39.97.63.200:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，nodes 将不保留原来的数据，整个更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.200:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 替换路由的 methods  -- sub path</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1/methods -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;[&quot;POST&quot;, &quot;DELETE&quot;, &quot;PATCH&quot;]&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，methods 将不保留原来的数据，整个更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;DELETE&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;PATCH&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 禁用路由</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;status&quot;: 0</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，status 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启用路由</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;status&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，status 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="应答参数"></a>应答参数<a class="hash-link" href="#应答参数" title="Direct link to heading">#</a></h3><p>目前是直接返回与 etcd 交互后的结果。</p><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="service"></a>Service<a class="hash-link" href="#service" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/services/{id}</p><p><em>说明</em>：<code>Service</code> 是某类 API 的抽象（也可以理解为一组 Route 的抽象）。它通常与上游服务抽象是一一对应的，<code>Route</code>
与 <code>Service</code> 之间，通常是 N:1 的关系。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-1"></a>请求方法<a class="hash-link" href="#请求方法-1" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/services</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/services/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/services/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>POST</td><td>/apisix/admin/services</td><td>{...}</td><td>创建资源，id 由后台服务自动生成</td></tr><tr><td>DELETE</td><td>/apisix/admin/services/{id}</td><td>无</td><td>删除资源</td></tr><tr><td>PATCH</td><td>/apisix/admin/services/{id}</td><td>{...}</td><td>标准 PATCH ，修改已有 Service 的部分属性，其他不涉及的属性会原样保留；如果你要删除某个属性，将该属性的值设置为 null 即可删除；特别地，当需要修改属性的值为数组时，该属性将全量更新</td></tr><tr><td>PATCH</td><td>/apisix/admin/services/{id}/{path}</td><td>{...}</td><td>SubPath PATCH，通过 {path} 指定 Service 需要更新的属性，全量更新该属性的数据，其他不涉及的属性会原样保留</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-1"></a>body 请求参数<a class="hash-link" href="#body-请求参数-1" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>plugins</td><td>可选</td><td>Plugin</td><td>详见 <a href="/zh/docs/apisix/architecture-design/plugin">Plugin</a></td><td></td></tr><tr><td>upstream</td><td>upstream 或 upstream_id 两个选一个</td><td>Upstream</td><td>启用的 Upstream 配置，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr><tr><td>upstream_id</td><td>upstream 或 upstream_id 两个选一个</td><td>Upstream</td><td>启用的 upstream id，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr><tr><td>name</td><td>可选</td><td>辅助</td><td>标识服务名称。</td><td></td></tr><tr><td>desc</td><td>可选</td><td>辅助</td><td>服务描述、使用场景等。</td><td></td></tr><tr><td>labels</td><td>可选</td><td>匹配规则</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>enable_websocket</td><td>可选</td><td>辅助</td><td>是否启用 <code>websocket</code>(boolean), 缺省 <code>false</code>.</td><td></td></tr><tr><td>hosts</td><td>可选</td><td>匹配规则</td><td>非空列表形态的 <code>host</code>，表示允许有多个不同 <code>host</code>，匹配其中任意一个即可。</td><td>[&quot;foo.com&quot;, &quot;*.bar.com&quot;]</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr></tbody></table><p>service 对象 json 配置内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">              # id</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;plugins&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          # 指定 service 绑定的插件</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;upstream_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     # upstream 对象在 etcd 中的 id ，建议使用此值</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;upstream&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         # upstream 信息对象，不建议使用</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;测试svc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  # service 名称</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;desc&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  # service 描述</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;enable_websocket&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> #启动 websocket 功能</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;hosts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;foo.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>具体示例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建一个Service</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/services/201  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;limit-count&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;count&quot;: 2,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;time_window&quot;: 60,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;rejected_code&quot;: 503,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;key&quot;: &quot;remote_addr&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    },</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;enable_websocket&quot;: true,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.215:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 返回结果</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Service 增加一个 upstream node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/services/201 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.216:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Service 更新一个 upstream node 的权重</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/services/201 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.216:80&quot;: 10</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Service 删除一个 upstream node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/services/201 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;39.97.63.215:80&quot;: null</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 替换 Service 的 upstream nodes</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/services/201/upstream/nodes -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;39.97.63.200:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，upstream nodes 将不保留原来的数据，整个更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.200:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="应答参数-1"></a>应答参数<a class="hash-link" href="#应答参数-1" title="Direct link to heading">#</a></h3><p>目前是直接返回与 etcd 交互后的结果。</p><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="consumer"></a>Consumer<a class="hash-link" href="#consumer" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/consumers/{username}</p><p><em>说明</em>：Consumer 是某类服务的消费者，需与用户认证体系配合才能使用。Consumer 使用 <code>username</code> 作为唯一标识，只支持使用 HTTP <code>PUT</code> 方法创建 Consumer。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-2"></a>请求方法<a class="hash-link" href="#请求方法-2" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/consumers</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/consumers/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/consumers</td><td>{...}</td><td>创建资源</td></tr><tr><td>DELETE</td><td>/apisix/admin/consumers/{id}</td><td>无</td><td>删除资源</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-2"></a>body 请求参数<a class="hash-link" href="#body-请求参数-2" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>username</td><td>必需</td><td>辅助</td><td>Consumer 名称。</td><td></td></tr><tr><td>plugins</td><td>可选</td><td>Plugin</td><td>该 Consumer 对应的插件配置，它的优先级是最高的：Consumer &gt; Route &gt; Service。对于具体插件配置，可以参考 <a href="#plugin">Plugins</a> 章节。</td><td></td></tr><tr><td>desc</td><td>可选</td><td>辅助</td><td>consumer 描述</td><td></td></tr><tr><td>labels</td><td>可选</td><td>匹配规则</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr></tbody></table><p>consumer 对象 json 配置内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;plugins&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,          </span><span class="token comment" style="color:#999988;font-style:italic"># 指定 consumer 绑定的插件</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token plain">,     </span><span class="token comment" style="color:#999988;font-style:italic"># 必填</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token plain">,  </span><span class="token comment" style="color:#999988;font-style:italic"># consumer 描述</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>绑定认证插件有些特别，当它需要与 consumer 联合使用时，需要提供用户名、密码等信息；另一方面，当它与 route/service 绑定时，是不需要任何参数的。因为这时候是根据用户请求数据来反向推出用户对应的是哪个 consumer</p><p>示例：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建 Consumer ，指定认证插件 key-auth ，并开启特定插件 limit-count</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/consumers  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;username&quot;: &quot;jack&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;key-auth&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;key&quot;: &quot;auth-one&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        },</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;limit-count&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;count&quot;: 2,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;time_window&quot;: 60,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;rejected_code&quot;: 503,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;key&quot;: &quot;remote_addr&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Thu, </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> 08:17:49 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;node&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;jack&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;plugins&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;key-auth&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;auth-one&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;limit-count&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time_window&quot;</span><span class="token plain">:60,</span><span class="token string" style="color:#e3116c">&quot;count&quot;</span><span class="token plain">:2,</span><span class="token string" style="color:#e3116c">&quot;rejected_code&quot;</span><span class="token plain">:503,</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;remote_addr&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;policy&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;local&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;createdIndex&quot;</span><span class="token plain">:64,</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;\/apisix\/consumers\/jack&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;modifiedIndex&quot;</span><span class="token plain">:64</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;prevNode&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">username</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">jack</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">plugins</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">key-auth</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">key</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">auth-one</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">},</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">limit-count</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">time_window</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:60,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">count</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:2,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">rejected_code</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:503,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">key</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">remote_addr</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">policy</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">local</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}}}&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;createdIndex&quot;</span><span class="token plain">:63,</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;\/apisix\/consumers\/jack&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;modifiedIndex&quot;</span><span class="token plain">:63</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;action&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;set&quot;</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>从 <code>v2.2</code> 版本之后，同一个 consumer 可以绑定多个认证插件。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="应答参数-2"></a>应答参数<a class="hash-link" href="#应答参数-2" title="Direct link to heading">#</a></h3><p>目前是直接返回与 etcd 交互后的结果。</p><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="upstream"></a>Upstream<a class="hash-link" href="#upstream" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/upstreams/{id}</p><p><em>说明</em>：Upstream 是虚拟主机抽象，对给定的多个服务节点按照配置规则进行负载均衡。Upstream 的地址信息可以直接配置到 <code>Route</code>（或 <code>Service</code>) 上，当 Upstream 有重复时，就需要用“引用”方式避免重复了。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-3"></a>请求方法<a class="hash-link" href="#请求方法-3" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/upstreams</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/upstreams/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/upstreams/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>POST</td><td>/apisix/admin/upstreams</td><td>{...}</td><td>创建资源，id 由后台服务自动生成</td></tr><tr><td>DELETE</td><td>/apisix/admin/upstreams/{id}</td><td>无</td><td>删除资源</td></tr><tr><td>PATCH</td><td>/apisix/admin/upstreams/{id}</td><td>{...}</td><td>标准 PATCH ，修改已有 Upstream 的部分属性，其他不涉及的属性会原样保留；如果你要删除某个属性，将该属性的值设置为 null 即可删除；特别地，当需要修改属性的值为数组时，该属性将全量更新</td></tr><tr><td>PATCH</td><td>/apisix/admin/upstreams/{id}/{path}</td><td>{...}</td><td>SubPath PATCH，通过 {path} 指定 Upstream 需要更新的属性，全量更新该属性的数据，其他不涉及的属性会原样保留。</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-3"></a>body 请求参数<a class="hash-link" href="#body-请求参数-3" title="Direct link to heading">#</a></h3><p>APISIX 的 Upstream 除了基本的负载均衡算法选择外，还支持对上游做主被动健康检查、重试等逻辑，具体看下面表格。</p><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>type</td><td>必需</td><td>枚举</td><td>负载均衡算法</td><td></td></tr><tr><td>nodes</td><td>必需，不能和 <code>service_name</code> 一起用</td><td>Node</td><td>哈希表或数组。当它是哈希表时，内部元素的 key 是上游机器地址列表，格式为<code>地址 + （可选的）端口</code>，其中地址部分可以是 IP 也可以是域名，比如 <code>192.168.1.100:80</code>、<code>foo.com:80</code>等。value 则是节点的权重。当它是数组时，数组中每个元素都是一个哈希表，其中包含 <code>host</code>、<code>weight</code> 以及可选的 <code>port</code>、<code>priority</code>。<code>nodes</code> 可以为空，这通常用作占位符。客户端命中这样的上游会返回 502。</td><td><code>192.168.1.100:80</code></td></tr><tr><td>service_name</td><td>必需，不能和 <code>nodes</code> 一起用</td><td>string</td><td>服务发现时使用的服务名，见<a href="/zh/docs/apisix/discovery">集成服务发现注册中心</a></td><td><code>a-bootiful-client</code></td></tr><tr><td>discovery_type</td><td>必需，如果设置了 <code>service_name</code></td><td>string</td><td>服务发现类型，见<a href="/zh/docs/apisix/discovery">集成服务发现注册中心</a></td><td><code>eureka</code></td></tr><tr><td>key</td><td>条件必需</td><td>匹配类型</td><td>该选项只有类型是 <code>chash</code> 才有效。根据 <code>key</code> 来查找对应的 node <code>id</code>，相同的 <code>key</code> 在同一个对象中，永远返回相同 id，目前支持的 Nginx 内置变量有 <code>uri, server_name, server_addr, request_uri, remote_port, remote_addr, query_string, host, hostname, arg_***</code>，其中 <code>arg_***</code> 是来自 URL 的请求参数，<a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">Nginx 变量列表</a></td><td></td></tr><tr><td>checks</td><td>可选</td><td>health_checker</td><td>配置健康检查的参数，详细可参考<a href="/zh/docs/apisix/health-check">health-check</a></td><td></td></tr><tr><td>retries</td><td>可选</td><td>整型</td><td>使用底层的 Nginx 重试机制将请求传递给下一个上游，默认启用重试且次数为后端可用的 node 数量。如果指定了具体重试次数，它将覆盖默认值。<code>0</code> 代表不启用重试机制。</td><td></td></tr><tr><td>retry_timeout</td><td>可选</td><td>number</td><td>限制是否继续重试的时间，若之前的请求和重试请求花费太多时间就不再继续重试。<code>0</code> 代表不启用重试超时机制。</td><td></td></tr><tr><td>timeout</td><td>可选</td><td>超时时间对象</td><td>设置连接、发送消息、接收消息的超时时间</td><td></td></tr><tr><td>hash_on</td><td>可选</td><td>辅助</td><td><code>hash_on</code> 支持的类型有 <code>vars</code>（Nginx 内置变量），<code>header</code>（自定义 header），<code>cookie</code>，<code>consumer</code>，默认值为 <code>vars</code></td><td></td></tr><tr><td>name</td><td>可选</td><td>辅助</td><td>标识上游服务名称、使用场景等。</td><td></td></tr><tr><td>desc</td><td>可选</td><td>辅助</td><td>上游服务描述、使用场景等。</td><td></td></tr><tr><td>pass_host</td><td>可选</td><td>枚举</td><td>请求发给上游时的 host 设置选型。 [<code>pass</code>，<code>node</code>，<code>rewrite</code>] 之一，默认是<code>pass</code>。<code>pass</code>: 将客户端的 host 透传给上游； <code>node</code>: 使用 <code>upstream</code>  node 中配置的 host； <code>rewrite</code>: 使用配置项 <code>upstream_host</code> 的值。</td><td></td></tr><tr><td>upstream_host</td><td>可选</td><td>辅助</td><td>指定上游请求的 host，只在 <code>pass_host</code> 配置为 <code>rewrite</code> 时有效。</td><td></td></tr><tr><td>scheme</td><td>可选</td><td>辅助</td><td>跟上游通信时使用的 scheme。需要是 [&#x27;http&#x27;, &#x27;https&#x27;, &#x27;grpc&#x27;, &#x27;grpcs&#x27;] 其中的一个，默认是 &#x27;http&#x27;。</td><td></td></tr><tr><td>labels</td><td>可选</td><td>匹配规则</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>tls.client_cert</td><td>可选</td><td>https 证书</td><td>设置跟上游通信时的客户端证书，细节见下文</td><td></td></tr><tr><td>tls.client_key</td><td>可选</td><td>https 证书私钥</td><td>设置跟上游通信时的客户端私钥，细节见下文</td><td></td></tr><tr><td>keepalive_pool.size</td><td>可选</td><td>辅助</td><td>动态设置 <code>keepalive</code> 指令，细节见下文</td><td></td></tr><tr><td>keepalive_pool.idle_timeout</td><td>可选</td><td>辅助</td><td>动态设置 <code>keepalive_timeout</code> 指令，细节见下文</td><td></td></tr><tr><td>keepalive_pool.requests</td><td>可选</td><td>辅助</td><td>动态设置 <code>keepalive_requests</code> 指令，细节见下文</td><td></td></tr></tbody></table><p><code>type</code> 可以是以下的一种：</p><ul><li><code>roundrobin</code>: 带权重的 roundrobin</li><li><code>chash</code>: 一致性哈希</li><li><code>ewma</code>: 选择延迟最小的节点，计算细节参考 <a href="https://en.wikipedia.org/wiki/EWMA_chart" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/EWMA_chart</a></li><li><code>least_conn</code>: 选择 <code>(active_conn + 1) / weight</code> 最小的节点。注意这里的 <code>active connection</code> 概念跟 Nginx 的相同：它是当前正在被请求使用的连接。</li><li>用户自定义的 balancer，需要可以通过 <code>require(&quot;apisix.balancer.your_balancer&quot;)</code> 来加载。</li></ul><p><code>hash_on</code> 比较复杂，这里专门说明下：</p><ol><li>设为 <code>vars</code> 时，<code>key</code> 为必传参数，目前支持的 Nginx 内置变量有 <code>uri, server_name, server_addr, request_uri, remote_port, remote_addr, query_string, host, hostname, arg_***</code>，其中 <code>arg_***</code> 是来自 URL 的请求参数，<a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">Nginx 变量列表</a></li><li>设为 <code>header</code> 时, <code>key</code> 为必传参数，其值为自定义的 header name, 即 &quot;http_<code>key</code>&quot;</li><li>设为 <code>cookie</code> 时, <code>key</code> 为必传参数，其值为自定义的 cookie name，即 &quot;cookie_<code>key</code>&quot;。请注意 cookie name 是<strong>区分大小写字母</strong>的。例如：&quot;cookie_x_foo&quot; 与 &quot;cookie_X_Foo&quot; 表示不同的 <code>cookie</code>。</li><li>设为 <code>consumer</code> 时，<code>key</code> 不需要设置。此时哈希算法采用的 <code>key</code> 为认证通过的 <code>consumer_name</code>。</li><li>如果指定的 <code>hash_on</code> 和 <code>key</code> 获取不到值时，就是用默认值：<code>remote_addr</code>。</li></ol><p><code>tls.client_cert/key</code> 可以用来跟上游进行 mTLS 通信。
他们的格式和 SSL 对象的 <code>cert</code> 和 <code>key</code> 一样。
这个特性需要 APISIX 运行于 <a href="/zh/docs/apisix/how-to-build#%E6%AD%A5%E9%AA%A46%EF%BC%9A%E4%B8%BA-Apache-APISIX-%E6%9E%84%E5%BB%BA-OpenResty">APISIX-OpenResty</a>。</p><p><code>keepalive_pool</code> 允许 upstream 对象有自己单独的连接池。
它下属的字段，比如 <code>requests</code>，可以用了配置上游连接保持的参数。
这个特性需要 APISIX 运行于 <a href="/zh/docs/apisix/how-to-build#%E6%AD%A5%E9%AA%A46%EF%BC%9A%E4%B8%BA-Apache-APISIX-%E6%9E%84%E5%BB%BA-OpenResty">APISIX-OpenResty</a>。</p><p><strong>upstream 对象 json 配置内容：</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">,                  </span><span class="token comment" style="color:#999988;font-style:italic"># id</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;retries&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,               </span><span class="token comment" style="color:#999988;font-style:italic"># 请求重试次数</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;timeout&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 设置连接、发送消息、接收消息的超时时间</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;connect&quot;</span><span class="token plain">:15,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;send&quot;</span><span class="token plain">:15,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token plain">:15,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;nodes&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;host:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,  </span><span class="token comment" style="color:#999988;font-style:italic"># 上游机器地址列表，格式为`地址 + 端口`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 等价于 &quot;nodes&quot;: [ {&quot;host&quot;:&quot;host&quot;, &quot;port&quot;:80, &quot;weight&quot;: 100} ],</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;roundrobin&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;checks&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,               </span><span class="token comment" style="color:#999988;font-style:italic"># 配置健康检查的参数</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;hash_on&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;upstream-xxx&quot;</span><span class="token plain">,     </span><span class="token comment" style="color:#999988;font-style:italic"># upstream 名称</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;desc&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token plain">,      </span><span class="token comment" style="color:#999988;font-style:italic"># upstream 描述</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;scheme&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http&quot;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 跟上游通信时使用的 scheme，默认是 `http`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>具体示例：</strong></p><p>示例一：创建一个 upstream 并对 <code>nodes</code> 的数据做修改</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建一个 upstream</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/upstreams/100  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -i -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;type&quot;:&quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;nodes&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;39.97.63.215:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Upstream 增加一个 node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/upstreams/100 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;39.97.63.216:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Upstream 更新一个 node 的权重</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/upstreams/100 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;39.97.63.216:80&quot;: 10</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.215:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 给 Upstream 删除一个 node</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/upstreams/100 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;39.97.63.215:80&quot;: null</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，nodes 将更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.216:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 替换 Upstream 的  nodes</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/upstreams/100/nodes -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PATCH -i -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;39.97.63.200:80&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">执行成功后，nodes 将不保留原来的数据，整个更新为：</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;39.97.63.200:80&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>示例二：将客户端请求代理到上游 <code>https</code> 服务</p><p>1、创建 route 并配置 upstream 的 scheme 为 <code>https</code>。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/get&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;scheme&quot;: &quot;https&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;httpbin.org:443&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>执行成功后，请求与上游通信时的 scheme 将为 <code>https</code>。</p><p>2、 发送请求进行测试。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/get</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;args&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;headers&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Accept&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*/*&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Host&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;curl/7.29.0&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;X-Amzn-Trace-Id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Root=1-6058324a-0e898a7f04a5e95b526bb183&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;X-Forwarded-Host&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;origin&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;url&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://127.0.0.1/get&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>请求成功，表示代理上游 <code>https</code> 生效了。</p><p><strong>注意：</strong></p><p>节点可以配置自己的优先级。只有在高优先级的节点不可用或者尝试过，才会访问一个低优先级的节点。</p><p>由于默认的优先级是 0，我们可以给一些节点配置负数的优先级来作为备份。
举个例子:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;uri&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;upstream&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;roundrobin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;nodes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;host&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;port&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1980</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;weight&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;host&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;port&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1980</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;weight&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;priority&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;checks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;active&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;http_path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/status&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;healthy&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;interval&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;successes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;unhealthy&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;interval&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token property" style="color:#36acaa">&quot;http_failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>节点 <code>127.0.0.2</code> 只有在 <code>127.0.0.1</code> 不可用或者尝试过之后才会被访问。
所以它是 <code>127.0.0.1</code> 的备份。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="应答参数-3"></a>应答参数<a class="hash-link" href="#应答参数-3" title="Direct link to heading">#</a></h3><p>目前是直接返回与 etcd 交互后的结果。</p><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="ssl"></a>SSL<a class="hash-link" href="#ssl" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/ssl/{id}</p><p><em>说明</em>：SSL.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-4"></a>请求方法<a class="hash-link" href="#请求方法-4" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/ssl</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/ssl/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/ssl/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>POST</td><td>/apisix/admin/ssl</td><td>{...}</td><td>创建资源，id 由后台服务自动生成</td></tr><tr><td>DELETE</td><td>/apisix/admin/ssl/{id}</td><td>无</td><td>删除资源</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-4"></a>body 请求参数<a class="hash-link" href="#body-请求参数-4" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>cert</td><td>必需</td><td>证书</td><td>https 证书</td><td></td></tr><tr><td>key</td><td>必需</td><td>私钥</td><td>https 证书私钥</td><td></td></tr><tr><td>certs</td><td>可选</td><td>证书字符串数组</td><td>当你想给同一个域名配置多个证书时，除了第一个证书需要通过 cert 传递外，剩下的证书可以通过该参数传递上来</td><td></td></tr><tr><td>keys</td><td>可选</td><td>私钥字符串数组</td><td>certs 对应的证书私钥，注意要跟 certs 一一对应</td><td></td></tr><tr><td>client.ca</td><td>可选</td><td>证书</td><td>设置将用于客户端证书校验的 CA 证书。该特性需要 OpenResty 1.19+</td><td></td></tr><tr><td>client.depth</td><td>可选</td><td>辅助</td><td>设置客户端证书校验的深度，默认为 1。该特性需要 OpenResty 1.19+</td><td></td></tr><tr><td>snis</td><td>必需</td><td>匹配规则</td><td>非空数组形式，可以匹配多个 SNI</td><td></td></tr><tr><td>labels</td><td>可选</td><td>匹配规则</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>status</td><td>可选</td><td>辅助</td><td>是否启用此 SSL, 缺省 <code>1</code>。</td><td><code>1</code> 表示启用，<code>0</code> 表示禁用</td></tr></tbody></table><p>ssl 对象 json 配置内容：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">,          </span><span class="token comment" style="color:#999988;font-style:italic"># id</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;cert&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cert&quot;</span><span class="token plain">,     </span><span class="token comment" style="color:#999988;font-style:italic"># 证书</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token plain">,       </span><span class="token comment" style="color:#999988;font-style:italic"># 私钥</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;snis&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;t.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># HTTPS 握手时客户端发送的 SNI</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>更多的配置示例见 <a href="/zh/docs/apisix/certificate">证书</a>。</p><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="global-rule"></a>Global Rule<a class="hash-link" href="#global-rule" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/global_rules/{id}</p><p><em>说明</em>：设置全局运行的插件。这一类插件在所有路由级别的插件之前优先运行。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-5"></a>请求方法<a class="hash-link" href="#请求方法-5" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/global_rules</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/global_rules/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/global_rules/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>DELETE</td><td>/apisix/admin/global_rules/{id}</td><td>无</td><td>删除资源</td></tr><tr><td>PATCH</td><td>/apisix/admin/global_rules/{id}</td><td>{...}</td><td>标准 PATCH ，修改已有 Global Rule 的部分属性，其他不涉及的属性会原样保留；如果你要删除某个属性，将该属性的值设置为 null 即可删除；特别地，当需要修改属性的值为数组时，该属性将全量更新</td></tr><tr><td>PATCH</td><td>/apisix/admin/global_rules/{id}/{path}</td><td>{...}</td><td>SubPath PATCH，通过 {path} 指定 Global Rule 要更新的属性，全量更新该属性的数据，其他不涉及的属性会原样保留。</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-5"></a>body 请求参数<a class="hash-link" href="#body-请求参数-5" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>plugins</td><td>必需</td><td>Plugin</td><td>详见 <a href="/zh/docs/apisix/architecture-design/plugin">Plugin</a></td><td></td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr></tbody></table><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="plugin-config"></a>Plugin Config<a class="hash-link" href="#plugin-config" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/plugin_configs/{id}</p><p><em>说明</em>：配置一组可以在路由间复用的插件。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-6"></a>请求方法<a class="hash-link" href="#请求方法-6" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/plugin_configs</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/plugin_configs/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/plugin_configs/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>DELETE</td><td>/apisix/admin/plugin_configs/{id}</td><td>无</td><td>删除资源</td></tr><tr><td>PATCH</td><td>/apisix/admin/plugin_configs/{id}</td><td>{...}</td><td>标准 PATCH ，修改已有 Plugin Config 的部分属性，其他不涉及的属性会原样保留；如果你要删除某个属性，将该属性的值设置为 null 即可删除；特别地，当需要修改属性的值为数组时，该属性将全量更新</td></tr><tr><td>PATCH</td><td>/apisix/admin/plugin_configs/{id}/{path}</td><td>{...}</td><td>SubPath PATCH，通过 {path} 指定 Plugin Config 要更新的属性，全量更新该属性的数据，其他不涉及的属性会原样保留。</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-6"></a>body 请求参数<a class="hash-link" href="#body-请求参数-6" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>plugins</td><td>必需</td><td>Plugin</td><td>详见 <a href="/zh/docs/apisix/architecture-design/plugin">Plugin</a></td><td></td></tr><tr><td>desc</td><td>可选</td><td>辅助</td><td>标识描述、使用场景等</td><td>customer xxxx</td></tr><tr><td>labels</td><td>可选</td><td>辅助</td><td>标识附加属性的键值对</td><td>{&quot;version&quot;:&quot;v2&quot;,&quot;build&quot;:&quot;16&quot;,&quot;env&quot;:&quot;production&quot;}</td></tr><tr><td>create_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr><tr><td>update_time</td><td>可选</td><td>辅助</td><td>单位为秒的 epoch 时间戳，如果不指定则自动创建</td><td>1602883670</td></tr></tbody></table><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="plugin-metadata"></a>Plugin Metadata<a class="hash-link" href="#plugin-metadata" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/plugin_metadata/{plugin_name}</p><p><em>说明</em>: 插件元数据。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-7"></a>请求方法<a class="hash-link" href="#请求方法-7" title="Direct link to heading">#</a></h3><table><thead><tr><th>Method</th><th>请求 URI</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/plugin_metadata/{plugin_name}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/plugin_metadata/{plugin_name}</td><td>{...}</td><td>根据 plugin name 创建资源</td></tr><tr><td>DELETE</td><td>/apisix/admin/plugin_metadata/{plugin_name}</td><td>无</td><td>删除资源</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-7"></a>body 请求参数<a class="hash-link" href="#body-请求参数-7" title="Direct link to heading">#</a></h3><p>一个根据插件 ({plugin_name}) 的 <code>metadata_schema</code> 定义的数据结构的 json object 。</p><p>例子:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/plugin_metadata/example-plugin  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -i -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;skey&quot;: &quot;val&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;ikey&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Thu, </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">2019</span><span class="token plain"> 04:19:34 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="plugin"></a>Plugin<a class="hash-link" href="#plugin" title="Direct link to heading">#</a></h2><p><em>地址</em>：/apisix/admin/plugins/{plugin_name}</p><p><em>说明</em>:  插件</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-8"></a>请求方法<a class="hash-link" href="#请求方法-8" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字       </th><th>请求  uri</th><th>请求  body</th><th>说明         </th></tr></thead><tbody><tr><td>GET      </td><td>/apisix/admin/plugins/list</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET      </td><td>/apisix/admin/plugins/{plugin_name}</td><td>无</td><td>获取资源</td></tr><tr><td>GET</td><td>/apisix/admin/plugins?all=true</td><td>无</td><td>获取所有插件的所有属性</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-8"></a>body 请求参数<a class="hash-link" href="#body-请求参数-8" title="Direct link to heading">#</a></h3><p>获取插件  ({plugin_name})  数据结构的  json object 。</p><p>例子:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://127.0.0.1:9080/apisix/admin/plugins/list&quot;</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;zipkin&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;request-id&quot;</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://127.0.0.1:9080/apisix/admin/plugins/key-auth&quot;</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;properties&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;disable&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;boolean&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;additionalProperties&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>地址</em>：/apisix/admin/plugins?all=true</p><p><em>说明</em>: 所有插件的所有属性，每个插件包括 <code>name</code>, <code>priority</code>, <code>type</code>, <code>schema</code>, <code>consumer_schema</code> 和 <code>version</code>。</p><p>默认情况下，这个接口只返回 http 插件。如果你需要 stream 插件，需要用 <code>/apisix/admin/plugins?all=true&amp;subsystem=stream</code>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-9"></a>请求方法<a class="hash-link" href="#请求方法-9" title="Direct link to heading">#</a></h3><table><thead><tr><th>Method</th><th>请求 URI</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/plugins?all=true</td><td>无</td><td>获取资源</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求参数"></a>请求参数<a class="hash-link" href="#请求参数" title="Direct link to heading">#</a></h3><table><thead><tr><th>名称</th><th>说明</th><th>默认</th></tr></thead><tbody><tr><td>subsystem</td><td>插件所属的子系统</td><td>http</td></tr></tbody></table><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="stream-route"></a>Stream Route<a class="hash-link" href="#stream-route" title="Direct link to heading">#</a></h2><p><em>API</em>：/apisix/admin/stream_routes/{id}</p><p><em>Description</em>：Stream Route 是用于 TCP/UDP 动态代理的路由。参见 <a href="/zh/docs/apisix/stream-proxy">TCP/UDP 动态代理</a> 一节.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="请求方法-10"></a>请求方法<a class="hash-link" href="#请求方法-10" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>请求 uri</th><th>请求 body</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>/apisix/admin/stream_routes</td><td>无</td><td>获取资源列表</td></tr><tr><td>GET</td><td>/apisix/admin/stream_routes/{id}</td><td>无</td><td>获取资源</td></tr><tr><td>PUT</td><td>/apisix/admin/stream_routes/{id}</td><td>{...}</td><td>根据 id 创建资源</td></tr><tr><td>POST</td><td>/apisix/admin/stream_routes</td><td>{...}</td><td>创建资源，id 由后台服务自动生成</td></tr><tr><td>DELETE</td><td>/apisix/admin/stream_routes/{id}</td><td>无</td><td>删除资源</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="body-请求参数-9"></a>body 请求参数<a class="hash-link" href="#body-请求参数-9" title="Direct link to heading">#</a></h3><table><thead><tr><th>名字</th><th>可选项</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>remote_addr</td><td>可选</td><td>IP/CIDR</td><td>客户端 IP 地址</td><td>&quot;127.0.0.1/32&quot; 或 &quot;127.0.0.1&quot;</td></tr><tr><td>server_addr</td><td>可选</td><td>IP/CIDR</td><td>服务端 IP 地址</td><td>&quot;127.0.0.1/32&quot; 或 &quot;127.0.0.1&quot;</td></tr><tr><td>server_port</td><td>可选</td><td>整数</td><td>服务端端口</td><td>9090</td></tr><tr><td>sni</td><td>可选</td><td>Host</td><td>服务器名称指示</td><td>&quot;test.com&quot;</td></tr><tr><td>upstream</td><td>可选</td><td>Upstream</td><td>启用的 Upstream 配置，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr><tr><td>upstream_id</td><td>可选</td><td>Upstream</td><td>启用的 upstream id，详见 <a href="/zh/docs/apisix/architecture-design/upstream">Upstream</a></td><td></td></tr></tbody></table><p><a href="#%E7%9B%AE%E5%BD%95">Back to TOC</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/apisix/edit/release/2.11/docs/zh/latest/admin-api.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/docs/apisix/plugins/mqtt-proxy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« mqtt-proxy</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/docs/apisix/control-api"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Control API »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目录" class="table-of-contents__link">目录</a></li><li><a href="#description" class="table-of-contents__link">Description</a></li><li><a href="#route" class="table-of-contents__link">Route</a><ul><li><a href="#请求方法" class="table-of-contents__link">请求方法</a></li><li><a href="#url-请求参数" class="table-of-contents__link">URL 请求参数</a></li><li><a href="#body-请求参数" class="table-of-contents__link">body 请求参数</a></li><li><a href="#应答参数" class="table-of-contents__link">应答参数</a></li></ul></li><li><a href="#service" class="table-of-contents__link">Service</a><ul><li><a href="#请求方法-1" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-1" class="table-of-contents__link">body 请求参数</a></li><li><a href="#应答参数-1" class="table-of-contents__link">应答参数</a></li></ul></li><li><a href="#consumer" class="table-of-contents__link">Consumer</a><ul><li><a href="#请求方法-2" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-2" class="table-of-contents__link">body 请求参数</a></li><li><a href="#应答参数-2" class="table-of-contents__link">应答参数</a></li></ul></li><li><a href="#upstream" class="table-of-contents__link">Upstream</a><ul><li><a href="#请求方法-3" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-3" class="table-of-contents__link">body 请求参数</a></li><li><a href="#应答参数-3" class="table-of-contents__link">应答参数</a></li></ul></li><li><a href="#ssl" class="table-of-contents__link">SSL</a><ul><li><a href="#请求方法-4" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-4" class="table-of-contents__link">body 请求参数</a></li></ul></li><li><a href="#global-rule" class="table-of-contents__link">Global Rule</a><ul><li><a href="#请求方法-5" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-5" class="table-of-contents__link">body 请求参数</a></li></ul></li><li><a href="#plugin-config" class="table-of-contents__link">Plugin Config</a><ul><li><a href="#请求方法-6" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-6" class="table-of-contents__link">body 请求参数</a></li></ul></li><li><a href="#plugin-metadata" class="table-of-contents__link">Plugin Metadata</a><ul><li><a href="#请求方法-7" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-7" class="table-of-contents__link">body 请求参数</a></li></ul></li><li><a href="#plugin" class="table-of-contents__link">Plugin</a><ul><li><a href="#请求方法-8" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-8" class="table-of-contents__link">body 请求参数</a></li><li><a href="#请求方法-9" class="table-of-contents__link">请求方法</a></li><li><a href="#请求参数" class="table-of-contents__link">请求参数</a></li></ul></li><li><a href="#stream-route" class="table-of-contents__link">Stream Route</a><ul><li><a href="#请求方法-10" class="table-of-contents__link">请求方法</a></li><li><a href="#body-请求参数-9" class="table-of-contents__link">body 请求参数</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/zh/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/zh/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX®, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.96d5d87d.js"></script>
<script src="/zh/assets/js/main.3d0d5e50.js"></script>
</body>
</html>