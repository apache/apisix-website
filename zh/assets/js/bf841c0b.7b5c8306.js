"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[85456],{35318:(e,t,n)=>{n.d(t,{Zo:()=>g,kt:()=>u});var r=n(27378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),c=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},g=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),m=c(n),u=a,h=m["".concat(i,".").concat(u)]||m[u]||s[u]||o;return n?r.createElement(h,p(p({ref:t},g),{},{components:n})):r.createElement(h,p({ref:t},g))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,p=new Array(o);p[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,p[1]=l;for(var c=2;c<o;c++)p[c]=n[c];return r.createElement.apply(null,p)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},71250:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>p,default:()=>s,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=n(25773),a=(n(27378),n(35318));const o={title:"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406",authors:[{name:"\u5e05\u8fdb\u8d85",title:"Author",url:"https://github.com/shuaijinchao",image_url:"https://avatars.githubusercontent.com/u/8529452?v=4"},{name:"\u66fe\u5955\u9716",title:"Technical Writer",url:"https://github.com/yzeng25",image_url:"https://avatars.githubusercontent.com/u/36651058?v=4"}],keywords:["Apache APISIX","gRPC","API \u7f51\u5173","Ecosystem"],description:"\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\u3002\u672c\u6587\u5c06\u4ecb\u7ecd gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u7684\u5177\u4f53\u4f7f\u7528\u6b65\u9aa4\u53ca\u7ec6\u8282\u3002",tags:["Ecosystem","Plugins"]},p=void 0,l={permalink:"/zh/blog/2022/01/25/apisix-grpc-web-integration",source:"@site/blog/2022/01/25/apisix-grpc-web-integration.md",title:"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406",description:"\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\u3002\u672c\u6587\u5c06\u4ecb\u7ecd gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u7684\u5177\u4f53\u4f7f\u7528\u6b65\u9aa4\u53ca\u7ec6\u8282\u3002",date:"2022-01-25T00:00:00.000Z",formattedDate:"2022\u5e741\u670825\u65e5",tags:[{label:"Ecosystem",permalink:"/zh/blog/tags/ecosystem"},{label:"Plugins",permalink:"/zh/blog/tags/plugins"}],readingTime:7.89,truncated:!0,authors:[{name:"\u5e05\u8fdb\u8d85",title:"Author",url:"https://github.com/shuaijinchao",image_url:"https://avatars.githubusercontent.com/u/8529452?v=4",imageURL:"https://avatars.githubusercontent.com/u/8529452?v=4"},{name:"\u66fe\u5955\u9716",title:"Technical Writer",url:"https://github.com/yzeng25",image_url:"https://avatars.githubusercontent.com/u/36651058?v=4",imageURL:"https://avatars.githubusercontent.com/u/36651058?v=4"}],prevItem:{title:"\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9",permalink:"/zh/blog/2022/01/26/apisix-integrate-forward-auth-plugin"},nextItem:{title:"Apache APISIX 2.12.0 \u6b63\u5f0f\u53d1\u5e03",permalink:"/zh/blog/2022/01/25/release-apache-apisix-2.12"}},i={authorsImageUrls:[void 0,void 0]},c=[{value:"gRPC Web \u80cc\u666f\u4ecb\u7ecd",id:"grpc-web-\u80cc\u666f\u4ecb\u7ecd",children:[],level:2},{value:"Apache APISIX gRPC Web Proxy",id:"apache-apisix-grpc-web-proxy",children:[],level:2},{value:"\u914d\u7f6e Protocol Buffer",id:"\u914d\u7f6e-protocol-buffer",children:[],level:2},{value:"\u914d\u7f6e\u670d\u52a1\u7aef\u7a0b\u5e8f",id:"\u914d\u7f6e\u670d\u52a1\u7aef\u7a0b\u5e8f",children:[],level:2},{value:"\u914d\u7f6e\u5ba2\u6237\u7aef\u7a0b\u5e8f",id:"\u914d\u7f6e\u5ba2\u6237\u7aef\u7a0b\u5e8f",children:[],level:2},{value:"\u914d\u7f6e Apache APISIX",id:"\u914d\u7f6e-apache-apisix",children:[],level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[],level:2}],g={toc:c};function s(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Apache APISIX \u5df2\u7ecf\u652f\u6301\u4e86 gRPC \u534f\u8bae\u4ee3\u7406\uff0c\u4ee5\u53ca\u901a\u8fc7 gRPC Transcode \u63d2\u4ef6\u652f\u6301\u4e86 HTTP(s) \u5230 gRPC Server \u7684\u4ee3\u7406\u3002\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\uff1a\u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u3002")),(0,a.kt)("h2",{id:"grpc-web-\u80cc\u666f\u4ecb\u7ecd"},"gRPC Web \u80cc\u666f\u4ecb\u7ecd"),(0,a.kt)("p",null,"gRPC \u6700\u521d\u7531\u8c37\u6b4c\u5f00\u53d1\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e HTTP/2 \u5b9e\u73b0\u7684\u9ad8\u6027\u80fd\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u6846\u67b6\u3002\u4f46\u7531\u4e8e\u6d4f\u89c8\u5668\u6ca1\u6709\u76f4\u63a5\u66b4\u9732 HTTP/2\uff0c\u6240\u4ee5 Web \u5e94\u7528\u7a0b\u5e8f\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 gRPC\u3002gRPC Web \u662f\u4e00\u4e2a\u6807\u51c6\u5316\u534f\u8bae\uff0c\u5b83\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002"),(0,a.kt)("p",null,"\u7b2c\u4e00\u4e2a gRPC-web \u5b9e\u73b0\u662f\u5728 2018 \u5e74\u4f5c\u4e3a\u4e00\u4e2a JavaScript \u5e93\u53d1\u5e03\u7684\uff0cWeb \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5b83\u76f4\u63a5\u4e0e gRPC \u670d\u52a1\u901a\u4fe1\u3002\u5176\u539f\u7406\u662f\u521b\u5efa\u4e0e HTTP/1.1 \u548c HTTP/2 \u517c\u5bb9\u7684\u7aef\u5230\u7aef gRPC \u7ba1\u9053\uff0c\u7136\u540e\u6d4f\u89c8\u5668\u53d1\u9001\u5e38\u89c4\u7684 HTTP \u8bf7\u6c42\uff0c\u4f4d\u4e8e\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684 gRPC-Web \u4ee3\u7406\u5bf9\u8bf7\u6c42\u548c\u54cd\u5e94\u8fdb\u884c\u8f6c\u6362\u3002\u4e0e gRPC \u7c7b\u4f3c\uff0cgRPC Web \u5728 Web \u5ba2\u6237\u7aef\u548c\u540e\u7aef gRPC \u670d\u52a1\u4e4b\u95f4\u4f7f\u7528\u9884\u5b9a\u4e49\u7684\u5951\u7ea6\u3002Protocol Buffers \u88ab\u7528\u6765\u5e8f\u5217\u5316\u548c\u7f16\u7801\u6d88\u606f\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1643099754071-1f5c3c68-f2bc-4746-95f5-cc083ace554b.png",alt:"gRPC-web \u5de5\u4f5c\u539f\u7406"})),(0,a.kt)("p",null,"\u6709\u4e86 gRPC Web\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u6216 Node \u5ba2\u6237\u7aef\u76f4\u63a5\u8c03\u7528\u540e\u7aef\u7684 gRPC \u5e94\u7528\u7a0b\u5e8f\u3002\u4e0d\u8fc7\uff0c\u5728\u6d4f\u89c8\u5668\u7aef\u4f7f\u7528 gRPC-Web \u8c03\u7528 gRPC \u670d\u52a1\u4e5f\u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u652f\u6301\u5ba2\u6237\u7aef\u6d41\u548c\u53cc\u5411\u6d41\u8c03\u7528\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u8de8\u57df\u8c03\u7528 gRPC \u670d\u52a1\u9700\u8981\u5728\u670d\u52a1\u5668\u7aef\u914d\u7f6e CORS\u3002"),(0,a.kt)("li",{parentName:"ul"},"gRPC \u670d\u52a1\u5668\u7aef\u5fc5\u987b\u914d\u7f6e\u4e3a\u652f\u6301 gRPC-Web\uff0c\u6216\u8005\u5fc5\u987b\u6709\u7b2c\u4e09\u65b9\u670d\u52a1\u4ee3\u7406\u5728\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u5bf9\u8c03\u7528\u8fdb\u884c\u8f6c\u6362\u3002")),(0,a.kt)("h2",{id:"apache-apisix-grpc-web-proxy"},"Apache APISIX gRPC Web Proxy"),(0,a.kt)("p",null,"Apache APISIX \u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u652f\u6301 gRPC Web \u534f\u8bae\u7684\u4ee3\u7406\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u63d2\u4ef6\u4e2d\u5b8c\u6210\u4e86 gRPC Web\u4e0e gRPC Server \u901a\u8baf\u65f6\u7684\u534f\u8bae\u8f6c\u6362\u53ca\u6570\u636e\u7f16\u89e3\u7801\u5de5\u4f5c\uff0c\u5176\u901a\u8baf\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,"gRPC Web Client -> Apache APISIX\uff08protocol conversion & data codec\uff09-> gRPC server"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u901a\u8fc7\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\u5411\u5927\u5bb6\u6f14\u793a\u600e\u6837\u6784\u5efa\u4e00\u4e2a gRPC Web \u5ba2\u6237\u7aef\uff0c\u5e76\u901a\u8fc7 Apache APISIX \u8fdb\u884c gRPC Web \u8bf7\u6c42\u7684\u4ee3\u7406\u3002\u5728\u4ee5\u4e0b\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f1a\u5c06 Go \u4f5c\u4e3a gRPC Server \u670d\u52a1\u7aef\u5904\u7406\u7a0b\u5e8f\uff0cNode \u4f5c\u4e3a gRPC Web \u5ba2\u6237\u7aef\u8bf7\u6c42\u7a0b\u5e8f\u3002"),(0,a.kt)("h2",{id:"\u914d\u7f6e-protocol-buffer"},"\u914d\u7f6e Protocol Buffer"),(0,a.kt)("p",null,"\u9996\u5148\u8fdb\u884c\u7b2c\u4e00\u6b65\uff0c\u5b89\u88c5 Protocol Buffer \u7f16\u8bd1\u5668\u53ca\u76f8\u5173\u63d2\u4ef6\u3002"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5 ",(0,a.kt)("inlineCode",{parentName:"p"},"protoc")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"proto-grpc-*")," \u63d2\u4ef6\u3002"),(0,a.kt)("p",{parentName:"li"},"\u5728\u7f16\u5199\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7a0b\u5e8f\u524d\uff0c\u9700\u8981\u5728\u7cfb\u7edf\u4e2d\u5b89\u88c5 Protocol Buffer \u7f16\u8bd1\u5668 ",(0,a.kt)("inlineCode",{parentName:"p"},"protoc")," \u548c \u7528\u4e8e\u751f\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},".proto")," \u7684 Go\u3001JavaScript\u3001gRPC Web \u63a5\u53e3\u4ee3\u7801\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"protoc-gen-go")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"protoc-gen-grpc-web")," \u63d2\u4ef6\u3002"),(0,a.kt)("p",{parentName:"li"},"\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u811a\u672c\uff0c\u5b89\u88c5\u4e0a\u8ff0\u7ec4\u4ef6\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n set -ex\n\n PROTOBUF_VERSION="3.19.0"\n wget https://github.com/protocolbuffers/protobuf/releases/download/v${PROTOBUF_VERSION}/protoc-${PROTOBUF_VERSION}-linux-x86_64.zip\n unzip protoc-${PROTOBUF_VERSION}-linux-x86_64.zip\n mv bin/protoc /usr/local/bin/protoc\n mv include/google /usr/local/include/\n chmod +x /usr/local/bin/protoc\n\n PROTO_GO_PLUGIN_VER="1.2.0"\n wget https://github.com/grpc/grpc-go/releases/download/cmd/protoc-gen-go-grpc/v${PROTO_GO_PLUGIN_VER}/protoc-gen-go-grpc.v${PROTO_GO_PLUGIN_VER}.linux.amd64.tar.gz\n tar -zxvf protoc-gen-go-grpc.v${PROTO_GO_PLUGIN_VER}.linux.amd64.tar.gz\n mv protoc-gen-go-grpc /usr/local/bin/protoc-gen-go\n chmod +x /usr/local/bin/protoc-gen-go\n\n PROTO_JS_PLUGIN_VER="1.3.0"\n wget https://github.com/grpc/grpc-web/releases/download/${PROTO_JS_PLUGIN_VER}/protoc-gen-grpc-web-${PROTO_JS_PLUGIN_VER}-linux-x86_64\n mv protoc-gen-grpc-web-${PROTO_JS_PLUGIN_VER}-linux-x86_64 /usr/local/bin/protoc-gen-grpc-web\n chmod +x /usr/local/bin/protoc-gen-grpc-web\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"SayHello")," \u793a\u4f8b ",(0,a.kt)("inlineCode",{parentName:"p"},"proto")," \u6587\u4ef6\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},' // a6/echo.proto\n\n syntax = "proto3";\n\n package a6;\n\n option go_package = "./;a6";\n\n message EchoRequest {\n string message = 1;\n }\n\n message EchoResponse {\n string message = 1;\n }\n\n service EchoService {\n rpc Echo(EchoRequest) returns (EchoResponse);\n }\n')))),(0,a.kt)("h2",{id:"\u914d\u7f6e\u670d\u52a1\u7aef\u7a0b\u5e8f"},"\u914d\u7f6e\u670d\u52a1\u7aef\u7a0b\u5e8f"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u751f\u6210\u670d\u52a1\u7aef Go \u539f\u59cb\u6d88\u606f\u548c\u670d\u52a1/\u5ba2\u6237\u7aef\u5b58\u6839\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"protoc -I./a6 echo.proto --go_out=plugins=grpc:./a6\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u670d\u52a1\u7aef\u5904\u7406\u7a0b\u5e8f\u63a5\u53e3\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// a6/echo.impl.go\n\n package a6\n\n import (\n "errors"\n "golang.org/x/net/context"\n )\n\n type EchoServiceImpl struct {\n }\n\n func (esi *EchoServiceImpl) Echo(ctx context.Context, in *EchoRequest) (*EchoResponse, error) {\n if len(in.Message) <= 0 {\n     return nil, errors.New("message invalid")\n }\n return &EchoResponse{Message: "response: " + in.Message}, nil\n }\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u670d\u52a1\u7aef\u7a0b\u5e8f\u8fd0\u884c\u5165\u53e3\u6587\u4ef6\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// server.go\n package main\n\n import (\n "fmt"\n "log"\n "net"\n\n "apisix.apache.org/example/a6"\n "google.golang.org/grpc"\n )\n\n func main() {\n lis, err := net.Listen("tcp", fmt.Sprintf(":%d", 50001))\n if err != nil {\n     log.Fatalf("failed to listen: %v", err)\n }\n\n grpcServer := grpc.NewServer()\n a6.RegisterEchoServiceServer(grpcServer, &a6.EchoServiceImpl{})\n\n if err = grpcServer.Serve(lis); err != nil {\n     log.Fatalf("failed to serve: %s", err)\n }\n }\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u7f16\u8bd1\u5e76\u542f\u52a8\u670d\u52a1\u7aef\u670d\u52a1\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"go build -o grpc-server server.go\n./grpc-server\n")))),(0,a.kt)("h2",{id:"\u914d\u7f6e\u5ba2\u6237\u7aef\u7a0b\u5e8f"},"\u914d\u7f6e\u5ba2\u6237\u7aef\u7a0b\u5e8f"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u751f\u6210\u5ba2\u6237\u7aef ",(0,a.kt)("inlineCode",{parentName:"p"},"proto")," \u4ee3\u7801"),(0,a.kt)("p",{parentName:"li"}," \u751f\u6210\u5ba2\u6237\u7aef JavaScript \u539f\u59cb\u6d88\u606f\u3001\u670d\u52a1/\u5ba2\u6237\u7aef\u5b58\u6839\u548c gRPC Web \u7684 JavaScript \u7684\u63a5\u53e3\u4ee3\u7801\u3002\ngRPC Web \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"proto")," \u63d2\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4ee3\u7801\u751f\u6210\u6a21\u5f0f\uff1a"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"mode=grpcwebtext\uff1a \u9ed8\u8ba4\u751f\u6210\u7684\u4ee3\u7801\u4ee5 grpc-web-text \u683c\u5f0f\u53d1\u9001 payload")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Content-type\uff1a application/grpc-web-text"),(0,a.kt)("li",{parentName:"ul"},"Payload \u4f7f\u7528 base64 \u7f16\u7801"),(0,a.kt)("li",{parentName:"ul"},"\u652f\u6301\u4e00\u5143\u548c\u670d\u52a1\u5668\u6d41\u5f0f\u8c03\u7528")),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"mode=grpcweb\uff1a\u4ee5\u4e8c\u8fdb\u5236 protobuf \u683c\u5f0f\u53d1\u9001 payload")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Content-type\uff1a application/grpc-web+proto"),(0,a.kt)("li",{parentName:"ul"},"Payload \u91c7\u7528\u4e8c\u8fdb\u5236 protobuf \u683c\u5f0f"),(0,a.kt)("li",{parentName:"ul"},"\u76ee\u524d\u4ec5\u652f\u6301\u4e00\u5143\u8c03\u7528")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ protoc -I=./a6 echo.proto --js_out=import_style=commonjs:./a6 --grpc-web_out=import_style=commonjs,mode=grpcweb:./a6\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5\u5ba2\u6237\u7aef\u4f9d\u8d56\u5e93"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ npm i grpc-web\n$ npm i google-protobuf\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5ba2\u6237\u7aef\u6267\u884c\u5165\u53e3\u6587\u4ef6"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"// client.js\nconst {EchoRequest} = require('./a6/echo_pb');\nconst {EchoServiceClient} = require('./a6/echo_grpc_web_pb');\n// \u8fde\u63a5\u5230 Apache APISIX \u7684\u5165\u53e3\nlet echoService = new EchoServiceClient('http://127.0.0.1:9080');\n\nlet request = new EchoRequest();\nrequest.setMessage(\"hello\")\n\nechoService.echo(request, {}, function (err, response) {\n    if (err) {\n         console.log(err.code);\n         console.log(err.message);\n     } else {\n         console.log(response.getMessage());\n     }\n });\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u6700\u7ec8\u9879\u76ee\u7ed3\u6784"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ tree .\n \u251c\u2500\u2500 a6\n \u2502   \u251c\u2500\u2500 echo.impl.go\n \u2502   \u251c\u2500\u2500 echo.pb.go\n \u2502   \u251c\u2500\u2500 echo.proto\n \u2502   \u251c\u2500\u2500 echo_grpc_web_pb.js\n \u2502   \u2514\u2500\u2500 echo_pb.js\n \u251c\u2500\u2500 client.js\n \u251c\u2500\u2500 server.go\n \u251c\u2500\u2500 go.mod\n \u251c\u2500\u2500 go.sum\n \u251c\u2500\u2500 package.json\n \u2514\u2500\u2500 package-lock.json\n")))),(0,a.kt)("p",null,"\u5b8c\u6210\u4e0a\u8ff0\u7684\u6b65\u9aa4\u4e4b\u540e\uff0c\u4f60\u5df2\u7ecf\u914d\u7f6e\u4e86\u628a gRPC Server \u7684\u670d\u52a1\u7aef\u7a0b\u5e8f\u548c gRPC Web \u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5e76\u4e14\u542f\u52a8\u4e86\u670d\u52a1\u7aef\u7a0b\u5e8f\uff0c\u5b83\u5c06\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"50001")," \u7aef\u53e3\u63a5\u6536\u8bf7\u6c42\u3002"),(0,a.kt)("h2",{id:"\u914d\u7f6e-apache-apisix"},"\u914d\u7f6e Apache APISIX"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u53ea\u9700\u5728 Apache APISIX \u8def\u7531\u7684\u63d2\u4ef6\u914d\u7f6e\u4e2d\u542f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u63d2\u4ef6\uff0c\u5373\u53ef\u8fdb\u884c gRPC Web \u8bf7\u6c42\u7684\u4ee3\u7406\u3002"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u542f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u4ee3\u7406\u63d2\u4ef6"),(0,a.kt)("p",{parentName:"li"},"\u542f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u4ee3\u7406\u63d2\u4ef6\uff0c\u8def\u7531\u5fc5\u987b\u4f7f\u7528",(0,a.kt)("strong",{parentName:"p"},"\u524d\u7f00\u5339\u914d"),"\u6a21\u5f0f\uff08\u4f8b\u5982\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"/* \u6216 /grpc/example/*"),"\uff09\uff0c \u56e0 gRPC Web \u5ba2\u6237\u7aef\u4f1a\u5728 URI \u4e2d\u4f20\u9012 ",(0,a.kt)("inlineCode",{parentName:"p"},"proto")," \u4e2d\u58f0\u660e\u7684\u5305\u540d\u79f0\u3001\u670d\u52a1\u63a5\u53e3\u540d\u79f0\u3001\u65b9\u6cd5\u540d\u79f0\u7b49\u4fe1\u606f\uff08\u4f8b\u5982\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"/path/a6.EchoService/Echo"),"\uff09\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u4f7f\u7528\u7edd\u5bf9\u5339\u914d\u65f6\u4f1a\u4f7f\u63d2\u4ef6\u65e0\u6cd5\u4ece URI \u4e2d\u63d0\u53d6 ",(0,a.kt)("inlineCode",{parentName:"strong"},"proto")," \u4fe1\u606f"),"\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n {\n     "uri":"/*", // \u524d\u7f00\u5339\u914d\u6a21\u5f0f\n     "plugins":{\n         "grpc-web":{} //\u5f00\u542f gRPC Web \u4ee3\u7406\n     },\n     "upstream":{\n         "scheme":"grpc",\n         "type":"roundrobin",\n         "nodes":{\n             "127.0.0.1:50001":1 // gRPC Server Listen \u5730\u5740\u548c\u7aef\u53e3\n         }\n     }\n }\'\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u9a8c\u8bc1 gRPC Web \u4ee3\u7406\u8bf7\u6c42"),(0,a.kt)("p",{parentName:"li"},"\u901a\u8fc7 Node \u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"client.js")," \u5373\u53ef\u5411 Apache APISIX \u53d1\u9001 gRPC Web \u534f\u8bae\u8bf7\u6c42\u3002\n\u4e0a\u8ff0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u5904\u7406\u903b\u8f91\u5206\u522b\u662f\uff1a\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u6761\u6d88\u606f\u5185\u5bb9\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"hello"),"\uff0c\u670d\u52a1\u7aef\u6536\u5230\u6d88\u606f\u540e\u54cd\u5e94 ",(0,a.kt)("inlineCode",{parentName:"p"},"response: hello"),"\uff0c\u6267\u884c\u7ed3\u679c\u5982\u4e0b\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"$ node client.js\nresponse: hello\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5173\u95ed ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u4ee3\u7406\u63d2\u4ef6"),(0,a.kt)("p",{parentName:"li"},"\u53ea\u9700\u5c06\u8def\u7531\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 grpc-web \u5c5e\u6027\u79fb\u9664\u5373\u53ef\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n {\n     "uri":"/*",\n     "plugins":{\n     },\n     "upstream":{\n         "scheme":"grpc",\n         "type":"roundrobin",\n         "nodes":{\n             "127.0.0.1:50001":1\n         }\n     }\n }\'\n')))),(0,a.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("p",null,"\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"grpc-web")," \u63d2\u4ef6\u8bb2\u89e3\u53ca\u5b9e\u6218\u6848\u4f8b\u3002"),(0,a.kt)("p",null,"\u6b22\u8fce\u968f\u65f6\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/discussions"},"GitHub Discussions")," \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7",(0,a.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/general/join"},"\u90ae\u4ef6\u5217\u8868"),"\u8fdb\u884c\u4ea4\u6d41\u3002"))}s.isMDXComponent=!0}}]);