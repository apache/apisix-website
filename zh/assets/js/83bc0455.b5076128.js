"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[11886],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},p=Object.keys(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),l=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return a.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,p=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=l(t),k=r,h=c["".concat(s,".").concat(k)]||c[k]||m[k]||p;return t?a.createElement(h,i(i({ref:n},u),{},{components:t})):a.createElement(h,i({ref:n},u))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var p=t.length,i=new Array(p);i[0]=c;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var l=2;l<p;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},9220:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>i,default:()=>u,frontMatter:()=>p,metadata:()=>o,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const p={title:"\u7ba1\u7406 API \u6d88\u8d39\u8005",keywords:["API \u7f51\u5173","Apache APISIX","Rate Limit","Consumer","Consumer Group"],description:"This tutorial explains how to manage your single or multiple API consumers with Apache APISIX."},i=void 0,o={unversionedId:"tutorials/manage-api-consumers",id:"version-3.13/tutorials/manage-api-consumers",isDocsHomePage:!1,title:"\u7ba1\u7406 API \u6d88\u8d39\u8005",description:"This tutorial explains how to manage your single or multiple API consumers with Apache APISIX.",source:"@site/i18n/zh/docusaurus-plugin-content-docs-docs-apisix/version-3.13/tutorials/manage-api-consumers.md",sourceDirName:"tutorials",slug:"/tutorials/manage-api-consumers",permalink:"/zh/docs/apisix/3.13/tutorials/manage-api-consumers",editUrl:"/zh/edit#https://github.com/apache/apisix/edit/release/3.13/docs/zh/latest/tutorials/manage-api-consumers.md",tags:[],version:"3.13",frontMatter:{title:"\u7ba1\u7406 API \u6d88\u8d39\u8005",keywords:["API \u7f51\u5173","Apache APISIX","Rate Limit","Consumer","Consumer Group"],description:"This tutorial explains how to manage your single or multiple API consumers with Apache APISIX."},sidebar:"version-3.13/docs",previous:{title:"Monitor API Health Check with Prometheus",permalink:"/zh/docs/apisix/3.13/tutorials/monitor-api-health-check"},next:{title:"API \u54cd\u5e94\u7f13\u5b58",permalink:"/zh/docs/apisix/3.13/tutorials/cache-api-responses"}},s=[{value:"API \u6d88\u8d39\u8005\uff08API Consumers\uff09",id:"api-\u6d88\u8d39\u8005api-consumers",children:[]},{value:"Apache APISIX \u4e2d\u7684\u6d88\u8d39\u8005\uff08Consumers\uff09",id:"apache-apisix-\u4e2d\u7684\u6d88\u8d39\u8005consumers",children:[]},{value:"Apache APISIX Consumer \u793a\u4f8b",id:"apache-apisix-consumer-\u793a\u4f8b",children:[{value:"\u4e3a\u5355\u4e2a\u6d88\u8d39\u8005\u542f\u7528\u9650\u6d41\uff08Rate Limiting\uff09",id:"\u4e3a\u5355\u4e2a\u6d88\u8d39\u8005\u542f\u7528\u9650\u6d41rate-limiting",children:[]},{value:"\u4e3a\u6d88\u8d39\u8005\u7ec4\u542f\u7528\u9650\u6d41\uff08Rate Limiting for Consumer Groups\uff09",id:"\u4e3a\u6d88\u8d39\u8005\u7ec4\u542f\u7528\u9650\u6d41rate-limiting-for-consumer-groups",children:[]}]},{value:"\u66f4\u591a\u6559\u7a0b",id:"\u66f4\u591a\u6559\u7a0b",children:[]}],l={toc:s};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u672c\u6559\u7a0b\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Apache APISIX \u7ba1\u7406\u5355\u4e2a\u6216\u591a\u4e2a API \u6d88\u8d39\u8005\uff08API Consumers\uff09\u3002"),(0,r.kt)("p",null,"\u5982\u4eca\uff0c",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/API"},"API")," \u4f7f\u5f97\u591a\u4e2a\u7cfb\u7edf\u3001\u5185\u90e8\u670d\u52a1\u4ee5\u53ca\u7b2c\u4e09\u65b9\u5e94\u7528\u80fd\u591f\u8f7b\u677e\u4e14\u5b89\u5168\u5730\u4e92\u8054\u3002API \u6d88\u8d39\u8005\uff08API consumers\uff09\u5bf9\u4e8e API \u63d0\u4f9b\u65b9\u6765\u8bf4\u662f\u6700\u91cd\u8981\u7684\u5229\u76ca\u76f8\u5173\u8005\u4e4b\u4e00\uff0c\u56e0\u4e3a\u4ed6\u4eec\u4e0e API \u53ca\u5f00\u53d1\u8005\u95e8\u6237\u7684\u4ea4\u4e92\u6700\u4e3a\u9891\u7e41\u3002\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u5f00\u6e90 API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/"},"Apache APISIX")," \u6765\u7ba1\u7406\u5355\u4e2a\u6216\u591a\u4e2a API \u6d88\u8d39\u8005\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/11/29/6385b565b4c11.png",alt:"Manage API Consumers"})),(0,r.kt)("h2",{id:"api-\u6d88\u8d39\u8005api-consumers"},"API \u6d88\u8d39\u8005\uff08API Consumers\uff09"),(0,r.kt)("p",null,"API \u6d88\u8d39\u8005\u662f\u6307\u4f7f\u7528\u67d0\u4e2a API \u7684\u7528\u6237\uff0c\u4f46\u4ed6\u4eec\u5e76\u4e0d\u4f1a\u4e13\u95e8\u4e3a\u8be5 API \u5f00\u53d1\u5e94\u7528\u3002\u6362\u53e5\u8bdd\u8bf4\uff0cAPI \u6d88\u8d39\u8005\u5c31\u662f API \u7684\u4f7f\u7528\u8005\u3002\n\u4f8b\u5982\uff0c\u5e02\u573a\u90e8\u95e8\u53ef\u80fd\u4f1a\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://developers.facebook.com/docs/"},"Facebook API")," \u6765\u5206\u6790\u793e\u4ea4\u5a92\u4f53\u4e0a\u5bf9\u7279\u5b9a\u6d3b\u52a8\u7684\u53cd\u9988\uff0c\u4ed6\u4eec\u4f1a\u5728\u9700\u8981\u65f6\u5411\u63d0\u4f9b\u7684 API \u53d1\u9001\u72ec\u7acb\u4e14\u4e0d\u5b9a\u671f\u7684\u8bf7\u6c42\u3002"),(0,r.kt)("p",null,"\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/API_management"},"API \u7ba1\u7406")," \u89e3\u51b3\u65b9\u6848\u9700\u8981\u80fd\u591f\u8bc6\u522b\u8c01\u662f API \u7684\u6d88\u8d39\u8005\uff0c\u4ee5\u4fbf\u9488\u5bf9\u4e0d\u540c\u7684\u6d88\u8d39\u8005\u914d\u7f6e\u4e0d\u540c\u7684\u89c4\u5219\u3002"),(0,r.kt)("h2",{id:"apache-apisix-\u4e2d\u7684\u6d88\u8d39\u8005consumers"},"Apache APISIX \u4e2d\u7684\u6d88\u8d39\u8005\uff08Consumers\uff09"),(0,r.kt)("p",null,"\u5728 Apache APISIX \u4e2d\uff0c",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/terminology/consumer/"},"Consumer \u5bf9\u8c61")," \u662f API \u6d88\u8d39\u8005\u8bbf\u95ee\u901a\u8fc7 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/terminology/api-gateway/"},"API \u7f51\u5173\uff08API Gateway\uff09")," \u53d1\u5e03\u7684 API \u7684\u4e3b\u8981\u65b9\u5f0f\u3002\n\u5f53\u4e0d\u540c\u7684\u6d88\u8d39\u8005\u8bf7\u6c42\u540c\u4e00\u4e2a API\uff0c\u800c\u4f60\u9700\u8981\u9488\u5bf9\u4e0d\u540c\u6d88\u8d39\u8005\u6267\u884c\u4e0d\u540c\u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/terminology/plugin/"},"\u63d2\u4ef6\uff08Plugin\uff09")," \u6216 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/terminology/upstream/"},"\u4e0a\u6e38\uff08Upstream\uff09")," \u914d\u7f6e\u65f6\uff0cConsumer \u6982\u5ff5\u4f1a\u975e\u5e38\u6709\u7528\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7 Apache APISIX API \u7f51\u5173\u53d1\u5e03 API \u540e\uff0c\u53ef\u4ee5\u8f7b\u677e\u4f7f\u7528\u6d88\u8d39\u8005\u5bc6\u94a5\uff08consumer key\uff0c\u4e5f\u79f0\u8ba2\u9605\u5bc6\u94a5 subscription key\uff09\u6765\u4fdd\u62a4 API \u8bbf\u95ee\u3002\n\u9700\u8981\u4f7f\u7528\u5df2\u53d1\u5e03 API \u7684\u5f00\u53d1\u8005\u5fc5\u987b\u5728\u8c03\u7528\u8fd9\u4e9b API \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP")," \u8bf7\u6c42\u4e2d\u5305\u542b\u6709\u6548\u7684\u8ba2\u9605\u5bc6\u94a5\u3002\u82e5\u8ba2\u9605\u5bc6\u94a5\u65e0\u6548\uff0cAPI \u7f51\u5173\u4f1a\u7acb\u5373\u62d2\u7edd\u8bf7\u6c42\uff0c\u800c\u4e0d\u4f1a\u5c06\u5176\u8f6c\u53d1\u5230\u540e\u7aef\u670d\u52a1\u3002"),(0,r.kt)("p",null,"\u6d88\u8d39\u8005\u53ef\u4ee5\u5173\u8054\u4e0d\u540c\u7684\u4f5c\u7528\u8303\u56f4\uff1a\u6309\u63d2\u4ef6\u3001\u6240\u6709 API \u6216\u5355\u4e2a API\u3002\n\u5728 API \u7f51\u5173\u4e2d\uff0c\u7ed3\u5408\u63d2\u4ef6\u4f7f\u7528\u6d88\u8d39\u8005\u5bf9\u8c61\u53ef\u4ee5\u5b9e\u73b0\u591a\u79cd\u573a\u666f\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4e3a\u4e0d\u540c\u6d88\u8d39\u8005\u542f\u7528\u4e0d\u540c\u7684\u8ba4\u8bc1\u65b9\u5f0f\u3002\n\u5f53\u6d88\u8d39\u8005\u5c1d\u8bd5\u901a\u8fc7\u4e0d\u540c\u8ba4\u8bc1\u673a\u5236\uff08\u5982 ",(0,r.kt)("a",{parentName:"li",href:"https://apisix.apache.org/zh/docs/apisix/plugins/key-auth/"},"API key"),"\u3001",(0,r.kt)("a",{parentName:"li",href:"https://apisix.apache.org/zh/docs/apisix/plugins/basic-auth/"},"Basic"),"\u3001\u6216\u57fa\u4e8e ",(0,r.kt)("a",{parentName:"li",href:"https://apisix.apache.org/zh/docs/apisix/plugins/jwt-auth/"},"JWT")," \u7684\u8ba4\u8bc1\uff09\u8bbf\u95ee API \u65f6\uff0c\u8fd9\u79cd\u673a\u5236\u975e\u5e38\u6709\u7528\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u9650\u5236\u7279\u5b9a\u6d88\u8d39\u8005\u5bf9 API \u8d44\u6e90\u7684\u8bbf\u95ee\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6839\u636e\u6d88\u8d39\u8005\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u76f8\u5e94\u7684\u540e\u7aef\u670d\u52a1\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5b9a\u4e49\u6570\u636e\u6d88\u8d39\u7684\u901f\u7387\u9650\u5236\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5206\u6790\u5355\u4e2a\u6d88\u8d39\u8005\u6216\u6d88\u8d39\u8005\u5b50\u96c6\u7684\u6570\u636e\u4f7f\u7528\u60c5\u51b5\u3002")),(0,r.kt)("h2",{id:"apache-apisix-consumer-\u793a\u4f8b"},"Apache APISIX Consumer \u793a\u4f8b"),(0,r.kt)("p",null,"\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u793a\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u7ed3\u5408 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/plugins/key-auth/"},"key-auth")," \u8ba4\u8bc1\u63d2\u4ef6\uff08API Key\uff09\u4e0e ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/plugins/limit-count/"},"limit-count")," \u63d2\u4ef6\uff0c\u4e3a\u5355\u4e2a\u6d88\u8d39\u8005\u6216\u4e00\u7ec4\u6d88\u8d39\u8005\u914d\u7f6e\u9650\u6d41\u7b56\u7565\u3002"),(0,r.kt)("p",null,"\u5728\u672c\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u4e00\u4e2a\u57fa\u4e8e ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/aspnet/core/?view=aspnetcore-7.0"},"ASP.NET Core Web API")," \u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Boburmirzo/apisix-api-consumers-management"},"\u793a\u4f8b\u9879\u76ee"),"\uff0c\u8be5\u9879\u76ee\u5305\u542b\u4e00\u4e2a\u7b80\u5355\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"GET")," \u63a5\u53e3\uff0c\u7528\u4e8e\u83b7\u53d6\u5546\u54c1\u5217\u8868\u3002\n\u9879\u76ee\u7684\u8fd0\u884c\u65b9\u5f0f\u53ef\u5728\u5176 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Boburmirzo/apisix-api-consumers-management#readme"},"README \u6587\u4ef6")," \u4e2d\u627e\u5230\u8be6\u7ec6\u8bf4\u660e\u3002"),(0,r.kt)("h3",{id:"\u4e3a\u5355\u4e2a\u6d88\u8d39\u8005\u542f\u7528\u9650\u6d41rate-limiting"},"\u4e3a\u5355\u4e2a\u6d88\u8d39\u8005\u542f\u7528\u9650\u6d41\uff08Rate Limiting\uff09"),(0,r.kt)("p",null,"\u5047\u8bbe\u6b64\u65f6\u793a\u4f8b\u9879\u76ee\u5df2\u7ecf\u542f\u52a8\u8fd0\u884c\u3002\n\u8981\u5c06\u6d88\u8d39\u8005\u5bf9\u8c61\u4e0e\u4e0a\u8ff0\u4e24\u4e2a\u63d2\u4ef6\u914d\u5408\u4f7f\u7528\uff0c\u6211\u4eec\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 ",(0,r.kt)("strong",{parentName:"li"},"Consumer\uff08\u6d88\u8d39\u8005\uff09"),"\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4e3a\u8be5\u6d88\u8d39\u8005\u914d\u7f6e\u8ba4\u8bc1\u63d2\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"li"},"key-auth")," \u548c\u9650\u6d41\u63d2\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"li"},"limit-count"),"\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u65b0\u7684 ",(0,r.kt)("strong",{parentName:"li"},"Route\uff08\u8def\u7531\uff09"),"\uff0c\u5e76\u8bbe\u7f6e\u8def\u7531\u89c4\u5219\uff08\u5982\u6709\u9700\u8981\uff09\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4e3a\u8be5\u8def\u7531\u542f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"key-auth")," \u63d2\u4ef6\u914d\u7f6e\u3002")),(0,r.kt)("p",null,"\u4ee5\u4e0a\u6b65\u9aa4\u53ea\u9700\u901a\u8fc7\u4e24\u6761 ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/CURL"},"curl \u547d\u4ee4")," \u8c03\u7528 APISIX \u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/admin-api/"},"Admin API")," \u5373\u53ef\u5b8c\u6210\u3002"),(0,r.kt)("p",null,"\u7b2c\u4e00\u6761\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u542f\u7528\u4e86 API Key \u8ba4\u8bc1\u7684 ",(0,r.kt)("strong",{parentName:"p"},"\u65b0\u6d88\u8d39\u8005"),"\uff0c\u5e76\u914d\u7f6e\u9650\u6d41\u89c4\u5219\uff1a\n\u8be5\u6d88\u8d39\u8005\u5728 60 \u79d2\u5185\u6700\u591a\u53ea\u80fd\u8c03\u7528\u4ea7\u54c1 API \u4e24\u6b21\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumers -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n   "username":"consumer1",\n   "plugins":{\n      "key-auth":{\n         "key":"auth-one"\n      },\n      "limit-count":{\n         "count":2,\n         "time_window":60,\n         "rejected_code":403,\n         "rejected_msg":"Requests are too many, please try again later or upgrade your subscription plan.",\n         "key":"remote_addr"\n      }\n   }\n}\'\n')),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Route\uff08\u8def\u7531\uff09")," \u4e0e ",(0,r.kt)("strong",{parentName:"p"},"Upstream\uff08\u4e0a\u6e38\uff09"),"\uff0c\n\u4f7f\u5f97\u6240\u6709\u5230\u8fbe\u7f51\u5173\u7aef\u70b9 ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/products")," \u7684\u8bf7\u6c42\u5728\u901a\u8fc7\u8ba4\u8bc1\u540e\uff0c\u90fd\u4f1a\u88ab\u8f6c\u53d1\u5230\u793a\u4f8b\u9879\u76ee\u7684\u4ea7\u54c1\u670d\u52a1\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/routes/1 -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n  "name": "Route for consumer request rate limiting",\n  "methods": [\n    "GET"\n  ],\n  "uri": "/api/products",\n  "plugins": {\n      "key-auth": {}\n  },\n  "upstream": {\n    "type": "roundrobin",\n    "nodes": {\n      "productapi:80": 1\n    }\n  }\n}\'\n')),(0,r.kt)("p",null,"\u5728\u6b64\u914d\u7f6e\u4e0b\uff0cApache APISIX \u5c06\u6b63\u5e38\u5904\u7406\u524d\u4e24\u6b21\u8bf7\u6c42\uff0c\n\u4f46\u5728\u76f8\u540c\u7684 60 \u79d2\u65f6\u95f4\u7a97\u53e3\u5185\u7684 ",(0,r.kt)("strong",{parentName:"p"},"\u7b2c\u4e09\u6b21\u8bf7\u6c42")," \u5c06\u8fd4\u56de\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"403")," HTTP \u72b6\u6001\u7801\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://127.0.0.1:9080/api/products -H 'apikey: auth-one' -i\n")),(0,r.kt)("p",null,"\u5982\u679c\u5728 60 \u79d2\u5185\u8fde\u7eed\u8c03\u7528\u4e09\u6b21\u63a5\u53e3\uff0c\u793a\u4f8b\u8f93\u51fa\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'HTTP/1.1 403 Forbidden\nContent-Type: text/plain; charset=utf-8\nTransfer-Encoding: chunked\nConnection: keep-alive\nServer: APISIX/2.13.1\n\n{"error_msg":"Requests are too many, please try again later or upgrade your subscription plan."}\n')),(0,r.kt)("p",null,"\u5f53\u8bf7\u6c42\u6b21\u6570\u8fbe\u5230\u9608\u503c\u540e\uff0cAPISIX \u5c06\u62d2\u7edd\u540e\u7eed\u8bf7\u6c42\u3002"),(0,r.kt)("h3",{id:"\u4e3a\u6d88\u8d39\u8005\u7ec4\u542f\u7528\u9650\u6d41rate-limiting-for-consumer-groups"},"\u4e3a\u6d88\u8d39\u8005\u7ec4\u542f\u7528\u9650\u6d41\uff08Rate Limiting for Consumer Groups\uff09"),(0,r.kt)("p",null,"\u5728 Apache APISIX \u4e2d\uff0c",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/terminology/consumer-group/"},"Consumer Group\uff08\u6d88\u8d39\u8005\u7ec4\uff09")," \u5bf9\u8c61\u7528\u4e8e\u7ba1\u7406\u5f00\u53d1\u8005\u5bf9\u540e\u7aef\u670d\u52a1\u7684\u53ef\u89c1\u6027\u3002\n\u540e\u7aef\u670d\u52a1\u9996\u5148\u5bf9\u7279\u5b9a\u7ec4\u53ef\u89c1\uff0c\u7136\u540e\u7ec4\u5185\u7684\u5f00\u53d1\u8005\u5373\u53ef\u67e5\u770b\u5e76\u8ba2\u9605\u4e0e\u8be5\u7ec4\u5173\u8054\u7684\u4ea7\u54c1\u3002"),(0,r.kt)("p",null,"\u501f\u52a9\u6d88\u8d39\u8005\u7ec4\uff0c\u4f60\u53ef\u4ee5\u4e3a\u4e00\u7ec4\u6d88\u8d39\u8005\u5b9a\u4e49\u591a\u7ea7\u9650\u6d41\u7b56\u7565\uff0c\u800c\u65e0\u9700\u9010\u4e2a\u7ba1\u7406\u6bcf\u4e2a\u6d88\u8d39\u8005\u3002"),(0,r.kt)("p",null,"\u5178\u578b\u573a\u666f\u5305\u62ec\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"API \u5546\u4e1a\u5316\u4e2d\u7684\u4e0d\u540c\u5b9a\u4ef7\u7b56\u7565\uff0c\u4f8b\u5982\u201cBasic \u5957\u9910\u201d\u7684\u6d88\u8d39\u8005\u6bcf\u5206\u949f\u5141\u8bb8\u8c03\u7528 50 \u6b21 API\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u6216\u6839\u636e\u7528\u6237\u89d2\u8272\uff08\u7ba1\u7406\u5458\u3001\u5f00\u53d1\u8005\u3001\u8bbf\u5ba2\u7b49\uff09\u542f\u7528\u4e0d\u540c\u7684 API \u6743\u9650\u8bbf\u95ee\u3002")),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u7684\u7ba1\u7406 REST API \u4e2d\u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/admin-api/#consumer-group"},"Consumer Group \u5b9e\u4f53")," \u6765\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u7ba1\u7406\u6d88\u8d39\u8005\u7ec4\u3002"),(0,r.kt)("h4",{id:"consumer-groups-\u793a\u4f8b"},"Consumer groups \u793a\u4f8b"),(0,r.kt)("p",null,"\u4e3a\u4e86\u6f14\u793a\uff0c\u6211\u4eec\u5c06\u5206\u522b\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"Basic\uff08\u57fa\u7840\uff09")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"Premium\uff08\u9ad8\u7ea7\uff09")," \u4e24\u79cd\u5957\u9910\u521b\u5efa\u4e24\u4e2a\u6d88\u8d39\u8005\u7ec4\uff08Consumer Group\uff09\u3002\n\u6211\u4eec\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7ec4\u6dfb\u52a0\u4e00\u4e2a\u6216\u4e24\u4e2a\u6d88\u8d39\u8005\uff0c\u5e76\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"rate-limiting")," \u63d2\u4ef6\u6765\u63a7\u5236\u6765\u81ea\u4e0d\u540c\u6d88\u8d39\u8005\u7ec4\u7684\u6d41\u91cf\u3002"),(0,r.kt)("p",null,"\u8981\u5728\u9650\u6d41\u573a\u666f\u4e2d\u4f7f\u7528\u6d88\u8d39\u8005\u7ec4\uff0c\u4f60\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u542f\u7528\u4e86 ",(0,r.kt)("inlineCode",{parentName:"li"},"limit-count")," \u63d2\u4ef6\u7684\u6d88\u8d39\u8005\u7ec4\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u6d88\u8d39\u8005\uff08Consumers\uff09\uff0c\u5e76\u5c06\u5b83\u4eec\u5206\u914d\u5230\u5bf9\u5e94\u7684\u7ec4\u4e2d\u3002")),(0,r.kt)("p",null,"\u4e0b\u9762\u7684\u4e24\u6761 ",(0,r.kt)("inlineCode",{parentName:"p"},"curl")," \u547d\u4ee4\u7528\u4e8e\u5206\u522b\u521b\u5efa\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"basic_plan")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"premium_plan")," \u7684\u6d88\u8d39\u8005\u7ec4\uff1a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa Basic Plan\uff08\u57fa\u7840\u5957\u9910\uff09\u7684\u6d88\u8d39\u8005\u7ec4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumer_groups/basic_plan -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 403,\n            "group": "basic_plan"\n        }\n    }\n}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa Premium Plan\uff08\u9ad8\u7ea7\u5957\u9910\uff09\u7684\u6d88\u8d39\u8005\u7ec4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumer_groups/premium_plan -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n    "plugins": {\n        "limit-count": {\n            "count": 200,\n            "time_window": 60,\n            "rejected_code": 403,\n            "group": "premium_plan"\n        }\n    }\n}\'\n')),(0,r.kt)("p",null,"\u5728\u4e0a\u8ff0\u6b65\u9aa4\u4e2d\uff0c\u6211\u4eec\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"Basic Plan")," \u8bbe\u7f6e\u4e86\u9650\u6d41\u89c4\u5219\uff1a\u6bcf 60 \u79d2\u5185\u4ec5\u5141\u8bb8 ",(0,r.kt)("strong",{parentName:"p"},"2 \u6b21\u8bf7\u6c42"),"\uff1b\n\u800c ",(0,r.kt)("strong",{parentName:"p"},"Premium Plan")," \u5219\u5141\u8bb8\u5728\u76f8\u540c\u65f6\u95f4\u7a97\u53e3\u5185\u6267\u884c ",(0,r.kt)("strong",{parentName:"p"},"200 \u6b21 API \u8bf7\u6c42"),"\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa\u5e76\u5c06\u7b2c\u4e00\u4e2a\u6d88\u8d39\u8005\u52a0\u5165 Basic \u7ec4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumers -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n    "username": "consumer1",\n    "plugins": {\n        "key-auth": {\n            "key": "auth-one"\n        }\n    },\n    "group_id": "basic_plan"\n}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa\u5e76\u5c06\u7b2c\u4e8c\u4e2a\u6d88\u8d39\u8005\u52a0\u5165 Premium \u7ec4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumers -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n    "username": "consumer2",\n    "plugins": {\n        "key-auth": {\n            "key": "auth-two"\n        }\n    },\n    "group_id": "premium_plan"\n}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u521b\u5efa\u5e76\u5c06\u7b2c\u4e09\u4e2a\u6d88\u8d39\u8005\u52a0\u5165 Premium \u7ec4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/consumers -H "X-API-KEY: $admin_key" -X PUT -d \'\n{\n    "username": "consumer3",\n    "plugins": {\n        "key-auth": {\n            "key": "auth-three"\n        }\n    },\n    "group_id": "premium_plan"\n}\'\n')),(0,r.kt)("p",null,"\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u9a8c\u8bc1\u9650\u6d41\u6548\u679c\uff1a\n\u5c5e\u4e8e ",(0,r.kt)("strong",{parentName:"p"},"Basic Plan")," \u7ec4\u7684\u7b2c\u4e00\u4e2a\u6d88\u8d39\u8005 ",(0,r.kt)("inlineCode",{parentName:"p"},"consumer1")," \u5728 1 \u5206\u949f\u5185\u8c03\u7528 API \u8d85\u8fc7 2 \u6b21\u540e\uff0c\u5c06\u6536\u5230 ",(0,r.kt)("strong",{parentName:"p"},"403 HTTP \u72b6\u6001\u7801\u9519\u8bef"),"\uff1b\n\u800c\u5c5e\u4e8e ",(0,r.kt)("strong",{parentName:"p"},"Premium Plan")," \u7ec4\u7684\u5176\u4ed6\u4e24\u4e2a\u6d88\u8d39\u8005\u5219\u53ef\u7ee7\u7eed\u8bf7\u6c42\uff0c\u76f4\u5230\u8fbe\u5230\u5404\u81ea\u7684\u8bf7\u6c42\u4e0a\u9650\u3002"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u8bf7\u6c42\u5934\u4e2d\u66f4\u6362\u8ba4\u8bc1\u5bc6\u94a5\u6765\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl -i http://127.0.0.1:9080/api/products -H 'apikey: auth-one'\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl -i http://127.0.0.1:9080/api/products -H 'apikey: auth-two'\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl -i http://127.0.0.1:9080/api/products -H 'apikey: auth-three'\n")),(0,r.kt)("p",null,"\u8bf7\u6ce8\u610f\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728\u4efb\u610f\u65f6\u523b\u5c06\u6d88\u8d39\u8005\u6dfb\u52a0\u5230\u6216\u79fb\u51fa\u6d88\u8d39\u8005\u7ec4\uff0c\u5e76\u542f\u7528\u5176\u4ed6\u5185\u7f6e\u63d2\u4ef6\u3002"),(0,r.kt)("h2",{id:"\u66f4\u591a\u6559\u7a0b"},"\u66f4\u591a\u6559\u7a0b"),(0,r.kt)("p",null,"\u9605\u8bfb\u6211\u4eec\u7684\u5176\u4ed6 ",(0,r.kt)("a",{parentName:"p",href:"/zh/docs/apisix/3.13/tutorials/expose-api"},"\u6559\u7a0b"),"\uff0c\u4ee5\u4e86\u89e3\u66f4\u591a\u6709\u5173 ",(0,r.kt)("strong",{parentName:"p"},"API \u7ba1\u7406\uff08API Management\uff09")," \u7684\u5185\u5bb9\u3002"))}u.isMDXComponent=!0}}]);