"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[87821],{3905:(t,e,n)=>{n.d(e,{Zo:()=>m,kt:()=>k});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),u=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):p(p({},e),t)),n},m=function(t){var e=u(t.components);return a.createElement(s.Provider,{value:e},t.children)},o={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,s=t.parentName,m=i(t,["components","mdxType","originalType","parentName"]),d=u(n),k=r,c=d["".concat(s,".").concat(k)]||d[k]||o[k]||l;return n?a.createElement(c,p(p({ref:e},m),{},{components:n})):a.createElement(c,p({ref:e},m))}));function k(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,p=new Array(l);p[0]=d;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=t,i.mdxType="string"==typeof t?t:r,p[1]=i;for(var u=2;u<l;u++)p[u]=n[u];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},90766:(t,e,n)=>{n.r(e),n.d(e,{contentTitle:()=>p,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const l={title:"prometheus",keywords:["Apache APISIX","API \u7f51\u5173","Plugin","Prometheus"],description:"\u672c\u6587\u5c06\u4ecb\u7ecd prometheus \u63d2\u4ef6\uff0c\u4ee5\u53ca\u5c06 APISIX \u4e0e Prometheus \u96c6\u6210\u4ee5\u8fdb\u884c\u6307\u6807\u6536\u96c6\u548c\u6301\u7eed\u76d1\u63a7\u3002"},p=void 0,i={unversionedId:"plugins/prometheus",id:"version-3.12/plugins/prometheus",isDocsHomePage:!1,title:"prometheus",description:"\u672c\u6587\u5c06\u4ecb\u7ecd prometheus \u63d2\u4ef6\uff0c\u4ee5\u53ca\u5c06 APISIX \u4e0e Prometheus \u96c6\u6210\u4ee5\u8fdb\u884c\u6307\u6807\u6536\u96c6\u548c\u6301\u7eed\u76d1\u63a7\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs-docs-apisix/version-3.12/plugins/prometheus.md",sourceDirName:"plugins",slug:"/plugins/prometheus",permalink:"/zh/docs/apisix/3.12/plugins/prometheus",editUrl:"/zh/edit#https://github.com/apache/apisix/edit/release/3.12/docs/zh/latest/plugins/prometheus.md",tags:[],version:"3.12",frontMatter:{title:"prometheus",keywords:["Apache APISIX","API \u7f51\u5173","Plugin","Prometheus"],description:"\u672c\u6587\u5c06\u4ecb\u7ecd prometheus \u63d2\u4ef6\uff0c\u4ee5\u53ca\u5c06 APISIX \u4e0e Prometheus \u96c6\u6210\u4ee5\u8fdb\u884c\u6307\u6807\u6536\u96c6\u548c\u6301\u7eed\u76d1\u63a7\u3002"},sidebar:"version-3.12/docs",previous:{title:"opentelemetry",permalink:"/zh/docs/apisix/3.12/plugins/opentelemetry"},next:{title:"node-status",permalink:"/zh/docs/apisix/3.12/plugins/node-status"}},s=[{value:"\u63cf\u8ff0",id:"\u63cf\u8ff0",children:[]},{value:"\u9759\u6001\u914d\u7f6e",id:"\u9759\u6001\u914d\u7f6e",children:[]},{value:"\u5c5e\u6027",id:"\u5c5e\u6027",children:[]},{value:"\u6307\u6807",id:"\u6307\u6807",children:[]},{value:"\u6807\u7b7e",id:"\u6807\u7b7e",children:[{value:"<code>apisix_http_status</code> \u7684\u6807\u7b7e",id:"apisix_http_status-\u7684\u6807\u7b7e",children:[]},{value:"<code>apisix_bandwidth</code> \u7684\u6807\u7b7e",id:"apisix_bandwidth-\u7684\u6807\u7b7e",children:[]},{value:"<code>apisix_http_latency</code> \u7684\u6807\u7b7e",id:"apisix_http_latency-\u7684\u6807\u7b7e",children:[]},{value:"<code>apisix_upstream_status</code> \u7684\u6807\u7b7e",id:"apisix_upstream_status-\u7684\u6807\u7b7e",children:[]}]},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",children:[{value:"\u83b7\u53d6 APISIX \u6307\u6807",id:"\u83b7\u53d6-apisix-\u6307\u6807",children:[]},{value:"\u5728\u516c\u5171 API \u7aef\u70b9\u4e0a\u516c\u5f00 APISIX \u6307\u6807",id:"\u5728\u516c\u5171-api-\u7aef\u70b9\u4e0a\u516c\u5f00-apisix-\u6307\u6807",children:[]},{value:"\u76d1\u63a7\u4e0a\u6e38\u5065\u5eb7\u72b6\u6001",id:"\u76d1\u63a7\u4e0a\u6e38\u5065\u5eb7\u72b6\u6001",children:[]},{value:"\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e",id:"\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e",children:[]},{value:"\u4f7f\u7528 Prometheus \u76d1\u63a7 TCP/UDP \u6d41\u91cf",id:"\u4f7f\u7528-prometheus-\u76d1\u63a7-tcpudp-\u6d41\u91cf",children:[]}]}],u={toc:s};function m(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("head",null,(0,r.kt)("link",{rel:"canonical",href:"https://docs.api7.ai/hub/prometheus"})),(0,r.kt)("h2",{id:"\u63cf\u8ff0"},"\u63cf\u8ff0"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u63d0\u4f9b\u5c06 APISIX \u4e0e Prometheus \u96c6\u6210\u7684\u80fd\u529b\u3002"),(0,r.kt)("p",null,"\u542f\u7528\u8be5\u63d2\u4ef6\u540e\uff0cAPISIX \u5c06\u5f00\u59cb\u6536\u96c6\u76f8\u5173\u6307\u6807\uff0c\u4f8b\u5982 API \u8bf7\u6c42\u548c\u5ef6\u8fdf\uff0c\u5e76\u4ee5",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/instrumenting/exposition_formats/#exposition-formats"},"\u57fa\u4e8e\u6587\u672c\u7684\u5c55\u793a\u683c\u5f0f"),"\u5bfc\u51fa\u5230 Prometheus\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728 Prometheus \u4e2d\u521b\u5efa\u4e8b\u4ef6\u76d1\u63a7\u548c\u8b66\u62a5\uff0c\u4ee5\u76d1\u63a7 API \u7f51\u5173\u548c API \u7684\u5065\u5eb7\u72b6\u51b5\u3002"),(0,r.kt)("h2",{id:"\u9759\u6001\u914d\u7f6e"},"\u9759\u6001\u914d\u7f6e"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5df2\u5728\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/apisix/cli/config.lua"},(0,r.kt)("inlineCode",{parentName:"a"},"config.lua"))," \u4e2d\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u8fdb\u884c\u9884\u914d\u7f6e\u3002"),(0,r.kt)("p",null,"\u8981\u81ea\u5b9a\u4e49\u8fd9\u4e9b\u503c\uff0c\u8bf7\u5c06\u76f8\u5e94\u7684\u914d\u7f6e\u6dfb\u52a0\u5230 config.yaml \u4e2d\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"plugin_attr:\n  prometheus:                               # \u63d2\u4ef6\uff1aprometheus \u5c5e\u6027\n    export_uri: /apisix/prometheus/metrics  # \u8bbe\u7f6e Prometheus \u6307\u6807\u7aef\u70b9\u7684 URI\u3002\n    metric_prefix: apisix_                  # \u8bbe\u7f6e APISIX \u751f\u6210\u7684 Prometheus \u6307\u6807\u7684\u524d\u7f00\u3002\n    enable_export_server: true              # \u542f\u7528 Prometheus \u5bfc\u51fa\u670d\u52a1\u5668\u3002\n    export_addr:                            # \u8bbe\u7f6e Prometheus \u5bfc\u51fa\u670d\u52a1\u5668\u7684\u5730\u5740\u3002\n      ip: 127.0.0.1                         # \u8bbe\u7f6e IP\u3002\n      port: 9091                            # \u8bbe\u7f6e\u7aef\u53e3\u3002\n    # metrics:                              # \u4e3a\u6307\u6807\u521b\u5efa\u989d\u5916\u7684\u6807\u7b7e\u3002\n    #  http_status:                         # \u8fd9\u4e9b\u6307\u6807\u5c06\u4ee5 `apisix_` \u4e3a\u524d\u7f00\u3002\n    #    extra_labels:                      # \u8bbe\u7f6e http_status \u6307\u6807\u7684\u989d\u5916\u6807\u7b7e\u3002\n    #      - upstream_addr: $upstream_addr\n    #      - status: $upstream_status\n    #    expire: 0                          # \u6307\u6807\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002\n                                            # 0 \u8868\u793a\u6307\u6807\u4e0d\u4f1a\u8fc7\u671f\u3002\n    #  http_latency:\n    #    extra_labels:                      # \u8bbe\u7f6e http_latency \u6307\u6807\u7684\u989d\u5916\u6807\u7b7e\u3002\n    #      - upstream_addr: $upstream_addr\n    #    expire: 0                          # \u6307\u6807\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002\n                                            # 0 \u8868\u793a\u6307\u6807\u4e0d\u4f1a\u8fc7\u671f\u3002\n    #  bandwidth:\n    #    extra_labels:                      # \u8bbe\u7f6e bandwidth \u6307\u6807\u7684\u989d\u5916\u6807\u7b7e\u3002\n    #      - upstream_addr: $upstream_addr\n    #    expire: 0                          # \u6307\u6807\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002\n                                            # 0 \u8868\u793a\u6307\u6807\u4e0d\u4f1a\u8fc7\u671f\u3002\n    # default_buckets:                      # \u8bbe\u7f6e `http_latency` \u6307\u6807\u76f4\u65b9\u56fe\u7684\u9ed8\u8ba4\u6876\u3002\n    #   - 10\n    #   - 50\n    #   - 100\n    #   - 200\n    #   - 500\n    #   - 1000\n    #   - 2000\n    #   - 5000\n    #   - 10000\n    #   - 30000\n    #   - 60000\n    #   - 500\n")),(0,r.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_core_module.html"},"Nginx \u53d8\u91cf"),"\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"extra_labels"),"\u3002\u8bf7\u53c2\u89c1",(0,r.kt)("a",{parentName:"p",href:"#%E4%B8%BA%E6%8C%87%E6%A0%87%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E6%A0%87%E7%AD%BE"},"\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e"),"\u3002"),(0,r.kt)("p",null,"\u91cd\u65b0\u52a0\u8f7d APISIX \u4ee5\u4f7f\u66f4\u6539\u751f\u6548\u3002"),(0,r.kt)("h2",{id:"\u5c5e\u6027"},"\u5c5e\u6027"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u9009\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"prefer_name"),(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"False"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5f53\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u5219\u5728",(0,r.kt)("inlineCode",{parentName:"td"},"prometheus")," \u6307\u6807\u4e2d\u5bfc\u51fa\u8def\u7531/\u670d\u52a1\u540d\u79f0\u800c\u975e\u5b83\u4eec\u7684 ",(0,r.kt)("inlineCode",{parentName:"td"},"id"),"\u3002")))),(0,r.kt)("h2",{id:"\u6307\u6807"},"\u6307\u6807"),(0,r.kt)("p",null,"Prometheus \u4e2d\u6709\u4e0d\u540c\u7c7b\u578b\u7684\u6307\u6807\u3002\u8981\u4e86\u89e3\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\uff0c\u8bf7\u53c2\u89c1",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/concepts/metric_types/"},"\u6307\u6807\u7c7b\u578b"),"\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u9ed8\u8ba4\u5bfc\u51fa\u7684\u6307\u6807\u3002\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1","[\u83b7\u53d6 APISIX \u6307\u6807]","(#\u83b7\u53d6 APISIX \u6307\u6807)\u3002\u8bf7\u6ce8\u610f\uff0c\u4e00\u4e9b\u6307\u6807\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_batch_process_entries"),"\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e\uff0c\u5c06\u4e0d\u53ef\u89c1\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_bandwidth"),(0,r.kt)("td",{parentName:"tr",align:null},"counter"),(0,r.kt)("td",{parentName:"tr",align:null},"APISIX \u4e2d\u6bcf\u4e2a\u670d\u52a1\u6d88\u8017\u7684\u603b\u6d41\u91cf\uff08\u5b57\u8282\uff09\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_etcd_modify_indexes"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"APISIX \u952e\u7684 etcd \u4fee\u6539\u6b21\u6570\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_batch_process_entries"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"\u53d1\u9001\u6570\u636e\u65f6\u6279\u5904\u7406\u4e2d\u7684\u5269\u4f59\u6761\u76ee\u6570\uff0c\u4f8b\u5982\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"td"},"http logger")," \u548c\u5176\u4ed6\u65e5\u5fd7\u63d2\u4ef6\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_etcd_reachable"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"APISIX \u662f\u5426\u53ef\u4ee5\u8bbf\u95ee etcd\u3002\u503c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"1")," \u8868\u793a\u53ef\u8fbe\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"0")," \u8868\u793a\u4e0d\u53ef\u8fbe\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_http_status"),(0,r.kt)("td",{parentName:"tr",align:null},"counter"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4ece\u4e0a\u6e38\u670d\u52a1\u8fd4\u56de\u7684 HTTP \u72b6\u6001\u4ee3\u7801\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_http_requests_total"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6765\u81ea\u5ba2\u6237\u7aef\u7684 HTTP \u8bf7\u6c42\u6570\u91cf\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_nginx_http_current_connections"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5f53\u524d\u4e0e\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u6570\u91cf\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_nginx_metric_errors_total"),(0,r.kt)("td",{parentName:"tr",align:null},"counter"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"nginx-lua-prometheus")," \u9519\u8bef\u7684\u603b\u6570\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_http_latency"),(0,r.kt)("td",{parentName:"tr",align:null},"histogram"),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP \u8bf7\u6c42\u5ef6\u8fdf\uff08\u6beb\u79d2\uff09\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_node_info"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"APISIX \u8282\u70b9\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u4e3b\u673a\u540d\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_shared_dict_capacity_bytes"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/openresty/lua-nginx-module#ngxshareddict"},"NGINX \u5171\u4eab\u5b57\u5178")," \u7684\u603b\u5bb9\u91cf\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_shared_dict_free_space_bytes"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/openresty/lua-nginx-module#ngxshareddict"},"NGINX \u5171\u4eab\u5b57\u5178")," \u4e2d\u5269\u4f59\u7684\u7a7a\u95f4\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_upstream_status"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u6e38\u8282\u70b9\u7684\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\uff0c\u5982\u679c\u5728\u4e0a\u6e38\u914d\u7f6e\u4e86\u5065\u5eb7\u68c0\u67e5\uff0c\u5219\u53ef\u7528\u3002\u503c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"1")," \u8868\u793a\u5065\u5eb7\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"0")," \u8868\u793a\u4e0d\u5065\u5eb7\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"apisix_stream_connection_total"),(0,r.kt)("td",{parentName:"tr",align:null},"counter"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6bcf\u4e2a Stream Route \u5904\u7406\u7684\u603b\u8fde\u63a5\u6570\u3002")))),(0,r.kt)("h2",{id:"\u6807\u7b7e"},"\u6807\u7b7e"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/practices/naming/#labels"},"\u6807\u7b7e")," \u662f\u6307\u6807\u7684\u5c5e\u6027\uff0c\u7528\u4e8e\u533a\u5206\u6307\u6807\u3002"),(0,r.kt)("p",null,"\u4f8b\u5982\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_http_status")," \u6307\u6807\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"route")," \u4fe1\u606f\u8fdb\u884c\u6807\u8bb0\uff0c\u4ee5\u8bc6\u522b HTTP \u72b6\u6001\u7684\u6765\u6e90\u8def\u7531\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f APISIX \u6307\u6807\u7684\u975e\u8be6\u5c3d\u6807\u7b7e\u53ca\u5176\u63cf\u8ff0\u3002"),(0,r.kt)("h3",{id:"apisix_http_status-\u7684\u6807\u7b7e"},(0,r.kt)("inlineCode",{parentName:"h3"},"apisix_http_status")," \u7684\u6807\u7b7e"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u6807\u7b7e\u7528\u4e8e\u533a\u5206 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_http_status")," \u6307\u6807\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"code"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u6e38\u8282\u70b9\u8fd4\u56de\u7684 HTTP \u54cd\u5e94\u4ee3\u7801\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"route"),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP \u72b6\u6001\u6765\u6e90\u7684\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u8def\u7531\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u4e0d\u5339\u914d\u4efb\u4f55\u8def\u7531\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"matched_uri"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5339\u914d\u8bf7\u6c42\u7684\u8def\u7531 URI\u3002\u5982\u679c\u8bf7\u6c42\u4e0d\u5339\u914d\u4efb\u4f55\u8def\u7531\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"matched_host"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5339\u914d\u8bf7\u6c42\u7684\u8def\u7531\u4e3b\u673a\u3002\u5982\u679c\u8bf7\u6c42\u4e0d\u5339\u914d\u4efb\u4f55\u8def\u7531\uff0c\u6216\u8def\u7531\u672a\u914d\u7f6e\u4e3b\u673a\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"service"),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP \u72b6\u6001\u6765\u6e90\u7684\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u670d\u52a1\u540d\u79f0\u3002\u5982\u679c\u5339\u914d\u7684\u8def\u7531\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u670d\u52a1\uff0c\u5219\u9ed8\u8ba4\u4e3a\u8def\u7531\u4e0a\u914d\u7f6e\u7684\u4e3b\u673a\u503c\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"consumer"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0e\u8bf7\u6c42\u5173\u8054\u7684\u6d88\u8d39\u8005\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u4e0e\u4e4b\u5173\u8054\u7684\u6d88\u8d39\u8005\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u6e38\u8282\u70b9\u7684 IP \u5730\u5740\u3002")))),(0,r.kt)("h3",{id:"apisix_bandwidth-\u7684\u6807\u7b7e"},(0,r.kt)("inlineCode",{parentName:"h3"},"apisix_bandwidth")," \u7684\u6807\u7b7e"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u6807\u7b7e\u7528\u4e8e\u533a\u5206 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_bandwidth")," \u6307\u6807\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d41\u91cf\u7c7b\u578b\uff0c",(0,r.kt)("inlineCode",{parentName:"td"},"egress")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"td"},"ingress"),"\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"route"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5e26\u5bbd\u5bf9\u5e94\u7684\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u8def\u7531\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u4e0d\u5339\u914d\u4efb\u4f55\u8def\u7531\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"service"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5e26\u5bbd\u5bf9\u5e94\u7684\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u670d\u52a1\u540d\u79f0\u3002\u5982\u679c\u5339\u914d\u7684\u8def\u7531\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u670d\u52a1\uff0c\u5219\u9ed8\u8ba4\u4e3a\u8def\u7531\u4e0a\u914d\u7f6e\u7684\u4e3b\u673a\u503c\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"consumer"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0e\u8bf7\u6c42\u5173\u8054\u7684\u6d88\u8d39\u8005\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u4e0e\u4e4b\u5173\u8054\u7684\u6d88\u8d39\u8005\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u6e38\u8282\u70b9\u7684 IP \u5730\u5740\u3002")))),(0,r.kt)("h3",{id:"apisix_http_latency-\u7684\u6807\u7b7e"},(0,r.kt)("inlineCode",{parentName:"h3"},"apisix_http_latency")," \u7684\u6807\u7b7e"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u6807\u7b7e\u7528\u4e8e\u533a\u5206 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_http_latency")," \u6307\u6807\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5ef6\u8fdf\u7c7b\u578b\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 ",(0,r.kt)("a",{parentName:"td",href:"#%E5%BB%B6%E8%BF%9F%E7%B1%BB%E5%9E%8B"},"\u5ef6\u8fdf\u7c7b\u578b"),"\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"route"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5ef6\u8fdf\u5bf9\u5e94\u7684\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u8def\u7531 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u8def\u7531\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u4e0d\u5339\u914d\u4efb\u4f55\u8def\u7531\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"service"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5ef6\u8fdf\u5bf9\u5e94\u7684\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),"\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u4f7f\u7528\u670d\u52a1 ID\uff0c\u5f53 ",(0,r.kt)("inlineCode",{parentName:"td"},"prefer_name")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true")," \u65f6\uff0c\u4f7f\u7528\u670d\u52a1\u540d\u79f0\u3002\u5982\u679c\u5339\u914d\u7684\u8def\u7531\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u670d\u52a1\uff0c\u5219\u9ed8\u8ba4\u4e3a\u8def\u7531\u4e0a\u914d\u7f6e\u7684\u4e3b\u673a\u503c\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"consumer"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0e\u5ef6\u8fdf\u5173\u8054\u7684\u6d88\u8d39\u8005\u540d\u79f0\u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u4e0e\u4e4b\u5173\u8054\u7684\u6d88\u8d39\u8005\uff0c\u5219\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"node"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0e\u5ef6\u8fdf\u5173\u8054\u7684\u4e0a\u6e38\u8282\u70b9\u7684 IP \u5730\u5740\u3002")))),(0,r.kt)("h4",{id:"\u5ef6\u8fdf\u7c7b\u578b"},"\u5ef6\u8fdf\u7c7b\u578b"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"apisix_http_latency")," \u53ef\u4ee5\u6807\u8bb0\u4e3a\u4ee5\u4e0b\u4e09\u79cd\u7c7b\u578b\u4e4b\u4e00\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"request")," \u8868\u793a\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u5b57\u8282\u5230\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u65f6\u95f4\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"upstream")," \u8868\u793a\u7b49\u5f85\u4e0a\u6e38\u670d\u52a1\u54cd\u5e94\u7684\u65f6\u95f4\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"apisix")," \u8868\u793a ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," \u5ef6\u8fdf\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"upstream")," \u5ef6\u8fdf\u4e4b\u95f4\u7684\u5dee\u5f02\u3002"))),(0,r.kt)("p",null,"\u6362\u53e5\u8bdd\u8bf4\uff0cAPISIX \u5ef6\u8fdf\u4e0d\u4ec5\u5f52\u56e0\u4e8e Lua \u5904\u7406\u3002\u5e94\u7406\u89e3\u4e3a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"APISIX \u5ef6\u8fdf\n  = \u4e0b\u6e38\u8bf7\u6c42\u65f6\u95f4 - \u4e0a\u6e38\u54cd\u5e94\u65f6\u95f4\n  = \u4e0b\u6e38\u6d41\u91cf\u5ef6\u8fdf + NGINX \u5ef6\u8fdf\n")),(0,r.kt)("h3",{id:"apisix_upstream_status-\u7684\u6807\u7b7e"},(0,r.kt)("inlineCode",{parentName:"h3"},"apisix_upstream_status")," \u7684\u6807\u7b7e"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u6807\u7b7e\u7528\u4e8e\u533a\u5206 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix_upstream_status")," \u6307\u6807\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0e\u5065\u5eb7\u68c0\u67e5\u914d\u7f6e\u7684\u4e0a\u6e38\u5bf9\u5e94\u7684\u8d44\u6e90 ID\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"td"},"/apisix/routes/1")," \u548c ",(0,r.kt)("inlineCode",{parentName:"td"},"/apisix/upstreams/1"),"\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ip"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u6e38\u8282\u70b9\u7684 IP \u5730\u5740\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"port"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8282\u70b9\u7684\u7aef\u53e3\u53f7\u3002")))),(0,r.kt)("h2",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5728\u4e0d\u540c\u573a\u666f\u4e2d\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u3002"),(0,r.kt)("h3",{id:"\u83b7\u53d6-apisix-\u6307\u6807"},"\u83b7\u53d6 APISIX \u6307\u6807"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4ece APISIX \u83b7\u53d6\u6307\u6807\u3002"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u7684 Prometheus \u6307\u6807\u7aef\u70b9\u548c\u5176\u4ed6\u4e0e Prometheus \u76f8\u5173\u7684\u914d\u7f6e\u53ef\u4ee5\u5728 ",(0,r.kt)("a",{parentName:"p",href:"#%E9%9D%99%E6%80%81%E9%85%8D%E7%BD%AE"},"\u9759\u6001\u914d\u7f6e")," \u4e2d\u627e\u5230\u3002\u5982\u679c\u60a8\u5e0c\u671b\u81ea\u5b9a\u4e49\u8fd9\u4e9b\u914d\u7f6e\uff0c\u66f4\u65b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml")," \u5e76\u91cd\u65b0\u52a0\u8f7d APISIX\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u60a8\u5728\u5bb9\u5668\u5316\u73af\u5883\u4e2d\u90e8\u7f72 APISIX\uff0c\u5e76\u5e0c\u671b\u5916\u90e8\u8bbf\u95ee Prometheus \u6307\u6807\u7aef\u70b9\uff0c\u8bf7\u6309\u5982\u4e0b\u65b9\u5f0f\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u65b0\u52a0\u8f7d APISIX\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"plugin_attr:\n  prometheus:\n    export_addr:\n      ip: 0.0.0.0\n")),(0,r.kt)("p",null,"\u5411 APISIX Prometheus \u6307\u6807\u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9091/apisix/prometheus/metrics"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'# HELP apisix_bandwidth Total bandwidth in bytes consumed per Service in Apisix\n# TYPE apisix_bandwidth counter\napisix_bandwidth{type="egress",route="",service="",consumer="",node=""} 8417\napisix_bandwidth{type="egress",route="1",service="",consumer="",node="127.0.0.1"} 1420\napisix_bandwidth{type="egress",route="2",service="",consumer="",node="127.0.0.1"} 1420\napisix_bandwidth{type="ingress",route="",service="",consumer="",node=""} 189\napisix_bandwidth{type="ingress",route="1",service="",consumer="",node="127.0.0.1"} 332\napisix_bandwidth{type="ingress",route="2",service="",consumer="",node="127.0.0.1"} 332\n# HELP apisix_etcd_modify_indexes Etcd modify index for APISIX keys\n# TYPE apisix_etcd_modify_indexes gauge\napisix_etcd_modify_indexes{key="consumers"} 0\napisix_etcd_modify_indexes{key="global_rules"} 0\n...\n')),(0,r.kt)("h3",{id:"\u5728\u516c\u5171-api-\u7aef\u70b9\u4e0a\u516c\u5f00-apisix-\u6307\u6807"},"\u5728\u516c\u5171 API \u7aef\u70b9\u4e0a\u516c\u5f00 APISIX \u6307\u6807"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u7981\u7528\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5728\u7aef\u53e3 ",(0,r.kt)("inlineCode",{parentName:"p"},"9091")," \u4e0a\u516c\u5f00\u7684 Prometheus \u5bfc\u51fa\u670d\u52a1\u5668\uff0c\u5e76\u5728 APISIX \u7528\u4e8e\u76d1\u542c\u5176\u4ed6\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u516c\u5171 API \u7aef\u70b9\u4e0a\u516c\u5f00 APISIX Prometheus \u6307\u6807\u3002"),(0,r.kt)("p",null,"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7981\u7528 Prometheus \u5bfc\u51fa\u670d\u52a1\u5668\uff0c\u5e76\u91cd\u65b0\u52a0\u8f7d APISIX \u4ee5\u4f7f\u66f4\u6539\u751f\u6548\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"plugin_attr:\n  prometheus:\n    enable_export_server: false\n")),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/plugins/public-api"},(0,r.kt)("inlineCode",{parentName:"a"},"public-api"))," \u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5e76\u4e3a APISIX \u6307\u6807\u516c\u5f00\u4e00\u4e2a\u516c\u5171 API \u7aef\u70b9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes/prometheus-metrics" -X PUT \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "uri": "/apisix/prometheus/metrics",\n    "plugins": {\n      "public-api": {}\n    }\n  }\'\n')),(0,r.kt)("p",null,"\u5411\u65b0\u6307\u6807\u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\u4ee5\u8fdb\u884c\u9a8c\u8bc1\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/apisix/prometheus/metrics"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'# HELP apisix_http_requests_total \u81ea APISIX \u542f\u52a8\u4ee5\u6765\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u603b\u6570\u3002\n# TYPE apisix_http_requests_total gauge\napisix_http_requests_total 1\n# HELP apisix_nginx_http_current_connections \u5f53\u524d HTTP \u8fde\u63a5\u6570\u91cf\u3002\n# TYPE apisix_nginx_http_current_connections gauge\napisix_nginx_http_current_connections{state="accepted"} 1\napisix_nginx_http_current_connections{state="active"} 1\napisix_nginx_http_current_connections{state="handled"} 1\napisix_nginx_http_current_connections{state="reading"} 0\napisix_nginx_http_current_connections{state="waiting"} 0\napisix_nginx_http_current_connections{state="writing"} 1\n...\n')),(0,r.kt)("h3",{id:"\u76d1\u63a7\u4e0a\u6e38\u5065\u5eb7\u72b6\u6001"},"\u76d1\u63a7\u4e0a\u6e38\u5065\u5eb7\u72b6\u6001"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u76d1\u63a7\u4e0a\u6e38\u8282\u70b9\u7684\u5065\u5eb7\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5e76\u914d\u7f6e\u4e0a\u6e38\u7684\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes" -X PUT \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "id": "prometheus-route",\n    "uri": "/get",\n    "plugins": {\n      "prometheus": {}\n    },\n    "upstream": {\n      "type": "roundrobin",\n      "nodes": {\n        "httpbin.org:80": 1,\n        "127.0.0.1:20001": 1\n      },\n      "checks": {\n        "active": {\n          "timeout": 5,\n          "http_path": "/status",\n          "healthy": {\n            "interval": 2,\n            "successes": 1\n          },\n          "unhealthy": {\n            "interval": 1,\n            "http_failures": 2\n          }\n        },\n        "passive": {\n          "healthy": {\n            "http_statuses": [200, 201],\n            "successes": 3\n          },\n          "unhealthy": {\n            "http_statuses": [500],\n            "http_failures": 3,\n            "tcp_failures": 3\n          }\n        }\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"\u5411 APISIX Prometheus \u6307\u6807\u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9091/apisix/prometheus/metrics"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'# HELP apisix_upstream_status \u4e0a\u6e38\u5065\u5eb7\u68c0\u67e5\u7684\u72b6\u6001\n# TYPE apisix_upstream_status gauge\napisix_upstream_status{name="/apisix/routes/1",ip="54.237.103.220",port="80"} 1\napisix_upstream_status{name="/apisix/routes/1",ip="127.0.0.1",port="20001"} 0\n')),(0,r.kt)("p",null,"\u8fd9\u663e\u793a\u4e0a\u6e38\u8282\u70b9 ",(0,r.kt)("inlineCode",{parentName:"p"},"httpbin.org:80")," \u662f\u5065\u5eb7\u7684\uff0c\u800c\u4e0a\u6e38\u8282\u70b9 ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1:20001")," \u662f\u4e0d\u5065\u5eb7\u7684\u3002"),(0,r.kt)("h3",{id:"\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e"},"\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4e3a\u6307\u6807\u6dfb\u52a0\u989d\u5916\u6807\u7b7e\uff0c\u5e76\u5728\u6807\u7b7e\u503c\u4e2d\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_core_module.html"},"Nginx \u53d8\u91cf"),"\u3002"),(0,r.kt)("p",null,"\u76ee\u524d\uff0c\u4ec5\u4ee5\u4e0b\u6307\u6807\u652f\u6301\u989d\u5916\u6807\u7b7e\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"apisix_http_status"),(0,r.kt)("li",{parentName:"ul"},"apisix_http_latency"),(0,r.kt)("li",{parentName:"ul"},"apisix_bandwidth")),(0,r.kt)("p",null,"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5305\u542b\u4ee5\u4e0b\u914d\u7f6e\u4ee5\u4e3a\u6307\u6807\u6dfb\u52a0\u6807\u7b7e\uff0c\u5e76\u91cd\u65b0\u52a0\u8f7d APISIX \u4ee5\u4f7f\u66f4\u6539\u751f\u6548\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"plugin_attr:\n  prometheus:                                # \u63d2\u4ef6\uff1aprometheus\n    metrics:                                 # \u6839\u636e NGINX \u53d8\u91cf\u521b\u5efa\u989d\u5916\u6807\u7b7e\u3002\n      http_status:\n        extra_labels:                        # \u8bbe\u7f6e `http_status` \u6307\u6807\u7684\u989d\u5916\u6807\u7b7e\u3002\n          - upstream_addr: $upstream_addr    # \u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684 `upstream_addr` \u6807\u7b7e\uff0c\u5176\u503c\u4e3a NGINX \u53d8\u91cf $upstream_addr\u3002\n          - route_name: $route_name          # \u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684 `route_name` \u6807\u7b7e\uff0c\u5176\u503c\u4e3a APISIX \u53d8\u91cf $route_name\u3002\n")),(0,r.kt)("p",null,"\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u5728\u6807\u7b7e\u503c\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u5b83\u4e0e\u4efb\u4f55\u73b0\u6709\u7684 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/apisix-variable/"},"APISIX \u53d8\u91cf")," \u548c ",(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_core_module.html"},"Nginx \u53d8\u91cf")," \u4e0d\u5bf9\u5e94\uff0c\u5219\u6807\u7b7e\u503c\u5c06\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes" -X PUT \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "id": "prometheus-route",\n    "name": "extra-label",\n    "plugins": {\n      "prometheus": {}\n    },\n    "upstream": {\n      "nodes": {\n        "httpbin.org:80": 1\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"\u5411\u8def\u7531\u53d1\u9001\u8bf7\u6c42\u4ee5\u8fdb\u884c\u9a8c\u8bc1\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -i "http://127.0.0.1:9080/get"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP/1.1 200 OK")," \u7684\u54cd\u5e94\u3002"),(0,r.kt)("p",null,"\u5411 APISIX Prometheus \u6307\u6807\u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9091/apisix/prometheus/metrics"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'# HELP apisix_http_status APISIX \u4e2d\u6bcf\u4e2a\u670d\u52a1\u7684 HTTP \u72b6\u6001\u4ee3\u7801\n# TYPE apisix_http_status counter\napisix_http_status{code="200",route="1",matched_uri="/get",matched_host="",service="",consumer="",node="54.237.103.220",upstream_addr="54.237.103.220:80",route_name="extra-label"} 1\n')),(0,r.kt)("h3",{id:"\u4f7f\u7528-prometheus-\u76d1\u63a7-tcpudp-\u6d41\u91cf"},"\u4f7f\u7528 Prometheus \u76d1\u63a7 TCP/UDP \u6d41\u91cf"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5728 APISIX \u4e2d\u6536\u96c6 TCP/UDP \u6d41\u91cf\u6307\u6807\u3002"),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml")," \u4e2d\u5305\u542b\u4ee5\u4e0b\u914d\u7f6e\u4ee5\u542f\u7528 Stream proxy \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u3002\u91cd\u65b0\u52a0\u8f7d APISIX \u4ee5\u4f7f\u66f4\u6539\u751f\u6548\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"apisix:\n  proxy_mode: http&stream   # \u542f\u7528 L4 \u548c L7 \u4ee3\u7406\n  stream_proxy:             # \u914d\u7f6e L4 \u4ee3\u7406\n    tcp:\n      - 9100                # \u8bbe\u7f6e TCP \u4ee3\u7406\u76d1\u542c\u7aef\u53e3\n    udp:\n      - 9200                # \u8bbe\u7f6e UDP \u4ee3\u7406\u76d1\u542c\u7aef\u53e3\n\nstream_plugins:\n  - prometheus              # \u4e3a stream proxy \u542f\u7528 prometheus\n")),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"prometheus")," \u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a Stream Route\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/stream_routes" -X PUT \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "plugins": {\n      "prometheus": {}\n    },\n    "upstream": {\n      "type": "roundrobin",\n      "nodes": {\n        "httpbin.org:80": 1\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"\u5411\u8be5 Stream Route \u53d1\u9001\u8bf7\u6c42\u4ee5\u8fdb\u884c\u9a8c\u8bc1\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -i "http://127.0.0.1:9100"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP/1.1 200 OK")," \u7684\u54cd\u5e94\u3002"),(0,r.kt)("p",null,"\u5411 APISIX Prometheus \u6307\u6807\u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9091/apisix/prometheus/metrics"\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'# HELP apisix_stream_connection_total APISIX \u4e2d\u6bcf\u4e2a Stream Route \u5904\u7406\u7684\u603b\u8fde\u63a5\u6570\n# TYPE apisix_stream_connection_total counter\napisix_stream_connection_total{route="1"} 1\n')))}m.isMDXComponent=!0}}]);