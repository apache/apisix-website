"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[94402],{3905:function(e,n,t){t.d(n,{Zo:function(){return h},kt:function(){return m}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=a.createContext({}),u=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},h=function(e){var n=u(e.components);return a.createElement(o.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),c=u(t),m=i,d=c["".concat(o,".").concat(m)]||c[m]||s[m]||r;return t?a.createElement(d,p(p({ref:n},h),{},{components:t})):a.createElement(d,p({ref:n},h))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,p=new Array(r);p[0]=c;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l.mdxType="string"==typeof e?e:i,p[1]=l;for(var u=2;u<r;u++)p[u]=t[u];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},70504:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return l},metadata:function(){return o},assets:function(){return u},toc:function(){return h},default:function(){return c}});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),p={title:"Python \u52a9\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX \u63d2\u4ef6\u5f00\u53d1",author:"\u5e05\u8fdb\u8d85",authorURL:"https://github.com/shuaijinchao",authorImageURL:"https://avatars.githubusercontent.com/u/8529452?v=4",keywords:["Python","APISIX","APISIX Python \u63d2\u4ef6","APISIX Python plugin","apisix-python-plugin-runner","APISIX Python Plugin Runner"],tags:["technology"]},l=void 0,o={permalink:"/zh/blog/2021/09/06/python-helps-you-quickly-with-Apache-APISIX-development",source:"@site/blog/2021-09-06-python-helps-you-quickly-with-Apache-APISIX-development.md",title:"Python \u52a9\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX \u63d2\u4ef6\u5f00\u53d1",description:"\u5728 Apache APISIX Python Runner \u4e4b\u524d\u793e\u533a\u4e2d\u5df2\u7ecf\u652f\u6301\u4e86 Java",date:"2021-09-06T00:00:00.000Z",formattedDate:"2021\u5e749\u67086\u65e5",tags:[{label:"technology",permalink:"/zh/blog/tags/technology"}],readingTime:3.19,truncated:!0,authors:[{name:"\u5e05\u8fdb\u8d85",url:"https://github.com/shuaijinchao",imageURL:"https://avatars.githubusercontent.com/u/8529452?v=4"}],prevItem:{title:"\u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u66f4\u65b0\u4e0e\u843d\u5730\u5b9e\u8df5",permalink:"/zh/blog/2021/09/07/iQIYI-usercase"},nextItem:{title:"Apache APISIX \xd7 KubeSphere\uff1a\u63d0\u4f9b\u66f4\u597d\u7528\u7684\u7f51\u5173\u53ca K8S Ingress Controller",permalink:"/zh/blog/2021/08/31/Apache APISIX \xd7 KubeSphere-a-better-gateway-and-K8S-Ingress-Controller"}},u={authorsImageUrls:[void 0]},h=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",children:[{value:"Apache APISIX",id:"apache-apisix",children:[]},{value:"Python",id:"python",children:[]},{value:"Apache APISIX Python Runner",id:"apache-apisix-python-runner",children:[]}]},{value:"\u90e8\u7f72\u6d4b\u8bd5",id:"\u90e8\u7f72\u6d4b\u8bd5",children:[{value:"\u57fa\u7840\u8fd0\u884c\u73af\u5883",id:"\u57fa\u7840\u8fd0\u884c\u73af\u5883",children:[]},{value:"\u4e0b\u8f7d\u5b89\u88c5 Python Runner",id:"\u4e0b\u8f7d\u5b89\u88c5-python-runner",children:[]},{value:"\u914d\u7f6e Python Runner",id:"\u914d\u7f6e-python-runner",children:[]},{value:"\u542f\u52a8 Python Runner",id:"\u542f\u52a8-python-runner",children:[]},{value:"\u6d4b\u8bd5 Python Runner",id:"\u6d4b\u8bd5-python-runner",children:[]}]},{value:"\u63d2\u4ef6\u5f00\u53d1",id:"\u63d2\u4ef6\u5f00\u53d1",children:[{value:"\u63d2\u4ef6\u76ee\u5f55",id:"\u63d2\u4ef6\u76ee\u5f55",children:[]},{value:"\u63d2\u4ef6\u793a\u4f8b",id:"\u63d2\u4ef6\u793a\u4f8b",children:[]},{value:"\u63d2\u4ef6\u683c\u5f0f",id:"\u63d2\u4ef6\u683c\u5f0f",children:[]},{value:"\u63d2\u4ef6\u89c4\u8303\u53ca\u6ce8\u610f\u4e8b\u9879",id:"\u63d2\u4ef6\u89c4\u8303\u53ca\u6ce8\u610f\u4e8b\u9879",children:[]}]},{value:"\u6b22\u8fce\u53c2\u4e0e",id:"\u6b22\u8fce\u53c2\u4e0e",children:[]},{value:"\u76f8\u5173\u9605\u8bfb",id:"\u76f8\u5173\u9605\u8bfb",children:[]}],s={toc:h};function c(e){var n=e.components,p=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},s,p,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5728 Apache APISIX Python Runner \u4e4b\u524d\u793e\u533a\u4e2d\u5df2\u7ecf\u652f\u6301\u4e86 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-java-plugin-runner"},"Java"),"\n\u548c ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-go-plugin-runner"},"Go")," \u8bed\u8a00\u7684 Runner\uff0c\u4eca\u5929 Python Runner\n\u4e5f\u6765\u4e86\uff0c\u793e\u533a\u4e2d\u7684\u5c0f\u4f19\u4f34\u4eec\u5728\u5f00\u53d1 Apache APISIX \u7684\u63d2\u4ef6\u65f6\u53c8\u591a\u4e86\u4e00\u79cd\u65b0\u9009\u62e9\u3002")),(0,r.kt)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,r.kt)("h3",{id:"apache-apisix"},"Apache APISIX"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f\u5f00\u6e90 API \u7f51\u5173\uff0c\u5b83\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u8fdb\u884c\u7edf\u4e00\u7684\u62e6\u622a\u548c\u6cbb\u7406\uff08\u5982\uff1a\u9274\u6743\u3001\u8ba4\u8bc1\u3001\u7f13\u5b58\u3001\u7248\u672c\u3001\u7194\u65ad\u3001\u5ba1\u8ba1 \u7b49\u7b49\uff09\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u7684\u5bf9\u5916\u63d0\u4f9b\u5b89\u5168\u53ef\u9760\u7684\u670d\u52a1\uff0c\u800c\u5f00\u53d1\u4eba\u5458\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX"),"\n\u7684\u52a0\u6301\u53ea\u9700\u8981\u5173\u6ce8\u4e1a\u52a1\u5b9e\u73b0\u5373\u53ef\uff0c\u7701\u53bb\u4e86\u5927\u91cf\u82b1\u8d39\u5728\u901a\u7528\u80fd\u529b\u4e0a\u7684\u5f00\u53d1\u4e0e\u7ef4\u62a4\u4e0a\u7684\u65f6\u95f4\u5e76\u4e14\u4e5f\u964d\u4f4e\u4e86\u6574\u4f53\u4e1a\u52a1\u67b6\u6784\u7684\u590d\u6742\u5ea6\u3002"),(0,r.kt)("h3",{id:"python"},"Python"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Python")," \u8bed\u8a00\u4f5c\u4e3a\u4e00\u4e2a\u89e3\u91ca\u578b\u7684\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83 ",(0,r.kt)("inlineCode",{parentName:"p"},"\u8bed\u6cd5\u7b80\u6d01\u6613\u4e0a\u624b"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"\u4ee3\u7801\u53ef\u8bfb\u6027\u597d")," \uff0c\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"\u8de8\u5e73\u53f0")," \u3001",(0,r.kt)("inlineCode",{parentName:"p"},"\u53ef\u79fb\u690d\u6027")," \u3001",(0,r.kt)("inlineCode",{parentName:"p"},"\u5f00\u53d1\u6548\u7387"),"\n\u4e0a\u90fd\u6709\u5f88\u597d\u7684\u8868\u73b0\uff0c\u540c\u65f6\u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u5b83\u7684\u5c01\u88c5\u62bd\u8c61\u7a0b\u5ea6\u6bd4\u8f83\u9ad8\u5c4f\u853d\u4e86\u5f88\u591a\u5e95\u5c42\u7ec6\u8282\uff08\u4f8b\u5982\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"GC"),"\n\uff09\u8ba9\u6211\u4eec\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u66f4\u4e13\u6ce8\u5e94\u7528\u903b\u8f91\u7684\u5f00\u53d1\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"Python")," \u4f5c\u4e3a\u4e00\u4e2a\u670930\u5e74\u5386\u53f2\u7684\u8001\u724c\u5f00\u53d1\u8bed\u8a00\uff0c\u5b83\u7684\u751f\u6001\u4ee5\u53ca\u5404\u79cd\u6a21\u5757\u5df2\u7ecf\u975e\u5e38\u5b8c\u5584\uff0c\u6211\u4eec\u5927\u90e8\u5206\u7684\u5f00\u53d1\u548c\u5e94\u7528\u573a\u666f\u90fd\u53ef\u4ee5\u4ece\u793e\u533a\u4e2d\u627e\u5230\u5f88\u6210\u719f\u7684\u6a21\u5757\u6216\u89e3\u51b3\u65b9\u6848\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"Python"),"\n\u5176\u4ed6\u7684\u4f18\u70b9\u5c31\u4e0d\u518d\u4e00\u4e00\u8d58\u8ff0\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"Python")," \u7684\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"Python")," \u4f5c\u4e3a\u4e00\u95e8\u89e3\u91ca\u6027\u8bed\u8a00\uff0c\u76f8\u8f83\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"C++")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"Go")," \u8fd9\u6837\u7684\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5728\u6027\u80fd\u4e0a\u7684\u5dee\u8ddd\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\u3002"),(0,r.kt)("h3",{id:"apache-apisix-python-runner"},"Apache APISIX Python Runner"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-python-plugin-runner"},"apache-apisix-python-runner")," \u8fd9\u4e2a\u9879\u76ee\u53ef\u4ee5\u7406\u89e3\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX"),"\n\u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"Python"),"\n\u4e4b\u95f4\u7684\u4e00\u9053\u6865\u6881\uff0c\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"Python Runner")," \u53ef\u4ee5\u628a ",(0,r.kt)("inlineCode",{parentName:"p"},"Python")," \u76f4\u63a5\u5e94\u7528\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"APISIX")," \u7684\u63d2\u4ef6\u5f00\u53d1\u4e2d\uff0c\u6700\u91cd\u8981\u7684\u8fd8\u662f\u5e0c\u671b\u8ba9\u66f4\u591a\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"API \u7f51\u5173")," \u611f\u5174\u8da3\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Python\u5f00\u53d1\u8005"),"\n\u901a\u8fc7\u8fd9\u4e2a\u9879\u76ee\u66f4\u591a\u7684\u4e86\u89e3\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX"),"\uff0c\u4ee5\u4e0b\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u591a\u8bed\u8a00\u652f\u6301\u7684\u67b6\u6784\u56fe\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Apache APISIX work flow",src:t(32795).Z})),(0,r.kt)("p",null,"\u4e0a\u56fe\u5de6\u8fb9\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u53f3\u8fb9\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u662f\u5404\u8bed\u8a00\u7684\u63d2\u4ef6\u8fd0\u884c\u5668\uff0c\u672c\u6587\u4ecb\u7ecd\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix-python-plugin-runner")," \u5c31\u662f\u652f\u6301 ",(0,r.kt)("inlineCode",{parentName:"p"},"Python"),"\n\u8bed\u8a00\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner"),"\u3002"),(0,r.kt)("p",null,"\u5f53\u4f60\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u4e2d\u914d\u7f6e\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u65f6\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u4f1a\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u8fd0\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner"),"\uff0c\u8be5\u5b50\u8fdb\u7a0b\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX"),"\n\u8fdb\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7528\u6237\uff0c\u5f53\u6211\u4eec\u91cd\u542f\u6216\u91cd\u65b0\u52a0\u8f7d ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u65f6\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u4e5f\u5c06\u88ab\u91cd\u542f\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u4e3a\u4e00\u4e2a\u7ed9\u5b9a\u7684\u8def\u7531\u914d\u7f6e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"ext-plugin-*")," \u63d2\u4ef6\uff0c\u8bf7\u6c42\u547d\u4e2d\u8be5\u8def\u7531\u65f6\u5c06\u89e6\u53d1 ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"Unix Socket")," \u5411 ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u53d1\u8d77 ",(0,r.kt)("inlineCode",{parentName:"p"},"RPC")," \u8c03\u7528\u3002\u8c03\u7528\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/ext-plugin-pre-req.md"},"ext-plugin-pre-req"),"\n\uff1a\u5728\u6267\u884c ",(0,r.kt)("inlineCode",{parentName:"li"},"Apache APISIX")," \u5185\u7f6e\u63d2\u4ef6\uff08Lua \u8bed\u8a00\u63d2\u4ef6\uff09\u4e4b\u524d"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/ext-plugin-post-req.md"},"ext-plugin-post-req"),"\n\uff1a\u5728\u6267\u884c ",(0,r.kt)("inlineCode",{parentName:"li"},"Apache APISIX")," \u5185\u7f6e\u63d2\u4ef6\uff08Lua \u8bed\u8a00\u63d2\u4ef6\uff09\u4e4b\u540e")),(0,r.kt)("p",null,"\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u5e76\u914d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u7684\u6267\u884c\u65f6\u673a\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Runner")," \u4f1a\u5904\u7406 ",(0,r.kt)("inlineCode",{parentName:"p"},"RPC")," \u8c03\u7528\uff0c\u5728\u5176\u5185\u90e8\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u8bf7\u6c42\uff0c\u7136\u540e\u8fd0\u884c\u591a\u8bed\u8a00\u7f16\u5199\u7684\u63d2\u4ef6\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 Apache APISIX\u3002"),(0,r.kt)("p",null,"\u591a\u8bed\u8a00\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u662f\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"ext-plugin-*")," \u63d2\u4ef6\u914d\u7f6e\u9879\u4e2d\u5b9a\u4e49\u7684\uff0c\u50cf\u5176\u4ed6\u63d2\u4ef6\u4e00\u6837\uff0c\u5b83\u4eec\u53ef\u4ee5\u88ab\u542f\u7528\u5e76\u5728\u8fd0\u884c\u4e2d\u91cd\u65b0\u5b9a\u4e49\u3002"),(0,r.kt)("h2",{id:"\u90e8\u7f72\u6d4b\u8bd5"},"\u90e8\u7f72\u6d4b\u8bd5"),(0,r.kt)("h3",{id:"\u57fa\u7840\u8fd0\u884c\u73af\u5883"},"\u57fa\u7840\u8fd0\u884c\u73af\u5883"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Apache APISIX 2.7"),(0,r.kt)("li",{parentName:"ul"},"Python 3.6+")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX"),"\n\u7684\u5b89\u88c5\u90e8\u7f72\u672c\u6587\u4e0d\u5728\u8fc7\u591a\u8d58\u8ff0\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/docs/en/latest/how-to-build.md"},"Apache APISIX \u5b98\u65b9\u6587\u6863\uff1a\u5982\u4f55\u6784\u5efa Apache APISIX"),"\n\u8fdb\u884c\u90e8\u7f72\u3002"),(0,r.kt)("h3",{id:"\u4e0b\u8f7d\u5b89\u88c5-python-runner"},"\u4e0b\u8f7d\u5b89\u88c5 Python Runner"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/apache/apisix-python-plugin-runner.git\n$ cd apisix-python-plugin-runner\n$ make install\n")),(0,r.kt)("h3",{id:"\u914d\u7f6e-python-runner"},"\u914d\u7f6e Python Runner"),(0,r.kt)("h4",{id:"\u5f00\u53d1\u6a21\u5f0f"},"\u5f00\u53d1\u6a21\u5f0f"),(0,r.kt)("h5",{id:"\u8fd0\u884cpython-runner"},"\u8fd0\u884cPython Runner"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd /path/to/apisix-python-plugin-runner\n$ APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock python3 apisix/main.py start\n")),(0,r.kt)("h5",{id:"\u4fee\u6539apisix\u914d\u7f6e\u6587\u4ef6"},"\u4fee\u6539APISIX\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ vim /path/to/apisix/conf/config.yaml\napisix:\n  admin_key:\n    - name: "admin"\n      key: edd1c9f034335f136f87ad84b625c8f1\n      role: admin\next-plugin:\n  path_for_test: /tmp/runner.sock\n')),(0,r.kt)("h4",{id:"\u751f\u4ea7\u6a21\u5f0f"},"\u751f\u4ea7\u6a21\u5f0f"),(0,r.kt)("h5",{id:"\u4fee\u6539apisix\u914d\u7f6e\u6587\u4ef6-1"},"\u4fee\u6539APISIX\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ vim /path/to/apisix/conf/config.yaml\napisix:\n  admin_key:\n    - name: "admin"\n      key: edd1c9f034335f136f87ad84b625c8f1\n      role: admin\next-plugin:\n  cmd: [ "python3", "/path/to/apisix-python-plugin-runner/apisix/main.py", "start" ]\n')),(0,r.kt)("h4",{id:"python-runner\u914d\u7f6e\uff08\u53ef\u9009\uff09"},"Python Runner\u914d\u7f6e\uff08\u53ef\u9009\uff09"),(0,r.kt)("p",null,"\u5982\u679c\u9700\u8981\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"Log Level")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},"Unix Domain Socket")," \u73af\u5883\u53d8\u91cf\u8c03\u6574\u53ef\u4ee5\u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"p"},"Runner")," \u7684\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ vim /path/to/apisix-python-plugin-runner/apisix/config.yaml\nsocket:\n  file: $env.APISIX_LISTEN_ADDRESS # Environment variable or absolute path\n\nlogging:\n  level: debug # error warn info debug\n")),(0,r.kt)("h3",{id:"\u542f\u52a8-python-runner"},"\u542f\u52a8 Python Runner"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd /path/to/apisix\n# Start or Restart\n$ ./bin/apisix [ start | restart ]\n")),(0,r.kt)("p",null,"\u542f\u52a8\u6216\u91cd\u542f ",(0,r.kt)("inlineCode",{parentName:"p"},"APISIX")," \u5373\u53ef\uff0c\u6b64\u65f6 ",(0,r.kt)("inlineCode",{parentName:"p"},"APISIX")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"Python Runner")," \u5df2\u7ecf\u5b8c\u6210\u914d\u7f6e\u5e76\u542f\u52a8\u3002"),(0,r.kt)("h3",{id:"\u6d4b\u8bd5-python-runner"},"\u6d4b\u8bd5 Python Runner"),(0,r.kt)("h4",{id:"\u914d\u7f6e-apache-apisix-\u8def\u7531\u53ca\u63d2\u4ef6\u4fe1\u606f"},"\u914d\u7f6e Apache APISIX \u8def\u7531\u53ca\u63d2\u4ef6\u4fe1\u606f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# \u4f7f\u7528\u9ed8\u8ba4demo\u63d2\u4ef6\u8fdb\u884c\u6d4b\u8bd5\n$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n  "uri": "/get",\n  "plugins": {\n    "ext-plugin-pre-req": {\n      "conf": [\n        { "name": "stop", "value":"{\\"body\\":\\"hello\\"}"}\n      ]\n    }\n  },\n  "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "127.0.0.1:1980": 1\n        }\n    }\n}\'\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"plugins.ext-plugin-pre-req.conf")," \u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"Runner")," \u63d2\u4ef6\u914d\u7f6e\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"conf")," \u4e3a\u6570\u7ec4\u683c\u5f0f\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u591a\u4e2a\u63d2\u4ef6\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e2d ",(0,r.kt)("inlineCode",{parentName:"li"},"name")," \u4e3a\u63d2\u4ef6\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u9700\u8981\u4e0e\u63d2\u4ef6\u4ee3\u7801\u6587\u4ef6\u548c\u5bf9\u8c61\u540d\u79f0\u4e00\u76f4\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e2d ",(0,r.kt)("inlineCode",{parentName:"li"},"value")," \u4e3a\u63d2\u4ef6\u914d\u7f6e\uff0c\u53ef\u4ee5\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"JSON")," \u5b57\u7b26\u4e32\u3002")),(0,r.kt)("h4",{id:"\u8bbf\u95ee\u9a8c\u8bc1"},"\u8bbf\u95ee\u9a8c\u8bc1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl http://127.0.0.1:9080/get -i\nHTTP/1.1 200 OK\nDate: Fri, 13 Aug 2021 13:39:18 GMT\nContent-Type: text/plain; charset=utf-8\nTransfer-Encoding: chunked\nConnection: keep-alive\nhost: 127.0.0.1:9080\naccept: */*\nuser-agent: curl/7.64.1\nX-Resp-A6-Runner: Python\nServer: APISIX/2.7\n\nHello, Python Runner of APISIX\n")),(0,r.kt)("h2",{id:"\u63d2\u4ef6\u5f00\u53d1"},"\u63d2\u4ef6\u5f00\u53d1"),(0,r.kt)("h3",{id:"\u63d2\u4ef6\u76ee\u5f55"},"\u63d2\u4ef6\u76ee\u5f55"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/path/to/apisix-python-plugin-runner/apisix/plugins\n")),(0,r.kt)("p",null,"\u6b64\u76ee\u5f55\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},".py")," \u6587\u4ef6\u5c06\u4f1a\u88ab\u81ea\u52a8\u52a0\u8f7d\u3002"),(0,r.kt)("h3",{id:"\u63d2\u4ef6\u793a\u4f8b"},"\u63d2\u4ef6\u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/path/to/apisix-python-plugin-runner/apisix/plugins/stop.py\n/path/to/apisix-python-plugin-runner/apisix/plugins/rewrite.py\n")),(0,r.kt)("h3",{id:"\u63d2\u4ef6\u683c\u5f0f"},"\u63d2\u4ef6\u683c\u5f0f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from apisix.runner.plugin.base import Base\nfrom apisix.runner.http.request import Request\nfrom apisix.runner.http.response import Response\n\n\nclass Stop(Base):\n    def __init__(self):\n        """\n        Example of `stop` type plugin, features:\n            This type of plugin can customize response `body`, `header`, `http_code`\n            This type of plugin will interrupt the request\n        """\n        super(Stop, self).__init__(self.__class__.__name__)\n\n    def filter(self, request: Request, response: Response):\n        """\n        The plugin executes the main function\n        :param request:\n            request parameters and information\n        :param response:\n            response parameters and information\n        :return:\n        """\n        # \u5728\u63d2\u4ef6\u4e2d\u53ef\u4ee5\u901a\u8fc7 `self.config` \u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\uff0c\u5982\u679c\u63d2\u4ef6\u914d\u7f6e\u4e3aJSON\u5c06\u81ea\u52a8\u8f6c\u6362\u4e3a\u5b57\u5178\u7ed3\u6784\n        # print(self.config)\n\n        # \u8bbe\u7f6e\u54cd\u5e94\u5934\u4fe1\u606f\n        headers = request.headers\n        headers["X-Resp-A6-Runner"] = "Python"\n        response.headers = headers\n\n        # \u8bbe\u7f6e\u54cd\u5e94\u4f53\u4fe1\u606f\n        response.body = "Hello, Python Runner of APISIX"\n\n        # \u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\n        response.status_code = 201\n\n        # \u901a\u8fc7\u8c03\u7528 `self.stop()` \u4e2d\u65ad\u8bf7\u6c42\u6d41\u7a0b\uff0c\u6b64\u65f6\u5c06\u7acb\u5373\u54cd\u5e94\u8bf7\u6c42\u7ed9\u5ba2\u6237\u7aef\n        # \u5982\u679c\u672a\u663e\u793a\u8c03\u7528 `self.stop()` \u6216 \u663e\u793a\u8c03\u7528 `self.rewrite()`\u5c06\u7ee7\u7eed\u5c06\u8bf7\u6c42\n        # \u9ed8\u8ba4\u4e3a `self.rewrite()`\n        self.stop()\n')),(0,r.kt)("h3",{id:"\u63d2\u4ef6\u89c4\u8303\u53ca\u6ce8\u610f\u4e8b\u9879"},"\u63d2\u4ef6\u89c4\u8303\u53ca\u6ce8\u610f\u4e8b\u9879"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u63d2\u4ef6\u5bf9\u8c61\u5fc5\u987b\u7ee7\u627f ",(0,r.kt)("inlineCode",{parentName:"li"},"Base")," \u7c7b"),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u5fc5\u987b\u5b9e\u73b0 ",(0,r.kt)("inlineCode",{parentName:"li"},"filter")," \u51fd\u6570"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"filter")," \u51fd\u6570\u53c2\u6570\u53ea\u80fd\u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"li"},"Request")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"Response")," \u7c7b\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Request")," \u5bf9\u8c61\u53c2\u6570\u53ef\u4ee5\u83b7\u53d6\u8bf7\u6c42\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Response")," \u5bf9\u8c61\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u54cd\u5e94\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"self.config")," \u53ef\u4ee5\u83b7\u53d6\u63d2\u4ef6\u914d\u7f6e\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"filter")," \u51fd\u6570\u4e2d\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"self.stop()")," \u65f6\u5c06\u9a6c\u4e0a\u4e2d\u65ad\u8bf7\u6c42\uff0c\u54cd\u5e94\u6570\u636e\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"filter")," \u51fd\u6570\u4e2d\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"self.rewrite()")," \u65f6\uff0c\u5c06\u4f1a\u7ee7\u7eed\u8bf7\u6c42\u3002")),(0,r.kt)("h2",{id:"\u6b22\u8fce\u53c2\u4e0e"},"\u6b22\u8fce\u53c2\u4e0e"),(0,r.kt)("p",null,"\u76ee\u524d ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u5404\u8bed\u8a00\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Runner")," \u8fd8\u5904\u4e8e\u65e9\u671f\u5f00\u53d1\u9636\u6bb5\uff0c\u6211\u4eec\u4f1a\u9646\u7eed\u5b8c\u5584\u5176\u529f\u80fd\u3002\u6210\u529f\u7684\u5f00\u6e90\u9879\u76ee\u79bb\u4e0d\u5f00\u5927\u5bb6\u7684\u53c2\u4e0e\u548c\u8d21\u732e\uff0c\u6b22\u8fce\u5404\u4f4d\u53c2\u4e0e ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX Runner"),"\n\u7684\u5f00\u53d1\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u5171\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"Apache APISIX")," \u4e0e\u5404\u8bed\u8a00\u7684\u6865\u6881\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix-python-plugin-runner"},"apisix-python-plugin-runner")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix-go-plugin-runner"},"apisix-go-plugin-runner")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix-java-plugin-runner"},"apisix-java-plugin-runner"))),(0,r.kt)("h2",{id:"\u76f8\u5173\u9605\u8bfb"},"\u76f8\u5173\u9605\u8bfb"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://apisix.apache.org/blog/2021/08/19/go-makes-Apache-APISIX-better"},"Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins"},"\u5982\u4f55\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6"))))}c.isMDXComponent=!0},32795:function(e,n,t){n.Z=t.p+"assets/images/2021-09-06-1-309b019beba33f8b42cef1731324c711.png"}}]);