"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[97595],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,g=c["".concat(o,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(g,l(l({ref:t},u),{},{components:n})):a.createElement(g,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,l[1]=p;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},52029:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>o});var a=n(87462),r=(n(67294),n(3905));const i={title:"ai-rag",keywords:["Apache APISIX","API \u7f51\u5173","Plugin","ai-rag","AI","LLM"],description:"ai-rag \u63d2\u4ef6\u901a\u8fc7\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08RAG\uff09\u589e\u5f3a LLM \u8f93\u51fa\uff0c\u9ad8\u6548\u68c0\u7d22\u76f8\u5173\u6587\u6863\u4ee5\u63d0\u9ad8\u54cd\u5e94\u7684\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002"},l=void 0,p={unversionedId:"plugins/ai-rag",id:"version-3.15/plugins/ai-rag",isDocsHomePage:!1,title:"ai-rag",description:"ai-rag \u63d2\u4ef6\u901a\u8fc7\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08RAG\uff09\u589e\u5f3a LLM \u8f93\u51fa\uff0c\u9ad8\u6548\u68c0\u7d22\u76f8\u5173\u6587\u6863\u4ee5\u63d0\u9ad8\u54cd\u5e94\u7684\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs-docs-apisix/version-3.15/plugins/ai-rag.md",sourceDirName:"plugins",slug:"/plugins/ai-rag",permalink:"/zh/docs/apisix/plugins/ai-rag",editUrl:"/zh/edit#https://github.com/apache/apisix/edit/release/3.15/docs/zh/latest/plugins/ai-rag.md",tags:[],version:"3.15",frontMatter:{title:"ai-rag",keywords:["Apache APISIX","API \u7f51\u5173","Plugin","ai-rag","AI","LLM"],description:"ai-rag \u63d2\u4ef6\u901a\u8fc7\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08RAG\uff09\u589e\u5f3a LLM \u8f93\u51fa\uff0c\u9ad8\u6548\u68c0\u7d22\u76f8\u5173\u6587\u6863\u4ee5\u63d0\u9ad8\u54cd\u5e94\u7684\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002"},sidebar:"version-3.15/docs",previous:{title:"ai-prompt-template",permalink:"/zh/docs/apisix/plugins/ai-prompt-template"},next:{title:"ai-request-rewrite",permalink:"/zh/docs/apisix/plugins/ai-request-rewrite"}},o=[{value:"\u63cf\u8ff0",id:"\u63cf\u8ff0",children:[]},{value:"\u5c5e\u6027",id:"\u5c5e\u6027",children:[]},{value:"\u8bf7\u6c42\u4f53\u683c\u5f0f",id:"\u8bf7\u6c42\u4f53\u683c\u5f0f",children:[]},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",children:[{value:"\u4e0e Azure \u96c6\u6210\u4ee5\u83b7\u5f97 RAG \u589e\u5f3a\u54cd\u5e94",id:"\u4e0e-azure-\u96c6\u6210\u4ee5\u83b7\u5f97-rag-\u589e\u5f3a\u54cd\u5e94",children:[]}]}],s={toc:o};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("head",null,(0,r.kt)("link",{rel:"canonical",href:"https://docs.api7.ai/hub/ai-rag"})),(0,r.kt)("h2",{id:"\u63cf\u8ff0"},"\u63cf\u8ff0"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ai-rag")," \u63d2\u4ef6\u4e3a LLM \u63d0\u4f9b\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08Retrieval-Augmented Generation\uff0cRAG\uff09\u529f\u80fd\u3002\u5b83\u4fc3\u8fdb\u4ece\u5916\u90e8\u6570\u636e\u6e90\u9ad8\u6548\u68c0\u7d22\u76f8\u5173\u6587\u6863\u6216\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u7528\u4e8e\u589e\u5f3a LLM \u54cd\u5e94\uff0c\u4ece\u800c\u63d0\u9ad8\u751f\u6210\u8f93\u51fa\u7684\u51c6\u786e\u6027\u548c\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u3002"),(0,r.kt)("p",null,"\u8be5\u63d2\u4ef6\u652f\u6301\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/en-us/products/ai-services/openai-service"},"Azure OpenAI")," \u548c ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/en-us/products/ai-services/ai-search"},"Azure AI Search")," \u670d\u52a1\u6765\u751f\u6210\u5d4c\u5165\u548c\u6267\u884c\u5411\u91cf\u641c\u7d22\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"\u76ee\u524d\u4ec5\u652f\u6301 ",(0,r.kt)("a",{parentName:"em",href:"https://azure.microsoft.com/en-us/products/ai-services/openai-service"},"Azure OpenAI")," \u548c ",(0,r.kt)("a",{parentName:"em",href:"https://azure.microsoft.com/en-us/products/ai-services/ai-search"},"Azure AI Search")," \u670d\u52a1\u6765\u751f\u6210\u5d4c\u5165\u548c\u6267\u884c\u5411\u91cf\u641c\u7d22\u3002\u6b22\u8fce\u63d0\u4ea4 PR \u4ee5\u5f15\u5165\u5bf9\u5176\u4ed6\u670d\u52a1\u63d0\u4f9b\u5546\u7684\u652f\u6301\u3002"))),(0,r.kt)("h2",{id:"\u5c5e\u6027"},"\u5c5e\u6027"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u9009\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"embeddings_provider"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5d4c\u5165\u6a21\u578b\u63d0\u4f9b\u5546\u7684\u914d\u7f6e\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"embeddings_provider.azure_openai"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://azure.microsoft.com/en-us/products/ai-services/openai-service"},"Azure OpenAI")," \u4f5c\u4e3a\u5d4c\u5165\u6a21\u578b\u63d0\u4f9b\u5546\u7684\u914d\u7f6e\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"embeddings_provider.azure_openai.endpoint"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Azure OpenAI \u5d4c\u5165\u6a21\u578b\u7aef\u70b9\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"embeddings_provider.azure_openai.api_key"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Azure OpenAI API \u5bc6\u94a5\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vector_search_provider"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5411\u91cf\u641c\u7d22\u63d0\u4f9b\u5546\u7684\u914d\u7f6e\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vector_search_provider.azure_ai_search"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"Azure AI Search \u7684\u914d\u7f6e\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vector_search_provider.azure_ai_search.endpoint"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Azure AI Search \u7aef\u70b9\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vector_search_provider.azure_ai_search.api_key"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Azure AI Search API \u5bc6\u94a5\u3002")))),(0,r.kt)("h2",{id:"\u8bf7\u6c42\u4f53\u683c\u5f0f"},"\u8bf7\u6c42\u4f53\u683c\u5f0f"),(0,r.kt)("p",null,"\u8bf7\u6c42\u4f53\u4e2d\u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u5b57\u6bb5"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ai_rag"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bf7\u6c42\u4f53 RAG \u89c4\u8303\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ai_rag.embeddings"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u751f\u6210\u5d4c\u5165\u6240\u9700\u7684\u8bf7\u6c42\u53c2\u6570\u3002\u5185\u5bb9\u5c06\u53d6\u51b3\u4e8e\u914d\u7f6e\u7684\u63d0\u4f9b\u5546\u7684 API \u89c4\u8303\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ai_rag.vector_search"),(0,r.kt)("td",{parentName:"tr",align:null},"object"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6267\u884c\u5411\u91cf\u641c\u7d22\u6240\u9700\u7684\u8bf7\u6c42\u53c2\u6570\u3002\u5185\u5bb9\u5c06\u53d6\u51b3\u4e8e\u914d\u7f6e\u7684\u63d0\u4f9b\u5546\u7684 API \u89c4\u8303\u3002")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"ai_rag.embeddings")," \u7684\u53c2\u6570"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Azure OpenAI")),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u9009\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"input"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u8ba1\u7b97\u5d4c\u5165\u7684\u8f93\u5165\u6587\u672c\uff0c\u7f16\u7801\u4e3a\u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"user"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4ee3\u8868\u60a8\u7684\u6700\u7ec8\u7528\u6237\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u53ef\u4ee5\u5e2e\u52a9\u76d1\u63a7\u548c\u68c0\u6d4b\u6ee5\u7528\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"encoding_format"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8fd4\u56de\u5d4c\u5165\u7684\u683c\u5f0f\u3002\u53ef\u4ee5\u662f ",(0,r.kt)("inlineCode",{parentName:"td"},"float")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"td"},"base64"),"\u3002\u9ed8\u8ba4\u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"float"),"\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"dimensions"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,r.kt)("td",{parentName:"tr",align:null},"integer"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7ed3\u679c\u8f93\u51fa\u5d4c\u5165\u5e94\u5177\u6709\u7684\u7ef4\u6570\u3002\u4ec5\u5728 text-embedding-3 \u53ca\u66f4\u9ad8\u7248\u672c\u7684\u6a21\u578b\u4e2d\u652f\u6301\u3002")))))),(0,r.kt)("p",null,"\u6709\u5173\u5176\u4ed6\u53c2\u6570\uff0c\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/ai-services/openai/reference#embeddings"},"Azure OpenAI \u5d4c\u5165\u6587\u6863"),"\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"ai_rag.vector_search")," \u7684\u53c2\u6570"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Azure AI Search")),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u5b57\u6bb5"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u9009\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"fields"),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5411\u91cf\u641c\u7d22\u7684\u5b57\u6bb5\u3002")))),(0,r.kt)("p",{parentName:"li"},"\u6709\u5173\u5176\u4ed6\u53c2\u6570\uff0c\u8bf7\u53c2\u9605 ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/rest/api/searchservice/documents/search-post"},"Azure AI Search \u6587\u6863"),"\u3002"))),(0,r.kt)("p",null,"\u793a\u4f8b\u8bf7\u6c42\u4f53\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "ai_rag": {\n    "vector_search": { "fields": "contentVector" },\n    "embeddings": {\n      "input": "which service is good for devops",\n      "dimensions": 1024\n    }\n  }\n}\n')),(0,r.kt)("h2",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,r.kt)("p",null,"\u8981\u8ddf\u968f\u793a\u4f8b\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com"},"Azure \u8d26\u6237"),"\u5e76\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9aa4\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728 ",(0,r.kt)("a",{parentName:"li",href:"https://oai.azure.com/portal"},"Azure AI Foundry")," \u4e2d\uff0c\u90e8\u7f72\u4e00\u4e2a\u751f\u6210\u5f0f\u804a\u5929\u6a21\u578b\uff0c\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"gpt-4o"),"\uff0c\u4ee5\u53ca\u4e00\u4e2a\u5d4c\u5165\u6a21\u578b\uff0c\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"text-embedding-3-large"),"\u3002\u83b7\u53d6 API \u5bc6\u94a5\u548c\u6a21\u578b\u7aef\u70b9\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6309\u7167 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Azure/azure-search-vector-samples/blob/main/demo-python/code/basic-vector-workflow/azure-search-vector-python-sample.ipynb"},"Azure \u7684\u793a\u4f8b"),"\u4f7f\u7528 Python \u5728 ",(0,r.kt)("a",{parentName:"li",href:"https://azure.microsoft.com/en-us/products/ai-services/ai-search"},"Azure AI Search")," \u4e2d\u51c6\u5907\u5411\u91cf\u641c\u7d22\u3002\u8be5\u793a\u4f8b\u5c06\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"vectest")," \u7684\u641c\u7d22\u7d22\u5f15\uff0c\u5177\u6709\u6240\u9700\u7684\u67b6\u6784\uff0c\u5e76\u4e0a\u4f20\u5305\u542b 108 \u4e2a\u5404\u79cd Azure \u670d\u52a1\u63cf\u8ff0\u7684",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Azure/azure-search-vector-samples/blob/main/data/text-sample.json"},"\u793a\u4f8b\u6570\u636e"),"\uff0c\u4ee5\u4fbf\u57fa\u4e8e ",(0,r.kt)("inlineCode",{parentName:"li"},"title")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"content")," \u751f\u6210\u5d4c\u5165 ",(0,r.kt)("inlineCode",{parentName:"li"},"titleVector")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"contentVector"),"\u3002\u5728 Python \u4e2d\u6267\u884c\u5411\u91cf\u641c\u7d22\u4e4b\u524d\u5b8c\u6210\u6240\u6709\u8bbe\u7f6e\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5728 ",(0,r.kt)("a",{parentName:"li",href:"https://azure.microsoft.com/en-us/products/ai-services/ai-search"},"Azure AI Search")," \u4e2d\uff0c",(0,r.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/search/search-get-started-vector?tabs=api-key#retrieve-resource-information"},"\u83b7\u53d6 Azure \u5411\u91cf\u641c\u7d22 API \u5bc6\u94a5\u548c\u641c\u7d22\u670d\u52a1\u7aef\u70b9"),"\u3002")),(0,r.kt)("p",null,"\u5c06 API \u5bc6\u94a5\u548c\u7aef\u70b9\u4fdd\u5b58\u5230\u73af\u5883\u53d8\u91cf\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u66ff\u6362\u4e3a\u60a8\u7684\u503c\n\nAZ_OPENAI_DOMAIN=https://ai-plugin-developer.openai.azure.com\nAZ_OPENAI_API_KEY=9m7VYroxITMDEqKKEnpOknn1rV7QNQT7DrIBApcwMLYJQQJ99ALACYeBjFXJ3w3AAABACOGXGcd\nAZ_CHAT_ENDPOINT=${AZ_OPENAI_DOMAIN}/openai/deployments/gpt-4o/chat/completions?api-version=2024-02-15-preview\nAZ_EMBEDDING_MODEL=text-embedding-3-large\nAZ_EMBEDDINGS_ENDPOINT=${AZ_OPENAI_DOMAIN}/openai/deployments/${AZ_EMBEDDING_MODEL}/embeddings?api-version=2023-05-15\n\nAZ_AI_SEARCH_SVC_DOMAIN=https://ai-plugin-developer.search.windows.net\nAZ_AI_SEARCH_KEY=IFZBp3fKVdq7loEVe9LdwMvVdZrad9A4lPH90AzSeC06SlR\nAZ_AI_SEARCH_INDEX=vectest\nAZ_AI_SEARCH_ENDPOINT=${AZ_AI_SEARCH_SVC_DOMAIN}/indexes/${AZ_AI_SEARCH_INDEX}/docs/search?api-version=2024-07-01\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4ece ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml")," \u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_key")," \u5e76\u4fdd\u5b58\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff1a"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"admin_key=$(yq '.deployment.admin.admin_key[0].key' conf/config.yaml | sed 's/\"//g')\n")))),(0,r.kt)("h3",{id:"\u4e0e-azure-\u96c6\u6210\u4ee5\u83b7\u5f97-rag-\u589e\u5f3a\u54cd\u5e94"},"\u4e0e Azure \u96c6\u6210\u4ee5\u83b7\u5f97 RAG \u589e\u5f3a\u54cd\u5e94"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"/zh/docs/apisix/plugins/ai-proxy"},(0,r.kt)("inlineCode",{parentName:"a"},"ai-proxy"))," \u63d2\u4ef6\u5c06\u8bf7\u6c42\u4ee3\u7406\u5230 Azure OpenAI LLM\uff0c\u5e76\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ai-rag")," \u63d2\u4ef6\u751f\u6210\u5d4c\u5165\u548c\u6267\u884c\u5411\u91cf\u641c\u7d22\u4ee5\u589e\u5f3a LLM \u54cd\u5e94\u3002"),(0,r.kt)("p",null,"\u521b\u5efa\u8def\u7531\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes" -X PUT \\\n  -H "X-API-KEY: ${ADMIN_API_KEY}" \\\n  -d \'{\n  "id": "ai-rag-route",\n  "uri": "/rag",\n  "plugins": {\n    "ai-rag": {\n      "embeddings_provider": {\n        "azure_openai": {\n          "endpoint": "\'"$AZ_EMBEDDINGS_ENDPOINT"\'",\n          "api_key": "\'"$AZ_OPENAI_API_KEY"\'"\n        }\n      },\n      "vector_search_provider": {\n        "azure_ai_search": {\n          "endpoint": "\'"$AZ_AI_SEARCH_ENDPOINT"\'",\n          "api_key": "\'"$AZ_AI_SEARCH_KEY"\'"\n        }\n      }\n    },\n    "ai-proxy": {\n      "provider": "openai",\n      "auth": {\n        "header": {\n          "api-key": "\'"$AZ_OPENAI_API_KEY"\'"\n        }\n      },\n      "model": "gpt-4o",\n      "override": {\n        "endpoint": "\'"$AZ_CHAT_ENDPOINT"\'"\n      }\n    }\n  }\n}\'\n')),(0,r.kt)("p",null,"\u5411\u8def\u7531\u53d1\u9001 POST \u8bf7\u6c42\uff0c\u5728\u8bf7\u6c42\u4f53\u4e2d\u5305\u542b\u5411\u91cf\u5b57\u6bb5\u540d\u79f0\u3001\u5d4c\u5165\u6a21\u578b\u7ef4\u5ea6\u548c\u8f93\u5165\u63d0\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/rag" -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "ai_rag":{\n      "vector_search":{\n        "fields":"contentVector"\n      },\n      "embeddings":{\n        "input":"Which Azure services are good for DevOps?",\n        "dimensions":1024\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"\u60a8\u5e94\u8be5\u6536\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP/1.1 200 OK")," \u54cd\u5e94\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "choices": [\n    {\n      "content_filter_results": {\n        ...\n      },\n      "finish_reason": "length",\n      "index": 0,\n      "logprobs": null,\n      "message": {\n        "content": "Here is a list of Azure services categorized along with a brief description of each based on the provided JSON data:\\n\\n### Developer Tools\\n- **Azure DevOps**: A suite of services that help you plan, build, and deploy applications, including Azure Boards, Azure Repos, Azure Pipelines, Azure Test Plans, and Azure Artifacts.\\n- **Azure DevTest Labs**: A fully managed service to create, manage, and share development and test environments in Azure, supporting custom templates, cost management, and integration with Azure DevOps.\\n\\n### Containers\\n- **Azure Kubernetes Service (AKS)**: A managed container orchestration service based on Kubernetes, simplifying deployment and management of containerized applications with features like automatic upgrades and scaling.\\n- **Azure Container Instances**: A serverless container runtime to run and scale containerized applications without managing the underlying infrastructure.\\n- **Azure Container Registry**: A fully managed Docker registry service to store and manage container images and artifacts.\\n\\n### Web\\n- **Azure App Service**: A fully managed platform for building, deploying, and scaling web apps, mobile app backends, and RESTful APIs with support for multiple programming languages.\\n- **Azure SignalR Service**: A fully managed real-time messaging service to build and scale real-time web applications.\\n- **Azure Static Web Apps**: A serverless hosting service for modern web applications using static front-end technologies and serverless APIs.\\n\\n### Compute\\n- **Azure Virtual Machines**: Infrastructure-as-a-Service (IaaS) offering for deploying and managing virtual machines in the cloud.\\n- **Azure Functions**: A serverless compute service to run event-driven code without managing infrastructure.\\n- **Azure Batch**: A job scheduling service to run large-scale parallel and high-performance computing (HPC) applications.\\n- **Azure Service Fabric**: A platform to build, deploy, and manage scalable and reliable microservices and container-based applications.\\n- **Azure Quantum**: A quantum computing service to build and run quantum applications.\\n- **Azure Stack Edge**: A managed edge computing appliance to run Azure services and AI workloads on-premises or at the edge.\\n\\n### Security\\n- **Azure Bastion**: A fully managed service providing secure and scalable remote access to virtual machines.\\n- **Azure Security Center**: A unified security management service to protect workloads across Azure and on-premises infrastructure.\\n- **Azure DDoS Protection**: A cloud-based service to protect applications and resources from distributed denial-of-service (DDoS) attacks.\\n\\n### Databases\\n",\n        "role": "assistant"\n      }\n    }\n  ],\n  "created": 1740625850,\n  "id": "chatcmpl-B54gQdumpfioMPIybFnirr6rq9ZZS",\n  "model": "gpt-4o-2024-05-13",\n  "object": "chat.completion",\n  "prompt_filter_results": [\n    {\n      "prompt_index": 0,\n      "content_filter_results": {\n        ...\n      }\n    }\n  ],\n  "system_fingerprint": "fp_65792305e4",\n  "usage": {\n    ...\n  }\n}\n')))}u.isMDXComponent=!0}}]);