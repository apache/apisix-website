"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[33752],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),g=o,f=d["".concat(l,".").concat(g)]||d[g]||p[g]||i;return n?r.createElement(f,a(a({ref:t},u),{},{components:n})):r.createElement(f,a({ref:t},u))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},72450:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=n(87462),o=(n(67294),n(3905));const i={title:"Configuration Troubleshooting",slug:"/reference/apisix-ingress-controller/configuration-troubleshoot",description:"Learn how to inspect and troubleshoot configuration translation and synchronization in APISIX Ingress Controller."},a=void 0,s={unversionedId:"reference/troubleshoot",id:"version-2.0.0/reference/troubleshoot",isDocsHomePage:!1,title:"Configuration Troubleshooting",description:"Learn how to inspect and troubleshoot configuration translation and synchronization in APISIX Ingress Controller.",source:"@site/docs-apisix-ingress-controller_versioned_docs/version-2.0.0/reference/troubleshoot.md",sourceDirName:"reference",slug:"/reference/apisix-ingress-controller/configuration-troubleshoot",permalink:"/zh/docs/ingress-controller/reference/apisix-ingress-controller/configuration-troubleshoot",editUrl:"/zh/edit#https://github.com/apache/apisix-ingress-controller/edit/v2.0.0/docs/zh/latest/reference/troubleshoot.md",tags:[],version:"2.0.0",frontMatter:{title:"Configuration Troubleshooting",slug:"/reference/apisix-ingress-controller/configuration-troubleshoot",description:"Learn how to inspect and troubleshoot configuration translation and synchronization in APISIX Ingress Controller."},sidebar:"version-2.0.0/docs",previous:{title:"Configuration Examples",permalink:"/zh/docs/ingress-controller/reference/apisix-ingress-controller/examples"},next:{title:"Configuration File",permalink:"/zh/docs/ingress-controller/reference/apisix-ingress-controller/configuration-file"}},l=[{value:"Inspect Translated ADC Configurations",id:"inspect-translated-adc-configurations",children:[]},{value:"Inspect Synchronized Gateway Configurations",id:"inspect-synchronized-gateway-configurations",children:[]}],c={toc:l};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Troubleshooting is required if the applied behavior does not match expectations, such as routes not being created correctly, plugins not being applied, or services failing to route traffic."),(0,o.kt)("p",null,"When you apply a Kubernetes resource\u2014whether a Gateway API, Ingress, or APISIX CRD\u2014the Ingress Controller translates it into ADC YAML, which is then applied to the gateway."),(0,o.kt)("p",null,"This document explains how to inspect the translated ADC configurations in memory and check the configurations actually applied to the gateway."),(0,o.kt)("h2",{id:"inspect-translated-adc-configurations"},"Inspect Translated ADC Configurations"),(0,o.kt)("p",null,"APISIX Ingress Controller provides a browser-accessible debug API that displays the translated ADC configurations, derived from the last applied Gateway API, Ingress, and APISIX CRD resources, in JSON format. It helps inspect the ",(0,o.kt)("strong",{parentName:"p"},"in-memory state before the configurations are synchronized with the gateway"),"."),(0,o.kt)("p",null,"To use the debug API, configure these values in the ingress controller's ",(0,o.kt)("a",{parentName:"p",href:"/zh/docs/ingress-controller/reference/apisix-ingress-controller/configuration-file"},"configuration file"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config.yaml"',title:'"config.yaml"'},'enable_server: true             # Enable the debug API server\nserver_addr: "127.0.0.1:9092"   # Server address\n')),(0,o.kt)("p",null,"These values are not yet available in the Helm chart. To apply the changes, modify the ConfigMap and restart the controller Deployment."),(0,o.kt)("p",null,"Once the debug API is enabled, you can access it by forwarding the controller pod\u2019s port to your local machine:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward pod/<your-apisix-ingress-controller-pod-name> 9092:9092 &\n")),(0,o.kt)("p",null,"You can now access the debug API in browser at ",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1:9092/debug")," and inspect the translated resources by resource type, such as routes and services."),(0,o.kt)("h2",{id:"inspect-synchronized-gateway-configurations"},"Inspect Synchronized Gateway Configurations"),(0,o.kt)("p",null,"To inspect the configurations synchronized to the gateway, you can use the Admin API."),(0,o.kt)("p",null,"First, forward the Admin API's service port to your local machine:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward service/apisix-admin 9180:9180 &\n")),(0,o.kt)("p",null,"If you are using APISIX in standalone mode, you can send a request to ",(0,o.kt)("inlineCode",{parentName:"p"},"/apisix/admin/configs")," to view all configurations synchronized to the gateway:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/configs" -H "X-API-KEY: ${ADMIN_API_KEY}"\n')),(0,o.kt)("p",null,"If you are using APISIX with etcd, you can send a request to ",(0,o.kt)("inlineCode",{parentName:"p"},"/apisix/admin/<resource>")," to view the synchronized configurations of specific resources. For instance, to view the route configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes" -H "X-API-KEY: ${ADMIN_API_KEY}"\n')),(0,o.kt)("p",null,"For reference, see ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/admin-api/"},"Admin API"),"."))}u.isMDXComponent=!0}}]);