<!doctype html>
<html class="docs-version-2.7" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/releases/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/releases/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">FAQ | Apache APISIX¬Æ --  Cloud-Native API Gateway</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org/img/favicon.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org/img/favicon.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/docs/apisix/2.7/FAQ"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="2.7"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-apisix-2.7"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" property="og:title" content="FAQ | Apache APISIX¬Æ --  Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/docs/apisix/2.7/FAQ"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/apisix/2.7/FAQ" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/docs/apisix/2.7/FAQ" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/apisix/2.7/FAQ" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/css/styles.0ee3ec58.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/runtime~main.ea969a47.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/main.f5b1410f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">ü§î Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ">join #apisix channel</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/security">General</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">FAQ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/FAQ/">Apache APISIX¬Æ</a></li><li><a class="dropdown__link" href="/docs/dashboard/FAQ/">Apache APISIX¬Æ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/FAQ/">Apache APISIX¬Æ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/FAQ/">Apache APISIX¬Æ Helm Chart</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/releases">Releases</a></li><li><a class="dropdown__link" href="/help">Help</a></li></ul></div><a class="navbar__item navbar__link" href="/showcase">Showcase</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/apisix/2.7/FAQ" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/apisix/2.7/FAQ" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3AUJ"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_2LAn"><div class="sidebar_3jCp sidebarWithHideableNavbar_Uxjr"><a tabindex="-1" class="sidebarLogo_8bKs" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--dark_hz6m"><b>Apache APISIX¬Æ</b></a><div class="sidebarVersionSwitch_m-Df">Version:<div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/docs/apisix/2.7/architecture-design/apisix">2.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/next/FAQ">Next</a></li><li><a class="dropdown__link" href="/docs/apisix/FAQ">2.10.1</a></li><li><a class="dropdown__link" href="/docs/apisix/2.10/FAQ">2.10</a></li><li><a class="dropdown__link" href="/docs/apisix/2.9/FAQ">2.9</a></li><li><a class="dropdown__link" href="/docs/apisix/2.8/FAQ">2.8</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/apisix/2.7/FAQ">2.7</a></li><li><a class="dropdown__link" href="/docs/apisix/2.6/FAQ">2.6</a></li><li><a class="dropdown__link" href="/docs/apisix/2.5/FAQ">2.5</a></li><li><a class="dropdown__link" href="/docs/apisix/2.4/FAQ">2.4</a></li></ul></div></div><nav class="menu thin-scrollbar menu_1DcY menuWithAnnouncementBar_3IKd"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture Design</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/apisix/2.7/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/apisix/2.7/how-to-build">How to build Apache APISIX</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Plugins</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/apisix/2.7/FAQ">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Others</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a href="https://github.com/apache/apisix/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="menu__link"><span>CHANGELOG<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_3okl"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_1LB5"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_2AUC"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache APISIX¬Æ --  Cloud-Native API Gateway <b>2.7</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/apisix/FAQ">latest version</a></b> (2.10.1).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.7</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FAQ</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-a-new-api-gateway"></a>Why a new API gateway?<a class="hash-link" href="#why-a-new-api-gateway" title="Direct link to heading">#</a></h2><p>There are new requirements for API gateways in the field of microservices: higher flexibility, higher performance requirements, and cloud native.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="what-are-the-differences-between-apisix-and-other-api-gateways"></a>What are the differences between APISIX and other API gateways?<a class="hash-link" href="#what-are-the-differences-between-apisix-and-other-api-gateways" title="Direct link to heading">#</a></h2><p>APISIX is based on etcd to save and synchronize configuration, not relational databases such as Postgres or MySQL.</p><p>This not only eliminates polling, makes the code more concise, but also makes configuration synchronization more real-time. At the same time, there will be no single point in the system, which is more usable.</p><p>In addition, APISIX has dynamic routing and hot loading of plug-ins, which is especially suitable for API management under micro-service system.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="whats-the-performance-of-apisix"></a>What&#x27;s the performance of APISIX?<a class="hash-link" href="#whats-the-performance-of-apisix" title="Direct link to heading">#</a></h2><p>One of the goals of APISIX design and development is the highest performance in the industry. Specific test data can be found hereÔºö<a href="/docs/apisix/2.7/benchmark">benchmark</a></p><p>APISIX is the highest performance API gateway with a single-core QPS of 23,000, with an average delay of only 0.6 milliseconds.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="does-apisix-have-a-console-interface"></a>Does APISIX have a console interface?<a class="hash-link" href="#does-apisix-have-a-console-interface" title="Direct link to heading">#</a></h2><p>Yes, APISIX has a powerful Dashboard. APISIX and <a href="https://github.com/apache/apisix-dashboard" target="_blank" rel="noopener noreferrer">APISIX Dashboard</a> are independent projects, you can deploy <a href="https://github.com/apache/apisix-dashboard" target="_blank" rel="noopener noreferrer">APISIX Dashboard</a> to operate APISIX through the web interface.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="can-i-write-my-own-plugin"></a>Can I write my own plugin?<a class="hash-link" href="#can-i-write-my-own-plugin" title="Direct link to heading">#</a></h2><p>Of course, APISIX provides flexible custom plugins for developers and businesses to write their own logic.</p><p><a href="/docs/apisix/2.7/plugin-develop">How to write plugin</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-we-choose-etcd-as-the-configuration-center"></a>Why we choose etcd as the configuration center?<a class="hash-link" href="#why-we-choose-etcd-as-the-configuration-center" title="Direct link to heading">#</a></h2><p>For the configuration center, configuration storage is only the most basic function, and APISIX also needs the following features:</p><ol><li>Cluster</li><li>Transactions</li><li>Multi-version Concurrency Control</li><li>Change Notification</li><li>High Performance</li></ol><p>See more <a href="https://github.com/etcd-io/website/blob/master/content/en/docs/next/learning/why.md#comparison-chart" target="_blank" rel="noopener noreferrer">etcd why</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-is-it-that-installing-apisix-dependencies-with-luarocks-causes-timeout-slow-or-unsuccessful-installation"></a>Why is it that installing APISIX dependencies with Luarocks causes timeout, slow or unsuccessful installation?<a class="hash-link" href="#why-is-it-that-installing-apisix-dependencies-with-luarocks-causes-timeout-slow-or-unsuccessful-installation" title="Direct link to heading">#</a></h2><p>There are two possibilities when encountering slow luarocks:</p><ol><li>Server used for luarocks installation is blocked</li><li>There is a place between your network and github server to block the &#x27;git&#x27; protocol</li></ol><p>For the first problem, you can use https_proxy or use the <code>--server</code> option to specify a luarocks server that you can access or access faster.
Run the <code>luarocks config rocks_servers</code> command(this command is supported after luarocks 3.0) to see which server are available.
For China mainland users, you can use the <code>luarocks.cn</code> as the luarocks server.</p><p>We already provide a wrapper in the Makefile to simplify your job:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">LUAROCKS_SERVER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://luarocks.cn </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> deps</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If using a proxy doesn&#x27;t solve this problem, you can add <code>--verbose</code> option during installation to see exactly how slow it is. Excluding the first case, only the second that the <code>git</code> protocol is blocked. Then we can run <code>git config --global url.&quot;https://&quot;.insteadOf git://</code> to using the &#x27;HTTPS&#x27; protocol instead of <code>git</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-support-gray-release-via-apisix"></a>How to support gray release via APISIX?<a class="hash-link" href="#how-to-support-gray-release-via-apisix" title="Direct link to heading">#</a></h2><p>An example, <code>foo.com/product/index.html?id=204&amp;page=2</code>, gray release based on <code>id</code> in the query string in URL as a conditionÔºö</p><ol><li>Group AÔºöid &lt;= 1000</li><li>Group BÔºöid &gt; 1000</li></ol><p>There are two different ways to do thisÔºö</p><ol><li>Use the <code>vars</code> field of route to do it.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/index.html&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;vars&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        [&quot;arg_id&quot;, &quot;&lt;=&quot;, &quot;1000&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;redirect&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;uri&quot;: &quot;/test?group_id=1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/2 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/index.html&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;vars&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        [&quot;arg_id&quot;, &quot;&gt;&quot;, &quot;1000&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;redirect&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;uri&quot;: &quot;/test?group_id=2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here is the operator list of current <code>lua-resty-radixtree</code>Ôºö
<a href="https://github.com/iresty/lua-resty-radixtree#operator-list" target="_blank" rel="noopener noreferrer">https://github.com/iresty/lua-resty-radixtree#operator-list</a></p><ol start="2"><li>Use <code>traffic-split</code> plugin to do it.</li></ol><p>Please refer to the <a href="/docs/apisix/2.7/plugins/traffic-split">traffic-split.md</a> plugin documentation for usage examples.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-redirect-http-to-https-via-apisix"></a>How to redirect http to https via APISIX?<a class="hash-link" href="#how-to-redirect-http-to-https-via-apisix" title="Direct link to heading">#</a></h2><p>An example, redirect <code>http://foo.com</code> to <code>https://foo.com</code></p><p>There are several different ways to do this.</p><ol><li>Directly use the <code>http_to_https</code> in <code>redirect</code> pluginÔºö</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/hello&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;host&quot;: &quot;foo.com&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;redirect&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;http_to_https&quot;: true</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Use with advanced routing rule <code>vars</code> with <code>redirect</code> plugin:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/hello&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;host&quot;: &quot;foo.com&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;vars&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;scheme&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;==&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;http&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        ]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;redirect&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;uri&quot;: &quot;https://</span><span class="token string variable" style="color:#36acaa">$host</span><span class="token string variable" style="color:#36acaa">$request_uri</span><span class="token string" style="color:#e3116c">&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;ret_code&quot;: 301</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li><code>serverless</code> pluginÔºö</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/hello&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;serverless-pre-function&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;phase&quot;: &quot;rewrite&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;functions&quot;: [&quot;return function() if ngx.var.scheme == </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">http</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c"> and ngx.var.host == </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">foo.com</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c"> then ngx.header[</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">Location</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">] = </span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">https://foo.com</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c"> .. ngx.var.request_uri; ngx.exit(ngx.HTTP_MOVED_PERMANENTLY); end; end&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then test it to see if it worksÔºö</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i -H </span><span class="token string" style="color:#e3116c">&#x27;Host: foo.com&#x27;</span><span class="token plain"> http://127.0.0.1:9080/hello</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The response body should be:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> Moved Permanently</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Mon, </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> May </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"> 02:56:04 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/html</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: </span><span class="token number" style="color:#36acaa">166</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Location: https://foo.com/hello</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: APISIX web server</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">html</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> Moved Permanently</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/title</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/head</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">301</span><span class="token plain"> Moved Permanently</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/h</span><span class="token operator file-descriptor important" style="color:#393A34">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hr</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">openresty</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/center</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/body</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/html</span><span class="token operator" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-change-the-log-level"></a>How to change the log level?<a class="hash-link" href="#how-to-change-the-log-level" title="Direct link to heading">#</a></h2><p>The default log level for APISIX is <code>warn</code>. However You can change the log level to <code>info</code> if you want to trace the messages print by <code>core.log.info</code>.</p><p>Steps:</p><ol><li>Modify the parameter <code>error_log_level: &quot;warn&quot;</code> to <code>error_log_level: &quot;info&quot;</code> in conf/config.yaml.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nginx_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">error_log_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;info&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Reload or restart APISIX</li></ol><p>Now you can trace the info level log in logs/error.log.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-reload-your-own-plugin"></a>How to reload your own plugin?<a class="hash-link" href="#how-to-reload-your-own-plugin" title="Direct link to heading">#</a></h2><p>The Apache APISIX plugin supports hot reloading.
See the <code>Hot reload</code> section in <a href="/docs/apisix/2.7/plugins">plugins</a> for how to do that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-make-apisix-listen-on-multiple-ports-when-handling-http-or-https-requests"></a>How to make APISIX listen on multiple ports when handling HTTP or HTTPS requests?<a class="hash-link" href="#how-to-make-apisix-listen-on-multiple-ports-when-handling-http-or-https-requests" title="Direct link to heading">#</a></h2><p>By default, APISIX only listens on port 9080 when handling HTTP requests. If you want APISIX to listen on multiple ports, you need to modify the relevant parameters in the configuration file as follows:</p><ol><li><p>Modify the parameter of HTTP port listen <code>node_listen</code> in <code>conf/config.yaml</code>, for example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> apisix:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   node_listen:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     - </span><span class="token number" style="color:#36acaa">9080</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     - </span><span class="token number" style="color:#36acaa">9081</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     - </span><span class="token number" style="color:#36acaa">9082</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Handling HTTPS requests is similar, modify the parameter of HTTPS port listen <code>ssl.listen_port</code> in <code>conf/config.yaml</code>, for example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apisix:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen_port:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token number" style="color:#36acaa">9443</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token number" style="color:#36acaa">9444</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token number" style="color:#36acaa">9445</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Reload or restart APISIX</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-does-apisix-use-etcd-to-achieve-millisecond-level-configuration-synchronization"></a>How does APISIX use etcd to achieve millisecond-level configuration synchronization<a class="hash-link" href="#how-does-apisix-use-etcd-to-achieve-millisecond-level-configuration-synchronization" title="Direct link to heading">#</a></h2><p>etcd provides subscription functions to monitor whether the specified keyword or directory is changed (for example: <a href="https://github.com/api7/lua-resty-etcd/blob/master/api_v3.md#watch" target="_blank" rel="noopener noreferrer">watch</a>, <a href="https://github.com/api7/lua-resty-etcd/blob/master/api_v3.md#watchdir" target="_blank" rel="noopener noreferrer">watchdir</a>).</p><p>APISIX uses <a href="https://github.com/api7/lua-resty-etcd/blob/master/api_v3.md#watchdir" target="_blank" rel="noopener noreferrer">etcd.watchdir</a> to monitor directory content changes:</p><ul><li>If there is no data update in the monitoring directory: the process will be blocked until timeout or other errors occurred.</li><li>If the monitoring directory has data updates: etcd will return the new subscribed data immediately (in milliseconds), and APISIX will update it to the memory cache.</li></ul><p>With the help of etcd which incremental notification feature is millisecond-level, APISIX achieve millisecond-level of configuration synchronization.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-customize-the-apisix-instance-id"></a>How to customize the APISIX instance id?<a class="hash-link" href="#how-to-customize-the-apisix-instance-id" title="Direct link to heading">#</a></h2><p>By default, APISIX will read the instance id from <code>conf/apisix.uid</code>. If it is not found, and no id is configured, APISIX will generate a <code>uuid</code> as the instance id.</p><p>If you want to specify a meaningful id to bind APISIX instance to your internal system, you can configure it in <code>conf/config.yaml</code>, for example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">``</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa"></span></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">apisix:</span></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">  id: </span><span class="token variable string" style="color:#e3116c">&quot;your-meaningful-id&quot;</span><span class="token variable" style="color:#36acaa"></span></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">``</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-there-are-a-lot-of-failed-to-fetch-data-from-etcd-failed-to-read-etcd-dir-etcd-key-xxxxxx-errors-in-errorlog"></a>Why there are a lot of &quot;failed to fetch data from etcd, failed to read etcd dir, etcd key: xxxxxx&quot; errors in error.log?<a class="hash-link" href="#why-there-are-a-lot-of-failed-to-fetch-data-from-etcd-failed-to-read-etcd-dir-etcd-key-xxxxxx-errors-in-errorlog" title="Direct link to heading">#</a></h2><p>First please make sure the network between APISIX and etcd cluster is not partitioned.</p><p>If the network is healthy, please check whether your etcd cluster enables the <a href="https://etcd.io/docs/v3.4.0/dev-guide/api_grpc_gateway/" target="_blank" rel="noopener noreferrer">gRPC gateway</a>.  However, The default case for this feature is different when use command line options or configuration file to start etcd server.</p><ol><li>When command line options is in use, this feature is enabled by default, the related option is <code>--enable-grpc-gateway</code>.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">etcd --enable-grpc-gateway --data-dir=/path/to/data</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note this option is not shown in the output of <code>etcd --help</code>.</p><ol start="2"><li>When configuration file is used, this feature is disabled by default, please enable <code>enable-grpc-gateway</code> explicitly.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># etcd.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;enable-grpc-gateway&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data-dir&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/data&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># etcd.conf.yml</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">enable-grpc-gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Indeed this distinction was eliminated by etcd in their master branch, but not backport to announced versions, so be care when deploy your etcd cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-set-up-high-available-apache-apisix-clusters"></a>How to set up high available Apache APISIX clusters?<a class="hash-link" href="#how-to-set-up-high-available-apache-apisix-clusters" title="Direct link to heading">#</a></h2><p>The high availability of APISIX can be divided into two parts:</p><ol><li><p>The data plane of Apache APISIX is stateless and can be elastically scaled at will. Just add a layer of LB in front.</p></li><li><p>The control plane of Apache APISIX relies on the highly available implementation of <code>etcd cluster</code> and does not require any relational database dependency.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-does-the-make-deps-command-fail-in-source-installation"></a>Why does the <code>make deps</code> command fail in source installation?<a class="hash-link" href="#why-does-the-make-deps-command-fail-in-source-installation" title="Direct link to heading">#</a></h2><p>When executing the <code>make deps</code> command, an error such as the one shown below occurs. This is caused by the missing openresty&#x27;s <code>openssl</code> development kit, you need to install it first. Please refer to the <a href="/docs/apisix/2.7/install-dependencies">install dependencies</a> document for installation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> deps</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: Failed installing dependency: https://luarocks.org/luasec-0.9-1.src.rock - Could not </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> header </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> OPENSSL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  No </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> openssl/ssl.h </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /usr/local/include</span></span><span class="token-line" style="color:#393A34"><span class="token plain">You may have to </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> OPENSSL </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> your system and/or pass OPENSSL_DIR or OPENSSL_INCDIR to the luarocks command.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Example: luarocks </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> luasec </span><span class="token assign-left variable" style="color:#36acaa">OPENSSL_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local</span></span><span class="token-line" style="color:#393A34"><span class="token plain">make: *** </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">deps</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Error </span><span class="token number" style="color:#36acaa">1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-access-apisix-dashboard-through-apisix-proxy"></a>How to access APISIX Dashboard through APISIX proxy<a class="hash-link" href="#how-to-access-apisix-dashboard-through-apisix-proxy" title="Direct link to heading">#</a></h2><ol><li>Keep the APISIX proxy port and Admin API port different(or disable Admin API). For example, do the following configuration in <code>conf/config.yaml</code>.</li></ol><p>The Admin API use a separate port 9180:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apisix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port_admin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9180</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># use a separate port</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Add proxy route of APISIX Dashboard:</li></ol><p>Note: The APISIX Dashboard service here is listening on <code>127.0.0.1:9000</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9180/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uris&quot;:[ &quot;/*&quot; ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;name&quot;:&quot;apisix_proxy_dashboard&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;:[</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;host&quot;:&quot;127.0.0.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;port&quot;:9000,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;weight&quot;:1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;:&quot;roundrobin&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-use-route-uri-for-regular-matching"></a>How to use route <code>uri</code> for regular matching<a class="hash-link" href="#how-to-use-route-uri-for-regular-matching" title="Direct link to heading">#</a></h2><p>The regular matching of uri is achieved through the <code>vars</code> field of route.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/*&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;vars&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        [&quot;uri&quot;, &quot;~~&quot;, &quot;^/[a-z]+$&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;127.0.0.1:1980&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Test request:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># The uri matched successfully</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/hello -i</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The uri match failed</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/12ab -i</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">404</span><span class="token plain"> Not Found</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In route, we can achieve more condition matching by combining <code>uri</code> with <code>vars</code> field. For more details of using <code>vars</code>, please refer to <a href="https://github.com/api7/lua-resty-expr" target="_blank" rel="noopener noreferrer">lua-resty-expr</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="does-the-upstream-node-support-configuring-the-fqdn-address"></a>Does the upstream node support configuring the <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name" target="_blank" rel="noopener noreferrer">FQDN</a> address<a class="hash-link" href="#does-the-upstream-node-support-configuring-the-fqdn-address" title="Direct link to heading">#</a></h2><p>This is supported. Here is an example where the <code>FQDN</code> is <code>httpbin.default.svc.cluster.local</code>:</p><p>This is supported. Here is an example where the <code>FQDN</code> is <code>httpbin.default.svc.cluster.local</code> (a Kubernetes Service):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;: &quot;/ip&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;httpbin.default.svc.cluster.local&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Test request</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/ip -i</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="what-is-the-x-api-key-of-admin-api-can-it-be-modified"></a>What is the <code>X-API-KEY</code> of Admin API? Can it be modified?<a class="hash-link" href="#what-is-the-x-api-key-of-admin-api-can-it-be-modified" title="Direct link to heading">#</a></h2><ol><li>The <code>X-API-KEY</code> of Admin API refers to the <code>apisix.admin_key.key</code> in the <code>config.yaml</code> file, and the default value is <code>edd1c9f034335f136f87ad84b625c8f1</code>. It is the access token of the Admin API.</li></ol><p>Note: There are security risks in using the default API token. It is recommended to update it when deploying to a production environment.</p><ol start="2"><li><code>X-API-KEY</code> can be modified.</li></ol><p>For example: make the following changes to the <code>apisix.admin_key.key</code> in the <code>conf/config.yaml</code> file and reload APISIX.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apisix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  admin_key</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> abcdefghabcdefgh</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Access the Admin API:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -i http://127.0.0.1:9080/apisix/admin/routes/1  -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: abcdefghabcdefgh&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uris&quot;:[ &quot;/*&quot; ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;name&quot;:&quot;admin-token-test&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;:{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;:[</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;host&quot;:&quot;127.0.0.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;port&quot;:1980,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;weight&quot;:1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        ],</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;:&quot;roundrobin&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The route was created successfully. It means that the modification of <code>X-API-KEY</code> takes effect.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-allow-all-ips-to-access-admin-api"></a>How to allow all IPs to access Admin API<a class="hash-link" href="#how-to-allow-all-ips-to-access-admin-api" title="Direct link to heading">#</a></h2><p>By default, Apache APISIX only allows the IP range of <code>127.0.0.0/24</code> to access the <code>Admin API</code>. If you want to allow all IP access, then you only need to add the following configuration in the <code>conf/config.yaml</code> configuration file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apisix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allow_admin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0.0.0.0/0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Restart or reload APISIX, all IPs can access the <code>Admin API</code>.</p><p><strong>Note: You can use this method in a non-production environment to allow all clients from anywhere to access your <code>Apache APISIX</code> instances, but it is not safe to use it in a production environment. In production environment, please only authorize specific IP addresses or address ranges to access your instance.</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-auto-renew-ssl-cert-via-acmesh"></a>How to auto renew SSL cert via acme.sh<a class="hash-link" href="#how-to-auto-renew-ssl-cert-via-acmesh" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> --output /root/.acme.sh/renew-hook-update-apisix.sh --silent https://gist.githubusercontent.com/anjia0532/9ebf8011322f43e3f5037bc2af3aeaa6/raw/65b359a4eed0ae990f9188c2afa22bacd8471652/renew-hook-update-apisix.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /root/.acme.sh/renew-hook-update-apisix.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ acme.sh  --issue  --staging  -d demo.domain --renew-hook </span><span class="token string" style="color:#e3116c">&quot;/root/.acme.sh/renew-hook-update-apisix.sh  -h http://apisix-admin:port -p /root/.acme.sh/demo.domain/demo.domain.cer -k /root/.acme.sh/demo.domain/demo.domain.key -a xxxxxxxxxxxxx&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ acme.sh --renew --domain demo.domain</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Blog <a href="https://juejin.cn/post/6965778290619449351" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6965778290619449351</a> has detail setup.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/apisix/edit/master/docs/en/latest/FAQ.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/apisix/2.7/control-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Control API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/apisix/2.7/discovery"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Integration service discovery registry ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-a-new-api-gateway" class="table-of-contents__link">Why a new API gateway?</a></li><li><a href="#what-are-the-differences-between-apisix-and-other-api-gateways" class="table-of-contents__link">What are the differences between APISIX and other API gateways?</a></li><li><a href="#whats-the-performance-of-apisix" class="table-of-contents__link">What&#39;s the performance of APISIX?</a></li><li><a href="#does-apisix-have-a-console-interface" class="table-of-contents__link">Does APISIX have a console interface?</a></li><li><a href="#can-i-write-my-own-plugin" class="table-of-contents__link">Can I write my own plugin?</a></li><li><a href="#why-we-choose-etcd-as-the-configuration-center" class="table-of-contents__link">Why we choose etcd as the configuration center?</a></li><li><a href="#why-is-it-that-installing-apisix-dependencies-with-luarocks-causes-timeout-slow-or-unsuccessful-installation" class="table-of-contents__link">Why is it that installing APISIX dependencies with Luarocks causes timeout, slow or unsuccessful installation?</a></li><li><a href="#how-to-support-gray-release-via-apisix" class="table-of-contents__link">How to support gray release via APISIX?</a></li><li><a href="#how-to-redirect-http-to-https-via-apisix" class="table-of-contents__link">How to redirect http to https via APISIX?</a></li><li><a href="#how-to-change-the-log-level" class="table-of-contents__link">How to change the log level?</a></li><li><a href="#how-to-reload-your-own-plugin" class="table-of-contents__link">How to reload your own plugin?</a></li><li><a href="#how-to-make-apisix-listen-on-multiple-ports-when-handling-http-or-https-requests" class="table-of-contents__link">How to make APISIX listen on multiple ports when handling HTTP or HTTPS requests?</a></li><li><a href="#how-does-apisix-use-etcd-to-achieve-millisecond-level-configuration-synchronization" class="table-of-contents__link">How does APISIX use etcd to achieve millisecond-level configuration synchronization</a></li><li><a href="#how-to-customize-the-apisix-instance-id" class="table-of-contents__link">How to customize the APISIX instance id?</a></li><li><a href="#why-there-are-a-lot-of-failed-to-fetch-data-from-etcd-failed-to-read-etcd-dir-etcd-key-xxxxxx-errors-in-errorlog" class="table-of-contents__link">Why there are a lot of &quot;failed to fetch data from etcd, failed to read etcd dir, etcd key: xxxxxx&quot; errors in error.log?</a></li><li><a href="#how-to-set-up-high-available-apache-apisix-clusters" class="table-of-contents__link">How to set up high available Apache APISIX clusters?</a></li><li><a href="#why-does-the-make-deps-command-fail-in-source-installation" class="table-of-contents__link">Why does the <code>make deps</code> command fail in source installation?</a></li><li><a href="#how-to-access-apisix-dashboard-through-apisix-proxy" class="table-of-contents__link">How to access APISIX Dashboard through APISIX proxy</a></li><li><a href="#how-to-use-route-uri-for-regular-matching" class="table-of-contents__link">How to use route <code>uri</code> for regular matching</a></li><li><a href="#does-the-upstream-node-support-configuring-the-fqdn-address" class="table-of-contents__link">Does the upstream node support configuring the FQDN address</a></li><li><a href="#what-is-the-x-api-key-of-admin-api-can-it-be-modified" class="table-of-contents__link">What is the <code>X-API-KEY</code> of Admin API? Can it be modified?</a></li><li><a href="#how-to-allow-all-ips-to-access-admin-api" class="table-of-contents__link">How to allow all IPs to access Admin API</a></li><li><a href="#how-to-auto-renew-ssl-cert-via-acmesh" class="table-of-contents__link">How to auto renew SSL cert via acme.sh</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ea969a47.js"></script>
<script src="/assets/js/main.f5b1410f.js"></script>
</body>
</html>