<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/releases/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/releases/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">Getting started | Apache APISIX¬Æ --  Cloud-Native API Gateway</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org//img/favicon.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org//img/favicon.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org//docs/go-plugin-runner/next/getting-started"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-apisix-go-plugin-runner-current"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" property="og:title" content="Getting started | Apache APISIX¬Æ --  Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org//docs/go-plugin-runner/next/getting-started"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//docs/go-plugin-runner/next/getting-started" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//zh/docs/go-plugin-runner/next/getting-started" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org//docs/go-plugin-runner/next/getting-started" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9bc844bd.css">
<link rel="preload" href="/assets/js/runtime~main.03d80ca2.js" as="script">
<link rel="preload" href="/assets/js/main.2c63f7a4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">ü§î Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ">join #apisix channel</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/security">General</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">FAQ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/FAQ/">Apache APISIX¬Æ</a></li><li><a class="dropdown__link" href="/docs/dashboard/FAQ/">Apache APISIX¬Æ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/FAQ/">Apache APISIX¬Æ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/FAQ/">Apache APISIX¬Æ Helm Chart</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/releases">Releases</a></li><li><a class="dropdown__link" href="/help">Help</a></li></ul></div><a class="navbar__item navbar__link" href="/showcase">Showcase</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/go-plugin-runner/next/getting-started" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/go-plugin-runner/next/getting-started" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3AUJ"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_2LAn"><div class="sidebar_3jCp sidebarWithHideableNavbar_Uxjr"><a tabindex="-1" class="sidebarLogo_8bKs" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--dark_hz6m"><b>Apache APISIX¬Æ</b></a><div class="sidebarVersionSwitch_m-Df">Version:<div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link" href="/docs/go-plugin-runner/next/getting-started">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/go-plugin-runner/next/getting-started">Next</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started">0.2.0</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/0.1.0/getting-started">0.1.0</a></li></ul></div></div><nav class="menu thin-scrollbar menu_1DcY menuWithAnnouncementBar_3IKd"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/go-plugin-runner/next/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/go-plugin-runner/next/developer-guide">Developer Guide</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_3okl"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_1LB5"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_2AUC"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Apache APISIX¬Æ --  Cloud-Native API Gateway <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/go-plugin-runner/getting-started">latest version</a></b> (0.2.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting started</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>Go (&gt;= 1.15)</li><li>APISIX (&gt;= 2.9.0)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="installation"></a>Installation<a class="hash-link" href="#installation" title="Direct link to heading">#</a></h2><p>For now, we need to use Go Runner as a library. <code>cmd/go-runner</code> in this project is an official example showing how to use the Go Runner SDK.
We will also support loading pre-compiled plugins through the Go Plugin mechanism later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="development"></a>Development<a class="hash-link" href="#development" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="developing-with-the-go-runner-sdk"></a>Developing with the Go Runner SDK<a class="hash-link" href="#developing-with-the-go-runner-sdk" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree cmd/go-runner</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cmd/go-runner</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îú‚îÄ‚îÄ main.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îú‚îÄ‚îÄ main_test.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îú‚îÄ‚îÄ plugins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÇ ‚îú‚îÄ‚îÄ say.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÇ ‚îî‚îÄ‚îÄ say_test.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îî‚îÄ‚îÄ version.go</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Above is the directory structure of the official example. <code>main.go</code> is the entry point, where the most critical part is:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cfg </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> runner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RunnerConfig</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">runner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>RunnerConfig</code> can be used to control the log level and log output location.</p><p><code>runner.Run</code> will make the application listen to the target socket path, receive requests and execute the registered plugins. The application will remain in this state until it exits.</p><p>Then let&#x27;s look at the plugin implementation.</p><p>Open <code>plugins/say.go</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Say</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatalf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;failed to register plugin say: %s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Since <code>main.go</code> imports the plugins package,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;github.com/apache/apisix-go-plugin-runner/cmd/go-runner/plugins&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>in this way we register <code>Say</code> with <code>plugin.RegisterPlugin</code> before executing <code>runner.Run</code>.</p><p><code>Say</code> needs to implement the following methods:</p><p>The <code>Name</code> method returns the plugin name.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p *Say</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> string </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;say&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>ParseConf</code> will be called when the plugin configuration changes, parsing the configuration and returning the plugin specific configuration.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p *Say</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ParseConf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    conf :</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SayConf</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    err :</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json.Unmarshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in, </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> conf, err</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The configuration of the plugin looks like this.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">type</span><span class="token plain"> SayConf struct </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Body string </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">json: </span><span class="token variable string" style="color:#e3116c">&quot;body&quot;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Filter</code> will be executed on every request with the say plugin configured.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p *Say</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conf interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, w http.ResponseWriter, r pkgHTTP.Request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    body :</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conf.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SayConf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">return</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    w.Header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;X-Resp-A6-Runner&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;Go&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _, err :</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> w.Write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nil </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;failed to write: %s&quot;</span><span class="token plain">, err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can see that the Filter takes the value of the body set in the configuration as the response body. If we respond directly in the plugin, it will response directly in the APISIX without touching the upstream.</p><p>Here you can read the API documentation provided by the Go Runner SDK: <a href="https://pkg.go.dev/github.com/apache/apisix-go-plugin-runner" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/github.com/apache/apisix-go-plugin-runner</a></p><p>After building the application (<code>make build</code> in the example), we need to set some environment variables at runtime:</p><ul><li><code>APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock</code></li></ul><p>Like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">APISIX_LISTEN_ADDRESS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">unix:/tmp/runner.sock ./go-runner run</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The application will listen to <code>/tmp/runner.sock</code> when it runs.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="setting-up-apisix-debugging"></a>Setting up APISIX (debugging)<a class="hash-link" href="#setting-up-apisix-debugging" title="Direct link to heading">#</a></h3><p>First you need to have APISIX on your machine, which needs to be on the same instance as Go Runner.</p><p><img src="https://raw.githubusercontent.com/apache/apisix-go-plugin-runner/master/docs/assets/images/runner-overview.png" alt="runner-overview"></p><p>The diagram above shows the workflow of APISIX on the left, while the plugin runner on the right is responsible for running external plugins written in different languages. apisix-go-plugin-runner is one such runner that supports Go.</p><p>When you configure a plugin runner in APISIX, APISIX will treat the plugin runner as a child process of its own. This sub-process belongs to the same user as the APISIX process. When we restart or reload APISIX, the plugin runner will also be restarted.</p><p>If you configure the ext-plugin-* plugin for a given route, a request to hit that route will trigger APISIX to make an RPC call to the plugin runner via a unix socket. The call is broken down into two phases.</p><ul><li>ext-plugin-pre-req: before executing most of the APISIX built-in plugins (Lua language plugins)</li><li>ext-plugin-post-req: after the execution of the APISIX built-in plugins (Lua language plugins)</li></ul><p>Configure the timing of plugin runner execution as needed.</p><p>The plugin runner handles the RPC calls, creates a mock request from it, then runs the plugins written in other languages and returns the results to APISIX.</p><p>The order of execution of these plugins is defined in the ext-plugin-* plugin configuration. Like other plugins, they can be enabled and disabled on the fly.</p><p>Let&#x27;s go back to the examples. To show how to develop Go plugins, we first set APISIX into debug mode. Add the following configuration to config.yaml.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ext-plugin:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  path_for_test: /tmp/runner.sock</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This configuration means that after hitting a routing rule, APISIX will make an RPC request to /tmp/runner.sock.</p><p>Next, prepare the routing rule.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;uri&quot;: &quot;/get&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;plugins&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;ext-plugin-pre-req&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      &quot;conf&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        { &quot;name&quot;: &quot;say&quot;, &quot;value&quot;:&quot;{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">body</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">hello</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      ]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  },</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;upstream&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;127.0.0.1:1980&quot;: 1</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that the plugin name is configured in <code>name</code> and the plugin configuration (after JSON serialization) is placed in <code>value</code>.</p><p>If you see <code>refresh cache and try again</code> warning on APISIX side and <code>key not found</code> warning on Runner side during development, this is due to configuration cache inconsistency. Because the Runner is not managed by APISIX in the development state, the internal state may be inconsistent. Don&#x27;t worry, APISIX will retry.</p><p>Then we request: curl 127.0.0.1:9080/get</p><p>We can see that the interface returns hello and does not access anything upstream.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="setting-up-apisix-running"></a>Setting up APISIX (running)<a class="hash-link" href="#setting-up-apisix-running" title="Direct link to heading">#</a></h3><p>Here&#x27;s an example of go-runner, you just need to configure the command line to run it inside ext-plugin:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ext-plugin:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># path_for_test: /tmp/runner.sock</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  cmd: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/path/to/apisix-go-plugin-runner/go-runner&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>APISIX will treat the plugin runner as a child process of its own, managing its entire lifecycle.</p><p>APISIX will automatically assign a unix socket address for the runner to listen to when it starts. environment variables do not need to be set manually.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/apisix-go-plugin-runner/edit/master/docs/en/latest/getting-started.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/go-plugin-runner/next/developer-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Developer Guide ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#installation" class="table-of-contents__link">Installation</a></li><li><a href="#development" class="table-of-contents__link">Development</a><ul><li><a href="#developing-with-the-go-runner-sdk" class="table-of-contents__link">Developing with the Go Runner SDK</a></li><li><a href="#setting-up-apisix-debugging" class="table-of-contents__link">Setting up APISIX (debugging)</a></li><li><a href="#setting-up-apisix-running" class="table-of-contents__link">Setting up APISIX (running)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.03d80ca2.js"></script>
<script src="/assets/js/main.2c63f7a4.js"></script>
</body>
</html>