"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[22774],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(a),u=i,m=d["".concat(l,".").concat(u)]||d[u]||h[u]||r;return a?n.createElement(m,o(o({ref:t},p),{},{components:a})):n.createElement(m,o({ref:t},p))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},35030:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return l},assets:function(){return c},toc:function(){return p},default:function(){return d}});var n=a(87462),i=a(63366),r=(a(67294),a(3905)),o={title:"Centralized authentication using the OpenID Connect plug-in for Apache APISIX",author:"Xinxin Zhu",authorURL:"https://github.com/starsz",authorImageURL:"https://avatars.githubusercontent.com/u/25628854?v=4",keywords:["API Gateway","APISIX","Apache APISIX","Okta","Authorization"],description:"This article demonstrates the process of centralized Okta authentication using the Apache APISIX OpenID Connect Plugin. This article contains a conceptual introduction to Apache APISIX and Okta centralized authentication, showing the process of establishing centralized authentication from Okta directly in Apache APISIX. This centralized authentication approach reduces learning and maintenance costs for developers and provides a secure and streamlined user experience.",tags:["Practical Case"]},s=void 0,l={permalink:"/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication",source:"@site/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication.md",title:"Centralized authentication using the OpenID Connect plug-in for Apache APISIX",description:"This article demonstrates the process of centralized Okta authentication using the Apache APISIX OpenID Connect Plugin. This article contains a conceptual introduction to Apache APISIX and Okta centralized authentication, showing the process of establishing centralized authentication from Okta directly in Apache APISIX. This centralized authentication approach reduces learning and maintenance costs for developers and provides a secure and streamlined user experience.",date:"2021-08-25T00:00:00.000Z",formattedDate:"August 25, 2021",tags:[{label:"Practical Case",permalink:"/blog/tags/practical-case"}],readingTime:9.815,truncated:!0,authors:[{name:"Xinxin Zhu",url:"https://github.com/starsz",imageURL:"https://avatars.githubusercontent.com/u/25628854?v=4"}],prevItem:{title:"Authorization with Casbin in Apache APISIX",permalink:"/blog/2021/08/25/Auth-with-Casbin-in-Apache-APISIX"},nextItem:{title:"Why Apache APISIX chose Nginx and Lua to build API Gateway",permalink:"/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua"}},c={authorsImageUrls:[void 0]},p=[{value:"What is Apache APISIX",id:"what-is-apache-apisix",children:[]},{value:"What is authentication",id:"what-is-authentication",children:[{value:"Traditional authentication mode",id:"traditional-authentication-mode",children:[]},{value:"Centralized authentication mode",id:"centralized-authentication-mode",children:[]}]},{value:"What is OpenID",id:"what-is-openid",children:[{value:"OpenID Authentication Process",id:"openid-authentication-process",children:[]}]},{value:"How to configure Okta authentication using the OpenID Connect plugin for Apache APISIX",id:"how-to-configure-okta-authentication-using-the-openid-connect-plugin-for-apache-apisix",children:[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Step 1: Configure Okta",id:"step-1-configure-okta",children:[]},{value:"Installing Apache APISIX",id:"installing-apache-apisix",children:[]},{value:"Start Apache APISIX and configure the corresponding routes",id:"start-apache-apisix-and-configure-the-corresponding-routes",children:[]},{value:"Step 4: Accessing Apache APISIX",id:"step-4-accessing-apache-apisix",children:[]}]},{value:"About Okta",id:"about-okta",children:[]},{value:"About Apache APISIX",id:"about-apache-apisix",children:[]}],h={toc:p};function d(e){var t=e.components,o=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Compared with the traditional authentication mode, the centralized authentication mode has the following advantages: first, it simplifies the application development process, reduces the development application workload and maintenance costs, and avoids repeated development of authentication code for each application; second, it improves business security, and the centralized authentication mode can intercept unauthenticated requests at the gateway level in time to protect back-end applications.")),(0,r.kt)("h2",{id:"what-is-apache-apisix"},"What is Apache APISIX"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/"},"Apache APISIX")," is a dynamic, real-time, high-performance API gateway that provides rich traffic management features such as load balancing, dynamic upstream, grayscale publishing, service meltdown, authentication, observability, and more. Apache APISIX's OpenID Connect plug-in supports OpenID, which allows users to replace authentication from traditional authentication mode to centralized authentication mode."),(0,r.kt)("h2",{id:"what-is-authentication"},"What is authentication"),(0,r.kt)("p",null,"Authentication refers to the verification of a user's identity through certain means. The application identifies the user through authentication and obtains detailed user metadata from the Identity Provider based on the user identity ID, and uses it to determine whether the user has access to the specified resources. Authentication modes are divided into two categories: ",(0,r.kt)("strong",{parentName:"p"},"Traditional Authentication Mode")," and ",(0,r.kt)("strong",{parentName:"p"},"Centralized Authentication Mode"),"."),(0,r.kt)("h3",{id:"traditional-authentication-mode"},"Traditional authentication mode"),(0,r.kt)("p",null,"In traditional authentication mode, each application service needs to support authentication separately, such as accessing the login interface when the user is not logged in, and the interface returns a 301 jump page. The application needs to develop the logic for maintaining the Session and the authentication interaction with the identity provider. The flow of the traditional authentication model is shown in the figure below: first, the user initiates a request, then the gateway receives the request and forwards it to the corresponding application service, and finally the application service interfaces with the identity provider to complete the authentication."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Flowchart of traditional authentication mode",src:a(74937).Z})),(0,r.kt)("h3",{id:"centralized-authentication-mode"},"Centralized authentication mode"),(0,r.kt)("p",null,"Unlike the traditional authentication model, the centralized authentication model takes user authentication out of the application service. Take Apache APISIX as an example, the centralized authentication process is shown in the following diagram: first, the user initiates a request, and then the front gateway is responsible for the user authentication process, interfacing with the identity provider and sending the identity provider an authorization) request to the identity provider. The identity provider returns user info. After the gateway identifies the user, it forwards the user identity information to the back-end application in the form of a request header."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Flow chart of centralized authentication mode",src:a(53726).Z})),(0,r.kt)("p",null,"Compared with the traditional authentication mode, the centralized authentication mode has the following advantages."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"simplify the application development process, reduce the development of application workload and maintenance costs, to avoid the repeated development of each application authentication code."),(0,r.kt)("li",{parentName:"ol"},"improve business security, centralized authentication mode at the gateway level to intercept unauthenticated requests in time to protect the back-end applications.")),(0,r.kt)("h2",{id:"what-is-openid"},"What is OpenID"),(0,r.kt)("p",null,"OpenID is a centralized authentication model, which is a decentralized identity system. The benefit of using OpenID is that users only need to register and log in with one OpenID identity provider's website and use one account password information to access different applications. okta is a common OpenID identity provider and the Apache APISIX OpenID Connect plugin supports OpenID so users can use the plugin to to replace the traditional authentication model with a centralized authentication model."),(0,r.kt)("h3",{id:"openid-authentication-process"},"OpenID Authentication Process"),(0,r.kt)("p",null,"The OpenID authentication process has the following 7 steps, as shown in the figure below. 1."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"APISIX initiates an authentication request to Identity Provider. 2."),(0,r.kt)("li",{parentName:"ol"},"The user logs in and authenticates on the Identity Provider. 3."),(0,r.kt)("li",{parentName:"ol"},"The Identity Provider returns to APISIX with the Authorization Code. 4."),(0,r.kt)("li",{parentName:"ol"},"APISIX requests the Identity Provider with the Code extracted from the request parameters. 5."),(0,r.kt)("li",{parentName:"ol"},"The Identity Provider sends an answer message to APISIX containing the ID Token and Access Token. 6."),(0,r.kt)("li",{parentName:"ol"},"APISIX sends the Access Token to the Identity Provider's User Endpoint to obtain the user's identity."),(0,r.kt)("li",{parentName:"ol"},"After authentication, the User Endpoint sends the User info to APISIX to complete the authentication.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"OpenID Authentication Flowchart",src:a(6896).Z})),(0,r.kt)("h2",{id:"how-to-configure-okta-authentication-using-the-openid-connect-plugin-for-apache-apisix"},"How to configure Okta authentication using the OpenID Connect plugin for Apache APISIX"),(0,r.kt)("p",null,"Configuring Okta authentication using the Apache APISIX OpenID Connect plug-in is a simple three-step process that allows you to switch from traditional to centralized authentication mode. The following section describes the steps to configure Okta authentication using the OpenID Connect plug-in for Apache APISIX."),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"An Okta account already exists."),(0,r.kt)("h3",{id:"step-1-configure-okta"},"Step 1: Configure Okta"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Login to your Okta account and create an Okta application, select the OIDC login mode and the Web Application application type.\n",(0,r.kt)("img",{alt:"Create an Okta application",src:a(17054).Z}),(0,r.kt)("img",{alt:"Select OIDC login mode and Web Application application type",src:a(54109).Z})," 2."),(0,r.kt)("li",{parentName:"ol"},'Set the login and logout jump URLs.\nThe "Sign-in redirect URIs" are the links that are allowed to be redirected after successful login, and the "Sign-out redirect URIs" are the links that are redirected after logging out. In this example, we set both the sign-in redirect and sign-out redirect URLs to ',(0,r.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1:9080/"),".\n",(0,r.kt)("img",{alt:"Set the login and logout URL",src:a(36090).Z})),(0,r.kt)("li",{parentName:"ol"},'Click "Save" to save the changes after finishing the settings.\n',(0,r.kt)("img",{alt:"Save Changes",src:a(87033).Z}),"\nVisit the General page of the application to get the following configuration, which is required to configure Apache APISIX OpenID Connect.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Client ID: OAuth client ID, which is the ID of the application, corresponding to ",(0,r.kt)("inlineCode",{parentName:"li"},"client_id")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"{YOUR_CLIENT_ID}")," below."),(0,r.kt)("li",{parentName:"ul"},"Client secret: OAuth client secret, i.e. application key, corresponds to ",(0,r.kt)("inlineCode",{parentName:"li"},"client_secret")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"{YOUR_CLIENT_SECRET}")," below."),(0,r.kt)("li",{parentName:"ul"},"Okta domain: The domain name used by the application, corresponds to ",(0,r.kt)("inlineCode",{parentName:"li"},"{YOUR_ISSUER}")," in discovery below.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Get configuration info",src:a(46719).Z})),(0,r.kt)("h3",{id:"installing-apache-apisix"},"Installing Apache APISIX"),(0,r.kt)("p",null,"You can install Apache APISIX in a variety of ways such as through source packages, Docker, Helm Chart, etc."),(0,r.kt)("h4",{id:"installing-dependencies"},"Installing dependencies"),(0,r.kt)("p",null,"The Apache APISIX runtime environment requires dependencies on NGINX and etcd, so before installing Apache APISIX, please install the corresponding dependencies according to the operating system you are using. We have provided steps for installing dependencies on CentOS7, Fedora 31 & 32, Ubuntu 16.04 & 18.04, Debian 9 & 10 and MacOS, please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/install"},"Installing dependencies")," for details. -dependencies/)."),(0,r.kt)("p",null,"When installing Apache APISIX via Docker or Helm Chart, the required NGINX and etcd are already included, please refer to the respective documentation."),(0,r.kt)("h4",{id:"installation-via-rpm-package-centos-7"},"Installation via RPM package (CentOS 7)"),(0,r.kt)("p",null,"This installation method is available for CentOS 7 operating system, please run the following command to install Apache APISIX."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo yum install -y https://github.com/apache/apisix/releases/download/2.7/apisix-2.7-0.x86_64.rpm\n")),(0,r.kt)("h4",{id:"installation-via-docker"},"Installation via Docker"),(0,r.kt)("p",null,"For details, please refer to: ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/apache/apisix"},"Installing Apache APISIX with Docker"),"."),(0,r.kt)("h4",{id:"installation-via-helm-chart"},"Installation via Helm Chart"),(0,r.kt)("p",null,"For details, please refer to: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-helm-chart"},"Installing Apache APISIX with Helm Chart"),"."),(0,r.kt)("h4",{id:"installation-via-source-package"},"Installation via source package"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a directory named ",(0,r.kt)("inlineCode",{parentName:"p"},"apisix-2.7"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir apisix-2.7\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Download the Apache APISIX Release source package."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"wget https://downloads.apache.org/apisix/2.7/apache-apisix-2.7-src.tgz\n")),(0,r.kt)("p",{parentName:"li"},"You can also download the Apache APISIX Release source package from the Apache APISIX official website. The Apache APISIX official website also provides source packages for Apache APISIX, APISIX Dashboard, and APISIX Ingress Controller, see ","[Apache APISIX official website - download page]","(",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/"},"https://apisix.apache.org/zh/")," For details, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/downloads"},"Apache APISIX official-downloads page"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Unpack the Apache APISIX Release source package."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"tar zxvf apache-apisix-2.7-src.tgz -C apisix-2.7\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"install the runtime dependencies of the Lua library:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Switch to the apisix-2.7 directory\ncd apisix-2.7\n# Create dependencies\nmake deps\n")))),(0,r.kt)("h4",{id:"initializing-dependencies"},"Initializing dependencies"),(0,r.kt)("p",null,"Run the following command to initialize the NGINX configuration file and etcd."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# initialize NGINX config file and etcd\nmake init\n")),(0,r.kt)("h3",{id:"start-apache-apisix-and-configure-the-corresponding-routes"},"Start Apache APISIX and configure the corresponding routes"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the following command to start Apache APISIX. 2.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create routes and configure the OpenID Connect plug-in."))),(0,r.kt)("p",null,"The OpenID Connect configuration list is as follows."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"fields"),(0,r.kt)("th",{parentName:"tr",align:"left"},"default"),(0,r.kt)("th",{parentName:"tr",align:"left"},"description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"client_id"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"OAuth client ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"client_secret"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"OAuth client key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"discovery"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"the identity provider's service discovery endpoint")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"scope"),(0,r.kt)("td",{parentName:"tr",align:"left"},"openid"),(0,r.kt)("td",{parentName:"tr",align:"left"},"scope of resources to be accessed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"relm"),(0,r.kt)("td",{parentName:"tr",align:"left"},"apisix"),(0,r.kt)("td",{parentName:"tr",align:"left"},"specifies the WWW-Authenticate response header authentication information")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"bearer_only"),(0,r.kt)("td",{parentName:"tr",align:"left"},"false"),(0,r.kt)("td",{parentName:"tr",align:"left"},"whether to check the token in the request header")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"logout_path"),(0,r.kt)("td",{parentName:"tr",align:"left"},"/logout"),(0,r.kt)("td",{parentName:"tr",align:"left"},"logout URI")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"redirect_uri"),(0,r.kt)("td",{parentName:"tr",align:"left"},"request_uri"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The URI that the identity provider jumped back to, defaulting to the request address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"timeout"),(0,r.kt)("td",{parentName:"tr",align:"left"},"3"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The request timeout in seconds")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"ssl_verify"),(0,r.kt)("td",{parentName:"tr",align:"left"},"false"),(0,r.kt)("td",{parentName:"tr",align:"left"},"whether the identity provider verifies the ssl certificate")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"introspection_endpoint"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"the URL of the identity provider's token verification endpoint, which will be extracted from the discovery response if not filled")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"introspection_endpoint_auth_method"),(0,r.kt)("td",{parentName:"tr",align:"left"},"client_secret_basic"),(0,r.kt)("td",{parentName:"tr",align:"left"},"the name of the token's default authentication method")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"public_key"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"public key of the authentication token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"token_signing_alg_values_expected"),(0,r.kt)("td",{parentName:"tr",align:"left"},'""'),(0,r.kt)("td",{parentName:"tr",align:"left"},"the algorithm for authenticating tokens")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"set_access_token_header"),(0,r.kt)("td",{parentName:"tr",align:"left"},"true"),(0,r.kt)("td",{parentName:"tr",align:"left"},"whether to carry the access token in the request header")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"access_token_in_authorization_header"),(0,r.kt)("td",{parentName:"tr",align:"left"},"false"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Place the access token in the Authorization header if true, or in the X-Access-Token header if false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"set_id_token_header"),(0,r.kt)("td",{parentName:"tr",align:"left"},"true"),(0,r.kt)("td",{parentName:"tr",align:"left"},"whether to carry the ID token in the X-ID-Token request header")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"set_userinfo_header"),(0,r.kt)("td",{parentName:"tr",align:"left"},"true"),(0,r.kt)("td",{parentName:"tr",align:"left"},"whether to carry user information in the X-Userinfo request header")))),(0,r.kt)("p",null,"The following code example creates a route through the Apache APISIX Admin API, setting the route upstream to httpbin.org. httpbin.org is a simple backend service for receiving and responding to requests, and the get page of httpbin.org is used below, see ",(0,r.kt)("a",{parentName:"p",href:"http://httpbin.org/#/HTTP_Methods/get_get"},"http bin get"),"."),(0,r.kt)("p",null,"Please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/plugins/openid-connect/"},"Apache APISIX OpenID Connect Plugin")," for specific configuration items."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -XPOST 127.0.0.1:9080/apisix/admin/routes -H "X-Api-Key: edd1c9f034335f136f87ad84b625c8f1" -d \'{\n    "uri":"/*",\n    "plugins":{\n        "openid-connect":{\n            "client_id":"{YOUR_CLIENT_ID}",\n            "client_secret":"{YOUR_CLIENT_SECRET}",\n            "discovery":"https://{YOUR_ISSUER}/.well-known/openid-configuration",\n            "scope":"openid profile",\n            "bearer_only":false,\n            "realm":"master",\n            "introspection_endpoint_auth_method":"client_secret_post",\n            "redirect_uri": "http://127.0.0.1:9080/"\n        }\n    },\n    "upstream":{\n        "type": "roundrobin",\n        "nodes":{\n            "httpbin.org:80":1\n        }\n    }\n}\'\n')),(0,r.kt)("h3",{id:"step-4-accessing-apache-apisix"},"Step 4: Accessing Apache APISIX"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Visit ",(0,r.kt)("a",{parentName:"li",href:"http://127.0.0.1:9080/get"},"http://127.0.0.1:9080/get")," and the page is redirected to the Okta login page because the OpenID Connect plugin is turned on.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"visit Okta login page",src:a(62887).Z})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Enter the password you registered with Okta and click "Sign in" to log in to your Okta account. 3.')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"After successful login, you can successfully access the get page in httpbin.org. The httpbin.org/get page will return the requested data as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'"X-Access-Token": "******Y0RPcXRtc0FtWWVuX2JQaFo1ZVBvSlBNdlFHejN1dXY5elV3IiwiYWxnIjoiUlMyNTYifQ.***TVER3QUlPbWZYSVRzWHRxRWh2QUtQMWRzVDVGZHZnZzAiLCJpc3MiOiJodHRwczovL3FxdGVzdG1hbi5va3RhLmNvbSIsImF1ZCI6Imh0dHBzOi8vcXF0ZXN0bWFuLm9rdGEuY29tIiwic3ViIjoiMjgzMDE4Nzk5QHFxLmNvbSIsImlhdCI6MTYyODEyNjIyNSwiZXhwIjoxNjI4MTI5ODI1LCJjaWQiOiIwb2ExMWc4ZDg3TzBGQ0dYZzY5NiIsInVpZCI6IjAwdWEwNWVjZEZmV0tMS3VvNjk1Iiwic2NwIjpbIm9wZW5pZCIsInByb2Zpb***.****iBshIcJhy8QNvzAFD0fV4gh7OAdTXFMu5k0hk0JeIU6Tfg_Mh-josfap38nxRN5hSWAvWSk8VNxokWTf1qlaRbypJrKI4ntadl1PrvG-HgUSFD0JpyqSQcv10TzVeSgBfOVD-czprG2Azhck-SvcjCNDV-qc3P9KoPQz0SRFX0wuAHWUbj1FRBq79YnoJfjkJKUHz3uu7qpTK89mxco8iyuIwB8fAxPMoXjIuU6-6Bw8kfZ4S2FFg3GeFtN-vE9bE5vFbP-JFQuwFLZNgqI0XO2S7l7Moa4mWm51r2fmV7p7rdpoNXYNerXOeZIYysQwe2_L****",\n"X-Id-Token": "******aTdDRDJnczF5RnlXMUtPZUtuSUpQdyIsImFtciI6WyJwd2QiXSwic3ViIjoiMDB1YTA1ZWNkRmZXS0xLdW82OTUiLCJpc3MiOiJodHRwczpcL1wvcXF0ZXN0bWFuLm9rdGEuY29tIiwiYXVkIjoiMG9hMTFnOGQ4N08wRkNHWGc2OTYiLCJuYW1lIjoiUGV0ZXIgWmh1IiwianRpIjoiSUQuNGdvZWo4OGUyX2RuWUI1VmFMeUt2djNTdVJTQWhGNS0tM2l3Z0p5TTcxTSIsInZlciI6MSwicHJlZmVycmVkX3VzZXJuYW1lIjoiMjgzMDE4Nzk5QHFxLmNvbSIsImV4cCI6MTYyODEyOTgyNSwiaWRwIjoiMDBvYTA1OTFndHAzMDhFbm02OTUiLCJub25jZSI6ImY3MjhkZDMxMWRjNGY3MTI4YzlmNjViOGYzYjJkMDgyIiwiaWF0IjoxNjI4MTI2MjI1LCJhdXRoX3RpbWUi*****",\n"X-Userinfo": "*****lfbmFtZSI6IlpodSIsImxvY2FsZSI6ImVuLVVTIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiMjgzMDE4Nzk5QHFxLmNvbSIsInVwZGF0ZWRfYXQiOjE2MjgwNzA1ODEsInpvbmVpbmZvIjoiQW1lcmljYVwvTG9zX0FuZ2VsZXMiLCJzdWIiOiIwMHVhMDVlY2RGZldLTEt1bzY5NSIsImdpdmVuX25hbWUiOiJQZXRlciIsIm5hbWUiOiJQZXRl****"\n')))),(0,r.kt)("p",null,"In which:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"X-Access-Token"),": Apache APISIX puts the access token obtained from the user provider into the X-Access-Token request header, which can be optionally put into the Authorization request header via access_token_in_authorization_header in the plugin configuration."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"X-Access-Token",src:a(19379).Z})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"X-Id-Token"),": Apache APISIX will put the ID token obtained from the user provider into the X-Id-Token request header after base64 encoding, you can choose whether to enable this feature by using the set_id_token_header in the plugin configuration."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"X-Id-Token",src:a(56561).Z})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"X-Userinfo"),": Apache APISIX will get the user information from the user provider and put it into X-Userinfo after base64 encoding, you can choose whether to turn it on or not by using set_userinfo_header in the plugin configuration, the default is on."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"X-Userinfo",src:a(79318).Z})),(0,r.kt)("p",null,"As you can see, Apache APISIX will carry the X-Access-Token, X-Id-Token, and X-Userinfo request headers to the upstream. The upstream can parse these headers to get the user ID information and user metadata."),(0,r.kt)("p",null,"We show the process of setting up centralized authentication from Okta directly in Apache APISIX. It is easy to get started by signing up for a free Okta developer account. This centralized approach to authentication reduces learning and maintenance costs for developers and provides a secure and streamlined user experience."),(0,r.kt)("h2",{id:"about-okta"},"About Okta"),(0,r.kt)("p",null,"Okta is a customizable, secure centralized authentication solution. Okta can add authentication and authorization to your application. Get scalable authentication directly in your application without writing your own code. You can connect your application to Okta and define how users log in. Each time a user tries to authenticate, Okta verifies their identity and sends the required information back to your application."),(0,r.kt)("h2",{id:"about-apache-apisix"},"About Apache APISIX"),(0,r.kt)("p",null,"Apache APISIX is a dynamic, real-time, high-performance API gateway that provides load balancing, dynamic upstream, grayscale publishing, service meltdown, authentication, observability, and other rich traffic management features. You can use Apache APISIX for traditional north-south traffic, as well as east-west traffic between services, or as a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-ingress-controller"},"Kubernetes Ingress Controller"),"."),(0,r.kt)("p",null,"Hundreds of enterprises worldwide have used Apache APISIX to handle business-critical traffic, covering finance, Internet, manufacturing, retail, carriers, and more, such as NASA, the EU's Digital Factory, China Airlines, China Mobile, Tencent, Huawei, Sina Weibo, NetEase, Ke, 360, Taikang, Nayuki, and more."),(0,r.kt)("p",null,"Github: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix"},"https://github.com/apache/apisix")),(0,r.kt)("p",null,"Official website: ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org"},"https://apisix.apache.org")))}d.isMDXComponent=!0},74937:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-1-6b6bfd5a6ac99bafa8ba33555499d2c9.png"},19379:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-10-4cf579f111e40baad9180625798ae68c.png"},56561:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-11-55634bfb527367e0fc0a4882cc9c0a23.png"},79318:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-12-ca8f94d3f7463d7d21eb0c327ff6f782.png"},53726:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-2-b929bda58f8f6facbd5ab27e9d401742.png"},6896:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-3-08fa96f4a7e30f486efde0ddce85f194.png"},17054:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-4-56246ab773e8514b6d7ff6e88a1ba575.png"},54109:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-5-27949e296923f482ca03e52147040e5b.png"},36090:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-6-f282419b7f52ab87487580f15b7789f3.png"},87033:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-7-b7ceb94a0cbdac698adcdd78dd290bbe.png"},46719:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-8-81d934986b33acd9cc80dbb6329c38e3.png"},62887:function(e,t,a){t.Z=a.p+"assets/images/2021-08-16-9-9752a521c7717adfb0fe94f20bb28c8d.png"}}]);