"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[98197],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=i.createContext({}),p=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return i.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||a;return t?i.createElement(g,o(o({ref:n},u),{},{components:t})):i.createElement(g,o({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=t[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},16177:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var i=t(87462),r=(t(67294),t(3905));const a={title:"Plugin",keywords:["API Gateway","Apache APISIX","Plugin","Filter","Priority"],description:"This article introduces the related information of the APISIX Plugin object and how to use it, and introduces how to customize the plugin priority, customize the error response, and dynamically control the execution status of the plugin."},o=void 0,l={unversionedId:"terminology/plugin",id:"version-3.10/terminology/plugin",isDocsHomePage:!1,title:"Plugin",description:"This article introduces the related information of the APISIX Plugin object and how to use it, and introduces how to customize the plugin priority, customize the error response, and dynamically control the execution status of the plugin.",source:"@site/docs-apisix_versioned_docs/version-3.10/terminology/plugin.md",sourceDirName:"terminology",slug:"/terminology/plugin",permalink:"/docs/apisix/3.10/terminology/plugin",editUrl:"/edit#https://github.com/apache/apisix/edit/release/3.10/docs/en/latest/terminology/plugin.md",tags:[],version:"3.10",frontMatter:{title:"Plugin",keywords:["API Gateway","Apache APISIX","Plugin","Filter","Priority"],description:"This article introduces the related information of the APISIX Plugin object and how to use it, and introduces how to customize the plugin priority, customize the error response, and dynamically control the execution status of the plugin."},sidebar:"version-3.10/docs",previous:{title:"Global Rules",permalink:"/docs/apisix/3.10/terminology/global-rule"},next:{title:"Plugin Config",permalink:"/docs/apisix/3.10/terminology/plugin-config"}},s=[{value:"Description",id:"description",children:[]},{value:"Plugins installation",id:"plugins-installation",children:[]},{value:"Plugins execution lifecycle",id:"plugins-execution-lifecycle",children:[]},{value:"Plugins execution order",id:"plugins-execution-order",children:[]},{value:"Plugins merging precedence",id:"plugins-merging-precedence",children:[]},{value:"Plugin common configuration",id:"plugin-common-configuration",children:[{value:"Disable the plugin",id:"disable-the-plugin",children:[]},{value:"Custom error response",id:"custom-error-response",children:[]},{value:"Custom plugin priority",id:"custom-plugin-priority",children:[]},{value:"Dynamically control whether the plugin is executed",id:"dynamically-control-whether-the-plugin-is-executed",children:[]}]},{value:"Hot reload",id:"hot-reload",children:[{value:"Hot reload in standalone mode",id:"hot-reload-in-standalone-mode",children:[]}]}],p={toc:s};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,i.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"description"},"Description"),(0,r.kt)("p",null,"APISIX Plugins extend APISIX's functionalities to meet organization or user-specific requirements in traffic management, observability, security, request/response transformation, serverless computing, and more."),(0,r.kt)("p",null,"A ",(0,r.kt)("strong",{parentName:"p"},"Plugin")," configuration can be bound directly to a ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/route"},(0,r.kt)("inlineCode",{parentName:"a"},"Route")),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/service"},(0,r.kt)("inlineCode",{parentName:"a"},"Service")),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/consumer"},(0,r.kt)("inlineCode",{parentName:"a"},"Consumer"))," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/plugin-config"},(0,r.kt)("inlineCode",{parentName:"a"},"Plugin Config")),". You can refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/admin-api#plugin"},"Admin API plugins")," for how to use this resource."),(0,r.kt)("p",null,"If existing APISIX Plugins do not meet your needs, you can also write your own plugins in Lua or other languages such as Java, Python, Go, and Wasm."),(0,r.kt)("h2",{id:"plugins-installation"},"Plugins installation"),(0,r.kt)("p",null,"By default, most APISIX plugins are ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/apisix/cli/config.lua"},"installed"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:'title="apisix/cli/config.lua"',title:'"apisix/cli/config.lua"'},'local _M = {\n  ...\n  plugins = {\n    "real-ip",\n    "ai",\n    "client-control",\n    "proxy-control",\n    "request-id",\n    "zipkin",\n    "ext-plugin-pre-req",\n    "fault-injection",\n    "mocking",\n    "serverless-pre-function",\n    ...\n  },\n  ...\n}\n')),(0,r.kt)("p",null,"If you would like to make adjustments to plugins installation, add the customized ",(0,r.kt)("inlineCode",{parentName:"p"},"plugins")," configuration to ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml"),". For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"plugins:\n  - real-ip                   # installed\n  - ai\n  - real-ip\n  - ai\n  - client-control\n  - proxy-control\n  - request-id\n  - zipkin\n  - ext-plugin-pre-req\n  - fault-injection\n  # - mocking                 # not install\n  - serverless-pre-function\n  ...                         # other plugins\n")),(0,r.kt)("p",null,"See ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml.example"),"(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/conf/config.yaml.example"},"https://github.com/apache/apisix/blob/master/conf/config.yaml.example"),") for a complete configuration reference."),(0,r.kt)("p",null,"You should reload APISIX for configuration changes to take effect."),(0,r.kt)("h2",{id:"plugins-execution-lifecycle"},"Plugins execution lifecycle"),(0,r.kt)("p",null,"An installed plugin is first initialized. The configuration of the plugin is then checked against the defined ",(0,r.kt)("a",{parentName:"p",href:"https://json-schema.org"},"JSON Schema")," to make sure the plugins configuration schema is correct."),(0,r.kt)("p",null,"When a request goes through APISIX, the plugin's corresponding methods are executed in one or more of the following phases : ",(0,r.kt)("inlineCode",{parentName:"p"},"rewrite"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"access"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"before_proxy"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"header_filter"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"body_filter"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"log"),". These phases are largely influenced by the ",(0,r.kt)("a",{parentName:"p",href:"https://openresty-reference.readthedocs.io/en/latest/Directives/"},"OpenResty directives"),"."),(0,r.kt)("br",null),(0,r.kt)("div",{style:{textAlign:"center"}},(0,r.kt)("img",{src:"https://static.apiseven.com/uploads/2023/03/09/ZsH5C8Og_plugins-phases.png",alt:"Routes Diagram",width:"50%"})),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"plugins-execution-order"},"Plugins execution order"),(0,r.kt)("p",null,"In general, plugins are executed in the following order:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Plugins in ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/global-rule"},"global rules")),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"plugins in rewrite phase"),(0,r.kt)("li",{parentName:"ol"},"plugins in access phase"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Plugins bound to other objects"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"plugins in rewrite phase"),(0,r.kt)("li",{parentName:"ol"},"plugins in access phase")))),(0,r.kt)("p",null,"Within each phase, you can optionally define a new priority number in the ",(0,r.kt)("inlineCode",{parentName:"p"},"_meta.priority")," field of the plugin, which takes precedence over the default plugins priority during execution. Plugins with higher priority numbers are executed first."),(0,r.kt)("p",null,"For example, if you want to have ",(0,r.kt)("inlineCode",{parentName:"p"},"limit-count")," (priority 1002) run before ",(0,r.kt)("inlineCode",{parentName:"p"},"ip-restriction")," (priority 3000) when requests hit a route, you can do so by passing a higher priority number to ",(0,r.kt)("inlineCode",{parentName:"p"},"_meta.priority")," field of ",(0,r.kt)("inlineCode",{parentName:"p"},"limit-count"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "plugins": {\n    "limit-count": {\n      ...,\n      "_meta": {\n        "priority": 3010\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"To reset the priority of this plugin instance to the default, simply remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"_meta.priority")," field from your plugin configuration."),(0,r.kt)("h2",{id:"plugins-merging-precedence"},"Plugins merging precedence"),(0,r.kt)("p",null,"When the same plugin is configured both globally in a global rule and locally in an object (e.g. a route), both plugin instances are executed sequentially."),(0,r.kt)("p",null,"However, if the same plugin is configured locally on multiple objects, such as on ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/route"},"Route"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/service"},"Service"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/consumer"},"Consumer"),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/consumer-group"},"Consumer Group"),", or ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/terminology/plugin-config"},"Plugin Config"),", only one copy of configuration is used as each non-global plugin is only executed once. This is because during execution, plugins configured in these objects are merged with respect to a specific order of precedence:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Consumer"),"  > ",(0,r.kt)("inlineCode",{parentName:"p"},"Consumer Group")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Route")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Plugin Config")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Service")),(0,r.kt)("p",null,"such that if the same plugin has different configurations in different objects, the plugin configuration with the highest order of precedence during merging will be used."),(0,r.kt)("h2",{id:"plugin-common-configuration"},"Plugin common configuration"),(0,r.kt)("p",null,"Some common configurations can be applied to plugins through the ",(0,r.kt)("inlineCode",{parentName:"p"},"_meta")," configuration items, the specific configuration items are as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"disable"),(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"When set to ",(0,r.kt)("inlineCode",{parentName:"td"},"true"),", the plugin is disabled.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"error_response"),(0,r.kt)("td",{parentName:"tr",align:null},"string/object"),(0,r.kt)("td",{parentName:"tr",align:null},"Custom error response.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"priority"),(0,r.kt)("td",{parentName:"tr",align:null},"integer"),(0,r.kt)("td",{parentName:"tr",align:null},"Custom plugin priority.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"filter"),(0,r.kt)("td",{parentName:"tr",align:null},"array"),(0,r.kt)("td",{parentName:"tr",align:null},"Depending on the requested parameters, it is decided at runtime whether the plugin should be executed. Something like this: ",(0,r.kt)("inlineCode",{parentName:"td"},"{{var, operator, val}, {var, operator, val}, ...}}"),". For example: ",(0,r.kt)("inlineCode",{parentName:"td"},'{"arg_version", "==", "v2"}'),", indicating that the current request parameter ",(0,r.kt)("inlineCode",{parentName:"td"},"version")," is ",(0,r.kt)("inlineCode",{parentName:"td"},"v2"),". The variables here are consistent with NGINX internal variables. For details on supported operators, please see ",(0,r.kt)("a",{parentName:"td",href:"https://github.com/api7/lua-resty-expr#operator-list"},"lua-resty-expr"),".")))),(0,r.kt)("h3",{id:"disable-the-plugin"},"Disable the plugin"),(0,r.kt)("p",null,"Through the ",(0,r.kt)("inlineCode",{parentName:"p"},"disable")," configuration, you can add a new plugin with disabled status and the request will not go through the plugin."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "proxy-rewrite": {\n        "_meta": {\n            "disable": true\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"custom-error-response"},"Custom error response"),(0,r.kt)("p",null,"Through the ",(0,r.kt)("inlineCode",{parentName:"p"},"error_response")," configuration, you can configure the error response of any plugin to a fixed value to avoid troubles caused by the built-in error response information of the plugin."),(0,r.kt)("p",null,"The configuration below means to customize the error response of the ",(0,r.kt)("inlineCode",{parentName:"p"},"jwt-auth")," plugin to ",(0,r.kt)("inlineCode",{parentName:"p"},"Missing credential in request"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "jwt-auth": {\n        "_meta": {\n            "error_response": {\n                "message": "Missing credential in request"\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"custom-plugin-priority"},"Custom plugin priority"),(0,r.kt)("p",null,"All plugins have default priorities, but through the ",(0,r.kt)("inlineCode",{parentName:"p"},"priority")," configuration item you can customize the plugin priority and change the plugin execution order."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},' {\n    "serverless-post-function": {\n        "_meta": {\n            "priority": 10000\n        },\n        "phase": "rewrite",\n        "functions" : ["return function(conf, ctx)\n                    ngx.say(\\"serverless-post-function\\");\n                    end"]\n    },\n    "serverless-pre-function": {\n        "_meta": {\n            "priority": -2000\n        },\n        "phase": "rewrite",\n        "functions": ["return function(conf, ctx)\n                    ngx.say(\\"serverless-pre-function\\");\n                    end"]\n    }\n}\n')),(0,r.kt)("p",null,"The default priority of serverless-pre-function is 10000, and the default priority of serverless-post-function is -2000. By default, the serverless-pre-function plugin will be executed first, and serverless-post-function plugin will be executed next."),(0,r.kt)("p",null,"The above configuration means setting the priority of the serverless-pre-function plugin to -2000 and the priority of the serverless-post-function plugin to 10000. The serverless-post-function plugin will be executed first, and serverless-pre-function plugin will be executed next."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"Custom plugin priority only affects the current object(route, service ...) of the plugin instance binding, not all instances of that plugin. For example, if the above plugin configuration belongs to Route A, the order of execution of the plugins serverless-post-function and serverless-post-function on Route B will not be affected and the default priority will be used."),(0,r.kt)("li",{parentName:"ul"},"Custom plugin priority does not apply to the rewrite phase of some plugins configured on the consumer. The rewrite phase of plugins configured on the route will be executed first, and then the rewrite phase of plugins (exclude auth plugins) from the consumer will be executed.")))),(0,r.kt)("h3",{id:"dynamically-control-whether-the-plugin-is-executed"},"Dynamically control whether the plugin is executed"),(0,r.kt)("p",null,"By default, all plugins specified in the route will be executed. But we can add a filter to the plugin through the ",(0,r.kt)("inlineCode",{parentName:"p"},"filter")," configuration item, and control whether the plugin is executed through the execution result of the filter."),(0,r.kt)("p",null,"The configuration below means that the ",(0,r.kt)("inlineCode",{parentName:"p"},"proxy-rewrite")," plugin will only be executed if the ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," value in the request query parameters is ",(0,r.kt)("inlineCode",{parentName:"p"},"v2"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "proxy-rewrite": {\n        "_meta": {\n            "filter": [\n                ["arg_version", "==", "v2"]\n            ]\n        },\n        "uri": "/anything"\n    }\n}\n')),(0,r.kt)("p",null,"Create a complete route with the below configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "uri": "/get",\n    "plugins": {\n        "proxy-rewrite": {\n            "_meta": {\n                "filter": [\n                    ["arg_version", "==", "v2"]\n                ]\n            },\n            "uri": "/anything"\n        }\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "httpbin.org:80": 1\n        }\n    }\n}\n')),(0,r.kt)("p",null,"When the request does not have any parameters, the ",(0,r.kt)("inlineCode",{parentName:"p"},"proxy-rewrite")," plugin will not be executed, the request will be proxy to the upstream ",(0,r.kt)("inlineCode",{parentName:"p"},"/get"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v /dev/null http://127.0.0.1:9080/get -H"host:httpbin.org"\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'< HTTP/1.1 200 OK\n......\n< Server: APISIX/2.15.0\n<\n{\n  "args": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin.org",\n    "User-Agent": "curl/7.79.1",\n    "X-Amzn-Trace-Id": "Root=1-62eb6eec-46c97e8a5d95141e621e07fe",\n    "X-Forwarded-Host": "httpbin.org"\n  },\n  "origin": "127.0.0.1, 117.152.66.200",\n  "url": "http://httpbin.org/get"\n}\n')),(0,r.kt)("p",null,"When the parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"version=v2")," is carried in the request, the ",(0,r.kt)("inlineCode",{parentName:"p"},"proxy-rewrite")," plugin is executed, and the request will be proxy to the upstream ",(0,r.kt)("inlineCode",{parentName:"p"},"/anything"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v /dev/null http://127.0.0.1:9080/get?version=v2 -H"host:httpbin.org"\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'< HTTP/1.1 200 OK\n......\n< Server: APISIX/2.15.0\n<\n{\n  "args": {\n    "version": "v2"\n  },\n  "data": "",\n  "files": {},\n  "form": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin.org",\n    "User-Agent": "curl/7.79.1",\n    "X-Amzn-Trace-Id": "Root=1-62eb6f02-24a613b57b6587a076ef18b4",\n    "X-Forwarded-Host": "httpbin.org"\n  },\n  "json": null,\n  "method": "GET",\n  "origin": "127.0.0.1, 117.152.66.200",\n  "url": "http://httpbin.org/anything?version=v2"\n}\n')),(0,r.kt)("h2",{id:"hot-reload"},"Hot reload"),(0,r.kt)("p",null,"APISIX Plugins are hot-loaded. This means that there is no need to restart the service if you add, delete, modify plugins, or even if you update the plugin code. To hot-reload, you can send an HTTP request through the ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/admin-api"},"Admin API"),":"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can fetch the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_key")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yaml")," and save to an environment variable with the following command:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"admin_key=$(yq '.deployment.admin.admin_key[0].key' conf/config.yaml | sed 's/\"//g')\n")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9180/apisix/admin/plugins/reload -H "X-API-KEY: $admin_key" -X PUT\n')),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If a configured Plugin is disabled, then its execution will be skipped."))),(0,r.kt)("h3",{id:"hot-reload-in-standalone-mode"},"Hot reload in standalone mode"),(0,r.kt)("p",null,"For hot-reloading in standalone mode, see the plugin related section in ",(0,r.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/deployment-modes#standalone"},"stand alone mode"),"."))}u.isMDXComponent=!0}}]);