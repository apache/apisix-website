"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[21457],{35318:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(27378);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(a),d=r,m=u["".concat(c,".").concat(d)]||u[d]||h[d]||o;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},65739:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(25773),r=(a(27378),a(35318));const o={title:"Event-Driven APIs with Webhook and API Gateway",authors:[{name:"Bobur Umurzokov",title:"Author",url:"https://github.com/Boburmirzo",image_url:"https://avatars.githubusercontent.com/u/14247607"}],keywords:["API Gateway","Apache APISIX","API","Architecture","Use-cases","Webhook","Event-driven"],description:"This post elaborates on building event-driven APIs by making use of Webhook and API Gateway, we understand the role of each in this solution.",tags:["Ecosystem"],image:"https://static.apiseven.com/2022/11/07/6368d30abf672.png"},i=void 0,s={permalink:"/blog/2022/11/07/webhook-api-gateway-event-driven-apis",source:"@site/blog/2022/11/07/webhook-api-gateway-event-driven-apis.md",title:"Event-Driven APIs with Webhook and API Gateway",description:"This post elaborates on building event-driven APIs by making use of Webhook and API Gateway, we understand the role of each in this solution.",date:"2022-11-07T00:00:00.000Z",formattedDate:"November 7, 2022",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:5.8,truncated:!0,authors:[{name:"Bobur Umurzokov",title:"Author",url:"https://github.com/Boburmirzo",image_url:"https://avatars.githubusercontent.com/u/14247607",imageURL:"https://avatars.githubusercontent.com/u/14247607"}],prevItem:{title:"Geo-routing with Apache APISIX",permalink:"/blog/2022/11/09/georouting-apisix"},nextItem:{title:"Apache APISIX 3.0: 11 Highlights of Open Source API Gateway",permalink:"/blog/2022/11/02/apache-apisix-v3-preview"}},c={authorsImageUrls:[void 0]},l=[{value:"Need for a webhook",id:"need-for-a-webhook",children:[],level:2},{value:"What\u2019s Webhook?",id:"whats-webhook",children:[],level:2},{value:"Webhook and API Gateway in Event-Driven Architecture",id:"webhook-and-api-gateway-in-event-driven-architecture",children:[{value:"Subscription process",id:"subscription-process",children:[],level:3},{value:"Callback process",id:"callback-process",children:[],level:3}],level:2},{value:"Summary",id:"summary",children:[{value:"Related resources",id:"related-resources",children:[],level:3},{value:"Recommended content \ud83d\udc81",id:"recommended-content-",children:[],level:3}],level:2}],p={toc:l};function h(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"There are many ways and technology options to consider when implementing an event-driven API. For example, we explored how to ",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/apisix/building-event-driven-api-services-using-cqrs-api-gateway-and-serverless-af4"},"build event-driven APIs using these 3 well-known patterns"),": ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs"},"CQRS"),", ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/terminology/api-gateway/"},"API Gateway")," and ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/dotnet/architecture/serverless/serverless-architecture"},"Serverless")," on the previous blog post. This post elaborates on ",(0,r.kt)("strong",{parentName:"p"},"building event-driven APIs by making use of Webhook and API Gateway"),", we understand the role of each in this solution. Firstly, let\u2019s turn our attention to the initial problem statement without the webhook in place.")),(0,r.kt)("h2",{id:"need-for-a-webhook"},"Need for a webhook"),(0,r.kt)("p",null,"Consuming applications expect to be informed of any change of state on a specific record or records."),(0,r.kt)("p",null,"Examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Updating or adding customers in a CRM system triggers an event."),(0,r.kt)("li",{parentName:"ul"},"Currency exchange rates from a foreign exchange application informs users about currency change."),(0,r.kt)("li",{parentName:"ul"},"New post on a user's blog notifies subscribers."),(0,r.kt)("li",{parentName:"ul"},"New order creation on an online shopping application informs another service in the system."),(0,r.kt)("li",{parentName:"ul"},"An orchestrator service wants to be notified when Service A completes a task and when to handover the task to Service B in a data ingestion pipeline and so on.")),(0,r.kt)("p",null,"The majority of APIs only support these types of requirements by having the consuming application constantly poll for changes. This means that the consuming application has to make frequent API calls to find out any changes of state in the desired resource. This is highly inefficient, and calls may result in empty payloads when there haven't been any updates. Also, what if the called HTTP API accepts our HTTP request but takes a long time to handle it, this could affect the user experience, especially when the behavior is reflected in the user interface (meaning a user has to refresh a page to get the latest changes)."),(0,r.kt)("p",null,"Instead of having to constantly poll for changes, create a subscription endpoint against a specific resource so consuming applications can register their interest to be informed on any change of state (an event) by providing a call-back endpoint. At this point, it becomes the API's responsibility to send back any change of state by posting the updates to the registered endpoint."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/11/07/6368cda2cbae7.png",alt:"poll for changes vs webhook"})),(0,r.kt)("h2",{id:"whats-webhook"},"What\u2019s Webhook?"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Webhook"},"webhook")," is a software architecture approach that allows applications and services to submit a web-based notification to other applications whenever a specific event occurs. The application provides a way for users to register or connect API calls to certain events under specific conditions, such as when a new user, account, or order is created or an order ships out of a warehouse."),(0,r.kt)("p",null,"Webhooks are generally used to notify clients of events, in real-time, as they occur. They normally take the form of HTTP POST endpoints that can be requested with a JSON body and it is fully managed by an event consumer. An event producer, such as an API server, can send event notifications to a webhook when something interesting happens."),(0,r.kt)("h2",{id:"webhook-and-api-gateway-in-event-driven-architecture"},"Webhook and API Gateway in Event-Driven Architecture"),(0,r.kt)("p",null,"Leveraging Webhook and API Gateway enables you to build an event-driven API that can be decoupled from your main application code. Enabling you to call external systems that have subscribed via webhooks in complete isolation from your application code."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/11/06/6367bd7b2ad1a.png",alt:"Webhook with an API Gateway"})),(0,r.kt)("p",null,"As you can see in the preceding architectural diagram, there are two main flows."),(0,r.kt)("h3",{id:"subscription-process"},"Subscription process"),(0,r.kt)("p",null,"In the first flow on the left, API Consumers can subscribe to the API by registering a Webhook URL as the callback. A consuming application subscribing for changes in a resource by making a POST call (with the call-back URL in the body) to a resource subscription API endpoint (for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"/{resource}/subscribe"),") exposed in an API gateway. Once the API gateway receives the call, it routes the request to the subscription service, which then adds the subscriber details to a database."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/11/07/6368be4e9bba1.png",alt:"the first flow Subscription process"})),(0,r.kt)("p",null,"It is also possible to unsubscribe from the API. In this scenario, API Gateway\u2019s tasks first identify unknown messages so be sure that the request is always authenticated and credentials are valid,  it returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"2xx response")," immediately as an acknowledgment or if the request cannot be authenticated or there is an error getting the payload into a staging system, an error is returned. Then it is also passing the request to the responsible service based on the path provided by the consumer."),(0,r.kt)("h3",{id:"callback-process"},"Callback process"),(0,r.kt)("p",null,"In the second flow on the right, we are delivering events to API consumers asynchronously through the call-back component and the API Gateway. An event listener service queries the database as subscribers are matched against particular processed events. The event listener service then creates call-back commands and publishes them in an Event Hub so a call-back service can execute all API calls (and retries if necessary) via the API gateway."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/11/07/6368be5603f54.png",alt:"the second flow Callback process"})),(0,r.kt)("p",null,"There, API Gateway plays not only a role of a reverse proxy but can convert internal calls from one format to another. For example, the call-back service is using another ",(0,r.kt)("a",{parentName:"p",href:"https://www.amqp.org/"},"AMQP")," (Advanced Message Queuing Protocol) messaging protocol but the API should make a REST call to the consumer\u2019s callback endpoint, in this gateway an API Gateway such as ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/"},"Apache APISIX")," can help. It can receive a REST request, then transform it to the desired format and forward it to a service, get the response, and return it to the client in REST format utilizing its ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/plugins/response-rewrite/"},"different plug-ins"),"."),(0,r.kt)("p",null,"Also, it comes with other concerns like securing it with certificates and preventing ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Denial-of-service_attack"},"DDoS attacks"),". And it enables a monitoring feature for your webhook to be able to see what is going on with the webhook, you know like what is wrong with the configuration on the API provider side."),(0,r.kt)("p",null,"One of the most efficient ways to handle the ",(0,r.kt)("strong",{parentName:"p"},"webhook processing part")," of the above architecture by using API Gateway of your choice and an event-driven serverless function."),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"As we understood throughout the post, Webhook tries to decouple the concerns like a message acknowledgment and the processing messages in the API and no synchronous business logic is performed. However, the above architectural example we discussed can be a complicated pattern to implement given that it has many moving parts and the API are not aware of a consuming application endpoint is up and running but that can be improved. In addition to this, Webhooks force the event consumer to establish a publicly accessible HTTP endpoint to receive events that are not secure enough. We can secure it properly by enabling some authentication mechanism (Basic auth, JWT or other ways) with the API Gateway capabilities."),(0,r.kt)("h3",{id:"related-resources"},"Related resources"),(0,r.kt)("p",null,"\u2794 ",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/apisix/building-event-driven-api-services-using-cqrs-api-gateway-and-serverless-af4"},"Building event-driven API services using CQRS, API Gateway and Serverless"),"."),(0,r.kt)("p",null,"\u2794 ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/terminology/api-gateway/"},"API Gateway"),"."),(0,r.kt)("h3",{id:"recommended-content-"},"Recommended content \ud83d\udc81"),(0,r.kt)("p",null,"\u2794 Watch Video Tutorial:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://youtu.be/dUOjJkb61so"},"Getting Started with Apache APISIX"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://youtu.be/hMFjhwLMtQ8"},"APIs security with Apache APISIX"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://youtu.be/aWzo0ysH__c"},"Implementing resilient applications with API Gateway (Circuit breaker)"),"."))),(0,r.kt)("p",null,"\u2794 Read the blog posts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://dev.to/apisix/implementing-resilient-applications-with-api-gateway-health-check-338c"},"Implementing resilient applications with API Gateway (Health Check)"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/blog/2022/10/27/ten-use-cases-api-gateway/"},"10 most common use cases of an API Gateway"),"."))))}h.isMDXComponent=!0}}]);