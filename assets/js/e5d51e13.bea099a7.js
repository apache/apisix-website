"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[79584],{35318:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>d});var a=n(27378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},h=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),u=l(n),d=o,m=u["".concat(c,".").concat(d)]||u[d]||p[d]||i;return n?a.createElement(m,r(r({ref:t},h),{},{components:n})):a.createElement(m,r({ref:t},h))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},34233:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=n(25773),o=(n(27378),n(35318));const i={title:"Implementing Apache APISIX in Tencent Cloud TI-ONE Platform",author:"Shoujun Diao",keywords:["Apache APISIX","Tencent","Kong","Nginx"],description:"This article mainly introduces the enterprise case of Tencent Cloud Intelligent Titanium Platform using the cloud-native API gateway Apache APISIX.",tags:["Case Studies"],image:"https://static.apiseven.com/2022/blog/0817/%E8%85%BE%E8%AE%AF%E4%BA%91.png"},r=void 0,s={permalink:"/blog/2021/09/16/tencent-cloud",source:"@site/blog/2021/09/16/tencent-cloud.md",title:"Implementing Apache APISIX in Tencent Cloud TI-ONE Platform",description:"This article mainly introduces the enterprise case of Tencent Cloud Intelligent Titanium Platform using the cloud-native API gateway Apache APISIX.",date:"2021-09-16T00:00:00.000Z",formattedDate:"September 16, 2021",tags:[{label:"Case Studies",permalink:"/blog/tags/case-studies"}],readingTime:5.49,truncated:!0,authors:[{name:"Shoujun Diao"}],prevItem:{title:"Apache APISIX helps DIAN to facilitate cloud native solution",permalink:"/blog/2021/09/18/xiaodian-usercase"},nextItem:{title:"BiWeekly Report (Aug 30 - Sep 15)",permalink:"/blog/2021/09/15/weekly-report"}},c={authorsImageUrls:[void 0]},l=[{value:"Background Information",id:"background-information",children:[],level:2},{value:"What Does TI-ONE Need from Apache APISIX?",id:"what-does-ti-one-need-from-apache-apisix",children:[],level:2},{value:"Research and Compare Products",id:"research-and-compare-products",children:[{value:"Why Did TI-ONE Choose Apache APISIX?",id:"why-did-ti-one-choose-apache-apisix",children:[],level:3}],level:2},{value:"Architecture Alignment Based on Apache APISIX",id:"architecture-alignment-based-on-apache-apisix",children:[],level:2},{value:"Experience Sharing",id:"experience-sharing",children:[{value:"Counterintuitive Nginx Configuration",id:"counterintuitive-nginx-configuration",children:[],level:3},{value:"Test Cases as Documentation",id:"test-cases-as-documentation",children:[],level:3}],level:2},{value:"Some Thoughts on Service Mesh",id:"some-thoughts-on-service-mesh",children:[],level:2},{value:"Personal Expectations",id:"personal-expectations",children:[],level:2}],h={toc:l};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This article is a practical case of implementing Apache APISIX in Tencent Cloud\u2019s production environment.")),(0,o.kt)("h2",{id:"background-information"},"Background Information"),(0,o.kt)("p",null,"Tencent Cloud Intelligent Titanium Machine Learning Platform (TI-ONE) is a machine learning service platform for AI engineers, providing users with full-process development support from data pre-processing, model building, model training to model evaluation. TI-ONE has rich built-in algorithm components and supports multiple algorithm frameworks to meet the needs of various AI application scenarios."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304750-e4716cb4-9024-4995-a910-ad3ddd5d00a9.png",alt:"TI-ONE Architecture"})),(0,o.kt)("h2",{id:"what-does-ti-one-need-from-apache-apisix"},"What Does TI-ONE Need from Apache APISIX?"),(0,o.kt)("p",null,"We divide the requirements into two categories: technical needs, i.e. the requirements of the R&D team for the API gateway; and business needs, i.e. the requirements of the users of the TI-ONE for the API gateway."),(0,o.kt)("p",null,"The main requirement at the technical aspect is to have cross-sectional functionality. Specifically, cross-plane functions such as authentication, flow limit, logging, monitoring, etc. are coalesced into the API gateway to decouple the back-end services, so that R&D can focus on function development and reduce maintenance costs."),(0,o.kt)("p",null,"Considering the demand of subsequent business connection to Tencent Cloud, the API gateway must support Tencent\u2019s customized authentication and login mechanism and comply with Tencent Cloud API 3.0 format."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304728-8be486b7-80e9-4b07-8a02-2c753f70c6d1.png",alt:"TI-ONE's Technical Needs"})),(0,o.kt)("p",null,"From the business aspect, the main consideration is user perception. When the platform is developed, AI and algorithm colleagues need an interactive programming environment, and then the API gateway needs to support Notebook. It also needs to support request-level monitoring, including logging monitoring and metrics monitoring."),(0,o.kt)("p",null,"We conducted research on API Gateway products to address the above requirements."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304731-719124e9-8206-4ffb-8be1-eb54c7c0e159.png",alt:"TI-ONE's requirements on  API Gateway"})),(0,o.kt)("h2",{id:"research-and-compare-products"},"Research and Compare Products"),(0,o.kt)("p",null,"We have compared Envoy, Kong and Apache APISIX from multiple dimensions in our research stage."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830766533-be5642c4-04d3-4999-8c0a-07116f0c08c7.png",alt:"Envoy, Kong and Apache APISIX Comparison"})),(0,o.kt)("p",null,"Since Envoy\u2019s technology stack is C++, it is likely that we will have to look at the C++ source code when we need to locate the problem. It is very likely to bring us some extra problems, so Envoy was eliminated from our options in the early stage."),(0,o.kt)("p",null,"Kong and Apache APISIX use the same technology stack, OpenResty, but in the storage dependency aspect, Kong relies on PostgreSQL, a relational database, which is a very complex database to configure for high availability in the software industry. Not only do you need to have a dedicated DBA, but it is also very difficult to implement. Relational databases are too heavy, and we don\u2019t need to use them to guarantee ACID and MVCC."),(0,o.kt)("h3",{id:"why-did-ti-one-choose-apache-apisix"},"Why Did TI-ONE Choose Apache APISIX?"),(0,o.kt)("p",null,"Apache APISIX does a very good job of storing dependencies and routing rules, which is a good fit for our business scenario. Our business values routing flexibility and routing matching algorithms over other features. The complexity of Apache APISIX route matching algorithm is significantly better than Kong, and the configuration effective time is less than 1ms, and the single-core QPS is much higher than Kong."),(0,o.kt)("h2",{id:"architecture-alignment-based-on-apache-apisix"},"Architecture Alignment Based on Apache APISIX"),(0,o.kt)("p",null,"After connecting to Apache APISIX, we have completed the gateway aspect of TI-ONE, which solves the previous requirements about technical and business level."),(0,o.kt)("p",null,"Apache APISIX supports http+pb, http+json, gRPC, WebSocket and other traffic. After these traffic flows go through Apache APISIX, they will go to some components custom-developed by TI-ONE."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304733-0ccfe462-0214-430e-8316-079cc0e0d4de.png",alt:"Apache APISIX Architecture"})),(0,o.kt)("p",null,"The business of TI-ONE is deployed on Tencent Cloud TKE platform. In order to improve its availability, the gateway, etcd, etc. are clustered and deployed. Instead of using the Apache APISIX dashboard, Smart Titanium Machine Learning Platform interacts directly with the Admin API and writes directly to etcd."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304736-ae479c95-9be7-43b5-8600-bcac8914c08d.png",alt:"Add Plugin Process"})),(0,o.kt)("h2",{id:"experience-sharing"},"Experience Sharing"),(0,o.kt)("p",null,"In the process of doing this, we have summarized some of the pitfalls of using Nginx and discovered some of the advantages of APISIX, which we will briefly share here."),(0,o.kt)("h3",{id:"counterintuitive-nginx-configuration"},"Counterintuitive Nginx Configuration"),(0,o.kt)("p",null,"When I used Nginx before, I felt that Nginx was a configuration-driven product. Nginx is often counterintuitive when it comes to configuration management. One such counterintuitive pitfall was encountered by my colleague during this hands-on experience:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304738-224447bd-ee49-4369-9fce-c53d9a828d0e.png",alt:"Nginx Configuration Error"})),(0,o.kt)("p",null,"For those are new to Nginx, these two lines of commands are added before the ",(0,o.kt)("inlineCode",{parentName:"p"},"if"),", and there are no other commands inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"if")," that could override them, so they should be executed. Anyone familiar with Nginx knows that the command inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"if")," overrides the outside command, but this is very counterintuitive."),(0,o.kt)("h3",{id:"test-cases-as-documentation"},"Test Cases as Documentation"),(0,o.kt)("p",null,"In practicing using Apache APISIX practices, the Apache APISIX project test cases are written in great detail. Even if I didn\u2019t have a deep understanding of how to call certain functions in Apache APISIX, I could often find the answers in the test cases. When I encountered some OpenResty problems later, I would look for the relevant code in these test cases, and I was able to solve the problem every time."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646830304739-dcfb66f9-f765-4e15-a476-edea9ca3ff11.png",alt:"Test Cases as Documentation"})),(0,o.kt)("h2",{id:"some-thoughts-on-service-mesh"},"Some Thoughts on Service Mesh"),(0,o.kt)("p",null,"In the early stage of technology selection, apart from Envoy, Kong and Apache APISIX, some colleagues also mentioned Service Mesh. Why do we still choose Apache APISIX, given that Service Mesh is also capable of doing this? Isn\u2019t this a regression in technology? On this issue, my view is as follows."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The API gateway is at the system boundary and handles north-south traffic; the Service Mesh is inside the cluster and handles east-west traffic. The functions of the two are different and cannot be directly compared.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Service Mesh has proven to have some performance loss. But there is also a voice that says, on the cloud, this loss may not be the performance bottleneck of the business, so this is a matter of opinion.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Apache APISIX customization development is more efficient thanks to the easy-to-use features of OpenResty and Lua. Even if the development team has no prior development experience with OpenResty or Lua, they can still complete the custom development requirements of the business in a short period of time.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Apache APISIX is less expensive to deliver than Service Mesh because the Istio community is very active and iterates very quickly, resulting in incompatibility between versions of Istio and versions of Kubernetes. In a customer\u2019s production environment, some Kubernetes clusters may have version differences, and these Kubernetes clusters cannot share a single version of Istio, which can cause some problems in the actual delivery process."))),(0,o.kt)("h2",{id:"personal-expectations"},"Personal Expectations"),(0,o.kt)("p",null,"Thanks to Apache APISIX for creating an open source API gateway product that is extremely high performance and easy to use. During the development process of TI-ONE Network, we hope that we can learn more about using it in practice and give feedback to the Apache APISIX community."))}p.isMDXComponent=!0}}]);