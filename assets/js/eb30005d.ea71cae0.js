"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[73402],{35318:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(27378);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),r=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):p(p({},t),e)),a},c=function(e){var t=r(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=r(a),h=o,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||i;return a?n.createElement(m,p(p({ref:t},c),{},{components:a})):n.createElement(m,p({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,p=new Array(i);p[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,p[1]=l;for(var r=2;r<i;r++)p[r]=a[r];return n.createElement.apply(null,p)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},1491:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>r});var n=a(25773),o=(a(27378),a(35318));const i={title:"Announcing Integration between Apache APISIX and open-appsec WAF",authors:[{name:"Christopher Lutat",title:"Author",url:"https://github.com/ByteSkater",image_url:"https://github.com/ByteSkater.png"},{name:"Yilia Lin",title:"Technical Writer",url:"https://github.com/Yilialinn",image_url:"https://github.com/Yilialinn.png"}],keywords:["API gateway","Apache APISIX","WAF","Open-appsec","Machine Learning","API Security","Open Source"],description:"Let's protect your web APIs and applications exposed by Apache APISIX against known and unknown attacks with open-appsec - the automatic, machine learning-based WAF.",tags:["Ecosystem"],image:"https://static.apiseven.com/uploads/2024/10/18/8d1iVJWL_logo%20x%20open-appsec.png"},p=void 0,l={permalink:"/blog/2024/10/22/apisix-integrates-with-open-appsec",source:"@site/blog/2024/10/22/apisix-integrates-with-open-appsec.md",title:"Announcing Integration between Apache APISIX and open-appsec WAF",description:"Let's protect your web APIs and applications exposed by Apache APISIX against known and unknown attacks with open-appsec - the automatic, machine learning-based WAF.",date:"2024-10-22T00:00:00.000Z",formattedDate:"October 22, 2024",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:12.91,truncated:!0,authors:[{name:"Christopher Lutat",title:"Author",url:"https://github.com/ByteSkater",image_url:"https://github.com/ByteSkater.png",imageURL:"https://github.com/ByteSkater.png"},{name:"Yilia Lin",title:"Technical Writer",url:"https://github.com/Yilialinn",image_url:"https://github.com/Yilialinn.png",imageURL:"https://github.com/Yilialinn.png"}],prevItem:{title:"Bi-Monthly Report (October 01 - November 30)",permalink:"/blog/2024/11/30/bi-monthly-report"},nextItem:{title:"Release Apache APISIX 3.11.0",permalink:"/blog/2024/10/17/release-apache-apisix-3.11.0"}},s={authorsImageUrls:[void 0,void 0]},r=[{value:"Introduction",id:"introduction",children:[{value:"About Apache APISIX",id:"about-apache-apisix",children:[],level:3},{value:"About open-appsec WAF",id:"about-open-appsec-waf",children:[],level:3}],level:2},{value:"Integrating Apache APISIX with open-appsec",id:"integrating-apache-apisix-with-open-appsec",children:[{value:"Linux",id:"linux",children:[],level:3},{value:"Docker",id:"docker",children:[],level:3},{value:"Kubernetes",id:"kubernetes",children:[],level:3}],level:2},{value:"Adding open-appsec WAF to APISIX on Linux",id:"adding-open-appsec-waf-to-apisix-on-linux",children:[{value:"1. Prerequisites",id:"1-prerequisites",children:[],level:3},{value:"2. Download the open-appsec Installer",id:"2-download-the-open-appsec-installer",children:[],level:3},{value:"3. Install open-appsec",id:"3-install-open-appsec",children:[],level:3},{value:"4. Get and Store APISIX Admin Key",id:"4-get-and-store-apisix-admin-key",children:[],level:3},{value:"5. Configure Route to Expose Services",id:"5-configure-route-to-expose-services",children:[],level:3},{value:"6. Validate",id:"6-validate",children:[],level:3},{value:"7. Simulate an SQL Injection Attack",id:"7-simulate-an-sql-injection-attack",children:[],level:3},{value:"8. Review Log Files",id:"8-review-log-files",children:[],level:3},{value:"9. Connect to open-appsec for Central Management (Optional)",id:"9-connect-to-open-appsec-for-central-management-optional",children:[],level:3}],level:2},{value:"Deploying APISIX with open-appsec WAF on Containerized Platforms (Docker)",id:"deploying-apisix-with-open-appsec-waf-on-containerized-platforms-docker",children:[{value:"1. Prerequisite",id:"1-prerequisite",children:[],level:3},{value:"2. Create a Folder for open-appsec",id:"2-create-a-folder-for-open-appsec",children:[],level:3},{value:"3. Download the open-appsec File into the Folder",id:"3-download-the-open-appsec-file-into-the-folder",children:[],level:3},{value:"4. Create a Folder for APISIX",id:"4-create-a-folder-for-apisix",children:[],level:3},{value:"5. Download APISIX File into the Folder",id:"5-download-apisix-file-into-the-folder",children:[],level:3},{value:"6. Create a <code>docer-compose.yaml</code> File",id:"6-create-a-docer-composeyaml-file",children:[],level:3},{value:"7. Update Your Email Address (Optional)",id:"7-update-your-email-address-optional",children:[],level:3},{value:"8. Start All Containers",id:"8-start-all-containers",children:[],level:3},{value:"9. Check Container Status",id:"9-check-container-status",children:[],level:3},{value:"10. Validate the Standalone Configuration",id:"10-validate-the-standalone-configuration",children:[],level:3},{value:"11. Simulate an SQL Injection Attack",id:"11-simulate-an-sql-injection-attack",children:[],level:3},{value:"12. Connect to open-appsec for Central Management (Optional)",id:"12-connect-to-open-appsec-for-central-management-optional",children:[],level:3}],level:2},{value:"Deploying APISIX with open-appsec WAF on Kubernetes Using Helm",id:"deploying-apisix-with-open-appsec-waf-on-kubernetes-using-helm",children:[{value:"1. Prerequisite",id:"1-prerequisite-1",children:[],level:3},{value:"2. Download open-appsec",id:"2-download-open-appsec",children:[],level:3},{value:"3. Install Helm Chart",id:"3-install-helm-chart",children:[],level:3},{value:"4. Validate",id:"4-validate",children:[],level:3},{value:"5. Create an open-appsec Policy Resource",id:"5-create-an-open-appsec-policy-resource",children:[],level:3},{value:"6. Fetch the Target Resource Name",id:"6-fetch-the-target-resource-name",children:[],level:3},{value:"7. Edit the Ingress Resource",id:"7-edit-the-ingress-resource",children:[],level:3},{value:"8. Change the ingressClassname",id:"8-change-the-ingressclassname",children:[],level:3},{value:"9. Add Annotation to the Ingress Resource",id:"9-add-annotation-to-the-ingress-resource",children:[],level:3},{value:"10. Validate the Standalone Configuration",id:"10-validate-the-standalone-configuration-1",children:[],level:3},{value:"11. Simulate an SQL Injection Attack",id:"11-simulate-an-sql-injection-attack-1",children:[],level:3}],level:2},{value:"How to Manage Your open-appsec WAF Deployment Centrally?",id:"how-to-manage-your-open-appsec-waf-deployment-centrally",children:[],level:2},{value:"Summary",id:"summary",children:[],level:2},{value:"Additional Resources",id:"additional-resources",children:[{value:"open-appsec WAF",id:"open-appsec-waf",children:[],level:3},{value:"Apache APISIX",id:"apache-apisix",children:[],level:3}],level:2}],c={toc:r};function d(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"We are excited to announce a new integration between Apache APISIX and open-appsec WAF, combining the power of a dynamic API gateway with cutting-edge application security.")),(0,o.kt)("head",null,(0,o.kt)("link",{rel:"canonical",href:"https://www.openappsec.io/post/announcing-open-appsec-WAF-integration-with-Apache-APISIX-API-Gateway"})),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"open-appsec WAF is excited to announce a new integration with the open-source API gateway Apache APISIX."),(0,o.kt)("p",null,"This new collaboration between the open-appsec and API7 teams now allows users to protect their web APIs and other web services exposed by Apache APISIX against unknown and known attack types effectively based on open-appsec's advanced machine-learning-based technology and also adds several more enhanced security capabilities."),(0,o.kt)("h3",{id:"about-apache-apisix"},"About Apache APISIX"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/"},"Apache APISIX")," is a modern, flexible, and high-performance open-source API gateway solution designed to handle various use cases in microservices and cloud-native architectures. Its primary purpose is to facilitate API management by serving as a gateway for managing, securing, and optimizing API traffic between clients and backend services."),(0,o.kt)("p",null,"Further use cases for APISIX as an API gateway include load balancing, rate limiting, authentication, and authorization. It provides comprehensive features such as traffic control, dynamic upstream, and plugin extensibility, enabling developers to customize and extend functionality according to their specific needs."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Website: ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org"},"apisix.apache.org"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Github: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix"},"github.com/apache/apisix"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Docs: ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs"},"apisix.apache.org/docs")))),(0,o.kt)("h3",{id:"about-open-appsec-waf"},"About open-appsec WAF"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io"},"open-appsec WAF")," provides automatic, preemptive threat prevention and integrates with various types of reverse proxies like NGINX as well as API gateways like APISIX. It is machine-learning-based, meaning it doesn't require signatures (or updates) at all. This enables it to provide automatic, state-of-the-art threat prevention even for true zero-day attacks while significantly reducing both administrative effort and the amount of false positives."),(0,o.kt)("p",null,"In addition, open-appsec provides many additional security layers such as AntiBot, rate limiting, schema enforcement, snort signature support, custom rules/exceptions, and more. open-appsec can be managed centrally using a Web UI provided as a SaaS service and also locally using a declarative configuration file."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Website: ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io"},"www.openappsec.io"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Github: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openappsec"},"github.com/openappsec"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Docs: ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openappsec.io"},"docs.openappsec.io"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Playgrounds: ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io/playground"},"www.openappsec.io/playground")))),(0,o.kt)("h2",{id:"integrating-apache-apisix-with-open-appsec"},"Integrating Apache APISIX with open-appsec"),(0,o.kt)("p",null,"With this new integration, APISIX users will now have access to open-appsec WAF as an integrated, state-of-the-art machine-learning-based WAF solution for the protection of their web APIs and web applications."),(0,o.kt)("p",null,'They can now use e.g. open-appsec\'s free and open-source "Community Edition" to get effective, AI-based protection against known but also unknown attacks for everything exposed by their APISIX API gateway, while at the same time reducing the amount of false positives significantly unburdening the administrator from tedious tasks such as creating exceptions, updating traditional signature-based policies and more.'),(0,o.kt)("p",null,"This integration will be available for all common platforms: Linux, Docker, and Kubernetes."),(0,o.kt)("h3",{id:"linux"},"Linux"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},'For Linux "embedded" deployments'),' of APISIX, an open-appsec installer will add an "open-appsec attachment" module to the existing APISIX installation and also install the "open-appsec agent" alongside it, which will receive the traffic from the attachment, inspect it, and return the concluded action to block or allow the traffic back to the APISIX respectively the open-appsec attachment integrated with it.'),(0,o.kt)("p",null,"Here's a simple architecture schematic for Linux deployment."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2024/10/18/6QZvRy6P_linux-deployment.png",alt:"Architecture for Linus Deployment"})),(0,o.kt)("h3",{id:"docker"},"Docker"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For Docker-based deployments")," of APISIX with open-appsec WAF, there is a special APISIX container image available, to which the open-appsec attachment was already added and also an enhanced docker-compose file, which deploys both, the APISIX gateway container as well as an open-appsec Agent that does the security inspection and returns the concluded decisions to the APISIX gateway to allow or block traffic."),(0,o.kt)("p",null,"Here's a simple architecture schematic for deployment on Docker."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2024/10/18/bxKsXOqW_docker-deployment.png",alt:"Architecture for Docker-Based Deployment"})),(0,o.kt)("h3",{id:"kubernetes"},"Kubernetes"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For Kubernetes based-deployments"),' of APISIX integrated with open-appsec, there\'s a Helm chart available, which is based on the official APISIX Helm chart and further enhanced to also include the open-appsec attachment in the APISIX gateway container and also deploys the open-appsec agent. Further, you will have the option to configure open-appsec in a declarative "DevOps-style" way using custom resources in K8s as an alternative to using the open-appsec central management Web UI.'),(0,o.kt)("p",null,"Here's a simple architecture schematic for deployment on Kubernetes."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2024/10/18/SEZQ6E14_k8s-deployment.png",alt:"Architecture for Kubernetes Deployment"})),(0,o.kt)("h2",{id:"adding-open-appsec-waf-to-apisix-on-linux"},"Adding open-appsec WAF to APISIX on Linux"),(0,o.kt)("p",null,"To install open-appsec on a Linux system with APISIX installed, please follow these steps:"),(0,o.kt)("h3",{id:"1-prerequisites"},"1. Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The Linux platform must be Ubuntu 22.04."),(0,o.kt)("li",{parentName:"ul"},"Make sure to have APISIX installed.")),(0,o.kt)("p",null,"You can find the list of supported APISIX versions here: ",(0,o.kt)("a",{parentName:"p",href:"https://downloads.openappsec.io/packages/supported-apisix.txt"},"https://downloads.openappsec.io/packages/supported-apisix.txt"),"."),(0,o.kt)("p",null,'If you don\'t have APISIX installed yet, you can use the following commands to perform an APISIX installation in "traditional mode". By running these commands you will first install the etcd database for APISIX, then add the required repos before installing and starting APISIX.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Install etcd Database")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"ETCD_VERSION='3.5.4'\nwget https://github.com/etcd-io/etcd/releases/download/v${ETCD_VERSION}/etcd-v${ETCD_VERSION}-linux-amd64.tar.gz\ntar -xvf etcd-v${ETCD_VERSION}-linux-amd64.tar.gz && cd etcd-v${ETCD_VERSION}-linux-amd64\ncp -a etcd etcdctl /usr/bin/\nnohup etcd >/tmp/etcd.log 2>&1 &\netcd\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Add and Update Package Repositories")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'apt install gnupg\necho "deb http://openresty.org/package/debian bullseye openresty" | tee /etc/apt/sources.list.d/openresty.list\nwget -O - https://openresty.org/package/pubkey.gpg | apt-key add -\nwget -O - http://repos.apiseven.com/pubkey.gpg | apt-key add -\necho "deb http://repos.apiseven.com/packages/debian bullseye main" | tee /etc/apt/sources.list.d/apisix.list\napt update\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Install, Initiate, and Start APISIX")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"apt install apisix=3.9.1-0\napisix init\napisix start\n")),(0,o.kt)("h3",{id:"2-download-the-open-appsec-installer"},"2. Download the open-appsec Installer"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"wget https://downloads.openappsec.io/open-appsec-install && chmod +x open-appsec-install\n")),(0,o.kt)("h3",{id:"3-install-open-appsec"},"3. Install open-appsec"),(0,o.kt)("p",null,"Install open-appsec to integrate with the existing APISIX installation."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that the ",(0,o.kt)("inlineCode",{parentName:"p"},"--prevent")," flag will install open-appsec with a default policy already set to prevent mode.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"./open-appsec-install --auto --prevent\n")),(0,o.kt)("h3",{id:"4-get-and-store-apisix-admin-key"},"4. Get and Store APISIX Admin Key"),(0,o.kt)("p",null,"Get the APISIX admin key from the APISIX ",(0,o.kt)("inlineCode",{parentName:"p"},"config.yaml")," configuration file and store it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"APISIX_KEY")," env variable."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"export APISIX_KEY=$(awk '/key:/{ if ($2 ~ /^edd1/) print $2 }' /usr/local/apisix/conf/config.yaml )\n")),(0,o.kt)("h3",{id:"5-configure-route-to-expose-services"},"5. Configure Route to Expose Services"),(0,o.kt)("p",null,"Configure an example route in the APISIX gateway to expose an external web service or web API. In this example, we use ",(0,o.kt)("inlineCode",{parentName:"p"},"httpbin.org")," as the example backend."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'curl http://127.0.0.1:9180/apisix/admin/routes/100 -H "X-API-KEY:$APISIX_KEY" -X PUT -d \'{\n    "methods": [\n      "GET"\n    ],\n    "uri": "/anything",\n    "upstream": {\n      "type": "roundrobin",\n      "nodes": {\n        "httpbin.org:80": 1\n      }\n    }\n  }\'\n')),(0,o.kt)("h3",{id:"6-validate"},"6. Validate"),(0,o.kt)("p",null,"Let's see if this route works by accessing it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc http://localhost:9080/anything\n")),(0,o.kt)("h3",{id:"7-simulate-an-sql-injection-attack"},"7. Simulate an SQL Injection Attack"),(0,o.kt)("p",null,"Now let's try to simulate an SQL injection attack (see ",(0,o.kt)("inlineCode",{parentName:"p"},"'OR '1'='1'")," in the below HTTP request) against the ",(0,o.kt)("inlineCode",{parentName:"p"},"httpbin.org")," service exposed by the APISIX gateway which is now protected by the open-appsec WAF."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc' OR '1'='1 http://localhost:9080/anything\n")),(0,o.kt)("p",null,"This simulated attack now gets blocked successfully by open-appsec's contextual machine-learning WAF engine."),(0,o.kt)("h3",{id:"8-review-log-files"},"8. Review Log Files"),(0,o.kt)("p",null,'Check out the corresponding log files showing the "prevent" for the HTTP request with the simulated attack that we just sent.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"tail -f /var/log/nano_agent/cp-nano-http-transaction-handler.log*| grep -i user@domain.abc\n")),(0,o.kt)("p",null,"Alternatively you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"open-appsec-ctl")," tool:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"open-appsec-ctl --view-logs | grep -i user@domain.abc\n")),(0,o.kt)("h3",{id:"9-connect-to-open-appsec-for-central-management-optional"},"9. Connect to open-appsec for Central Management (Optional)"),(0,o.kt)("p",null,"Optionally you can connect your deployment now to ",(0,o.kt)("a",{parentName:"p",href:"https://my.openappsec.io"},"https://my.openappsec.io")," for centrally managing open-appsec with an easy-to-use Web UI, monitoring security events and more, see section ",(0,o.kt)("strong",{parentName:"p"},"How to Manage Your open-appsec WAF Deployment Centrally?")," further below for more information."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Congratulations!")," You successfully added open-appsec WAF to your existing APISIX installation and verified that your web services exposed by the APISIX gateway are now protected against web attacks."),(0,o.kt)("h2",{id:"deploying-apisix-with-open-appsec-waf-on-containerized-platforms-docker"},"Deploying APISIX with open-appsec WAF on Containerized Platforms (Docker)"),(0,o.kt)("p",null,"To install APISIX integrated with open-appsec on Docker, you can follow the steps shown below."),(0,o.kt)("p",null,"Opposite to the above example here we are deploying APISIX in \"standalone mode\", which means it's declaratively configured using a docker volume mount with a yaml file that holds the configurations and therefore won't require an etcd database deployment."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that APISIX supports both, traditional as well as standalone modes in all deployment types (Linux, Docker, \u2026)")),(0,o.kt)("h3",{id:"1-prerequisite"},"1. Prerequisite"),(0,o.kt)("p",null,"Make sure to have a Linux platform with both Docker and docker-compose tools installed."),(0,o.kt)("h3",{id:"2-create-a-folder-for-open-appsec"},"2. Create a Folder for open-appsec"),(0,o.kt)("p",null,"Within the directory that you want to use for the deployment, create a folder ",(0,o.kt)("inlineCode",{parentName:"p"},"appsec-localconfig")," which will hold the appsec declarative configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"mkdir ./appsec-localconfig\n")),(0,o.kt)("h3",{id:"3-download-the-open-appsec-file-into-the-folder"},"3. Download the open-appsec File into the Folder"),(0,o.kt)("p",null,"Download the initial declarative configuration file for open-appsec into that folder."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"wget https://raw.githubusercontent.com/openappsec/openappsec/main/config/linux/latest/prevent/local_policy.yaml -O appsec-localconfig/local_policy.yaml\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that this example declarative configuration file is already set to prevent attacks.")),(0,o.kt)("h3",{id:"4-create-a-folder-for-apisix"},"4. Create a Folder for APISIX"),(0,o.kt)("p",null,"Create another folder ",(0,o.kt)("inlineCode",{parentName:"p"},"apisix-localconfig")," which will hold the declarative configuration file for APISIX: ",(0,o.kt)("inlineCode",{parentName:"p"},"mkdir ./apisix-localconfig"),"."),(0,o.kt)("h3",{id:"5-download-apisix-file-into-the-folder"},"5. Download APISIX File into the Folder"),(0,o.kt)("p",null,"Let's download a simple declarative configuration file also for APISIX so we can verify open-appsec protection after the deployment."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"wget https://raw.githubusercontent.com/openappsec/openappsec/main/deployment/apisix/apisix-example-config/apisix-standalone.yaml -O ./apisix-localconfig/apisix-standalone.yaml\n")),(0,o.kt)("h3",{id:"6-create-a-docer-composeyaml-file"},"6. Create a ",(0,o.kt)("inlineCode",{parentName:"h3"},"docer-compose.yaml")," File"),(0,o.kt)("p",null,"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," file with the content below, which can be downloaded as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"wget https://raw.githubusercontent.com/openappsec/openappsec/main/deployment/apisix/docker-compose.yaml\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'version: "3"\n\nservices:\n  apisix:\n    container_name: apisix\n    image: "ghcr.io/openappsec/apisix-attachment:latest"\n    ipc: service:appsec-agent\n    restart: always\n    volumes:\n      - ./apisix-localconfig/apisix-standalone.yaml:/usr/local/apisix/conf/apisix.yaml:ro\n    environment:\n      - APISIX_STAND_ALONE=true\n    ports:\n      - "9180:9180/tcp"\n      - "9080:9080/tcp"\n      - "9091:9091/tcp"\n      - "9443:9443/tcp"\n\n  appsec-agent:\n    container_name: appsec-agent\n    image: \'ghcr.io/openappsec/agent:latest\'\n    ipc: shareable\n    restart: unless-stopped\n    environment:\n      # adjust with your own email below\n      - user_email=user@email.com\n      - registered_server="APISIX Server"\n    volumes:\n      - ./appsec-config:/etc/cp/conf\n      - ./appsec-data:/etc/cp/data\n      - ./appsec-logs:/var/log/nano_agent\n      - ./appsec-localconfig:/ext/appsec\n    command: /cp-nano-agent\n')),(0,o.kt)("h3",{id:"7-update-your-email-address-optional"},"7. Update Your Email Address (Optional)"),(0,o.kt)("p",null,"Edit the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml"),' file and replace "',(0,o.kt)("a",{parentName:"p",href:"mailto:user@email.com"},"user@email.com"),'" with your own email address, so we can provide assistance in case of any issues with the specific deployment in the future and provide information proactively regarding open-appsec.'),(0,o.kt)("p",null,"This is an optional parameter and can be removed. If we send automatic emails, there will also be an opt-out option included for receiving similar communication in the future."),(0,o.kt)("h3",{id:"8-start-all-containers"},"8. Start All Containers"),(0,o.kt)("p",null,"Run docker-compose up to start the deployment of all relevant containers:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose up -d\n")),(0,o.kt)("h3",{id:"9-check-container-status"},"9. Check Container Status"),(0,o.kt)("p",null,"Check if the ",(0,o.kt)("inlineCode",{parentName:"p"},"apisix-attachment")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"appsec-agent")," containers are up and running."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker ps\n")),(0,o.kt)("h3",{id:"10-validate-the-standalone-configuration"},"10. Validate the Standalone Configuration"),(0,o.kt)("p",null,"Let's see if the standalone configuration works by accessing it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc http://localhost:9080/anything\n")),(0,o.kt)("h3",{id:"11-simulate-an-sql-injection-attack"},"11. Simulate an SQL Injection Attack"),(0,o.kt)("p",null,"Now let's try to simulate an SQL injection attack against the httpin.org service exposed by the APISIX gateway container which is now protected by open-appsec."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc' OR '1'='1 http://localhost:9080/anything\n")),(0,o.kt)("h3",{id:"12-connect-to-open-appsec-for-central-management-optional"},"12. Connect to open-appsec for Central Management (Optional)"),(0,o.kt)("p",null,"Optionally you can connect your deployment now to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://my.openappsec.io")," for centrally managing open-appsec with an easy-to-use Web UI, monitoring security events, and more, see section ",(0,o.kt)("strong",{parentName:"p"},"How to Manage Your open-appsec WAF Deployment Centrally?")," further below for more information."),(0,o.kt)("h2",{id:"deploying-apisix-with-open-appsec-waf-on-kubernetes-using-helm"},"Deploying APISIX with open-appsec WAF on Kubernetes Using Helm"),(0,o.kt)("h3",{id:"1-prerequisite-1"},"1. Prerequisite"),(0,o.kt)("p",null,"Make sure the Kubernetes platform and Helm tool are available."),(0,o.kt)("h3",{id:"2-download-open-appsec"},"2. Download open-appsec"),(0,o.kt)("p",null,"Download the open-appsec for the APISIX Helm chart here."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"wget https://downloads.openappsec.io/packages/helm-charts/apisix/open-appsec-k8s-apisix-latest.tgz\n")),(0,o.kt)("h3",{id:"3-install-helm-chart"},"3. Install Helm Chart"),(0,o.kt)("p",null,"This example ",(0,o.kt)("inlineCode",{parentName:"p"},"helm install")," command is installing the open-appsec for the APISIX Helm chart which is based on an extended version of the official APISIX Helm chart."),(0,o.kt)("p",null,"It will deploy the APISIX gateway as the APISIX Ingress Controller, as well as open-appsec WAF integrated with it. It also offers an additional configuration option specifically for open-appsec WAF (see ",(0,o.kt)("inlineCode",{parentName:"p"},"values.yaml")," inside the Helm chart and open-appsec ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openappsec.io/"},"docs"),")."),(0,o.kt)("p",null,"After deployment, you can assign your K8s ingress resources to the APISIX gateway by configuring them to use the following ingress class: ",(0,o.kt)("inlineCode",{parentName:"p"},"appsec-apisix"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"helm install open-appsec-k8s-apisix-latest.tgz \\\n--name-template=appsec-apisix \\\n--set rbac.create=true \\\n--set appsec.mode=standalone \\\n--set service.type=LoadBalancer \\\n--set appsec.persistence.enabled=false \\\n--set ingress-controller.enabled=true \\\n--set ingress-controller.config.ingressClass=appsec-apisix \\\n--set appsec.userEmail=\u201d<your-email-address>\u201d \\\n--set appsec.agentToken= \\\n--create-namespace \\\n-n appsec-apisix\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<your-email-address>")," in the Helm install command above with your own email address, so we can send you news and updates related to open-appsec and better support you with your deployment if needed! You can unsubscribe at any time or alternatively, just remove that line if you prefer not to provide your email.")),(0,o.kt)("h3",{id:"4-validate"},"4. Validate"),(0,o.kt)("p",null,"Validate that pods were properly deployed and are in a ready state:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get pods -n appsec-apisix\n")),(0,o.kt)("h3",{id:"5-create-an-open-appsec-policy-resource"},"5. Create an open-appsec Policy Resource"),(0,o.kt)("p",null,'Run the following command to create the "open-appsec-best-practice-policy" in K8s.'),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that this example policy is already pre-configured to prevent attacks.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"kubectl apply -f https://raw.githubusercontent.com/openappsec/openappsec/main/config/k8s/v1beta1/open-appsec-k8s-prevent-config-v1beta1.yaml\n")),(0,o.kt)("p",null,"You can also create your own custom policy, ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openappsec.io/getting-started/start-with-kubernetes/configuration-using-crds"},"here")," you find all the details."),(0,o.kt)("h3",{id:"6-fetch-the-target-resource-name"},"6. Fetch the Target Resource Name"),(0,o.kt)("p",null,"Find out the name of the relevant ingress resource which you want to protect:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get ing -A\n")),(0,o.kt)("h3",{id:"7-edit-the-ingress-resource"},"7. Edit the Ingress Resource"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit ing/<ingress name> -n <ingress namespace>\n")),(0,o.kt)("h3",{id:"8-change-the-ingressclassname"},"8. Change the ingressClassname"),(0,o.kt)("p",null,"Change the ingressClassname to use open-appsec:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"spec: ingressClassName: appsec-apisix\n")),(0,o.kt)("h3",{id:"9-add-annotation-to-the-ingress-resource"},"9. Add Annotation to the Ingress Resource"),(0,o.kt)("p",null,"Add this annotation to the ingress resource to activate open-appsec for this ingress by specifying the desired open-appsec policy custom resource."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"openappsec.io/policy: open-appsec-best-practice-policy\n")),(0,o.kt)("h3",{id:"10-validate-the-standalone-configuration-1"},"10. Validate the Standalone Configuration"),(0,o.kt)("p",null,"Let's see if the standalone configuration works by accessing it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc http://[YOUR-INGRESS-HOSTNAME]\n")),(0,o.kt)("h3",{id:"11-simulate-an-sql-injection-attack-1"},"11. Simulate an SQL Injection Attack"),(0,o.kt)("p",null,"Now let's try to simulate an SQL injection attack against the ",(0,o.kt)("inlineCode",{parentName:"p"},"httpin.org")," service exposed by the APISIX gateway container which is now protected by open-appsec."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"curl -s -v -G --data-urlencode email=user@domain.abc' OR '1'='1 http://[YOUR-INGRESS-HOSTNAME]\n")),(0,o.kt)("p",null,"Replace ","[YOUR-INGRESS-HOSTNAME]",' in the command above with the hostname you set in the ingress resource which you protected with open-appsec WAF in the earlier steps, also change "http" to "https" if required.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Congratulations!")," You successfully deployed APISIX integrated with open-appsec WAF and verified that your web services exposed by the APISIX Gateway are now protected against attacks."),(0,o.kt)("h2",{id:"how-to-manage-your-open-appsec-waf-deployment-centrally"},"How to Manage Your open-appsec WAF Deployment Centrally?"),(0,o.kt)("p",null,"If you like you can also manage your open-appsec WAF deployment (integrated with APISIX) centrally using the open-appsec Web UI (SaaS Service) available at ",(0,o.kt)("a",{parentName:"p",href:"https://my.openappsec.io"},"https://my.openappsec.io"),", by connecting the open-appsec agent to a deployment profile in the central Web UI."),(0,o.kt)("p",null,'You can alternatively continue to manage your deployment locally but still connect to a central WebUI profile in "Declarative mode" so that you will be able to see the local configuration (read-only) in the Web UI.'),(0,o.kt)("p",null,"Alongside the configuration of open-appsec the Web UI allows you to also see much more information like the status of deployed open-appsec agents, security logs, dashboards and more."),(0,o.kt)("p",null,"For instructions on how to connect your deployment to the central Web UI see the open-appsec docs available at ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openappsec.io"},"https://docs.openappsec.io"),"."),(0,o.kt)("p",null,"Below you find some screenshots of the Web UI."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2024/10/11/MzsUwqh3_open-appsec-4.jpeg",alt:"Open-websec UI 1"})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2024/10/11/YFofdEzT_open-appsec-5.jpeg",alt:"Open-websec UI 2"})),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,"In this blog we explained how open-appsec can integrate with Apache APISIX on all of the following: regular Linux-based deployments, containerized deployments (Docker), and also Kubernetes environments."),(0,o.kt)("p",null,"Following the deployment steps for APISIX with open-appsec WAF, we simulated SQL injection attacks, which were effectively prevented by open-appsec's machine learning-based WAF technology."),(0,o.kt)("p",null,"Additionally, it was explained, what the benefits are of connecting to open-appsec central WebUI for managing, monitoring, log analysis, and reporting."),(0,o.kt)("p",null,"We hope these new integrations will prove very useful to enhance the security of your APISIX API gateway and its exposed web APIs and web applications with open-appsec machine learning-based WAF."),(0,o.kt)("p",null,"Welcome you to contact us if you have any feedback, or questions or might face some technical challenge that you want us to assist with. You can reach the open-appsec team via the chat on ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io"},"https://www.openappsec.io")," or via email to: ",(0,o.kt)("a",{parentName:"p",href:"info@openappsec.io"},"info@openappsec.io"),"."),(0,o.kt)("h2",{id:"additional-resources"},"Additional Resources"),(0,o.kt)("h3",{id:"open-appsec-waf"},"open-appsec WAF"),(0,o.kt)("p",null,"Website: ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io"},"https://www.openappsec.io")),(0,o.kt)("p",null,"GitHub: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openappsec"},"https://github.com/openappsec")),(0,o.kt)("p",null,"Docs: ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openappsec.io"},"https://docs.openappsec.io")),(0,o.kt)("p",null,"Playgrounds: ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io/playground"},"https://www.openappsec.io/playground")),(0,o.kt)("p",null,"Blogs: ",(0,o.kt)("a",{parentName:"p",href:"https://www.openappsec.io/blogs"},"https://www.openappsec.io/blogs")),(0,o.kt)("h3",{id:"apache-apisix"},"Apache APISIX"),(0,o.kt)("p",null,"Website: ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org"},"https://apisix.apache.org")),(0,o.kt)("p",null,"GitHub: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix"},"https://github.com/apache/apisix")),(0,o.kt)("p",null,"Docs: ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/"},"https://apisix.apache.org/docs/")),(0,o.kt)("p",null,"Blogs: ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/blog/"},"https://apisix.apache.org/blog/")))}d.isMDXComponent=!0}}]);