"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[27775],{35318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(g,o(o({ref:t},u),{},{components:n})):a.createElement(g,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11951:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(25773),r=(n(27378),n(35318));const i={title:"Release Apache APISIX 2.13.0",authors:[{name:"Zexuan Luo",title:"Author",url:"https://github.com/spacewander",image_url:"https://avatars.githubusercontent.com/u/4161644?v=4"},{name:"Yilin Zeng",title:"Technical Writer",url:"https://github.com/yzeng25",image_url:"https://github.com/yzeng25.png"}],keywords:["Apache APISIX","API Gateway","Service Discovery","Release Notes","LTS version"],description:"Apache APISIX 2.13.0 LTS version is released. This version not only has more stable performance, but also supports more observability and service discovery plugins.",tags:["Community"]},o=void 0,l={permalink:"/blog/2022/03/28/release-apache-apisix-2.13",source:"@site/blog/2022/03/28/release-apache-apisix-2.13.md",title:"Release Apache APISIX 2.13.0",description:"Apache APISIX 2.13.0 LTS version is released. This version not only has more stable performance, but also supports more observability and service discovery plugins.",date:"2022-03-28T00:00:00.000Z",formattedDate:"March 28, 2022",tags:[{label:"Community",permalink:"/blog/tags/community"}],readingTime:4.935,truncated:!0,authors:[{name:"Zexuan Luo",title:"Author",url:"https://github.com/spacewander",image_url:"https://avatars.githubusercontent.com/u/4161644?v=4",imageURL:"https://avatars.githubusercontent.com/u/4161644?v=4"},{name:"Yilin Zeng",title:"Technical Writer",url:"https://github.com/yzeng25",image_url:"https://github.com/yzeng25.png",imageURL:"https://github.com/yzeng25.png"}],prevItem:{title:"Apache APISIX Summit ASIA 2022 is coming",permalink:"/blog/2022/04/12/apisix-summit-asia-2022"},nextItem:{title:"Biweekly Report (Mar 1st - Mar 14th)",permalink:"/blog/2022/03/24/weekly-report-0314"}},s={authorsImageUrls:[void 0,void 0]},p=[{value:"Features Preview",id:"features-preview",children:[{value:"New Change: API Is No Longer Exposed by Default",id:"new-change-api-is-no-longer-exposed-by-default",children:[],level:3},{value:"New Features: Enhancements in Observability",id:"new-features-enhancements-in-observability",children:[],level:3},{value:"Better Multilingual Development System",id:"better-multilingual-development-system",children:[],level:3}],level:2},{value:"Bugfixes",id:"bugfixes",children:[],level:2},{value:"More Details",id:"more-details",children:[],level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Apache APISIX community has rolled out a new LTS version, 2.13.0. This version not only delivers more stable performance, but also supports more observability and service discovery plugins, as well as a more robust multilingual development system.")),(0,r.kt)("p",null,"It has been more than half a year since the last LTS release of Apache APISIX, and today the Apache APISIX community is bringing a new LTS release, 2.13.0, which is not only more stable, but also supports more observability and service discovery plugins, and a more complete multilingual development system."),(0,r.kt)("p",null,"If you're trying to find a balance between stability and new features, Apache APISIX 2.13.0 is an ideal choice. Since 2.13.0 is a LTS version, we will release a series of patch releases based on 2.13.0."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1648452101951-d69cb087-a6b4-490f-9a7b-47e122f72240.png",alt:"Apache APISIX 2.13.0 Features Preview"})),(0,r.kt)("h2",{id:"features-preview"},"Features Preview"),(0,r.kt)("h3",{id:"new-change-api-is-no-longer-exposed-by-default"},"New Change: API Is No Longer Exposed by Default"),(0,r.kt)("p",null,"In versions prior to 2.13.0, we allowed plugins to register APIs that could be called by clients. For example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"jwt-auth")," plugin would register a JWT-signed interface that could be accessed by clients to generate signatures for validation. However, this design has a  drawback - since it is the interface that is exposed and not the route, it is not possible to enforce security for it in the same way as for routes. While existing mechanisms allow users to intercept interface access by writing a corresponding plugin interceptor, there are still security risks in this approach."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Starting with version 2.13.0, we decide to make a major change and no longer expose the API by default"),". If a user needs to expose an interface, they need to bind the interface to the corresponding route via the ",(0,r.kt)("inlineCode",{parentName:"p"},"public-api")," plugin. This approach brings two benefits."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"registered APIs will have higher visibility, currently registered APIs only take effect through display configuration, and access is user-defined."),(0,r.kt)("li",{parentName:"ol"},"More security options are allowed, and registered APIs have the same permission controls as routes.")),(0,r.kt)("p",null,"Of course, there are other new changes in version 2.13.0, such as fixing unusual behaviors in previous versions. See ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/release/2.13/CHANGELOG.md#2130"},"Apache APISIX 2.13.0 Changelog")," for detailed information."),(0,r.kt)("h3",{id:"new-features-enhancements-in-observability"},"New Features: Enhancements in Observability"),(0,r.kt)("p",null,"As an API gateway, Apache APISIX has been working to connect more services and open up more observability upstream and downstream. We've been puting efforts in this field with every release, and 2.13.0 is also included."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"This time we have added a new tracing plugin: ",(0,r.kt)("inlineCode",{parentName:"strong"},"opentelemetry"),", which allows sending OpenTelemetry tracing data to the configured collector"),". Here is an example."),(0,r.kt)("p",null,"The collector is set in the static configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'plugin_attr:\n  opentelemetry:\n    resource:\n      service.name: APISIX\n      tenant.id: business_id\n    collector:\n      address: "127.0.0.1:4317"\n    batch_span_processor:\n      drop_on_queue_full: false\n      max_queue_size: 6\n      batch_timeout: 2\n      inactive_timeout: 1\n      max_export_batch_size: 2\n')),(0,r.kt)("p",null,"After that, tracing can be enabled on a specific route."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1  \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "methods": ["GET"],\n    "uris": [\n        "/uid/*"\n    ],\n    "plugins": {\n        "opentelemetry": {\n            "sampler": {\n                "name": "always_on"\n            }\n        }\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "127.0.0.1:8089": 1\n        }\n    }\n}\'\n')),(0,r.kt)("p",null,"Requests that hit this route will report OpenTelemetry data to the corresponding collector."),(0,r.kt)("p",null,"In addition, we have added two new logging plugins that support reporting logs to ClickHouse and Loggly."),(0,r.kt)("p",null,"ClickHouse is one of the fastest OLAP databases in the world. Apache APISIX supports sending access logs and error logs to ClickHouse, as shown in the following example."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1  \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n      "plugins": {\n            "clickhouse-logger": {\n                "user": "default",\n                "password": "a",\n                "database": "default",\n                "logtable": "test",\n                "endpoint_addr": "http://127.0.0.1:8123"\n            }\n       },\n      "upstream": {\n           "type": "roundrobin",\n           "nodes": {\n               "127.0.0.1:1980": 1\n           }\n      },\n      "uri": "/hello"\n}\'\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/error-log-logger  \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n  "clickhouse": {\n      "user": "default",\n      "password": "a",\n      "database": "error_log",\n      "logtable": "t",\n      "endpoint_addr": "http://127.0.0.1:8123"\n  }\n}\'\n')),(0,r.kt)("p",null,"Loggly is SolarWinds' SaaS platform for log processing, and we support sending access logs via syslog or HTTP/HTTPS. Examples are as follows."),(0,r.kt)("p",null,"Configure reporting method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/loggly  \\\n-H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d '\n{\n   \"protocol\": \"http\"\n}'\n")),(0,r.kt)("p",null,"Configure the routes that need to be reported."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1  \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "plugins":{\n        "loggly":{\n            "customer_token":"xxx",\n        }\n    },\n    "upstream":{\n        "type":"roundrobin",\n        "nodes":{\n            "127.0.0.1:80":1\n        }\n    },\n    "uri":"/index.html"\n}\'\n')),(0,r.kt)("h3",{id:"better-multilingual-development-system"},"Better Multilingual Development System"),(0,r.kt)("p",null,"Apache APISIX has supported Wasm (Proxy Wasm SDK) since version 2.11, but the LTS version has not provided support for it. We add and improv this feature in 2.13.0."),(0,r.kt)("p",null,"After six months of development with over 10,000 lines of code (including testing and documentation), APISIX now has full support for running Wasm code in all four phases of ",(0,r.kt)("strong",{parentName:"p"},"processing request headers, request bodies, response headers, and response bodies"),". Apache APISIX 2.13.0 is the first LTS release to support Wasm, and we consider it as a milestone."),(0,r.kt)("p",null,"In addition to Wasm, we are also working on a traditional, RPC-based multilingual plugin system. Not long ago, we released Python Runner version 0.2.0. In a few days, we will also release Go Runner 0.3.0."),(0,r.kt)("h2",{id:"bugfixes"},"Bugfixes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SkyWalking and OpenTelemetry do not track authentication failures."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"log-rotate")," cutting logs do not support completion by hours."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"deepcopy")," does not copy ",(0,r.kt)("inlineCode",{parentName:"li"},"metatable"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"request-validate")," handling of duplicate keys in JSON."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prometheus")," duplicate calculation metrics."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"conf.method")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"proxy-rewrite")," does not work when ",(0,r.kt)("inlineCode",{parentName:"li"},"conf.headers")," is missing."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"traffic-split")," fails to match when the first rule fails."),(0,r.kt)("li",{parentName:"ul"},"etcd timeout triggers ",(0,r.kt)("inlineCode",{parentName:"li"},"resync_delay"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proto")," definition conflict."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"limit-count")," configuration remains unchanged and resets the counter."),(0,r.kt)("li",{parentName:"ul"},"Admin API's ",(0,r.kt)("inlineCode",{parentName:"li"},"plugin-metadata")," count and ",(0,r.kt)("inlineCode",{parentName:"li"},"global-rule")," count report wrong count numbers."),(0,r.kt)("li",{parentName:"ul"},"Labels are missing when merging route and service.")),(0,r.kt)("h2",{id:"more-details"},"More Details"),(0,r.kt)("p",null,"In addition to the above features and components, Apache APISIX version 2.13.0 has been updated with the following features."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"grpc-transcode support for processing proto definitions with import via ",(0,r.kt)("inlineCode",{parentName:"li"},".pb")," files."),(0,r.kt)("li",{parentName:"ul"},"Support for fetching upstream nodes from K8s configuration."),(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"csrf")," plugin to provide protection against cross-site request forgery."),(0,r.kt)("li",{parentName:"ul"},"Add ",(0,r.kt)("inlineCode",{parentName:"li"},"mocking")," plugin to generate test data easily.")))}c.isMDXComponent=!0}}]);