"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[20814],{35318:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=p(n),d=r,g=h["".concat(i,".").concat(d)]||h[d]||u[d]||o;return n?a.createElement(g,l(l({ref:t},c),{},{components:n})):a.createElement(g,l({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<o;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},88598:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=n(25773),r=(n(27378),n(35318));const o={title:"Deploy APISIX and APISIX Ingress Controller on Rancher",author:"Jintao Zhang",authorURL:"https://github.com/tao12345666333",authorImageURL:"https://avatars.githubusercontent.com/u/3264292?v=4",keywords:["APISIX","Rancher","Helm Chart","API Gateway"],description:"Through the cloud-native API gateway Apache APISIX Helm repository, you can directly deploy Apache APISIX and APISIX Ingress controller in Rancher.",tags:["Ecosystem"]},l=void 0,s={permalink:"/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast",source:"@site/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast.md",title:"Deploy APISIX and APISIX Ingress Controller on Rancher",description:"Through the cloud-native API gateway Apache APISIX Helm repository, you can directly deploy Apache APISIX and APISIX Ingress controller in Rancher.",date:"2021-06-23T00:00:00.000Z",formattedDate:"June 23, 2021",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:3.655,truncated:!0,authors:[{name:"Jintao Zhang",url:"https://github.com/tao12345666333",imageURL:"https://avatars.githubusercontent.com/u/3264292?v=4"}],prevItem:{title:"Why would you choose Apache APISIX instead of NGINX or Kong?",permalink:"/blog/2021/06/28/why-we-need-apache-apisix"},nextItem:{title:"How to Write an Apache APISIX Plugin in Java",permalink:"/blog/2021/06/21/use-java-to-write-apache-apisix-plugins"}},i={authorsImageUrls:[void 0]},p=[{value:"Prerequisite",id:"prerequisite",children:[],level:2},{value:"Step 1: Configure Helm Chart in Rancher",id:"step-1-configure-helm-chart-in-rancher",children:[],level:2},{value:"Step 2: Deploy an Example Project",id:"step-2-deploy-an-example-project",children:[],level:2},{value:"Step 3: Use Apache APISIX as an API Gateway to Proxy Services",id:"step-3-use-apache-apisix-as-an-api-gateway-to-proxy-services",children:[],level:2},{value:"Step 4: Use Apache APISIX Ingress Controller Proxy Service",id:"step-4-use-apache-apisix-ingress-controller-proxy-service",children:[],level:2},{value:"Conclusion",id:"conclusion",children:[],level:2},{value:"Future Plans",id:"future-plans",children:[],level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This article shows the procedure of installing and deploying Apache APISIX and Apache APISIX Ingress Controller in the Rancher App Store (Catalog), and how to proxy Kubernetes services through them.")),(0,r.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,r.kt)("p",null,"Existing Kubernetes clusters are all hosted on Rancher."),(0,r.kt)("h2",{id:"step-1-configure-helm-chart-in-rancher"},"Step 1: Configure Helm Chart in Rancher"),(0,r.kt)("p",null,"Visit Rancher\u2019s Tools \u2014 Catalogs page."),(0,r.kt)("p",null,"Click \u201cEdit Catalog\u201d, enter ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-helm-chart"},"https://github.com/apache/apisix-helm-chart")," in \u201cCatalog URL\u201d to add the Helm repository for Apache APISIX in Rancher."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639464984786-20a73a62-1e9d-463b-aac3-26ac18ab5228.png",alt:"2021-06-23-1"})),(0,r.kt)("p",null,"Click \u201cSave\u201d to save the changes."),(0,r.kt)("p",null,"Select the Apps page, select Launch to see the Apache APISIX repository information. Here we can directly select \u201capisix\u201d to deploy Apache APISIX."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465059361-aa11ab87-11f7-45b6-964f-d285d41e8a39.png",alt:"2021-06-23-2"})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465129809-bf86383f-bab5-459d-bb02-e7d45e3b4c51.png",alt:"2021-06-23-3"})),(0,r.kt)("p",null,"Since we want to ",(0,r.kt)("strong",{parentName:"p"},"deploy APISIX Ingress controller at the same time"),", fill in the ",(0,r.kt)("inlineCode",{parentName:"p"},"ingress-controller.enabled=true")," in the Answers at the bottom. Then click 'Save\" to complete the deployment."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465197713-4ba6e7a2-8824-42e6-bf27-1d49f4e60ce5.png",alt:"2021-06-23-4"})),(0,r.kt)("p",null,"Wait a few moments for the deployment to complete."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465259396-fc1104e9-289d-41b6-ae23-d6e05da066b1.png",alt:"2021-06-23-5"})),(0,r.kt)("h2",{id:"step-2-deploy-an-example-project"},"Step 2: Deploy an Example Project"),(0,r.kt)("p",null,"We use ",(0,r.kt)("inlineCode",{parentName:"p"},"kennethreitz/httpbin")," as a sample project for demonstration purpose. The deployment is also done directly in Rancher."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465331864-d8160567-d30c-427a-b0e5-425df6657879.png",alt:"2021-06-23-6"})),(0,r.kt)("h2",{id:"step-3-use-apache-apisix-as-an-api-gateway-to-proxy-services"},"Step 3: Use Apache APISIX as an API Gateway to Proxy Services"),(0,r.kt)("p",null,"First, We demonstrate how to use Apache APISIX as a gateway to proxy services in a Kubernetes cluster."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'root@apisix:~$ kubectl -n apisix exec -it `kubectl -n apisix get pods -l app.kubernetes.io/name=apisix -o name` -- bash\nbash-5.1# curl httpbin.default/get\n{\n  "args": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin.default",\n    "User-Agent": "curl/7.76.1"\n  },\n  "origin": "10.244.3.3",\n  "url": "http://httpbin.default/get"\n}\n')),(0,r.kt)("p",null,"You can see that the sample project can be accessed normally from within the Apache APISIX Pod. Next, we use Apache APISIX to proxy the sample project."),(0,r.kt)("p",null,"Here we use ",(0,r.kt)("inlineCode",{parentName:"p"},"curl")," to call the admin interface of Apache APISIX to create a route. All requests with a host header of ",(0,r.kt)("inlineCode",{parentName:"p"},"httpbin.org")," are forwarded to the actual application service ",(0,r.kt)("inlineCode",{parentName:"p"},"httpbin.default:80"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'bash-5.1# curl "http://127.0.0.1:9180/apisix/admin/routes/1" -H "X-API-KEY: edd1c9f034335f136f87ad84b625c8f1" -X PUT -d \'\n{\n  "uri": "/*",\n  "host": "httpbin.org",\n  "upstream": {\n    "type": "roundrobin",\n    "nodes": {\n      "httpbin.default:80": 1\n    }\n  }\n}\'\n{"action":"set","node":{"value":{"uri":"\\/*","create_time":1623834078,"update_time":1623834078,"priority":0,"upstream":{"type":"roundrobin","hash_on":"vars","pass_host":"pass","nodes":{"httpbin.default:80":1},"scheme":"http"},"id":"1","status":1,"host":"httpbin.org"},"key":"\\/apisix\\/routes\\/1"}}\n')),(0,r.kt)("p",null,"You will get an output similar to the above code block. Next, verify that the proxy is successful."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'bash-5.1# curl http://127.0.0.1:9080/get -H "HOST: httpbin.org"\n{\n  "args": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin.org",\n    "User-Agent": "curl/7.76.1",\n    "X-Forwarded-Host": "httpbin.org"\n  },\n  "origin": "127.0.0.1",\n  "url": "http://httpbin.org/get"\n}\n')),(0,r.kt)("p",null,"The above output shows that the sample project traffic has been proxied through Apache APISIX. Next, let\u2019s try accessing the sample project from outside the cluster via Apache APISIX."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"root@apisix:~$ kubectl  -n apisix get svc -l app.kubernetes.io/name=apisix\nNAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\napisix-admin     ClusterIP   10.96.142.88    <none>        9180/TCP       51m\napisix-gateway   NodePort    10.96.158.192   <none>        80:32763/TCP   51m\n")),(0,r.kt)("p",null,"When deployed using Helm chart, the Apache APISIX port is exposed by default as a NodePort. We use the Node IP + NodePort port for access testing."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'root@apisix:~$ curl http://172.18.0.2:32763/get -H "HOST: httpbin.org"\n{\n  "args": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin.org",\n    "User-Agent": "curl/7.58.0",\n    "X-Forwarded-Host": "httpbin.org"\n  },\n  "origin": "10.244.3.1",\n  "url": "http://httpbin.org/get"\n}\n')),(0,r.kt)("p",null,"As you can see, ",(0,r.kt)("strong",{parentName:"p"},"Apache APISIX is able to proxy services within a Kubernetes cluster outside the cluster"),"."),(0,r.kt)("h2",{id:"step-4-use-apache-apisix-ingress-controller-proxy-service"},"Step 4: Use Apache APISIX Ingress Controller Proxy Service"),(0,r.kt)("p",null,"We can add Ingress directly to Rancher and the Apache APISIX Ingress controller will automatically synchronize the routing rules to Apache APISIX to complete the proxy for the service."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465402058-3f41e8de-033b-4888-a835-30969251e402.png",alt:"2021-06-23-7"})),(0,r.kt)("p",null,"Note in the bottom right corner, we have added the annotation configuration ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes.io/ingress.class: apisix")," to support multiple ingress-controller scenarios in the cluster."),(0,r.kt)("p",null,"After saving, you can see the following screen."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1639465466581-db8c19d7-9c8f-402c-9270-34e327908caa.png",alt:"2021-06-23-8"})),(0,r.kt)("p",null,"Test if the proxy is successful under the terminal\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'root@apisix:~$ curl http://172.18.0.2:32763/get -H "HOST: httpbin-ing.org"\n{\n  "args": {},\n  "headers": {\n    "Accept": "*/*",\n    "Host": "httpbin-ing.org",\n    "User-Agent": "curl/7.58.0",\n    "X-Forwarded-Host": "httpbin-ing.org"\n  },\n  "origin": "10.244.3.1",\n  "url": "http://httpbin-ing.org/get"\n}\n')),(0,r.kt)("p",null,"You can see that it is also proxied properly."),(0,r.kt)("p",null,"In addition, the Apache APISIX Ingress controller extends Kubernetes by way of CRD, and you can also expose services in Kubernetes to the public by publishing custom resources like  ",(0,r.kt)("inlineCode",{parentName:"p"},"ApisixRoute"),"."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"You can deploy Apache APISIX and APISIX Ingress controller directly in Rancher using the official Apache APISIX Helm repository. And Apache APISIX can be used as a gateway or as a data plane for the APISIX Ingress controller to carry business traffic."),(0,r.kt)("h2",{id:"future-plans"},"Future Plans"),(0,r.kt)("p",null,"The Rancher community has partnered with Apache APISIX community. You will be able to find Apache APISIX directly in Rancher\u2019s own app store in the future, eliminating the need to manually add Helm repositories."))}u.isMDXComponent=!0}}]);