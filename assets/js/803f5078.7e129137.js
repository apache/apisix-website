"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[48984],{35318:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(27378);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=s(n),m=o,h=u["".concat(p,".").concat(m)]||u[m]||d[m]||l;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,r=new Array(l);r[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var s=2;s<l;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},47920:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var a=n(25773),o=(n(27378),n(35318));const l={title:"Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry",authors:[{name:"Haochao Zhuang",title:"Author",url:"https://github.com/dmsolr",image_url:"https://avatars.githubusercontent.com/u/29735230?v=4"},{name:"Fei Han",title:"Technical Writer",url:"https://github.com/hf400159",image_url:"https://avatars.githubusercontent.com/u/97138894?v=4"}],keywords:["Apache APISIX","API Gateway","OpenTelemetry","Observability","Ecosystem"],description:"This article introduces you to the API Gateway Apache APISIX `opentelemetry` plugin concept and how to enable and deploy the `opentelemetry` plugin.",tags:["Plugins","Ecosystem"],image:"https://static.apiseven.com/2022/blog/0818/plugins/opentelemetry.png"},r=void 0,i={permalink:"/blog/2022/02/28/apisix-integration-opentelemetry-plugin",source:"@site/blog/2022/02/28/apisix-integration-opentelemetry-plugin.md",title:"Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry",description:"This article introduces you to the API Gateway Apache APISIX `opentelemetry` plugin concept and how to enable and deploy the `opentelemetry` plugin.",date:"2022-02-28T00:00:00.000Z",formattedDate:"February 28, 2022",tags:[{label:"Plugins",permalink:"/blog/tags/plugins"},{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:8,truncated:!0,authors:[{name:"Haochao Zhuang",title:"Author",url:"https://github.com/dmsolr",image_url:"https://avatars.githubusercontent.com/u/29735230?v=4",imageURL:"https://avatars.githubusercontent.com/u/29735230?v=4"},{name:"Fei Han",title:"Technical Writer",url:"https://github.com/hf400159",image_url:"https://avatars.githubusercontent.com/u/97138894?v=4",imageURL:"https://avatars.githubusercontent.com/u/97138894?v=4"}],prevItem:{title:"API Gateway Apache APISIX provides enhancements on API Management",permalink:"/blog/2022/03/01/apisix-integration-public-api-plugin"},nextItem:{title:"How to Integrate API Gateway and Consul?",permalink:"/blog/2022/02/25/consul-api-gateway"}},p={authorsImageUrls:[void 0,void 0]},s=[{value:"Background Information",id:"background-information",children:[],level:2},{value:"Plugin Introduction",id:"plugin-introduction",children:[],level:2},{value:"How to Use",id:"how-to-use",children:[{value:"Enable Plugin",id:"enable-plugin",children:[{value:"Method 1: Bind the plugin to the specified route",id:"method-1-bind-the-plugin-to-the-specified-route",children:[],level:4},{value:"Method 2: Set Global Rules",id:"method-2-set-global-rules",children:[],level:4},{value:"Method 3: Customize labels for Span through <code>additional_attributes</code>",id:"method-3-customize-labels-for-span-through-additional_attributes",children:[],level:4}],level:3},{value:"Test Example",id:"test-example",children:[],level:3},{value:"Scenario Example",id:"scenario-example",children:[{value:"Step 1: Deploy OpenTelemetry",id:"step-1-deploy-opentelemetry",children:[],level:4},{value:"Step 2: Configure the Test Environment",id:"step-2-configure-the-test-environment",children:[],level:4},{value:"Step 3: Test",id:"step-3-test",children:[],level:4}],level:3}],level:2},{value:"Disable Plugin",id:"disable-plugin",children:[],level:2},{value:"Summary",id:"summary",children:[],level:2},{value:"Related articles",id:"related-articles",children:[],level:2}],c={toc:s};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This article introduces you to the Apache APISIX ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin concept and how to enable and deploy the ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin.")),(0,o.kt)("head",null,(0,o.kt)("link",{rel:"canonical",href:"https://opentelemetry.io/blog/2022/apisix/"})),(0,o.kt)("h2",{id:"background-information"},"Background Information"),(0,o.kt)("p",null,"Apache APISIX is a dynamic, real-time, high-performance API gateway that provides rich traffic management features such as load balancing, dynamic upstream, canary release, circuit breaking, authentication, observability, and more. It not only has many useful plugins, but also supports plugin dynamic change and hot swap."),(0,o.kt)("p",null,"OpenTelemetry is an open source telemetry data acquisition and processing system. It not only provides various SDKS for application side telemetry data collection and reporting, but also data collection side for data receiving, processing and exporting. Export to any or more OpenTelemetry backends, such as Jaeger, Zipkin, and OpenCensus, by configuration. You can view the list of plug-ins that have adapted the OpenTelemetry Collector in the opentelemetry collector contrib  library."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.png",alt:"error/OpenTelemetry"})),(0,o.kt)("h2",{id:"plugin-introduction"},"Plugin Introduction"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin of Apache APISIX implements Tracing data collection based on OpenTelemetry native standard (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp-request"},"OTLP/HTTP"),"), and sends it to OpenTelemetry Collector through HTTP protocol. This feature will be supported online in Apache APISIX 2.13.0."),(0,o.kt)("p",null,"Since the Agent/SDK of OpenTelemetry has nothing to do with the back-end implementation, when the application integrates the Agent/SDK of OpenTelemetry, the user can easily and freely change the observability backend service without any perception on the application side, such as switching from Zipkin into Jaeger."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry"),"plug-in integrates the OpenTelemetry Agent/SDK in Apache APISIX, which can collect traced requests, generate trace and forward them to the OpenTelemetry Collector."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin is located on the Agent side in the above figure, but currently only supports the ",(0,o.kt)("inlineCode",{parentName:"p"},"trace")," part, and does not support the ",(0,o.kt)("inlineCode",{parentName:"p"},"logs")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"metrics")," protocols of OpenTelemetry."),(0,o.kt)("h2",{id:"how-to-use"},"How to Use"),(0,o.kt)("h3",{id:"enable-plugin"},"Enable Plugin"),(0,o.kt)("p",null,"You need to enable ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin and modify collector configuration in ",(0,o.kt)("inlineCode",{parentName:"p"},"conf/config.yaml")," configuration file."),(0,o.kt)("p",null,"It is assumed that you have already deployed the OpenTelemetry Collector and enabled the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-collector/blob/main/receiver/otlpreceiver/README.md"},"OTLP HTTP Receiver"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you have not completed the deployment, you can refer to the Scenario Example section in the next section to complete the deployment of OpenTelemetry Collector.")),(0,o.kt)("p",null,"The default port of the OTLP HTTP Receiver is ",(0,o.kt)("inlineCode",{parentName:"p"},"4318"),", and the address of ",(0,o.kt)("inlineCode",{parentName:"p"},"collector")," is the HTTP Receiver address of the OpenTelemetry Collector. For related fields, please refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/zh/docs/apisix/next/plugins/opentelemetry/"},"Apache APISIX official documentation"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-YAML"},"plugins\n... # Other plugins that have been enabled\n- opentelemetry\nplugin_attr:\n...\nopentelemetry:\n  trace_id_source: x-request-id\n  resource:\n    service.name: APISIX\n  collector:\n    address: 127.0.0.1:4318 # OTLP HTTP Receiver address\n    request_timeout: 3\n")),(0,o.kt)("h4",{id:"method-1-bind-the-plugin-to-the-specified-route"},"Method 1: Bind the plugin to the specified route"),(0,o.kt)("p",null,"In order to show the test effect more conveniently, ",(0,o.kt)("inlineCode",{parentName:"p"},"sampler")," is temporarily set to full sampling in the example to ensure that ",(0,o.kt)("inlineCode",{parentName:"p"},"trace")," data is generated after each request is traced, so that you can view ",(0,o.kt)("inlineCode",{parentName:"p"},"trace")," related data on the Web UI. You can also set relevant parameters according to the actual situation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1 \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\n-X PUT -d \'\n{\n  "uri": "/get",\n  "plugins": {\n      "opentelemetry": {\n          "sampler": {\n              "name": "always_on"\n          }\n      }\n  },\n  "upstream": {\n      "type": "roundrobin",\n      "nodes": {\n          "httpbin.org:80": 1\n      }\n  }\n}\'\n')),(0,o.kt)("h4",{id:"method-2-set-global-rules"},"Method 2: Set Global Rules"),(0,o.kt)("p",null,"You can also enable ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin through the Apache APISIX Plugins feature. After the global configuration is complete, you still need to create the route, otherwise it will not be possible to test."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},'curl \'http://127.0.0.1:9080/apisix/admin/global_rules/1\' \\\n-H \'X-API-KEY:  edd1c9f034335f136f87ad84b625c8f1\' \\\n-X PUT -d \'{\n  "plugins": {\n      "opentelemetry": {\n          "sampler": {\n              "name": "always_on"\n          }\n      }\n  }\n}\'\n')),(0,o.kt)("h4",{id:"method-3-customize-labels-for-span-through-additional_attributes"},"Method 3: Customize labels for Span through ",(0,o.kt)("inlineCode",{parentName:"h4"},"additional_attributes")),(0,o.kt)("p",null,"For the configuration of ",(0,o.kt)("inlineCode",{parentName:"p"},"sampler")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"additional_attributes"),", you can refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/next/plugins/opentelemetry/#attributes"},"Apache APISIX official documentation"),", where ",(0,o.kt)("inlineCode",{parentName:"p"},"additional_attributes")," is a series of ",(0,o.kt)("inlineCode",{parentName:"p"},"Key:Value")," key value pairs, you can use it to customize the label for Span, and can follow Span to display on the Web UI. Add ",(0,o.kt)("inlineCode",{parentName:"p"},"route_id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"http_x-custom-ot-key")," to the span of a route through ",(0,o.kt)("inlineCode",{parentName:"p"},"additional_attributes"),", you can refer to the following configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1001 \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\n-X PUT -d \'\n{\n  "uri": "/put",\n  "plugins": {\n      "opentelemetry": {\n          "sampler": {\n              "name": "always_on"\n          },\n          "additional_attributes":[\n              "route_id",\n              "http_x-custom-ot-key"\n          ]\n      }\n  },\n  "upstream": {\n      "type": "roundrobin",\n      "nodes": {\n          "httpbin.org:80": 1\n      }\n  }\n}\'\n')),(0,o.kt)("h3",{id:"test-example"},"Test Example"),(0,o.kt)("p",null,"You can enable ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin in any of the above three methods. The following example uses the example of method three to create a route. After the creation is successful, you can refer to the following commands to access the route:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},"curl -X PUT -H `x-custom-ot-key: test-ot-val` http://127.0.0.1:9080/put\n")),(0,o.kt)("p",null,"After the access is successful, you can see the details of the span similar to ",(0,o.kt)("inlineCode",{parentName:"p"},"/put")," in the Jaeger UI, and you can see that the custom tags in the route are displayed in the Tags list: ",(0,o.kt)("inlineCode",{parentName:"p"},"http_x-custom-ot-key")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"route_id"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.png",alt:"error/Span details.png"})),(0,o.kt)("p",null,"You need to note that the ",(0,o.kt)("inlineCode",{parentName:"p"},"additional_attributes")," configuration is set to take values from Apache APISIX and Nginx variables as ",(0,o.kt)("inlineCode",{parentName:"p"},"attribute")," values, so ",(0,o.kt)("inlineCode",{parentName:"p"},"additional_attributes")," must be a valid Apache APISIX or Nginx variable. It also includes HTTP Header, but when fetching ",(0,o.kt)("inlineCode",{parentName:"p"},"http_header"),", you need to add ",(0,o.kt)("inlineCode",{parentName:"p"},"http_")," as the prefix of the variable name. If the variable does not exist, the ",(0,o.kt)("inlineCode",{parentName:"p"},"tag")," will not be displayed."),(0,o.kt)("h3",{id:"scenario-example"},"Scenario Example"),(0,o.kt)("p",null,"This scenario example deploys Collector, Jaeger, and Zipkin as backend services by simply modifying the official example of OpenTelemetry Collector, and starts two sample applications (Client and Server), where Server provides an HTTP service, and Client will cyclically call the server provided by the server. HTTP interface, resulting in a call chain consisting of two spans."),(0,o.kt)("h4",{id:"step-1-deploy-opentelemetry"},"Step 1: Deploy OpenTelemetry"),(0,o.kt)("p",null,"The following uses ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," as an example. For other deployments, please refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/collector/getting-started/"},"OpenTelemetry official documentation"),"."),(0,o.kt)("p",null,"You can refer to the following command to deploy:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},"git clone https://github.com/open-telemetry/opentelemetry-collector-contrib.git\ncd opentelemetry-collector-contrib/examples/demo\ndocker-compose up -d\n")),(0,o.kt)("p",null,"Enter ",(0,o.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:16886")," (Jaeger UI) or ",(0,o.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:9411/zipkin")," (Zipkin UI) in the browser. If it can be accessed normally, the deployment is successful."),(0,o.kt)("p",null,"The following figure shows an example of successful access:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.png",alt:"error/Jaeger example.png"})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.png",alt:"error/Zipkin example.png"})),(0,o.kt)("h4",{id:"step-2-configure-the-test-environment"},"Step 2: Configure the Test Environment"),(0,o.kt)("p",null,"The Apache APISIX service is introduced, and the topology of the final application is shown in the following figure:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.png",alt:"error/Architecture diagram.png"})),(0,o.kt)("p",null,"The Trace data reporting process is as follows. Among them, since Apache APISIX is deployed separately and not in the network of docker-compose, Apache APISIX accesses the OTLP HTTP Receiver of OpenTelemetry Collector through the locally mapped port (",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1:4138"),")."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.png",alt:"error/Trace data reporting process.png"})),(0,o.kt)("p",null,"You need to make sure you have enabled the ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin and reload Apache APISIX."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"You can refer to the following example to create a route and enable the ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," plugin for sampling:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},'curl http://127.0.0.1:9080/apisix/admin/routes/1 \\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\n  -X PUT -d \'\n{\n    "uri": "/hello",\n    "plugins": {\n        "opentelemetry": {\n            "sampler": {\n                "name": "always_on",\n            }\n        }\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "127.0.0.1:7080": 1\n        }\n    }\n}\'\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Modify the ",(0,o.kt)("inlineCode",{parentName:"p"},"./examples/demo/otel-collector-config.yaml")," file and add the OTLP HTTP Receiver as follows:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-Shell"},"receivers:\n  otlp:\n    protocols:\n      grpc:\n      http:${ip:port}   # add OTLP HTTP Receiver\uff0cdefault port is 4318\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Modify ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml"),"."))),(0,o.kt)("p",null,"You need to modify the configuration file, change the interface address of Client calling Server to the address of Apache APISIX, and map the ports of OTLP HTTP Receiver and Server services to local."),(0,o.kt)("p",null,"The following example is the complete docker-compose.yaml after the configuration is modified:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-YAML"},'version: "2"\nservices:\n\n# Jaeger\njaeger-all-in-one:\n  image: jaegertracing/all-in-one:latest\n  ports:\n    - "16686:16686" # jaeger ui port\n    - "14268"\n    - "14250"\n\n# Zipkin\nzipkin-all-in-one:\n  image: openzipkin/zipkin:latest\n  ports:\n    - "9411:9411"\n\n# Collector\notel-collector:\n  image: ${OTELCOL_IMG}\n  command: ["--config=/etc/otel-collector-config.yaml", "${OTELCOL_ARGS}"]\n  volumes:\n    - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\n  ports:\n    - "1888:1888"   # pprof extension\n    - "8888:8888"   # Prometheus metrics exposed by the collector\n    - "8889:8889"   # Prometheus exporter metrics\n    - "13133:13133" # health_check extension\n    - "4317"        # OTLP gRPC receiver\n    - "4318:4318"   # Add OTLP HTTP Receiver port mapping\n    - "55670:55679" # zpages extension\n  depends_on:\n    - jaeger-all-in-one\n    - zipkin-all-in-one\n\ndemo-client:\n  build:\n    dockerfile: Dockerfile\n    context: ./client\n  environment:\n    - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317\n    - DEMO_SERVER_ENDPOINT=http://172.17.0.1:9080/hello # APISIX address\n  depends_on:\n    - demo-server\n\ndemo-server:\n  build:\n    dockerfile: Dockerfile\n    context: ./server\n  environment:\n    - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317\n  ports:\n    - "7080:7080" # Map the Server port to the host\n  depends_on:\n    - otel-collector\n\nprometheus:\n  container_name: prometheus\n  image: prom/prometheus:latest\n  volumes:\n    - ./prometheus.yaml:/etc/prometheus/prometheus.yml\n  ports:\n    - "9090:9090"\n')),(0,o.kt)("p",null,"It should be noted that demo-client.environment.DEMO_SERVER_ENDPOINT needs to be changed to your Apache APISIX address, and ensure that it can be accessed normally in the container."),(0,o.kt)("p",null,"Of course, you can also deploy Apache APISIX through ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml"),". For details, please refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix-docker/blob/master/docs/en/latest/example.md"},"Apache APISIX official documentation"),"."),(0,o.kt)("h4",{id:"step-3-test"},"Step 3: Test"),(0,o.kt)("p",null,"After the redeployment is completed, you can access the Jaeger UI or Zipkin UI to see that the Span of APISIX is included in the Trace, as shown below:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.png",alt:"error/Jaeger example.png"})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.png",alt:"error/Zipkin example.png"})),(0,o.kt)("h2",{id:"disable-plugin"},"Disable Plugin"),(0,o.kt)("p",null,"If you do not need trace collection of a route temporarily, you only need to modify the route configuration and delete the related configuration of ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," under ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins")," in the configuration."),(0,o.kt)("p",null,"You can only remove the configuration of the ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry")," global plugin if you enabled it globally by binding Global Rules."),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,"After Apache APISIX integrates OpenTelemetry, it can easily connect with most mainstream Trace systems on the market with the help of OpenTelemetry's rich plug-ins. In addition, Apache APISIX has also implemented SkyWalking and Zipkin native standard protocol plug-ins, and is also actively cooperating with major communities to create a more powerful ecosystem."),(0,o.kt)("p",null,"Apache APISIX is also currently working on additional plugins to support integration with more services, so if you're interested, feel free to start a discussion thread in our GitHub Discussion or communicate via the mailing list."),(0,o.kt)("h2",{id:"related-articles"},"Related articles"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/blog/2021/11/04/skywalking/"},"The observability of Apache APISIX"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://apisix.apache.org/blog/2022/02/10/apisix-splunk-integration/"},"Integrating Splunk HTTP Event Collector with API Gateway")))))}d.isMDXComponent=!0}}]);