"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[93182],{35318:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>d});var s=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},i=Object.keys(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=s.createContext({}),c=function(e){var t=s.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},h=function(e){var t=c(e.components);return s.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},u=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),u=c(n),d=r,m=u["".concat(l,".").concat(d)]||u[d]||p[d]||i;return n?s.createElement(m,a(a({ref:t},h),{},{components:n})):s.createElement(m,a({ref:t},h))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,a[1]=o;for(var c=2;c<i;c++)a[c]=n[c];return s.createElement.apply(null,a)}return s.createElement.apply(null,n)}u.displayName="MDXCreateElement"},70445:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var s=n(25773),r=(n(27378),n(35318));const i={title:"Building a More Robust Apache APISIX Ingress Controller With Litmus Chaos",authors:[{name:"API7.ai",title:"Author",url:"https://github.com/api7",image_url:"https://avatars.githubusercontent.com/u/61078451?s=200&v=4"}],keywords:["Apache APISIX","Chaos Engineering","APISIX Ingress Controller"],description:"Chaos engineering is a powerful tool for ensuring system reliability and performance, and its application in designing Chaos experiments for Ingress Controllers can help organizations identify weaknesses in their applications and infrastructure.",tags:["Ecosystem"],image:"https://static.apiseven.com/uploads/2023/04/20/yeuKN9nu_Building%20a%20More%20Robust%20Apache%20APISIX%20Ingress%20Controller%20With%20Litmus%20Chaos.png",canonical_url:"https://api7.ai/blog/apache-apisix-chaos-engineering"},a=void 0,o={permalink:"/blog/2023/05/04/apache-apisix-chaos-engineering",source:"@site/blog/2023/05/04/apache-apisix-chaos-engineering.md",title:"Building a More Robust Apache APISIX Ingress Controller With Litmus Chaos",description:"Chaos engineering is a powerful tool for ensuring system reliability and performance, and its application in designing Chaos experiments for Ingress Controllers can help organizations identify weaknesses in their applications and infrastructure.",date:"2023-05-04T00:00:00.000Z",formattedDate:"May 4, 2023",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:8.47,truncated:!0,authors:[{name:"API7.ai",title:"Author",url:"https://github.com/api7",image_url:"https://avatars.githubusercontent.com/u/61078451?s=200&v=4",imageURL:"https://avatars.githubusercontent.com/u/61078451?s=200&v=4"}],prevItem:{title:"Release Apache APISIX 3.3.0",permalink:"/blog/2023/05/08/release-apache-apisix-3.3.0"},nextItem:{title:"Biweekly Report (Apr 10 - Apr 23)",permalink:"/blog/2023/04/26/weekly-report-0426"}},l={authorsImageUrls:[void 0]},c=[{value:"Overview",id:"overview",children:[],level:2},{value:"Why We Need Chaos Engineering?",id:"why-we-need-chaos-engineering",children:[],level:2},{value:"How to Design Chaos Experiments for an Ingress Controller?",id:"how-to-design-chaos-experiments-for-an-ingress-controller",children:[],level:2},{value:"Main Usage Scenarios of Ingress Controller",id:"main-usage-scenarios-of-ingress-controller",children:[],level:2}],h={toc:c};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,s.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Chaos engineering is a powerful tool for ensuring system reliability and performance, and its application in designing Chaos experiments for Ingress Controllers can help organizations identify weaknesses in their applications and infrastructure.")),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Chaos_engineering"},"Chaos Engineering")," plays a crucial role in assessing and enhancing the resilience and reliability of software systems. By simulating disruptive events, organizations can identify vulnerabilities and improve the system's design and architecture. In this article, we will discuss the importance of Chaos Engineering and its specific application in designing Chaos experiments for Ingress Controllers."),(0,r.kt)("h2",{id:"why-we-need-chaos-engineering"},"Why We Need Chaos Engineering?"),(0,r.kt)("p",null,"Chaos Engineering is the process of evaluating software systems by simulating destructive events, such as server network outages or API throttling. By introducing chaos or faults within the system, we can test the system's resilience and reliability in unstable and unexpected conditions."),(0,r.kt)("p",null,"Chaos Engineering helps teams identify hidden risks, monitor vulnerabilities, and identify performance bottlenecks in distributed systems by simulating real-world scenarios in a secure control environment. This approach effectively prevents system downtime or production interruptions."),(0,r.kt)("p",null,"Netflix's approach to handling systems inspired us to adopt a more scientific approach, which drove the birth and development of Chaos Engineering."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. Introduction of Disruptive Events")),(0,r.kt)("p",null,"Chaos Engineering involves introducing disruptive events, such as network partitions, service degradation, and resource constraints, to simulate real-world scenarios and test the system's ability to handle unexpected conditions. The purpose is to identify vulnerabilities or weaknesses and improve the system's design and architecture to make it more robust and resilient."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. Testing System Resilience")),(0,r.kt)("p",null,"In today's constantly evolving and fast-paced technology landscape, testing system resilience is crucial to ensure that systems are robust, scalable, and capable of handling unexpected challenges and conditions. Chaos Engineering is an effective way to achieve this by introducing disruptive events to observe the system's response and measure its ability to handle unexpected conditions."),(0,r.kt)("p",null,"Organizations can monitor system logs, performance metrics, and user experience to measure the impact of disruptive events on system resilience. Tracking these metrics provides a better understanding of the system's behavior, allowing organizations to identify areas for improvement."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. Discovering Hidden Problems")),(0,r.kt)("p",null,"Distributed systems are prone to hidden issues, such as data loss, performance bottlenecks, and communication errors, which can be challenging to detect, as they may only become visible when the system is under pressure. Chaos Engineering can help uncover these hidden issues by introducing disruptive events. This information can then be used to improve the system's design and architecture, making it more resilient and reliable."),(0,r.kt)("p",null,"Proactively identifying and resolving these problems enhances the reliability and performance of systems, preventing downtime, reducing the risk of data loss, and ensuring the system runs smoothly."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. What It's Worth and Why We Need It?")),(0,r.kt)("p",null,"Distributed systems are complex and inherently chaotic, which can lead to failure. The use of cloud and ",(0,r.kt)("a",{parentName:"p",href:"https://api7.ai/blog/what-are-microservices"},"microservices")," architecture provides many advantages but also comes with complexity and chaos. Engineers are responsible for making the system as reliable as possible."),(0,r.kt)("p",null,"Without testing, there is no confidence to use the project in the production environment. In addition to conventional unit tests and end-to-end tests, introducing chaos tests makes the system more robust."),(0,r.kt)("p",null,"When an error occurs, repairing it takes time and can cause immeasurable losses, with long-term effects in the future. During the repair process, various factors need consideration, including the system's complexity, the type of error, and possible new problems, to ensure effective final repair."),(0,r.kt)("p",null,"Furthermore, when an open-source project brings serious faults to users in the production environment, many users may switch to other products."),(0,r.kt)("h2",{id:"how-to-design-chaos-experiments-for-an-ingress-controller"},"How to Design Chaos Experiments for an Ingress Controller?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. What Is Ingress?")),(0,r.kt)("p",null,"Ingress is a Kubernetes resource object that contains rules for how external clients can access services within the cluster. These rules dictate which clients can access which services, how client requests are routed to the appropriate services, and how client requests are handled."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. What Is an Ingress Controller?")),(0,r.kt)("p",null,"An Ingress resource requires an Ingress Controller to process it. The controller translates the Ingress rules into configurations on a proxy, allowing external clients to access services within the cluster. In a production environment, Ingress Controllers need to have complex capabilities, such as limiting access sources and request methods, ",(0,r.kt)("a",{parentName:"p",href:"https://api7.ai/blog/api-gateway-authentication"},"authentication"),", and authorization. Most Ingress Controllers extend the semantics of Ingress through annotations in the Ingress resource."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. What Is Apache APISIX Ingress Controller?")),(0,r.kt)("p",null,"Apache APISIX Ingress Controller is a specialized type of load balancer that helps administrators manage and control Ingress traffic. It uses APISIX as a data plane to provide users with ",(0,r.kt)("a",{parentName:"p",href:"https://api7.ai/blog/dynamic-routing-based-on-user-credentials"},"dynamic routing"),", load balancing, elastic scaling, security policies, and other features to improve network control and ensure higher availability and security for their business. APISIX Ingress Controller supports three configuration modes: Kubernetes Ingress, custom resources, and Gateway API."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/04/25/0NSCMh9X_APISIX-Ingress-2.png",alt:"APISIX-Ingress"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. What Is Litmus Chaos?")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://litmuschaos.io/"},"Litmus Chaos")," is an open-source Chaos Engineering framework that provides an infrastructure experimental framework to validate the stability of controllers and microservices architectures. It can simulate various environments, such as container-level and application-level environments, natural disasters, faults, and upgrades, to understand how the system responds to these changes. The framework can also explore the behavior changes between controllers and applications, and how controllers respond to challenges in specific states. Litmus Chaos offers convenient observability integration capabilities and is highly extensible."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"5. How to Design Chaos Experiments?")),(0,r.kt)("p",null,"Here is a general procedure for designing chaos experiments in any scenario:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Define the system under test:")," Identify the specific components of the system you want to experiment on and develop clear and measurable objectives for the experiment. This includes creating a comprehensive list of the components, such as hardware and software, that will be tested, as well as defining the scope of the experiment and the expected outcomes.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/04/23/rZOw3IbZ_under-test-3.png",alt:"under-test"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"kube-apiserver: if an exception occurs, the Ingress resource write failed.\nIngress-controller: Network interruption, Crash, Podfaults, I/O\ndata-plane: Network interruption, Crash, Podfaults, I/O")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Choose the right experiment:")," Select an experiment that is aligned with the objectives you have set and closely mimics a real-world scenario. This will help ensure that the experiment produces meaningful results and accurately reflects the behavior of the system."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Establish a hypothesis:")," Establish a hypothesis about how the system will behave during the experiment and what outcomes you anticipate. This should be based on experience or research, and it should be reasonable and testable."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Run the experiment:")," Run the experiment in a controlled environment, such as a staging environment, to limit the potential for harm to the production system. Collect all relevant data during the experiment and store it securely. There may be differing opinions on whether the experiment should take place directly in the production environment. However, for most scenarios, we need to ensure the Service Level Objective (SLO) of the system is met."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Evaluate the results:")," Evaluate the results of the experiment and compare them to your hypothesis. Analyze the data collected and document any observations or findings. This includes identifying any unexpected results or discrepancies and determining how they might affect the system. Additionally, consider how the results of the experiment can be used to improve the system.")),(0,r.kt)("h2",{id:"main-usage-scenarios-of-ingress-controller"},"Main Usage Scenarios of Ingress Controller"),(0,r.kt)("p",null,"The most important capability of an Ingress Controller is to proxy traffic, and all other functions are based on this core function. Therefore, when conducting Chaos Engineering, normal proxy traffic is the key metric."),(0,r.kt)("p",null,"To define the system under test for APISIX Ingress Controller, users need to create route configurations, such as Ingress, Gateway API, or CRD, and apply them to the Kubernetes cluster via Kubectl. This process goes through kube-apiserver for authentication, authorization, admission and other related procedures, and is then stored in etcd."),(0,r.kt)("p",null,"The APISIX Ingress Controller continuously watches for changes in Kubernetes resources. These configurations are then converted to configurations on the data plane. When a client requests the data plane, it accesses the upstream service according to the routing rules."),(0,r.kt)("p",null,"If kube-apiserver has an exception, it will prevent the configuration from being created, or the Ingress Controller from getting the correct configuration. Similarly, if there is an exception in the data plane, such as a network interruption or Pod killed, it will also not be able to do normal traffic proxy."),(0,r.kt)("p",null,"The scope of our experiment is mainly the impact on system availability if the Ingress Controller has an exception."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. Detailed Operation Steps")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Choose the right experiment: We can cover many scenarios of incorrect configuration through end-to-end tests. Mainly through Chaos Engineering, we can verify whether the data plane can still proxy traffic normally when the Ingress Controller encounters an exception, such as DNS errors, network interruptions, or Pod killed."),(0,r.kt)("li",{parentName:"ul"},'Establish a hypothesis: For each scenario, we can create a hypothesis such as "When the Ingress-controller Pod gets ',(0,r.kt)("inlineCode",{parentName:"li"},"X?"),", the client's request can still get a normal response.\""),(0,r.kt)("li",{parentName:"ul"},"Run the experiment: The experiment and variables have been determined, so all that's left is to experiment.",(0,r.kt)("br",{parentName:"li"}),"Litmus Chaos provides various ways to conduct experiments. We can do this through the Litmus Portal. To do this, we need to create a Chaos scenario, select the application to be experimented on, and these steps are relatively straightforward. However, we must pay attention to the fact that Litmus Chaos includes a Probes resource.")),(0,r.kt)("p",null,"Probes are pluggable checks that can be defined within the ChaosEngine for any Chaos Experiment. The experiment pods execute these checks based on the mode they are defined in and factor their success as necessary conditions in determining the verdict of the experiment, in addition to the standard in-built checks.\nAt the same time, we can also schedule experiments, which is a very valuable function."),(0,r.kt)("p",null,"Additionally, Litmus Chaos also supports running experiments by submitting YAML manifests."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/04/23/2bpRFZWA_chaos-center-portal.png",alt:"chaos-center-portal"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Evaluate the results: Litmus Chaos has built-in statistical reports, and it can be integrated with ",(0,r.kt)("a",{parentName:"li",href:"https://apisix.apache.org/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus/#installing-prometheus-and-grafana"},"Prometheus and Grafana")," to provide a unified dashboard for integration.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/04/23/0Co6KugV_statistics-report.png",alt:"statistics-report"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. Benefits and Future")),(0,r.kt)("p",null,"Through rigorous end-to-end testing and the power of Chaos Engineering, we're confident in the stability and reliability of the delivered APISIX Ingress Controller. Chaos Engineering has also helped us to identify and fix bugs. We're constantly working to improve and evolve this amazing project, and we invite you to join our community."))}p.isMDXComponent=!0}}]);