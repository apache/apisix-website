"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[42177],{35318:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var o=n(27378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),u=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=u(n),g=a,d=h["".concat(s,".").concat(g)]||h[g]||c[g]||r;return n?o.createElement(d,i(i({ref:t},p),{},{components:n})):o.createElement(d,i({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},12546:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var o=n(25773),a=(n(27378),n(35318));const r={title:"Release Apache APISIX 2.12.0",authors:[{name:"Zexuan Luo",title:"Author",url:"https://github.com/spacewander",image_url:"https://avatars.githubusercontent.com/u/4161644?v=4"},{name:"Sylvia",title:"Technical Writer",url:"https://github.com/SylviaBABY",image_url:"https://avatars.githubusercontent.com/u/39793568?v=4"}],keywords:["Apache APISIX","2.12.0","Release","Serverless","API Gateway"],description:"The first version with new features in 2022. Support more authentication plugins and Serverless integration, rich log functions and more details.",tags:["Community"]},i=void 0,l={permalink:"/blog/2022/01/25/release-apache-apisix-2.12",source:"@site/blog/2022/01/25/release-apache-apisix-2.12.md",title:"Release Apache APISIX 2.12.0",description:"The first version with new features in 2022. Support more authentication plugins and Serverless integration, rich log functions and more details.",date:"2022-01-25T00:00:00.000Z",formattedDate:"January 25, 2022",tags:[{label:"Community",permalink:"/blog/tags/community"}],readingTime:4.795,truncated:!0,authors:[{name:"Zexuan Luo",title:"Author",url:"https://github.com/spacewander",image_url:"https://avatars.githubusercontent.com/u/4161644?v=4",imageURL:"https://avatars.githubusercontent.com/u/4161644?v=4"},{name:"Sylvia",title:"Technical Writer",url:"https://github.com/SylviaBABY",image_url:"https://avatars.githubusercontent.com/u/39793568?v=4",imageURL:"https://avatars.githubusercontent.com/u/39793568?v=4"}],prevItem:{title:"Integrate Apache APISIX with gRPC-Web",permalink:"/blog/2022/01/25/apisix-grpc-web-integration"},nextItem:{title:"Webinar | APISIX in QingCloud! ",permalink:"/blog/2022/01/24/apisix-with-qingcloud-meetup"}},s={authorsImageUrls:[void 0,void 0]},u=[{value:"New Feature: More Serverless Integrations",id:"new-feature-more-serverless-integrations",children:[],level:2},{value:"New features: More Authentication Plugins",id:"new-features-more-authentication-plugins",children:[],level:2},{value:"New features: More Logging Features",id:"new-features-more-logging-features",children:[{value:"Support for logging response bodies",id:"support-for-logging-response-bodies",children:[],level:3},{value:"Support for registering custom variables",id:"support-for-registering-custom-variables",children:[],level:3}],level:2},{value:"New: L4 Proxy Support for TLS over TCP Upstream",id:"new-l4-proxy-support-for-tls-over-tcp-upstream",children:[],level:2},{value:"Update: Multi-language plug-ins continue to improve",id:"update-multi-language-plug-ins-continue-to-improve",children:[{value:"WASM ecosystem is more feature-rich",id:"wasm-ecosystem-is-more-feature-rich",children:[],level:3},{value:"Java Plugin Runner latest version released",id:"java-plugin-runner-latest-version-released",children:[],level:3}],level:2},{value:"More details",id:"more-details",children:[],level:2},{value:"Download",id:"download",children:[],level:2}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Following the release of version 2.11.0, Apache APISIX will also bring you the first version with new features in 2022 during the upcoming Spring Festival.")),(0,a.kt)("h2",{id:"new-feature-more-serverless-integrations"},"New Feature: More Serverless Integrations"),(0,a.kt)("p",null,"Remember that in the last release, Apache APISIX added support for Azure Function. This new version is also full of intention, adding support for more Serverless vendors in the feature set."),(0,a.kt)("p",null,"Users can now also combine AWS Lambda and Apache OpenWhisk in Apache APISIX to expose specific functions on the gateway."),(0,a.kt)("h2",{id:"new-features-more-authentication-plugins"},"New features: More Authentication Plugins"),(0,a.kt)("p",null,"This new release also brings two new plugins that we've been waiting for: ",(0,a.kt)("inlineCode",{parentName:"p"},"forward-auth")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"opa"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"forward-auth")," plugin is similar to Traefik's plugin of the same name, which allows sending the information of the current request to an external service for authentication."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"opa")," plugin integrates with the well-known Open Policy Agent, which can perform complex authentication functions via OPA.")),(0,a.kt)("p",null,"These two plugins will add to the authentication functionality of Apache APISIX, giving users richer and easier authentication operations."),(0,a.kt)("h2",{id:"new-features-more-logging-features"},"New features: More Logging Features"),(0,a.kt)("p",null,"In addition to the authentication plugins mentioned above, this new release will also bring three new logging plugins: ",(0,a.kt)("inlineCode",{parentName:"p"},"google-cloud-logging"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"splunk-hec-logging")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"rocketmq-logger"),"."),(0,a.kt)("p",null,"In the future, Apache APISIX will connect to more and more logging service providers and open source brokers to make logging easier."),(0,a.kt)("h3",{id:"support-for-logging-response-bodies"},"Support for logging response bodies"),(0,a.kt)("p",null,"The 2.12.0 release also supports logging of response bodies at the logging level. As with other Apache APISIX features, this feature can be enabled dynamically via expressions. This makes it possible to log only when a specific Content-Type and Content-Length is returned upstream, without having to worry about the problems associated with full response body collection."),(0,a.kt)("p",null,"An example can be found below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "plugins": {\n        "kafka-logger": {\n            "broker_list" : {\n                "127.0.0.1":9092\n            },\n            "kafka_topic" : "test2",\n            "include_resp_body": true,\n            "include_resp_body_expr": [\n                [\n                    "sent_http_content_length",\n                    "<",\n                    "4096"\n                ],\n                [\n                    "sent_http_content_type",\n                    "==",\n                    "application/json"\n                ],\n            ]\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1980": 1\n        },\n        "type": "roundrobin"\n    },\n    "uri": "/hello"\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'The above configuration will log only when Content-Length < 4096 and Content-Type is "application/json".')),(0,a.kt)("h3",{id:"support-for-registering-custom-variables"},"Support for registering custom variables"),(0,a.kt)("p",null,"Another feature closely related to logging is that the new version of Apache APISIX now supports registration of custom variables. Combined with APISIX's custom logging format, it is possible to fully customize the reported log content. This means that log generation and reporting can be decoupled without modifying specific logging plugins. Here is a simple demonstration with an example."),(0,a.kt)("p",null,"For example, we can register a variable a6_route_labels in our own plug-in."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c"},'local core = require "apisix.core"\n\ncore.ctx.register_var("a6_route_labels", function(ctx)\n    local route = ctx.matched_route and ctx.matched_route.value\n    if route and route.labels then\n        return route.labels\n    end\n    return nil\nend)\n')),(0,a.kt)("p",null,"And use it in a custom log format."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "log_format": {\n        "host": "$host",\n        "labels": "$a6_route_labels",\n        "client_ip": "$remote_addr"\n    }\n}\n')),(0,a.kt)("p",null,"Suppose our Route looks like this."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "plugins": {\n        "http-logger": {\n            "uri": "http://127.0.0.1:1980/log",\n            "batch_max_size": 1,\n            "concat_method": "json"\n        }\n    },\n    "upstream": {\n        "nodes": {\n            "127.0.0.1:1982": 1\n        },\n        "type": "roundrobin"\n    },\n    "labels": {\n        "k": "v"\n    },\n    "uri": "/hello"\n}\n')),(0,a.kt)("p",null,"Eventually you will receive the log as shown below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{"client_ip":"127.0.0.1","host":"localhost","labels":{"k":"v"},"route_id":"1"}\n')),(0,a.kt)("h2",{id:"new-l4-proxy-support-for-tls-over-tcp-upstream"},"New: L4 Proxy Support for TLS over TCP Upstream"),(0,a.kt)("p",null,"With the new Upstream Scheme introduced in version 2.12.0, Apache APISIX now supports proxying to TLS over TCP."),(0,a.kt)("p",null,"See below for details, just specify Scheme as TLS in the Upstream configuration."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "scheme": "tls",\n    "nodes": {\n        "127.0.0.1:1995": 1\n    },\n    "type": "roundrobin"\n}\n')),(0,a.kt)("p",null,"The TCP proxy feature of Apache APISIX is now fully supported by TLS. In addition, we also support configuring the Access Log of the L4 proxy in a static file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'stream:\n    enable_access_log: false         # enable access log or not, default false\n    access_log: logs/access_stream.log\n    access_log_format: "$remote_addr [$time_local] $protocol $status $bytes_sent $bytes_received $session_time"\n                                            # create your custom log format by visiting http://nginx.org/en/docs/varindex.html\n    access_log_format_escape: default       # allows setting json or default characters escaping in variables\n')),(0,a.kt)("h2",{id:"update-multi-language-plug-ins-continue-to-improve"},"Update: Multi-language plug-ins continue to improve"),(0,a.kt)("h3",{id:"wasm-ecosystem-is-more-feature-rich"},"WASM ecosystem is more feature-rich"),(0,a.kt)("p",null,"In previous releases, Apache APISIX has opened up support for the WASM ecosystem. In version 2.12.0, a number of details have been updated for the WASM ecosystem."),(0,a.kt)("p",null,"Apache APISIX now supports running WASM code at the header_filter stage, making up for the fact that existing external plugins cannot modify the response."),(0,a.kt)("p",null,"In addition, we also support HTTP communication inside WASM through Apache APISIX as a host. With this feature, we have also re-implemented the forward-auth plugin with WASM. The functionality of the plugin is almost identical to the Lua version, and even the test cases pass with a name change from the Lua version."),(0,a.kt)("h3",{id:"java-plugin-runner-latest-version-released"},"Java Plugin Runner latest version released"),(0,a.kt)("p",null,"Of course, we haven't forgotten to update for existing external plugins, and with this 2.12.0 release, Apache APISIX now allows external plugins to fetch request bodies."),(0,a.kt)("p",null,"For example, the recent release of Java Plugin Runner version 2 includes this feature. The new version of the Java Plugin Runner also supports dynamic fetching of APISIX variables at runtime."),(0,a.kt)("h2",{id:"more-details"},"More details"),(0,a.kt)("p",null,"In addition to the new features and components mentioned above, Apache APISIX version 2.12.0 has been updated with the following features."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"gRPC-Web support: After gRPC proxies and HTTP to gRPC, we welcome the third member of the gRPC family. Apache APISIX now also supports the proxy gRPC Web protocol."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"limit-count")," enhancements: The ",(0,a.kt)("inlineCode",{parentName:"li"},"limit-count")," plugin now supports sharing of counters between requests and routes, which is quite flexible.")),(0,a.kt)("p",null,"More details about the Apache APISIX 2.12.0 update can be found in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/release/2.12/CHANGELOG.md#2120"},"Change log")," corresponding to this release."),(0,a.kt)("h2",{id:"download"},"Download"),(0,a.kt)("p",null,"To obtain the latest version of Apache APISIX 2.12.0, you can download it via the following path."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Source code: Please visit ",(0,a.kt)("a",{parentName:"li",href:"https://apisix.apache.org/downloads/"},"Download page")),(0,a.kt)("li",{parentName:"ul"},"Binary installation package: Please visit ",(0,a.kt)("a",{parentName:"li",href:"https://apisix.apache.org/zh/docs/apisix/how-to-build/"},"Installation Guide"))))}c.isMDXComponent=!0}}]);