"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[13116],{35318:(t,e,a)=>{a.d(e,{Zo:()=>p,kt:()=>d});var n=a(27378);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,i=function(t,e){if(null==t)return{};var a,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}var s=n.createContext({}),c=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):r(r({},e),t)),a},p=function(t){var e=c(t.components);return n.createElement(s.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},h=n.forwardRef((function(t,e){var a=t.components,i=t.mdxType,o=t.originalType,s=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),h=c(a),d=i,u=h["".concat(s,".").concat(d)]||h[d]||m[d]||o;return a?n.createElement(u,r(r({ref:e},p),{},{components:a})):n.createElement(u,r({ref:e},p))}));function d(t,e){var a=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var o=a.length,r=new Array(o);r[0]=h;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:i,r[1]=l;for(var c=2;c<o;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},51617:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(25773),i=(a(27378),a(35318));const o={title:"How to monitor Apache APISIX with DataAnt",authors:[{name:"Fei Han",title:"Author",url:"https://github.com/hf400159",image_url:"https://github.com/hf400159.png"}],keywords:["Apache APISIX","API Gateway","DataAnt"],description:"This article mainly introduces how to upload the API Gateway Apache APISIX indicator data to the DataAnt monitoring system through the DataAnt Agent.",tags:["Ecosystem"],image:"https://static.apiseven.com/2022/11/19/6378c1cf6c6c7.png"},r=void 0,l={permalink:"/blog/2022/07/05/use-dataant-to-monitor-apisix",source:"@site/blog/2022/07/05/use-dataant-to-monitor-apisix.md",title:"How to monitor Apache APISIX with DataAnt",description:"This article mainly introduces how to upload the API Gateway Apache APISIX indicator data to the DataAnt monitoring system through the DataAnt Agent.",date:"2022-07-05T00:00:00.000Z",formattedDate:"July 5, 2022",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:3.345,truncated:!0,authors:[{name:"Fei Han",title:"Author",url:"https://github.com/hf400159",image_url:"https://github.com/hf400159.png",imageURL:"https://github.com/hf400159.png"}],prevItem:{title:"Use Keycloak with API Gateway to secure APIs",permalink:"/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis"},nextItem:{title:"APISIX integrates with Ory Hydra",permalink:"/blog/2022/07/04/apisix-integrates-with-hydra"}},s={authorsImageUrls:[void 0]},c=[{value:"Background",id:"background",children:[],level:2},{value:"Introduction",id:"introduction",children:[],level:2},{value:"Operation steps",id:"operation-steps",children:[],level:2},{value:"Summary",id:"summary",children:[],level:2}],p={toc:c};function m(t){let{components:e,...a}=t;return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This article mainly introduces how to upload the APISIX indicator data to the DATA ANT monitoring system through the DataAnt Agent.")),(0,i.kt)("h2",{id:"background"},"Background"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix"},"Apache APISIX")," is an open source cloud native API gateway. As an API gateway, it has the characteristics of dynamic, real-time, and high performance. It provides rich traffic management functions such as load balancing, dynamic upstream, grayscale publishing, service fusing, identity authentication and observability. You can use APISIX to handle the traditional north-south traffic and the east-west traffic between services. It can also be used as a K8s ingress controller. Thanks to the full dynamic design of APISIX, configuration changes can be made at any time without restarting the service."),(0,i.kt)("p",null,"The DataAnt full-stack cloud monitoring system can aggregate all the operation and maintenance data of IaaS, PaaS and SaaS layers through big data and machine learning, and provide users with a unified visual interface. DataAnt allows users to move seamlessly and quickly between relevant monitoring data sources without having to switch tools and gain more granular visibility into the state of their IT systems. The DataAnt Agent it provides can monitor APISIX in real time and upload its monitoring data to the DataAnt PaSS platform to realize one-stop cloud monitoring."),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0705/1.svg",alt:"principle"})),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Collection configuration"),(0,i.kt)("p",{parentName:"li"},"The DataAnt Agent will first initialize and register the collector through the APISIX item in ",(0,i.kt)("inlineCode",{parentName:"p"},"config.yaml"),". The same Agent can register multiple collectors. After the collector collects the indicators exposed by APISIX, it encrypts the indicator data and uploads it to DataAnt Cloud.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Data visualization"),(0,i.kt)("p",{parentName:"li"},"After DataAnt Cloud receives the data, the data will be stored in the time series database after preliminary monitoring information supplementation and processing, and then APISIX can be monitored in real time through DataAnt's Dashboard.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Alarm notification"),(0,i.kt)("p",{parentName:"li"},"The data will also be distributed to the alarm matching processing through the message, and then the notification aggregation will be carried out. Finally, the alarm will be sent through the configured notification method, that is, the abnormal situation of APISIX can be received in real time."))),(0,i.kt)("h2",{id:"operation-steps"},"Operation steps"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"First, you need to access ",(0,i.kt)("a",{parentName:"p",href:"http://139.224.11.158"},"DataAnt Cloud"),", register an account and log in to the platform.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Obtain the Agent of DataAnt through the ",(0,i.kt)("a",{parentName:"p",href:"https://pan.baidu.com/s/1fabvSiDLDh8ZRTjpzINHLg?pwd=87d4"},"download link"),". After the download is complete, upload it to the machine where APISIX is located and add execution permission to the Agent.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create the configuration file ",(0,i.kt)("inlineCode",{parentName:"p"},"./config.yaml")," required by DataAnt Agent in the current directory. The detailed configuration is as follows:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"tenantId: 11\nhostIp: 127.0.0.1\nhostName: apisix\nconfigs:\n  - uri: http://127.0.0.1:9091\n    type: apisix\n    asName: apisix_test\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Start the Agent using the following command.\u3002"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"./agent\n")),(0,i.kt)("p",{parentName:"li"},"After successful startup, the following data will be returned:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'2022/06/21 20:50:10 {"code":200,"msg":"\u8bf7\u6c42\u6210\u529f","data":null}\n2022/06/21 20:50:30 {"code":200,"msg":"\u8bf7\u6c42\u6210\u529f","data":null}\n2022-06-21 20:51:00:000        INFO        apisix/apisix.go:25        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\uff0c\u6570\u636e\u957f\u5ea61675\n2022-06-21 20:51:00:000        INFO        prometheus/prometheusCollector.go:43        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\u5f00\u59cb\u89e3\u67901675\n2022-06-21 20:51:00:000        INFO        prometheus/prometheusCollector.go:43        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\u5b8c\u6210\u89e3\u6790 \u89e3\u6790\u6307\u6807\u6570\u91cf21\n2022-06-21 20:51:00:000        INFO        collector/collector.go:82        apisix\u91c7\u96c6\u5230\u6570\u636e\u6570\u91cf21\n2022-06-21 20:51:00:000        INFO        runtime/asm_amd64.s:1581        apisix_test9091:\u6307\u6807\u6570:21\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"On the home page of the DataAnt platform, click ",(0,i.kt)("inlineCode",{parentName:"p"},"Install Integration Plugin")," > ",(0,i.kt)("inlineCode",{parentName:"p"},"Monitoring Plugin"),", select APISIX and click ",(0,i.kt)("inlineCode",{parentName:"p"},"Click to configure")," under ",(0,i.kt)("inlineCode",{parentName:"p"},"Configuration"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"On the homepage of the DataAnt platform, click ",(0,i.kt)("inlineCode",{parentName:"p"},"Dashboard")," in the left navigation bar and create a new dashboard. Select the indicators you need and drag them to the dashboard. The configured indicators are as follows:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0705/2.PNG",alt:"dashboard"})),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"DataAnt Agent will report data every 30 seconds, so there will be a certain delay."))))),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"This article mainly introduces how to upload APISIX index data to the DataAnt monitoring system through DataAnt Agent. You can use it later to configure relevant alarm rules and alarm contacts. When the service fails, you can be notified in time."))}m.isMDXComponent=!0}}]);