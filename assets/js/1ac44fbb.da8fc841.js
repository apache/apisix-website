"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[59002],{35318:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(27378);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,s=e.originalType,o=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),u=p(a),m=l,h=u["".concat(o,".").concat(m)]||u[m]||d[m]||s;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function m(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var s=a.length,i=new Array(s);i[0]=u;var r={};for(var o in t)hasOwnProperty.call(t,o)&&(r[o]=t[o]);r.originalType=e,r.mdxType="string"==typeof e?e:l,i[1]=r;for(var p=2;p<s;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},29714:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var n=a(25773),l=(a(27378),a(35318));const s={title:"How to build APISIX in ARM Ubuntu",authors:[{name:"Qi Guo",title:"Author",url:"https://github.com/guoqqqi",image_url:"https://avatars.githubusercontent.com/u/72343596?v=4"}],keywords:["Apache APISIX","arm","ubuntu","Apple Macbook Pro M1"],description:"By reading this article, you will learn how to build Apache APISIX (M1 chip environment) in ARM Ubuntu from source code.",tags:["Ecosystem"],image:"https://static.apiseven.com/2022/blog/0818/ecosystem/ubuntu.png"},i=void 0,r={permalink:"/blog/2022/01/11/building-apisix-in-ubuntu-for-arm",source:"@site/blog/2022/01/11/building-apisix-in-ubuntu-for-arm.md",title:"How to build APISIX in ARM Ubuntu",description:"By reading this article, you will learn how to build Apache APISIX (M1 chip environment) in ARM Ubuntu from source code.",date:"2022-01-11T00:00:00.000Z",formattedDate:"January 11, 2022",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:4.48,truncated:!0,authors:[{name:"Qi Guo",title:"Author",url:"https://github.com/guoqqqi",image_url:"https://avatars.githubusercontent.com/u/72343596?v=4",imageURL:"https://avatars.githubusercontent.com/u/72343596?v=4"}],prevItem:{title:"Webinar | From API to Database",permalink:"/blog/2022/01/11/apisix-with-shardingsphere-meetup"},nextItem:{title:"Biweekly Report (Dec 16 - Dec 31)",permalink:"/blog/2022/01/05/weekly-report-1231"}},o={authorsImageUrls:[void 0]},p=[{value:"Prerequisites",id:"prerequisites",children:[{value:"Clone source code",id:"clone-source-code",children:[],level:3},{value:"Install OpenResty",id:"install-openresty",children:[{value:"Step 1: Install the several dependencies required to import the GPG public key",id:"step-1-install-the-several-dependencies-required-to-import-the-gpg-public-key",children:[],level:4},{value:"Step 2: Import GPG key",id:"step-2-import-gpg-key",children:[],level:4},{value:"Step 3: Add the official OpenResty APT repository",id:"step-3-add-the-official-openresty-apt-repository",children:[],level:4},{value:"Step 4: Update the APT Index",id:"step-4-update-the-apt-index",children:[],level:4},{value:"Step 5: Delete the corresponding associated package (optional)",id:"step-5-delete-the-corresponding-associated-package-optional",children:[],level:4}],level:3},{value:"Install Dependencies",id:"install-dependencies",children:[],level:3}],level:2},{value:"Install etcd",id:"install-etcd",children:[{value:"Run the etcd in Docker",id:"run-the-etcd-in-docker",children:[{value:"Step 1: Install Docker",id:"step-1-install-docker",children:[],level:4},{value:"Step 2: Pull and run etcd",id:"step-2-pull-and-run-etcd",children:[],level:4},{value:"Step 3: Verify etcd status",id:"step-3-verify-etcd-status",children:[],level:4}],level:3}],level:2},{value:"Start Apache APISIX",id:"start-apache-apisix",children:[{value:"Step 1: Install dependencies",id:"step-1-install-dependencies",children:[],level:3},{value:"Step 2: Initialise dependencies and start APISIX",id:"step-2-initialise-dependencies-and-start-apisix",children:[],level:3}],level:2},{value:"Summary",id:"summary",children:[],level:2}],c={toc:p};function d(e){let{components:t,...a}=e;return(0,l.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"By reading this article you will learn how to build Apache APISIX (M1 chip environment) in ARM Ubuntu from source code. The ARM Ubuntu system is installed with the help of ",(0,l.kt)("a",{parentName:"p",href:"https://multipass.run/"},"https://multipass.run/"),".")),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("h3",{id:"clone-source-code"},"Clone source code"),(0,l.kt)("p",null,"First follow the ",(0,l.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/how-to-build/"},"official documentation"),". Clone the Apache APISIX source code repository and go to the project directory."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/apache/apisix.git\ncd apisix\ngit checkout release/2.11\n")),(0,l.kt)("h3",{id:"install-openresty"},"Install OpenResty"),(0,l.kt)("p",null,"First, install the dependencies required for the project in one click via an automation script, running the following command in the ",(0,l.kt)("strong",{parentName:"p"},"project root")," directory."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"bash utils/install-dependencies.sh\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911830267-75310d03-1039-4f5a-a8b1-94c01474a086.png",alt:"Installation dependency.png"})),(0,l.kt)("p",null,"As you can see from the error message, it is due to the failure to install ",(0,l.kt)("inlineCode",{parentName:"p"},"OpenResty")," successfully. The root cause is that there is no source for the ",(0,l.kt)("inlineCode",{parentName:"p"},"ARM 64")," platform by default."),(0,l.kt)("p",null,"Here we install ",(0,l.kt)("inlineCode",{parentName:"p"},"OpenResty")," manually, the installation steps can be found at ",(0,l.kt)("a",{parentName:"p",href:"https://openresty.org/cn/linux-packages.html#ubuntu"},"https://openresty.org/cn/linux-packages.html#ubuntu"),"."),(0,l.kt)("h4",{id:"step-1-install-the-several-dependencies-required-to-import-the-gpg-public-key"},"Step 1: Install the several dependencies required to import the GPG public key"),(0,l.kt)("p",null,"Specific code examples can be found below (you can delete them at any time after the entire installation process is complete)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt-get -y install --no-install-recommends wget gnupg ca-certificates\n")),(0,l.kt)("h4",{id:"step-2-import-gpg-key"},"Step 2: Import GPG key"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"wget -O - https://openresty.org/package/pubkey.gpg | sudo apt-key add -\n")),(0,l.kt)("p",null,"The import was successful as shown in the figure below."),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911867662-8d1dcb8d-7c1e-4ddd-ad60-2d7448b6c544.png",alt:"Import GPG key.png"})),(0,l.kt)("h4",{id:"step-3-add-the-official-openresty-apt-repository"},"Step 3: Add the official OpenResty APT repository"),(0,l.kt)("p",null,"For x86_64 or amd64 systems, the following command can be used."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'echo "deb http://openresty.org/package/ubuntu $(lsb_release -sc) main" \\\n    | sudo tee /etc/apt/sources.list.d/openresty.list\n')),(0,l.kt)("p",null,"For ARM64 or aarch64 systems, you can use the following command (run on M1 to run the command, the last command will report an error)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'echo "deb http://openresty.org/package/arm64/ubuntu $(lsb_release -sc) main" \\\n    | sudo tee /etc/apt/sources.list.d/openresty.list\n')),(0,l.kt)("h4",{id:"step-4-update-the-apt-index"},"Step 4: Update the APT Index"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt-get update\n")),(0,l.kt)("p",null,"After that, you can install the software package according to the code below. Here we take ",(0,l.kt)("inlineCode",{parentName:"p"},"OpenResty")," as an example."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt-get -y install openresty\n")),(0,l.kt)("h4",{id:"step-5-delete-the-corresponding-associated-package-optional"},"Step 5: Delete the corresponding associated package (optional)"),(0,l.kt)("p",null,"Finally, we can delete the package and its corresponding associated package with the following command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt-get -y install --no-install-recommends software-properties-common\n")),(0,l.kt)("p",null,"Successful installation of ",(0,l.kt)("inlineCode",{parentName:"p"},"OpenResty"),"."),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911892167-2a6b56a9-aad8-400b-99d9-8401718c6ba9.png",alt:"OpenResty installed successfully.png"})),(0,l.kt)("h3",{id:"install-dependencies"},"Install Dependencies"),(0,l.kt)("p",null,"First rerun the installation dependency script. Then run the command ",(0,l.kt)("inlineCode",{parentName:"p"},"LUAROCKS_SERVER=https://luarocks.cn")," to install the dependencies."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"bash utils/install-dependencies.sh\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911909131-3f30b00e-2939-480e-809d-ccd17e5f15c4.png",alt:"Install dependency.png"})),(0,l.kt)("p",null,"Simply run the following command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"curl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911924788-7e0d2f90-90d6-41cc-8c98-450cdf55a3c1.png",alt:"Installation dependency feedback.png"})),(0,l.kt)("p",null,"Find the error prompt based on the feedback from the figure above, and then execute the following command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt install wget sudo unzip\n")),(0,l.kt)("p",null,"Then we rerun the following command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"curl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -\n")),(0,l.kt)("p",null,"Finally, run the installation dependency instruction ",(0,l.kt)("inlineCode",{parentName:"p"},"LUAROCKS_SERVER=https://luarocks.cn make deps")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911942296-0ed90547-80b3-4e80-be5a-89cf60ba67b4.png",alt:"Successful installation.png"})),(0,l.kt)("p",null,"At this point, most of the dependencies have been successfully installed, but a new error message appears (it looks like the two repositories failed to clone). It doesn't matter, it doesn't matter for the time being, you can execute the APISIX installation command here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"make install\n# If you get an insufficient permissions message, use `sudo make install`\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641911956728-0a64adb1-0bc5-489c-bf5b-929177325ab4.png",alt:"Excute APISIX.png"})),(0,l.kt)("h2",{id:"install-etcd"},"Install etcd"),(0,l.kt)("p",null,"Before starting Apache APISIX you need to install etcd, more details can refer to the ",(0,l.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/2.10/install-dependencies/#ubuntu-1604--1804"},"official documentation"),"."),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Because the installation tutorial was not written for arm, although etcd, was successfully installed, etcd could not be run successfully due to the default use of x86 binaries. The specific part of stepping on the pit will not be repeated here, but will directly put the correct steps for your reference."))),(0,l.kt)("h3",{id:"run-the-etcd-in-docker"},"Run the etcd in Docker"),(0,l.kt)("h4",{id:"step-1-install-docker"},"Step 1: Install Docker"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt install docker.io\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Common docker commands(add sudo before the command if you get no permission error):"),(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"View a list of all containers ",(0,l.kt)("inlineCode",{parentName:"li"},"docker ps -a")),(0,l.kt)("li",{parentName:"ul"},"View the list of running containers ",(0,l.kt)("inlineCode",{parentName:"li"},"docker ps")),(0,l.kt)("li",{parentName:"ul"},"View the list of images ",(0,l.kt)("inlineCode",{parentName:"li"},"docker image list")),(0,l.kt)("li",{parentName:"ul"},"Delete all containers ",(0,l.kt)("inlineCode",{parentName:"li"},"docker container prune")),(0,l.kt)("li",{parentName:"ul"},"Delete all images ",(0,l.kt)("inlineCode",{parentName:"li"},"docker image prune -f -a"))))),(0,l.kt)("p",null,"More references can refer to ",(0,l.kt)("a",{parentName:"p",href:"https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html"},"Docker Getting Started Tutorial - Ruan Yifeng's Weblog"),"."),(0,l.kt)("h4",{id:"step-2-pull-and-run-etcd"},"Step 2: Pull and run etcd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo docker run -d --name etcd -p 2379:2379 -e ETCD_UNSUPPORTED_ARCH=arm64 -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 gcr.io/etcd-development/etcd:v3.5.1-arm64\n")),(0,l.kt)("p",null,"It should be noted that the proxy needs to be enabled for mirroring in this operation."),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641912022850-0ad47270-79e2-4227-a786-9d478906b8b0.png",alt:"Run etcd.png"})),(0,l.kt)("h4",{id:"step-3-verify-etcd-status"},"Step 3: Verify etcd status"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"sudo docker ps -a\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641912040567-141b520e-4c33-448d-ba33-86e01a9f6114.png",alt:"Verify that etcd is on.png"})),(0,l.kt)("p",null,"As you can see, etcd has been successfully started."),(0,l.kt)("h2",{id:"start-apache-apisix"},"Start Apache APISIX"),(0,l.kt)("p",null,"After doing this, all the dependent projects are now ready, and now you are ready to start Apache APISIX."),(0,l.kt)("h3",{id:"step-1-install-dependencies"},"Step 1: Install dependencies"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"make deps\nmake install\n")),(0,l.kt)("h3",{id:"step-2-initialise-dependencies-and-start-apisix"},"Step 2: Initialise dependencies and start APISIX"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"apisix init\n\n# start APISIX\napisix start\n\n# stop APISIX\napisix stop\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://static.apiseven.com/202108/1641912056163-67b0f11b-a122-4f5b-b7a6-c09662443cce.png",alt:"APISIX started successfully.png"})),(0,l.kt)("p",null,"Apache APISIX started successfully. For more details on how to install and build Apache APISIX, please see ",(0,l.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/how-to-build"},"official documentation"),"."),(0,l.kt)("h2",{id:"summary"},"Summary"),(0,l.kt)("p",null,"Through detailed steps, this article shows you how to deploy and install Apache APISIX under Macbook M1 chip system. In overall practice, there will be some trampling process, but the overall experience is still a successful deployment."),(0,l.kt)("p",null,"If you have better suggestions, you are welcome to contribute to the Apache APISIX ",(0,l.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/how-to-build/"},"build documentation")," and leave your suggestions to help more people."))}d.isMDXComponent=!0}}]);