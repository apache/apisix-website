"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[24860],{35318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(o,".").concat(m)]||d[m]||c[m]||l;return n?a.createElement(h,s(s({ref:t},u),{},{components:n})):a.createElement(h,s({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<l;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},90605:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=n(25773),r=(n(27378),n(35318));const l={title:"How is the Azure ARM architecture server perform?",authors:[{name:"Shirui Zhao",title:"Author",url:"https://github.com/soulbird",image_url:"https://github.com/soulbird.png"},{name:"Fei Han",title:"Technical Writer",url:"https://github.com/hf400159",image_url:"https://github.com/hf400159.png"}],keywords:["API gateway","Azure","Microsoft","Apache APISIX","Arm"],description:"This article uses API Gateway Apache APISIX to compare the performance of Azure Ddsv5 and Azure Dpdsv5 in network IO-intensive scenarios.",tags:["Ecosystem"],image:"https://static.apiseven.com/2022/10/28/635b53794f32a.png"},s=void 0,i={permalink:"/blog/2022/08/08/apache-apisix-performance-test-in-azure",source:"@site/blog/2022/08/08/apache-apisix-performance-test-in-azure.md",title:"How is the Azure ARM architecture server perform?",description:"This article uses API Gateway Apache APISIX to compare the performance of Azure Ddsv5 and Azure Dpdsv5 in network IO-intensive scenarios.",date:"2022-08-08T00:00:00.000Z",formattedDate:"August 8, 2022",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:4.165,truncated:!0,authors:[{name:"Shirui Zhao",title:"Author",url:"https://github.com/soulbird",image_url:"https://github.com/soulbird.png",imageURL:"https://github.com/soulbird.png"},{name:"Fei Han",title:"Technical Writer",url:"https://github.com/hf400159",image_url:"https://github.com/hf400159.png",imageURL:"https://github.com/hf400159.png"}],prevItem:{title:"Biweekly Report (Jul 16 - Jul 31)",permalink:"/blog/2022/08/09/weekly-report-0731"},nextItem:{title:"Release Apache APISIX Ingress v1.5-rc1",permalink:"/blog/2022/08/05/apisix-ingress-1.5rc1-release"}},o={authorsImageUrls:[void 0,void 0]},p=[{value:"Background",id:"background",children:[],level:2},{value:"Preliminary preparation",id:"preliminary-preparation",children:[],level:2},{value:"Deploy Apache APISIX",id:"deploy-apache-apisix",children:[],level:2},{value:"Azure Ddsv5 vs Azure Dpdsv5",id:"azure-ddsv5-vs-azure-dpdsv5",children:[{value:"Single upstream + no plugin",id:"single-upstream--no-plugin",children:[],level:3},{value:"Single upstream + two plugins",id:"single-upstream--two-plugins",children:[],level:3},{value:"Data comparison",id:"data-comparison",children:[],level:3}],level:2},{value:"Summary",id:"summary",children:[],level:2},{value:"Reference",id:"reference",children:[],level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This article uses API Gateway Apache APISIX to compare the performance of Azure Ddsv5 and Azure Dpdsv5 in network IO-intensive scenarios.")),(0,r.kt)("head",null,(0,r.kt)("link",{rel:"canonical",href:"https://api7.ai/2022/08/08/apache-apisix-performance-test-in-azure/"})),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"In April, Microsoft announced a preview of its family of Azure virtual machines based on Ampere\xae Altra\xae Arm processors. The new VM series includes general-purpose Dpsv5 and memory-optimized Epsv5 VMs. For details, refer to the following figure:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0808/1.png",alt:"VM series"})),(0,r.kt)("p",null,"Notably, Ampere\xae Altra\xae Arm is a cloud-native processor, and Azure virtual machines based on Ampere\xae Altra\xae Arm processors can therefore run scale-out cloud-native applications in an efficient manner."),(0,r.kt)("p",null,"So what is the actual experience and performance? Let's take a cloud-native API gateway as an example to show you the performance of an Azure virtual machine based on the Arm architecture. Here, we choose Apache APISIX for installation and testing on the general-purpose Dpdsv5 series virtual machine environment."),(0,r.kt)("p",null,"Apache APISIX is a cloud-native, high-performance, scalable API gateway. Based on NGNIX + LuaJIT and etcd, APISIX has the characteristics of dynamic routing and plug-in hot loading compared with traditional API gateways, which is especially suitable for API management under cloud-native architecture."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0808/2.png",alt:"Apache APISIX"})),(0,r.kt)("h2",{id:"preliminary-preparation"},"Preliminary preparation"),(0,r.kt)("p",null,"First, you need to start a Dpdsv5 series instance on Azure, and choose Ubuntu 20.04 as the operating system."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0808/3.jpeg",alt:"Dpdsv5"})),(0,r.kt)("p",null,"Then install Docker to facilitate subsequent use of containerized methods to install and deploy Apache APISIX."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt-get update && sudo apt-get install docker.io\n")),(0,r.kt)("h2",{id:"deploy-apache-apisix"},"Deploy Apache APISIX"),(0,r.kt)("p",null,"Apache APISIX uses etcd as the configuration center, so you need to start an etcd instance first."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo docker run -d --name etcd \\\n    -p 2379:2379 \\\n    -e ETCD_UNSUPPORTED_ARCH=arm64 \\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\n    rancher/coreos-etcd:v3.4.16-arm64\n")),(0,r.kt)("p",null,"Then start an instance of Apache APISIX."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo docker run --net=host -d apache/apisix:2.14.1-alpine\n")),(0,r.kt)("p",null,"Create routes."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/apisix/admin/routes/1" \\\n-H "X-API-KEY: edd1c9f034335f136f87ad84b625c8f1" -X PUT -d \'\n{  \n    "uri": "/anything/*",\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n              "httpbin.org:80": 1\n        }\n    }\n}\'\n')),(0,r.kt)("p",null,"Access the test."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl -i http://127.0.0.1:9080/anything/das\n")),(0,r.kt)("p",null,"The installation is successful if the following results are returned:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"HTTP/1.1 200 OK\n.....\n")),(0,r.kt)("h2",{id:"azure-ddsv5-vs-azure-dpdsv5"},"Azure Ddsv5 vs Azure Dpdsv5"),(0,r.kt)("p",null,"From the above operations, the installation and compatibility test of Apache APISIX on Azure Dpdsv5 can be successfully completed. So what is the actual performance of Azure Dpdsv5? Next, we will use Apache APISIX to do performance test comparisons on Azure Dpdsv5 and Azure Ddsv5 to see their actual performance."),(0,r.kt)("p",null,"Azure Ddsv5 is another model of Azure D series, which is based on Intel\xae x86 architecture, so the above etcd installation steps are slightly different:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo docker run -d --name etcd \\\n    -p 2379:2379 \\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\n    -e ALLOW_NONE_AUTHENTICATION=yes \\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\n    bitnami/etcd:3.4.16\n")),(0,r.kt)("h3",{id:"single-upstream--no-plugin"},"Single upstream + no plugin"),(0,r.kt)("p",null,"Use a single upstream, without any plugins. It mainly tests the performance of APISIX in pure proxy back-to-origin mode."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# apisix: 1 worker + 1 upstream + no plugin\n\n# create route\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/hello",\n    "plugins": {\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "127.0.0.1:1980":1\n        }\n    }\n}\'\n')),(0,r.kt)("h3",{id:"single-upstream--two-plugins"},"Single upstream + two plugins"),(0,r.kt)("p",null,"Using a single upstream, two plugins. It mainly tests the performance of APISIX when the two core performance-consuming plugins, limit-count and prometheus, are enabled."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# apisix: 1 worker + 1 upstream + 2 plugins (limit-count + prometheus)\n\n# create route\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\n{\n    "uri": "/hello",\n    "plugins": {\n        "limit-count": {\n            "count": 2000000000000,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        },\n        "prometheus": {}\n    },\n    "upstream": {\n        "type": "roundrobin",\n        "nodes": {\n            "127.0.0.1:1980":1\n        }\n    }\n}\'\n')),(0,r.kt)("h3",{id:"data-comparison"},"Data comparison"),(0,r.kt)("p",null,"In the above two scenarios, relevant tests and comparisons were carried out from the two levels of request QPS (queries per second) and delay time. The result is as follows:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"QPS comparison"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0808/4.png",alt:"QPS"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Latency Comparison"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0808/5.png",alt:"Latency"})))),(0,r.kt)("table",null,(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"  ")),(0,r.kt)("td",{colspan:"2"},"Single upstream + no plugin"),(0,r.kt)("td",{colspan:"2"},"Single upstream + two plugins")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"  ")),(0,r.kt)("td",null,(0,r.kt)("b",null,"Azure Ddsv5")),(0,r.kt)("td",null,(0,r.kt)("b",null,"Azure Dpdsv5")),(0,r.kt)("td",null,(0,r.kt)("b",null,"Azure Ddsv5")),(0,r.kt)("td",null,(0,r.kt)("b",null,"Azure Dpdsv5"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"QPS(request/s)")),(0,r.kt)("td",null,(0,r.kt)("b",null,"14900")),(0,r.kt)("td",null,(0,r.kt)("b",null,"13400")),(0,r.kt)("td",null,(0,r.kt)("b",null,"13100")),(0,r.kt)("td",null,(0,r.kt)("b",null,"11000"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Latency(ms)")),(0,r.kt)("td",null,(0,r.kt)("b",null,"1.07")),(0,r.kt)("td",null,(0,r.kt)("b",null,"1.21")),(0,r.kt)("td",null,(0,r.kt)("b",null,"1.21")),(0,r.kt)("td",null,(0,r.kt)("b",null,"1.43")))),(0,r.kt)("p",null,"It can also be seen from the above data that in network IO-intensive computing scenarios such as API gateways, Dpdsv5 still has a performance gap compared to the same series of Ddsv5. But another good news is that the price of Dpdsv5 is about 20% cheaper than Ddsv5 under the same configuration. In actual machine selection, users can make flexible decisions according to their business volume."),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"This article mainly uses Apache APISIX to compare the performance of Azure Ddsv5 and Azure Dpdsv5. It can be seen that in network IO-intensive computing scenarios such as API gateways, Azure Dpdsv5 is not so bright compared to Ddsv5, but since this series of models is still in preview, Microsoft is making continuous improvements and optimizations. Looking forward to its sequel."),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/"},"Now in preview: Azure Virtual Machines with Ampere Altra Arm-based processors")))}c.isMDXComponent=!0}}]);