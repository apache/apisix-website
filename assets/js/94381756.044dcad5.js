"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[84759],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(t),u=i,g=c["".concat(p,".").concat(u)]||c[u]||m[u]||o;return t?a.createElement(g,r(r({ref:n},d),{},{components:t})):a.createElement(g,r({ref:n},d))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var s=2;s<o;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},61855:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=t(87462),i=(t(67294),t(3905));const o={title:"Upgrade Guide",keywords:["APISIX","APISIX Upgrade Guide","APISIX Version Upgrade"],description:"Guide for upgrading APISIX from version 2.15.x to 3.0.0."},r=void 0,l={unversionedId:"upgrade-guide-from-2.15.x-to-3.0.0",id:"version-3.10/upgrade-guide-from-2.15.x-to-3.0.0",isDocsHomePage:!1,title:"Upgrade Guide",description:"Guide for upgrading APISIX from version 2.15.x to 3.0.0.",source:"@site/docs-apisix_versioned_docs/version-3.10/upgrade-guide-from-2.15.x-to-3.0.0.md",sourceDirName:".",slug:"/upgrade-guide-from-2.15.x-to-3.0.0",permalink:"/docs/apisix/3.10/upgrade-guide-from-2.15.x-to-3.0.0",editUrl:"/edit#https://github.com/apache/apisix/edit/release/3.10/docs/en/latest/upgrade-guide-from-2.15.x-to-3.0.0.md",tags:[],version:"3.10",frontMatter:{title:"Upgrade Guide",keywords:["APISIX","APISIX Upgrade Guide","APISIX Version Upgrade"],description:"Guide for upgrading APISIX from version 2.15.x to 3.0.0."},sidebar:"version-3.10/docs",previous:{title:"HTTP/3 Protocol",permalink:"/docs/apisix/3.10/http3"}},p=[{value:"Changelog",id:"changelog",children:[]},{value:"Deployments",id:"deployments",children:[]},{value:"Dependencies",id:"dependencies",children:[]},{value:"Configurations",id:"configurations",children:[]},{value:"Data Compatibility",id:"data-compatibility",children:[]},{value:"API",id:"api",children:[]}],s={toc:p};function d(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This document guides you in upgrading APISIX from version 2.15.x to 3.0.0."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Upgrading to version 3.0.0 is a major change and it is recommended that you first upgrade to version 2.15.x before you upgrade to 3.0.0."))),(0,i.kt)("h2",{id:"changelog"},"Changelog"),(0,i.kt)("p",null,"Please refer to the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/CHANGELOG.md#300-beta"},"3.0.0-beta")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/CHANGELOG.md#300"},"3.0.0")," changelogs for a complete list of incompatible changes and major updates."),(0,i.kt)("h2",{id:"deployments"},"Deployments"),(0,i.kt)("p",null,"From 3.0.0, we no longer support the Alpine-based images of APISIX. You can use the ",(0,i.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/apache/apisix/tags?page=1&ordering=last_updated"},"Debian or CentOS-based images")," instead."),(0,i.kt)("p",null,"In addition to the Docker images, we also provide:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"RPM packages for CentOS 7 and CentOS 8 supporting both AMD64 and ARM64 architectures."),(0,i.kt)("li",{parentName:"ol"},"DEB packages for Debian 11 (bullseye) supporting both AMD64 and ARM64 architectures.")),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/installation-guide"},"installation guide")," for more details."),(0,i.kt)("p",null,"3.0.0 also introduces multiple deployment modes. The following modes are supported:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"/docs/apisix/3.10/deployment-modes#traditional"},"Traditional"),": As the name implies, this is the original deployment mode where one instance of APISIX acts as the control plane and the data plane. Use this deployment mode to keep your deployment similar to older versions."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"/docs/apisix/3.10/deployment-modes#decoupled"},"Decoupled"),": In this mode, the data plane and the control plane are separated. You can deploy an instance of APISIX either as a control plane or a data plane."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"/docs/apisix/3.10/deployment-modes#standalone"},"Standalone"),": Using this mode will disable etcd as the configuration center and use a static configuration file instead. You can use this to manage APISIX configuration decaratively or for using other configuration centers.")),(0,i.kt)("h2",{id:"dependencies"},"Dependencies"),(0,i.kt)("p",null,"All Docker images and binary packages (RPM, DEB) already come with all the necessary dependencies for APISIX."),(0,i.kt)("p",null,"Some features might require additional Nginx modules in OpenResty and requires you to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/api7/apisix-build-tools"},"build a custom OpenResty distribution (APISIX-Base)"),"."),(0,i.kt)("p",null,"To run APISIX on a native OpenResty instance use ",(0,i.kt)("a",{parentName:"p",href:"https://openresty.org/en/download.html#legacy-releases"},"OpenResty version 1.19.3.2")," and above."),(0,i.kt)("h2",{id:"configurations"},"Configurations"),(0,i.kt)("p",null,"There are some major changes to the configuration file in APISIX. You need to update your configuration file (",(0,i.kt)("inlineCode",{parentName:"p"},"conf/config.yaml"),") to reflect these changes. See the ",(0,i.kt)("inlineCode",{parentName:"p"},"conf/config-default.yaml")," file for the complete changes."),(0,i.kt)("p",null,"The following attributes in the configuration have been moved:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"config_center")," is replaced by ",(0,i.kt)("inlineCode",{parentName:"li"},"config_provider")," and moved under ",(0,i.kt)("inlineCode",{parentName:"li"},"deployment"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"etcd")," is moved under ",(0,i.kt)("inlineCode",{parentName:"li"},"deployment"),"."),(0,i.kt)("li",{parentName:"ol"},"The following Admin API configuration attributes are moved to the ",(0,i.kt)("inlineCode",{parentName:"li"},"admin")," attribute under ",(0,i.kt)("inlineCode",{parentName:"li"},"deployment"),":",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"admin_key")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"enable_admin_cors")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"allow_admin")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"admin_listen")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"https_admin")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"admin_api_mtls")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"admin_api_version"))))),(0,i.kt)("p",null,"The following attributes in the configuration have been replaced:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"enable_http2")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"listen_port")," under ",(0,i.kt)("inlineCode",{parentName:"p"},"apisix.ssl")," are replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"apisix.ssl.listen"),". i.e., the below configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"ssl:\n  enable_http2: true\n  listen_port: 9443\n")),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"ssl:\n  listen:\n    - port: 9443\n      enable_http2: true\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"nginx_config.http.lua_shared_dicts")," is replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"nginx_config.http.custom_lua_shared_dict"),". i.e., the below configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"nginx_config:\n  http:\n    lua_shared_dicts:\n      my_dict: 1m\n")),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"nginx_config:\n  http:\n    custom_lua_shared_dict:\n    my_dict: 1m\n")),(0,i.kt)("p",{parentName:"li"},"This attribute declares custom shared memory blocks.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"etcd.health_check_retry")," is replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"deployment.etcd.startup_retry"),". So this configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"etcd:\n  health_check_retry: 2\n")),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"deployment:\n  etcd:\n    startup_retry: 2\n")),(0,i.kt)("p",{parentName:"li"},"This attribute is to configure the number of retries when APISIX tries to connect to etcd.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"apisix.port_admin")," is replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"deployment.admin.admin_listen"),". So your previous configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"apisix:\n  port_admin: 9180\n")),(0,i.kt)("p",{parentName:"li"},"Should be changed to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"deployment:\n  apisix:\n    admin_listen:\n      ip: 127.0.0.1 # replace with the actual IP exposed\n      port: 9180\n")),(0,i.kt)("p",{parentName:"li"},"This attribute configures the Admin API listening port.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"apisix.real_ip_header")," is replaced by ",(0,i.kt)("inlineCode",{parentName:"p"},"nginx_config.http.real_ip_header"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"enable_cpu_affinity")," is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," by default instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". This is because Nginx's ",(0,i.kt)("inlineCode",{parentName:"p"},"worker_cpu_affinity")," does not count against the cgroup when APISIX is deployed in containers. In such scenarios, it can affect APISIX's behavior when multiple instances are bound to a single CPU."))),(0,i.kt)("h2",{id:"data-compatibility"},"Data Compatibility"),(0,i.kt)("p",null,"In 3.0.0, the data structures holding route, upstream, and plugin configuration have been modified and is not fully compatible with 2.15.x. You won't be able to connect an instance of APISIX 3.0.0 to an etcd cluster used by APISIX 2.15.x."),(0,i.kt)("p",null,"To ensure compatibility, you can try one of the two ways mentioned below:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Backup the incompatible data (see ",(0,i.kt)("a",{parentName:"li",href:"https://etcd.io/docs/v3.5/op-guide/maintenance/#snapshot-backup"},"etcdctl snapshot"),") in etcd and clear it. Convert the backed up data to be compatible with 3.0.0 as mentioned in the below examples and reconfigure it through the Admin API of 3.0.0 instance."),(0,i.kt)("li",{parentName:"ol"},"Use custom scripts to convert the data structure in etcd to be compatible with 3.0.0.")),(0,i.kt)("p",null,"The following changes have been made in version 3.0.0:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"disable")," attribute of a plugin has been moved under ",(0,i.kt)("inlineCode",{parentName:"p"},"_meta"),". It enables or disables the plugin. For example, this configuration to disable the ",(0,i.kt)("inlineCode",{parentName:"p"},"limit-count")," plugin:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "limit-count":{\n         ... // plugin configuration\n         "disable":true\n     }\n }\n}\n')),(0,i.kt)("p",{parentName:"li"},"should be changed to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "limit-count":{\n         ... // plugin configuration\n         "_meta":{\n             "disable":true\n         }\n     }\n }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"service_protocol")," in route has been replaced with ",(0,i.kt)("inlineCode",{parentName:"p"},"upstream.scheme"),". For example, this configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "uri": "/hello",\n  "service_protocol": "grpc",\n  "upstream": {\n    "type": "roundrobin",\n    "nodes": {\n      "127.0.0.1:1980": 1\n    }\n  }\n}\n')),(0,i.kt)("p",{parentName:"li"},"Should be changed to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "uri": "/hello",\n  "upstream": {\n    "type": "roundrobin",\n    "scheme": "grpc",\n    "nodes": {\n      "127.0.0.1:1980": 1\n    }\n  }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"audience")," field from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/plugins/authz-keycloak"},"authz-keycloak")," plugin has been replaced with ",(0,i.kt)("inlineCode",{parentName:"p"},"client_id"),". So this configuration:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "authz-keycloak":{\n         ... // plugin configuration\n         "audience":"Client ID"\n     }\n }\n}\n')),(0,i.kt)("p",{parentName:"li"},"should be changed to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "authz-keycloak":{\n         ... // plugin configuration\n         "client_id":"Client ID"\n     }\n }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"upstream")," attribute from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/plugins/mqtt-proxy"},"mqtt-proxy")," plugin has been moved outside the plugin conference and referenced in the plugin. The configuration below:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "remote_addr": "127.0.0.1",\n  "plugins": {\n    "mqtt-proxy": {\n      "protocol_name": "MQTT",\n      "protocol_level": 4,\n      "upstream": {\n        "ip": "127.0.0.1",\n        "port": 1980\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "remote_addr": "127.0.0.1",\n  "plugins": {\n    "mqtt-proxy": {\n      "protocol_name": "MQTT",\n      "protocol_level": 4\n    }\n  },\n  "upstream": {\n    "type": "chash",\n    "key": "mqtt_client_id",\n    "nodes": [\n      {\n        "host": "127.0.0.1",\n        "port": 1980,\n        "weight": 1\n      }\n    ]\n  }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"max_retry_times")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"retry_interval")," fields from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/plugins/syslog"},"syslog")," plugin are replaced ",(0,i.kt)("inlineCode",{parentName:"p"},"max_retry_count")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"retry_delay")," respectively. The configuration below:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "syslog":{\n         "max_retry_times":1,\n         "retry_interval":1,\n         ... // other configuration\n     }\n }\n}\n')),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "syslog":{\n         "max_retry_count":1,\n         "retry_delay":1,\n         ... // other configuration\n     }\n }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"scheme")," attribute has been removed from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/apisix/3.10/plugins/proxy-rewrite"},"proxy-rewrite")," plugin and has been added to the upstream. The configuration below:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n "plugins":{\n     "proxy-rewrite":{\n         "scheme":"https",\n         ... // other configuration\n     }\n },\n "upstream":{\n     "nodes":{\n         "127.0.0.1:1983":1\n     },\n     "type":"roundrobin"\n },\n "uri":"/hello"\n}\n')),(0,i.kt)("p",{parentName:"li"},"changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n"plugins":{\n   "proxy-rewrite":{\n       ... // other configuration\n   }\n},\n"upstream":{\n   "scheme":"https",\n   "nodes":{\n       "127.0.0.1:1983":1\n   },\n   "type":"roundrobin"\n},\n"uri":"/hello"\n}\n')))),(0,i.kt)("h2",{id:"api"},"API"),(0,i.kt)("p",null,"Changes have been made to the Admin API to make it easier to use and be more RESTful."),(0,i.kt)("p",null,"The following changes have been made:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"count"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"action"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," fields in the response body when querying resources (single and list) are removed and the fields in ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," are moved up to the root of the response body. For example, if you query the ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/routes/1")," endpoint of the Admin API in version 2.15.x, you get the response:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n"count":1,\n"action":"get",\n"node":{\n   "key":"\\/apisix\\/routes\\/1",\n   "value":{\n       ... // content\n   }\n}\n}\n')),(0,i.kt)("p",{parentName:"li"},"In 3.0.0, this response body is changes to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n"key":"\\/apisix\\/routes\\/1",\n"value":{\n   ... // content\n}\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"When querying list resources, the ",(0,i.kt)("inlineCode",{parentName:"p"},"dir")," field is removed from the response body, a ",(0,i.kt)("inlineCode",{parentName:"p"},"list")," field to store the data of the list resources and a ",(0,i.kt)("inlineCode",{parentName:"p"},"total")," field to show the total number of list resources are added. For example, if you query the ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/routes")," endpoint of the Admin API in version 2.15.x, you get the response:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n"action":"get",\n"count":2,\n"node":{\n   "key":"\\/apisix\\/routes",\n   "nodes":[\n       {\n           "key":"\\/apisix\\/routes\\/1",\n           "value":{\n               ... // content\n           }\n       },\n       {\n           "key":"\\/apisix\\/routes\\/2",\n           "value":{\n               ... // content\n           }\n       }\n   ],\n   "dir":true\n}\n}\n')),(0,i.kt)("p",{parentName:"li"},"In 3.0.0, the response body is:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n"list":[\n   {\n       "key":"\\/apisix\\/routes\\/1",\n       "value":{\n           ... // content\n       }\n\n   },\n   {\n       "key":"\\/apisix\\/routes\\/2",\n       "value":{\n           ... // content\n       }\n   }\n],\n"total":2\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The endpoint to SSL resource is changed from ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/ssl/{id}")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/ssls/{id}"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The endpoint to Proto resource is changed from ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/proto/{id}")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"/apisix/admin/protos/{id}"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Admin API port is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"9180")," by default."))))}d.isMDXComponent=!0}}]);