"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[60210],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=s(n),d=r,h=u["".concat(p,".").concat(d)]||u[d]||c[d]||i;return n?a.createElement(h,o(o({ref:t},m),{},{components:n})):a.createElement(h,o({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},69050:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={title:"ai-prompt-template",keywords:["Apache APISIX","API Gateway","Plugin","ai-prompt-template"],description:"The ai-prompt-template plugin supports pre-configuring prompt templates that only accept user inputs in designated template variables, in a fill-in-the-blank fashion."},o=void 0,l={unversionedId:"plugins/ai-prompt-template",id:"plugins/ai-prompt-template",isDocsHomePage:!1,title:"ai-prompt-template",description:"The ai-prompt-template plugin supports pre-configuring prompt templates that only accept user inputs in designated template variables, in a fill-in-the-blank fashion.",source:"@site/docs/apisix/plugins/ai-prompt-template.md",sourceDirName:"plugins",slug:"/plugins/ai-prompt-template",permalink:"/docs/apisix/next/plugins/ai-prompt-template",editUrl:"/edit#https://github.com/apache/apisix/edit/master/docs/en/latest/plugins/ai-prompt-template.md",tags:[],version:"current",frontMatter:{title:"ai-prompt-template",keywords:["Apache APISIX","API Gateway","Plugin","ai-prompt-template"],description:"The ai-prompt-template plugin supports pre-configuring prompt templates that only accept user inputs in designated template variables, in a fill-in-the-blank fashion."},sidebar:"docs",previous:{title:"ai-prompt-decorator",permalink:"/docs/apisix/next/plugins/ai-prompt-decorator"},next:{title:"ai-rag",permalink:"/docs/apisix/next/plugins/ai-rag"}},p=[{value:"Description",id:"description",children:[]},{value:"Plugin Attributes",id:"plugin-attributes",children:[]},{value:"Examples",id:"examples",children:[{value:"Configure a Template for Open Questions in Custom Complexity",id:"configure-a-template-for-open-questions-in-custom-complexity",children:[]},{value:"Configure Multiple Templates",id:"configure-multiple-templates",children:[]}]}],s={toc:p};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("head",null,(0,r.kt)("link",{rel:"canonical",href:"https://docs.api7.ai/hub/ai-prompt-template"})),(0,r.kt)("h2",{id:"description"},"Description"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ai-prompt-template"),' Plugin simplifies access to LLM providers, such as OpenAI and Anthropic, and their models. It pre-configures prompt templates that only accept user inputs in designated template variables, in a "fill in the blank" fashion.'),(0,r.kt)("h2",{id:"plugin-attributes"},"Plugin Attributes"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Field")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Required")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Type")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Array"),(0,r.kt)("td",{parentName:"tr",align:"left"},"An array of template objects.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.name")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"String"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Name of the template. When requesting the route, the request should include the template name that corresponds to the configured template.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.template")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Object"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Template specification.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.template.model")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"String"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Name of the AI Model, such as ",(0,r.kt)("inlineCode",{parentName:"td"},"gpt-4")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"gpt-3.5"),". See your LLM provider API documentation for more available models.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.template.messages")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Array"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Template message specification.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.template.messages.role")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"String"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Role of the message, such as ",(0,r.kt)("inlineCode",{parentName:"td"},"system"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"user"),", or ",(0,r.kt)("inlineCode",{parentName:"td"},"assistant"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"templates.template.messages.content")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Yes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"String"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Content of the message (prompt).")))),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,"The following examples will be using OpenAI as the Upstream service provider. Before proceeding, create an ",(0,r.kt)("a",{parentName:"p",href:"https://openai.com"},"OpenAI account")," and an ",(0,r.kt)("a",{parentName:"p",href:"https://openai.com/blog/openai-api"},"API key"),". You can optionally save the key to an environment variable as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"export OPENAI_API_KEY=<YOUR_OPENAI_API_KEY>\n")),(0,r.kt)("p",null,"If you are working with other LLM providers, please refer to the provider's documentation to obtain an API key."),(0,r.kt)("h3",{id:"configure-a-template-for-open-questions-in-custom-complexity"},"Configure a Template for Open Questions in Custom Complexity"),(0,r.kt)("p",null,"The following example demonstrates how to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ai-prompt-template")," Plugin to configure a template which can be used to answer open questions and accepts user-specified response complexity."),(0,r.kt)("p",null,"Create a Route to the chat completion endpoint with pre-configured prompt templates as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes/1" -X PUT \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "uri": "/v1/chat/completions",\n    "plugins": {\n      "ai-proxy": {\n        "provider": "openai",\n        "auth": {\n          "header": {\n            "Authorization": "Bearer \'"$OPENAI_API_KEY"\'"\n          }\n        },\n        "options": {\n          "model": "gpt-4"\n        }\n      },\n      "ai-prompt-template": {\n        "templates": [\n          {\n            "name": "QnA with complexity",\n            "template": {\n              "model": "gpt-4",\n              "messages": [\n                {\n                  "role": "system",\n                  "content": "Answer in {{complexity}}."\n                },\n                {\n                  "role": "user",\n                  "content": "Explain {{prompt}}."\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"Send a POST request to the Route with a sample question and desired answer complexity in the request body."),(0,r.kt)("p",null,"Now send a request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/v1/chat/completions" -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "template_name": "QnA with complexity",\n    "complexity": "brief",\n    "prompt": "quick sort"\n  }\'\n')),(0,r.kt)("p",null,"You should receive a response similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "choices": [\n    {\n      "finish_reason": "stop",\n      "index": 0,\n      "message": {\n        "content": "Quick sort is a highly efficient sorting algorithm that uses a divide-and-conquer approach to arrange elements in a list or array in order. Here\u2019s a brief explanation:\\n\\n1. **Choose a Pivot**: Select an element from the list as a \'pivot\'. Common methods include choosing the first element, the last element, the middle element, or a random element.\\n\\n2. **Partitioning**: Rearrange the elements in the list such that all elements less than the pivot are moved before it, and all elements greater than the pivot are moved after it. The pivot is now in its final position.\\n\\n3. **Recursively Apply**: Recursively apply the same process to the sub-lists of elements to the left and right of the pivot.\\n\\nThe base case of the recursion is lists of size zero or one, which are already sorted.\\n\\nQuick sort has an average-case time complexity of O(n log n), making it suitable for large datasets. However, its worst-case time complexity is O(n^2), which occurs when the smallest or largest element is always chosen as the pivot. This can be mitigated by using good pivot selection strategies or randomization.",\n        "role": "assistant"\n      }\n    }\n  ],\n  "created": 1723194057,\n  "id": "chatcmpl-9uFmTYN4tfwaXZjyOQwcp0t5law4x",\n  "model": "gpt-4o-2024-05-13",\n  "object": "chat.completion",\n  "system_fingerprint": "fp_abc28019ad",\n  "usage": {\n    "completion_tokens": 234,\n    "prompt_tokens": 18,\n    "total_tokens": 252\n  }\n}\n')),(0,r.kt)("h3",{id:"configure-multiple-templates"},"Configure Multiple Templates"),(0,r.kt)("p",null,"The following example demonstrates how you can configure multiple templates on the same Route. When requesting the Route, users will be able to pass custom inputs to different templates by specifying the template name."),(0,r.kt)("p",null,"The example continues with the ",(0,r.kt)("a",{parentName:"p",href:"#configure-a-template-for-open-questions-in-custom-complexity"},"last example"),". Update the Plugin with another template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9180/apisix/admin/routes/1" -X PATCH \\\n  -H "X-API-KEY: ${admin_key}" \\\n  -d \'{\n    "uri": "/v1/chat/completions",\n    "plugins": {\n      "ai-prompt-template": {\n        "templates": [\n          {\n            "name": "QnA with complexity",\n            "template": {\n              "model": "gpt-4",\n              "messages": [\n                {\n                  "role": "system",\n                  "content": "Answer in {{complexity}}."\n                },\n                {\n                  "role": "user",\n                  "content": "Explain {{prompt}}."\n                }\n              ]\n            }\n          },\n          {\n            "name": "echo",\n            "template": {\n              "model": "gpt-4",\n              "messages": [\n                {\n                  "role": "system",\n                  "content": "You are an echo bot. You must repeat exactly what the user says without any changes or additional text."\n                },\n                {\n                  "role": "user",\n                  "content": "Echo {{prompt}}."\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  }\'\n')),(0,r.kt)("p",null,"You should now be able to use both templates through the same Route."),(0,r.kt)("p",null,"Send a POST request to the Route and use the first template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/v1/chat/completions" -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "template_name": "QnA with complexity",\n    "complexity": "brief",\n    "prompt": "quick sort"\n  }\'\n')),(0,r.kt)("p",null,"You should receive a response similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "choices": [\n    {\n      "finish_reason": "stop",\n      "index": 0,\n      "message": {\n        "content": "Quick sort is a highly efficient sorting algorithm that uses a divide-and-conquer approach to arrange elements in a list or array in order. Here\u2019s a brief explanation:\\n\\n1. **Choose a Pivot**: Select an element from the list as a \'pivot\'. Common methods include choosing the first element, the last element, the middle element, or a random element.\\n\\n2. **Partitioning**: Rearrange the elements in the list such that all elements less than the pivot are moved before it, and all elements greater than the pivot are moved after it. The pivot is now in its final position.\\n\\n3. **Recursively Apply**: Recursively apply the same process to the sub-lists of elements to the left and right of the pivot.\\n\\nThe base case of the recursion is lists of size zero or one, which are already sorted.\\n\\nQuick sort has an average-case time complexity of O(n log n), making it suitable for large datasets. However, its worst-case time complexity is O(n^2), which occurs when the smallest or largest element is always chosen as the pivot. This can be mitigated by using good pivot selection strategies or randomization.",\n        "role": "assistant"\n      }\n    }\n  ],\n  ...\n}\n')),(0,r.kt)("p",null,"Send a POST request to the Route and use the second template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl "http://127.0.0.1:9080/v1/chat/completions" -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "template_name": "echo",\n    "prompt": "hello APISIX"\n  }\'\n')),(0,r.kt)("p",null,"You should receive a response similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "choices": [\n    {\n      "finish_reason": "stop",\n      "index": 0,\n      "message": {\n        "content": "hello APISIX",\n        "role": "assistant"\n      }\n    }\n  ],\n  ...\n}\n')))}m.isMDXComponent=!0}}]);