"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[8826],{35318:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(n),h=r,u=d["".concat(l,".").concat(h)]||d[h]||k[h]||s;return n?a.createElement(u,i(i({ref:t},c),{},{components:n})):a.createElement(u,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},23943:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>k,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=n(25773),r=(n(27378),n(35318));const s={title:"Accessing APISIX-Dashboard from Everywhere with Keycloak Authentication",authors:[{name:"Busico Mirto Silvio",title:"Author",url:"https://github.com/MirtoBusico",image_url:"https://avatars.githubusercontent.com/u/11090934?s=400&u=644e4f87c2fad56760f6eb4f46cbcb4db059880a&v=4"}],keywords:["Alternatives to NGINX","Access and Authentication","Nginx reverse proxy","OpenID-Connect","Keycloak"],description:"This guest blog shares how to expose the APISIX Dashboard using APISIX to authenticate access with the OpenID-Connect plugin and Keycloak server to manage identities.",tags:["Ecosystem"],cover:"https://static.apiseven.com/uploads/2023/01/19/FKDU7U6j_blog01a.png"},i=void 0,o={permalink:"/blog/2023/01/02/accessing_apisix-dashboard_from_everywhere_with_keycloak_authentication",source:"@site/blog/2023/01/02/accessing_apisix-dashboard_from_everywhere_with_keycloak_authentication.md",title:"Accessing APISIX-Dashboard from Everywhere with Keycloak Authentication",description:"This guest blog shares how to expose the APISIX Dashboard using APISIX to authenticate access with the OpenID-Connect plugin and Keycloak server to manage identities.",date:"2023-01-02T00:00:00.000Z",formattedDate:"January 2, 2023",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:17.575,truncated:!0,authors:[{name:"Busico Mirto Silvio",title:"Author",url:"https://github.com/MirtoBusico",image_url:"https://avatars.githubusercontent.com/u/11090934?s=400&u=644e4f87c2fad56760f6eb4f46cbcb4db059880a&v=4",imageURL:"https://avatars.githubusercontent.com/u/11090934?s=400&u=644e4f87c2fad56760f6eb4f46cbcb4db059880a&v=4"}],prevItem:{title:"How to Integrate API Gateway and Consul? Not Consul K/V",permalink:"/blog/2023/01/18/consul-with-apisix"},nextItem:{title:"Release Apache APISIX 3.1.0",permalink:"/blog/2022/12/30/release-apache-apisix-3.1.0"}},l={authorsImageUrls:[void 0]},p=[{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Create a Certification Authority and Certificates",id:"create-a-certification-authority-and-certificates",children:[{value:"Add the CA to Browsers",id:"add-the-ca-to-browsers",children:[],level:3},{value:"Add the CA to the Operating System",id:"add-the-ca-to-the-operating-system",children:[],level:3}],level:2},{value:"Install nginx-mainline",id:"install-nginx-mainline",children:[],level:2},{value:"Install Keycloak",id:"install-keycloak",children:[{value:"Prerequisites",id:"prerequisites-1",children:[],level:3},{value:"Keycloak Installation",id:"keycloak-installation",children:[],level:3},{value:"Automatic Keycloak Startup",id:"automatic-keycloak-startup",children:[],level:3},{value:'Create site and certificates for &quot;https://k6k.h.net"',id:"create-site-and-certificates-for-httpsk6khnet",children:[],level:3},{value:"Add Keycloak Reverse Proxy",id:"add-keycloak-reverse-proxy",children:[],level:3}],level:2},{value:"Apisix API Gateway",id:"apisix-api-gateway",children:[{value:"Addresses for apisix-dashboard",id:"addresses-for-apisix-dashboard",children:[],level:3},{value:"APISIX Deployment",id:"apisix-deployment",children:[],level:3},{value:"Accessing APISIX Dashboard",id:"accessing-apisix-dashboard",children:[],level:3}],level:2},{value:"Create Apisix resources for apisix-dashboard",id:"create-apisix-resources-for-apisix-dashboard",children:[{value:"Create the certificate for <strong>&quot;apisix.h.net&quot;</strong>",id:"create-the-certificate-for-apisixhnet",children:[],level:3},{value:"Apply certificates Nginx and enable HTTPS",id:"apply-certificates-nginx-and-enable-https",children:[],level:3},{value:"Create the load balancer definition",id:"create-the-load-balancer-definition",children:[],level:3},{value:"Create \u201capisix-dashboard\u201d route and upstream with apisix-dashboard",id:"create-apisix-dashboard-route-and-upstream-with-apisix-dashboard",children:[],level:3},{value:"Enable https in apisix",id:"enable-https-in-apisix",children:[{value:"Create Keycloak Definitions for OpenID-Connect",id:"create-keycloak-definitions-for-openid-connect",children:[],level:4},{value:"Get Client ID and Secret",id:"get-client-id-and-secret",children:[],level:4},{value:"OpenID-Connect for APISIX Dashboard",id:"openid-connect-for-apisix-dashboard",children:[],level:4}],level:3},{value:"Accessing the Protected APISIX Dashboard Route",id:"accessing-the-protected-apisix-dashboard-route",children:[],level:3}],level:2},{value:"Recap",id:"recap",children:[],level:2}],c={toc:p};function k(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This article describes how to setup an external access to apisix-dashboard protecting the URL with authentication managed by a keycloak server.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/mV2GUS21_blog01a.png",alt:"framework"})),(0,r.kt)("p",null,"This article presents how to setup a framework where a user can access the Apisix-dashboard protected using an authentication system managed by a Keycloak server."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Basic understanding of nginx reverse proxy, kubernetes, apisix and openid connect."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"A lot of information on this matter can be found in ",(0,r.kt)("a",{parentName:"p",href:"https://apisix.apache.org/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis/"},'"Use Keycloak with API Gateway to secure APIs"')," blog post")),(0,r.kt)("p",null,"Here I'll present instructions, examples, code and screenshots taken from my home lab."),(0,r.kt)("p",null,"The framework used in this article consists of some KVM virtual machines (from now VM):"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"VM Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Role"),(0,r.kt)("th",{parentName:"tr",align:null},"Services"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hdev"),(0,r.kt)("td",{parentName:"tr",align:null},"Development"),(0,r.kt)("td",{parentName:"tr",align:null},"kubectl, istioctl, helm"),(0,r.kt)("td",{parentName:"tr",align:null},"workstation from where manage the cluster")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hserv"),(0,r.kt)("td",{parentName:"tr",align:null},"external services"),(0,r.kt)("td",{parentName:"tr",align:null},"DNS server, Nginx, Keycloak"),(0,r.kt)("td",{parentName:"tr",align:null},"services used by the cluster VM and external users")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hkm"),(0,r.kt)("td",{parentName:"tr",align:null},"Kubernetes master"),(0,r.kt)("td",{parentName:"tr",align:null},"master node"),(0,r.kt)("td",{parentName:"tr",align:null},"control plane manager for K8S")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hkw1"),(0,r.kt)("td",{parentName:"tr",align:null},"K8S worker 1"),(0,r.kt)("td",{parentName:"tr",align:null},"first worker node"),(0,r.kt)("td",{parentName:"tr",align:null},"node for hosting pods")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hkw2"),(0,r.kt)("td",{parentName:"tr",align:null},"K8S worker 2"),(0,r.kt)("td",{parentName:"tr",align:null},"second worker node"),(0,r.kt)("td",{parentName:"tr",align:null},"node for hosting pods")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hkw3"),(0,r.kt)("td",{parentName:"tr",align:null},"K8S worker 3"),(0,r.kt)("td",{parentName:"tr",align:null},"third worker node"),(0,r.kt)("td",{parentName:"tr",align:null},"node for hosting pods")))),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"hserv")," VM have two lan cards: one on an external lan to expose services and one an internal lan to communicate with the Kubernetes (from now K8S) cluster.\nAll the other VM are only connected to the internal lan."),(0,r.kt)("p",null,"All the machines resolve the IP addresses using the DNS server installed on ",(0,r.kt)("strong",{parentName:"p"},"hserv")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hserv")," and ",(0,r.kt)("strong",{parentName:"p"},"hdev")," machines have a Graphical User Interface (from now GUI). All the other machines have only the character console."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The real framework is more complex. Here are reported only the relevant components")),(0,r.kt)("p",null,"All machines use Ubuntu distribution but commands reported here should worh for other distributions with some modifications.\nThe username used throughout this article will be ",(0,r.kt)("strong",{parentName:"p"},'"sysop"')," So the home directory will be indicated as ",(0,r.kt)("strong",{parentName:"p"},'"/home/sysop"')," or ",(0,r.kt)("strong",{parentName:"p"},'"~/"'),"."),(0,r.kt)("h2",{id:"create-a-certification-authority-and-certificates"},"Create a Certification Authority and Certificates"),(0,r.kt)("p",null,"For all the VM the DNS server will resolve ",(0,r.kt)("strong",{parentName:"p"},'"apisix.h.net"')," to the external address of ",(0,r.kt)("strong",{parentName:"p"},"hserv"),".\nIn all others machine that will access the the services exposed by ",(0,r.kt)("strong",{parentName:"p"},"hserv")," there will be a line in the ",(0,r.kt)("strong",{parentName:"p"},'"/etc/hosts"')," file resolving ",(0,r.kt)("strong",{parentName:"p"},'"apisix.h.net"')," to the external address of ",(0,r.kt)("strong",{parentName:"p"},"hserv"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Working on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"Create the directory for the entire project software"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd\nmkdir H\n")),(0,r.kt)("p",null,"Create the directory to hold the Certification authority (from now CA) certificates and the web sites certificates"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H\nmkdir hservcerts\ncd hservcerts\n")),(0,r.kt)("p",null,"Create a private key for ",(0,r.kt)("strong",{parentName:"p"},'"hservca"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo openssl genrsa -out hservca.key 2048\n")),(0,r.kt)("p",null,"This generates a ",(0,r.kt)("strong",{parentName:"p"},"hservca.key")," key file. Using this fiile generate the CA certificate"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo openssl req -x509 -new -nodes -key hservca.key -sha256 -days 3650 -out hservca.pem\n")),(0,r.kt)("p",null,"This generates a ",(0,r.kt)("strong",{parentName:"p"},'hservca.pem"')," certificate file. These two files will be used to create the web sites certificates"),(0,r.kt)("h3",{id:"add-the-ca-to-browsers"},"Add the CA to Browsers"),(0,r.kt)("p",null,"To be able to access the web sites with certidicates issued by this private CA, the CA certificate file have to be added to the web browser that will access these sites."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Working on hdev")),(0,r.kt)("p",null,"Copy the ",(0,r.kt)("strong",{parentName:"p"},'"hservca.pem"')," file in any machine that will access these sites."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd\ncp ~/H/hservcerts/hservca.pem .\nrcp hservca.pem mirto@_any_machine_name_://home/_your_username_/\n")),(0,r.kt)("p",null,"For ",(0,r.kt)("strong",{parentName:"p"},"Firefox")," browser go to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Preferences -> Privacy & Security -> Certificates -> View Certificates -> Authorities -> Import\n")),(0,r.kt)("p",null,"and import ",(0,r.kt)("strong",{parentName:"p"},'"hservca.pem"')," (remember to flag all options)"),(0,r.kt)("p",null,"For ",(0,r.kt)("strong",{parentName:"p"},"Chromium")," or ",(0,r.kt)("strong",{parentName:"p"},"Chrome")," browsers go to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Settings -> Advanced -> Privacy and security -> Manage certificates -> Authorities -> Import (flag all options)\n")),(0,r.kt)("p",null,"and import ",(0,r.kt)("strong",{parentName:"p"},'"hservca.pem"')," (remember to flag all options)"),(0,r.kt)("h3",{id:"add-the-ca-to-the-operating-system"},"Add the CA to the Operating System"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Working on hdev")),(0,r.kt)("p",null,'Copy the "hservca.pem" file in the "/home/sysop" directory.\nCopy this file on any other machine that will use sertificates signed by this CA.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd\ncp ~/H/hservcerts/hservca.pem .\nrcp hservca.pem mirto@_any_machine_name_://home/_your_username_/\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on any machine")),(0,r.kt)("p",null,"Then on any machine and hserv do the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd\nsudo mkdir -p /usr/share/ca-certificates/extra\nsudo cp hservca.pem /usr/share/ca-certificates/extra/hservca.crt\nsudo dpkg-reconfigure ca-certificates\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Attention"),":"),(0,r.kt)("p",{parentName:"blockquote"},'\u2022 "dpkg-reconfigure ca-certificates" do not recognize the ".pem" extension. Copy the ',(0,r.kt)("strong",{parentName:"p"},'"hservca.pem"')," file to ",(0,r.kt)("strong",{parentName:"p"},'"hservca.crt"')),(0,r.kt)("p",{parentName:"blockquote"},'\u2022 select the new certificate in "dpkg-reconfigure ca-certificates" (extra/hservca.crt is not selected)')),(0,r.kt)("p",null,"Confirm that you want to proceed: select \u201cyes\u201d and click \u201cOk\u201d. Select the new \u201chservca.crt\u201d entry and click \u201cOk\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/uSuVlfv2_2%20ca-certificates.png",alt:"confirm"})),(0,r.kt)("h2",{id:"install-nginx-mainline"},"Install nginx-mainline"),(0,r.kt)("p",null,"Verify the system is updated"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt update\nsudo apt full-upgrade\n")),(0,r.kt)("p",null,"Install prerequisites"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt install wget gnupg2 ca-certificates lsb-release ubuntu-keyring software-properties-common -y\n")),(0,r.kt)("p",null,"Download the Nginx GPG key"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"wget -O- https://nginx.org/keys/nginx_signing.key | sudo gpg --dearmor | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg\n")),(0,r.kt)("p",null,"Add the Nginx mainline apt repository"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"echo deb [arch=amd64,arm64 signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx | sudo tee /etc/apt/sources.list.d/nginx-mainline.list\n")),(0,r.kt)("p",null,"Pin the Nginx repository"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'echo -e "Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n" | sudo tee /etc/apt/preferences.d/99nginx\n')),(0,r.kt)("p",null,"Update apt and install nginx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt update\nsudo apt install nginx\n")),(0,r.kt)("h2",{id:"install-keycloak"},"Install Keycloak"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("h3",{id:"prerequisites-1"},"Prerequisites"),(0,r.kt)("p",null,"Install jdk"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt install default-jdk\n")),(0,r.kt)("p",null,"Remove anacron"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt remove anacron\n")),(0,r.kt)("p",null,"Reboot the ",(0,r.kt)("strong",{parentName:"p"},"hserv")," machine"),(0,r.kt)("h3",{id:"keycloak-installation"},"Keycloak Installation"),(0,r.kt)("p",null,"Go in base installation directory and get keycloak installation files (verify what is the last release)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/\nwget https://github.com/keycloak/keycloak/releases/download/20.0.1/keycloak-20.0.1.zip\n")),(0,r.kt)("p",null,"Extract the files"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"unzip keycloak-20.0.1.zip\n")),(0,r.kt)("p",null,"Go to the bin directory and start keycloak in standalone mode"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/keycloak-20.0.1/bin/\n./kc.sh start-dev\n")),(0,r.kt)("p",null,"Verify that Keycloak is accessible from ",(0,r.kt)("strong",{parentName:"p"},"hserv")," at the URL ",(0,r.kt)("strong",{parentName:"p"},'"http://localhost:8080"')),(0,r.kt)("p",null,"Create the admin user as name ",(0,r.kt)("strong",{parentName:"p"},'"admin"')," and password ",(0,r.kt)("strong",{parentName:"p"},'"1357Togo"')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/N8jhfNWf_3%20k6k01.png",alt:"k6k01"})),(0,r.kt)("p",null,"Go to the administration console"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/casYhEXo_4%20k6k02.png",alt:"k6k02"})),(0,r.kt)("p",null,"Login and the \u201cMaster\u201d realm appears. Note the Keycloak version"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/mReJJEkt_5%20k6k03.png",alt:"k6k03"})),(0,r.kt)("h3",{id:"automatic-keycloak-startup"},"Automatic Keycloak Startup"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"Create in ",(0,r.kt)("strong",{parentName:"p"},"\u201c/usr/lib/systemd/system\u201d")," a file named ",(0,r.kt)("strong",{parentName:"p"},"\u201ckeycloak.service\u201d")," containing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Unit]\nDescription=keycloak service\nAfter=network.service\n\n[Service]\nExecStart=/home/sysop/H/keycloak-20.0.1/bin/kc.sh start-dev >/var/log/keycloak.log 2>&1\nPIDFile=/var/run/keycloak.pid\n\n[Install]\nWantedBy=multi-user.target\n")),(0,r.kt)("p",null,"Enable and activate the service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl enable keycloak\nsudo systemctl start keycloak\n")),(0,r.kt)("p",null,"Reboot hserv and verify Keycloak is accessible at startup"),(0,r.kt)("h3",{id:"create-site-and-certificates-for-httpsk6khnet"},'Create site and certificates for "',(0,r.kt)("a",{parentName:"h3",href:"https://k6k.h.net%22"},'https://k6k.h.net"')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv")),(0,r.kt)("p",{parentName:"blockquote"},"Note that keycloak will be abbreviated in ",(0,r.kt)("strong",{parentName:"p"},"k6k"))),(0,r.kt)("p",null,"Verify that the keycloak address was added in ",(0,r.kt)("strong",{parentName:"p"},'"/etc/hosts"')," file on any machine that will access the service and is reported in the DNS server hosted on ",(0,r.kt)("strong",{parentName:"p"},"hserv"),"."),(0,r.kt)("p",null,"The address used is the exsternal address o the ",(0,r.kt)("strong",{parentName:"p"},"hsrv")," machine"),(0,r.kt)("p",null,"In the ",(0,r.kt)("strong",{parentName:"p"},'"/etc/hosts"')," fle add the line"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"192.168.100.20 k6k k6k.h.net\n")),(0,r.kt)("p",null,"In the DNS server on ",(0,r.kt)("strong",{parentName:"p"},"hserv")," add the k6k entry in the ",(0,r.kt)("strong",{parentName:"p"},"\u201ch.net\u201d")," DNS zone with address ",(0,r.kt)("strong",{parentName:"p"},"\u201c192.168.100.20\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/clouoRER_6%20dns01.png",alt:"dns01"})),(0,r.kt)("p",null,"Create the certificate for ",(0,r.kt)("strong",{parentName:"p"},'"k6k.h.net"')),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},'"~/H/hservcerts"')," create a file called ",(0,r.kt)("strong",{parentName:"p"},'"k6kssl.cnf"')," containing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[req]\ndefault_bits = 2048\ndistinguished_name = req_distinguished_name\nprompt = no\n\n[req_distinguished_name]\nC = IT\nST = Italy\nL = Rome\nO = Busico Mirto\nOU = Laboratory\nCN = k6k.h.net\n\n[v3_ca]\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = k6k\n# other names\nDNS.2 = k6k.h.net\nDNS.3 = k6k.ext.h.net\nDNS.4 = k6k.int.h.net\n")),(0,r.kt)("p",null,"Create the server private key and csr certificate request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/hservcerts\nsudo openssl req -new -sha256 -nodes -newkey rsa:2048 -keyout k6k.key -out k6k.csr -config k6kssl.cnf\n")),(0,r.kt)("p",null,"Create the certificate signed by the ",(0,r.kt)("strong",{parentName:"p"},'"hservca"')," certification authority"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo openssl x509 -req -in k6k.csr -CA hservca.pem -CAkey hservca.key -CAcreateserial -out k6k.crt -sha256 -days 3650 -extfile k6kssl.cnf -extensions v3_ca\n")),(0,r.kt)("p",null,"Now you have the key file ",(0,r.kt)("strong",{parentName:"p"},"k6k.key")," and the certificate file ",(0,r.kt)("strong",{parentName:"p"},"k6k.cert")," to be used in the nginx reverse proxy"),(0,r.kt)("p",null,"Change the access rights for k6k.key file to permit nginx access"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/hservcerts\nsudo chmod a+r k6k.key\n")),(0,r.kt)("p",null,"Create the root directory for k6k under nginx and create an index.html file in that directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo mkdir /usr/share/nginx/k6k\nsudo chmod 777 /usr/share/nginx/k6k\nvi /usr/share/nginx/k6k/index.html\n")),(0,r.kt)("p",null,'Put in index.html filke the "K6K" base document'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<!DOCTYPE html>\n<html>\n<text>\n\n<h1>K6K default page</h1>\n\n</text>\n</html>\n")),(0,r.kt)("p",null,"In the directory ",(0,r.kt)("strong",{parentName:"p"},"\u201c/etc/nginx/conf.d\u201d")," create the file ",(0,r.kt)("strong",{parentName:"p"},"\u201ck6k.conf\u201d")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd /etc/nginx/conf.d\nsudo vi k6k.conf\n")),(0,r.kt)("p",null,"The file contains"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"server {\n\n    listen 443 ssl http2;\n    server_name k6k.h.net;\n    root   /usr/share/nginx/k6k;\n\n    access_log  /var/log/nginx/k6k.access.log;\n    error_log  /var/log/nginx/k6k.error.log;\n\n    ssl_certificate     /home/sysop/H/hservcerts/k6k.crt;\n    ssl_certificate_key /home/sysop/H/hservcerts/k6k.key;\n\n\n    location / {\n        index  index.html index.htm;\n    }\n\n    error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")),(0,r.kt)("p",null,"Restart Nginx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,r.kt)("p",null,"Try to access \u201c",(0,r.kt)("a",{parentName:"p",href:"https://k6k.h.net%E2%80%9D"},"https://k6k.h.net\u201d")," from a browser: the k6k base document will be showed"),(0,r.kt)("h3",{id:"add-keycloak-reverse-proxy"},"Add Keycloak Reverse Proxy"),(0,r.kt)("p",null,"In the directory ",(0,r.kt)("strong",{parentName:"p"},"\u201c/etc/nginx/conf.d\u201d")," change the file ",(0,r.kt)("strong",{parentName:"p"},"\u201ck6k.conf\u201d")," to proxy keycloak"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd /etc/nginx/conf.d\nsudo vi k6k.conf\n")),(0,r.kt)("p",null,"The file now contains"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"server {\n\n    listen 443 ssl http2;\n    server_name k6k.h.net;\n    root   /usr/share/nginx/k6k;\n\n    access_log  /var/log/nginx/k6k.access.log;\n    error_log  /var/log/nginx/k6k.error.log;\n\n    ssl_certificate     /home/sysop/H/hservcerts/k6k.crt;\n    ssl_certificate_key /home/sysop/H/hservcerts/k6k.key;\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Forwarded-Proto $scheme;\n\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n    }\n\n    error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")),(0,r.kt)("p",null,"Restart Nginx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,r.kt)("p",null,"Rebuild keycloak for production"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/keycloak-20.0.1/bin/\n./kc.sh --verbose build\n")),(0,r.kt)("p",null,"Change in ",(0,r.kt)("strong",{parentName:"p"},"\u201c/usr/lib/systemd/system\u201d")," the file named ",(0,r.kt)("strong",{parentName:"p"},"\u201ckeycloak.service\u201d")," with this content"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Unit]\nDescription=keycloak service\nAfter=network.service\n\n[Service]\nExecStart=/home/sysop/H/keycloak-20.0.1/bin/kc.sh start --proxy edge --hostname-strict=false >/var/log/keycloak.log 2>&1\nPIDFile=/var/run/keycloak.pid\n\n[Install]\nWantedBy=multi-user.target\n")),(0,r.kt)("p",null,"Enable and activate the service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\nsudo systemctl restart keycloak\n")),(0,r.kt)("h2",{id:"apisix-api-gateway"},"Apisix API Gateway"),(0,r.kt)("h3",{id:"addresses-for-apisix-dashboard"},"Addresses for apisix-dashboard"),(0,r.kt)("p",null,"The address used is the exsternal address o the ",(0,r.kt)("strong",{parentName:"p"},"hsrv")," machine"),(0,r.kt)("p",null,"In the ",(0,r.kt)("strong",{parentName:"p"},'"/etc/hosts"')," file of any machine accessing the cluster through the nginx reverse proxy add the line"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"192.168.100.20 apisix apisix.h.net\n")),(0,r.kt)("p",null,"In the DNS server on ",(0,r.kt)("strong",{parentName:"p"},"hserv")," add the apisix entry in the ",(0,r.kt)("strong",{parentName:"p"},"\u201ch.net\u201d")," DNS zone with address ",(0,r.kt)("strong",{parentName:"p"},"\u201c192.168.100.20\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/fAqZA2hy_7%20dns02.png",alt:"dns02"})),(0,r.kt)("h3",{id:"apisix-deployment"},"APISIX Deployment"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hdev"))),(0,r.kt)("p",null,"create a namespace for apisix"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl create ns apisix\n")),(0,r.kt)("p",null,"Add apisix helm repo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir ~/H/software/apisisx\ncd ~/H/software/apisisx\nhelm repo add apisix https://charts.apiseven.com\nhelm repo update\nhelm repo list\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"On ",(0,r.kt)("strong",{parentName:"p"},"\u201chserv\u201d")," create the CA kubernetes secret (make readable hservca.key)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/hservcerts\nls -lh hservca.*\nkubectl -n apisix create secret generic hservcacert --from-file=cert=./hservca.pem\nkubectl describe secret hservcacert -n apisix\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"work on ",(0,r.kt)("strong",{parentName:"p"},"hdev"))),(0,r.kt)("p",null,"Get the core_dns service address and port (in this example 10.43.0.10:53)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sysop@hdev:~/H/software/apisisx$ kubectl get svc -n kube-system\nNAME              TYPE           CLUSTER-IP     EXTERNAL-IP                                                   PORT(S)                  AGE\nkube-dns          ClusterIP      10.43.0.10     <none>                                                        53/UDP,53/TCP,9153/TCP   97d\nmetrics-server    ClusterIP      10.43.64.71    <none>                                                        443/TCP                  97d\ndocker-registry   LoadBalancer   10.43.183.18   192.168.101.21,192.168.101.22,192.168.101.23,192.168.101.24   5000:31397/TCP           92d\nsysop@hdev:~/H/software/apisisx$\n")),(0,r.kt)("p",null,"Get the apisic helm chart the default values and put the output in a file named ",(0,r.kt)("strong",{parentName:"p"},"apisix-values.yaml")," then edit this file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/H/software/apisisx\nhelm show values apisix/apisix > apisix-values.yaml\nvi apisix-values.yaml\n")),(0,r.kt)("p",null,"You have to change:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the gateway type to ",(0,r.kt)("strong",{parentName:"li"},"LoadBalancer")," (my home lab is powered off every day and with the default gateway type of NodePort the Apisix gateway starts every day on a different node changing IP address)"),(0,r.kt)("li",{parentName:"ul"},"set the ",(0,r.kt)("strong",{parentName:"li"},"tls")," section to use the kubernetes secret with the private CA reference"),(0,r.kt)("li",{parentName:"ul"},"set the discovery section to use the kube-dns address found before (doing this enables apisix upstream definition to use the service name instead of the IP address)"),(0,r.kt)("li",{parentName:"ul"},"set a session secret in the httpSrv section as a workaround cited in the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/apisix/pull/8068"},"#8068")," feature request"),(0,r.kt)("li",{parentName:"ul"},"enable (set to true) apisix dashboard and ingress-controller")),(0,r.kt)("p",null,"The relevant tiles changed are:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'gateway:\n  type: LoadBalancer\n...\n  tls:\n    enabled: true\n    servicePort: 443\n    containerPort: 9443\n    existingCASecret: "hservcacert"\n    certCAFilename: "cert"\n...\ndiscovery:\n  enabled: true\n  registry:\n    dns:\n        servers:\n            - "10.43.0.10:53"\n...\n   httpSrv: |\n    set $session_secret 0123456789a5bac9bb3c868ec8b202e93;\n...\n\ndashboard:\n  enabled: true\n\ningress-controller:\n  enabled: true\n')),(0,r.kt)("p",null,"Install apisix using the new values.yaml file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"helm install apisix apisix/apisix -f apisix-values.yaml \\\n--set ingress-controller.config.apisix.serviceNamespace=apisix \\\n--set ingress-controller.config.apisix.serviceName=apisix-admin \\\n--set ingress-controller.config.kubernetes.apisixRouteVersion=apisix.apache.org/v2beta3 \\\n--namespace apisix\n")),(0,r.kt)("p",null,"Wait for the pods to start (it can take some time)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl -n apisix wait --for=condition=Ready pods --all\nkubectl get pods -n apisix\n")),(0,r.kt)("p",null,"When all the Apisix pods will be in ",(0,r.kt)("strong",{parentName:"p"},"Running")," state the installation is completed"),(0,r.kt)("h3",{id:"accessing-apisix-dashboard"},"Accessing APISIX Dashboard"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hdev"))),(0,r.kt)("p",null,"Port forward apisix-dashboard"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl -n apisix port-forward service/apisix-dashboard 9090:80\n")),(0,r.kt)("p",null,"The command output should be something like"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sysop@hdev:~$ kubectl -n apisix port-forward service/apisix-dashboard 9090:80\nForwarding from 127.0.0.1:8080 -> 9000\nForwarding from [::1]:8080 -> 9000\n")),(0,r.kt)("p",null,"Then access the dashboard on ",(0,r.kt)("strong",{parentName:"p"},"\u201chdev\u201d")," pointing the web browser to the url \u201chttp://localhost:9090\u201d\nLogin with ",(0,r.kt)("strong",{parentName:"p"},"\u201cadmin / admin\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/INeavn6G_8%20ad01.png",alt:"ad01"})),(0,r.kt)("p",null,"Verify the dashboard version"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/2lzTvaa8_9ad02.png",alt:"ad02"})),(0,r.kt)("h2",{id:"create-apisix-resources-for-apisix-dashboard"},"Create Apisix resources for apisix-dashboard"),(0,r.kt)("h3",{id:"create-the-certificate-for-apisixhnet"},"Create the certificate for ",(0,r.kt)("strong",{parentName:"h3"},'"apisix.h.net"')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"In the \u201c~/H/hservcerts/\u201d folder create the key and certificate for apisix.h.net"),(0,r.kt)("p",null,"Create a file called ",(0,r.kt)("strong",{parentName:"p"},'"apisixssl.cnf"')," containing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[req]\ndefault_bits = 2048\ndistinguished_name = req_distinguished_name\nprompt = no\n\n[req_distinguished_name]\nC = IT\nST = Italy\nL = Rome\nO = Busico Mirto\nOU = Laboratory\nCN = apisix.h.net\n\n[v3_ca]\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = apisix\n# other names\nDNS.2 = apisix.h.net\nDNS.3 = apisix.ext.h.net\nDNS.4 = apisix.int.h.net\n")),(0,r.kt)("p",null,"Create the server private key and csr"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo openssl req -new -sha256 -nodes -newkey rsa:2048 -keyout apisix.key -out apisix.csr -config apisixssl.cnf\n")),(0,r.kt)("p",null,"Create the certificate file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo openssl x509 -req -in apisix.csr -CA hservca.pem -CAkey hservca.key -CAcreateserial -out apisix.crt -sha256 -days 3650 -extfile apisixssl.cnf -extensions v3_ca\n")),(0,r.kt)("p",null,"Change the access rights for apisix key to permit nginx access"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo chmod a+r apisix.key\n")),(0,r.kt)("h3",{id:"apply-certificates-nginx-and-enable-https"},"Apply certificates Nginx and enable HTTPS"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"Create the root directory for apisix under nginx and create an index.html file in that directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo mkdir /usr/share/nginx/apisix\nsudo chmod 777 /usr/share/nginx/apisix\nvi /usr/share/nginx/apisix/index.html\n")),(0,r.kt)("p",null,"Create a ",(0,r.kt)("strong",{parentName:"p"},"index.html")," file containing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<!DOCTYPE html>\n<html>\n<text>\n\n<h1>apisix https default page</h1>\n\n</text>\n</html>\n")),(0,r.kt)("p",null,"In the directory ",(0,r.kt)("strong",{parentName:"p"},"\u201c/etc/nginx/conf.d\u201d")," create the file named ",(0,r.kt)("strong",{parentName:"p"},"\u201capisix.conf\u201d")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd /etc/nginx/conf.d\nsudo vi apisix.conf\n")),(0,r.kt)("p",null,"Put in the ",(0,r.kt)("strong",{parentName:"p"},"\u201capisix.conf\u201d")," file this content"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"server {\n\n    listen 443 ssl http2;\n    server_name apisix.h.net;\n    root   /usr/share/nginx/apisix;\n\n    access_log  /var/log/nginx/apisix.access.log;\n    error_log  /var/log/nginx/apisix.error.log;\n\n    ssl_certificate     /home/sysop/H/hservcerts/apisix.crt;\n    ssl_certificate_key /home/sysop/H/hservcerts/apisix.key;\n\n\n    location / {\n        index  index.html index.htm;\n    }\n\n    error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")),(0,r.kt)("p",null,"Restart Nginx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,r.kt)("p",null,"Add the apisix line in \u201c/etc/hosts\u201d on any machine that will access apisix-dashboard"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"192.168.100.20 apisix.h.net\n")),(0,r.kt)("p",null,"Add the apisix A record in the DNS in \u201ch.net\u201d zone"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/sXSh4zpz_10ad03.png",alt:"ad03"})),(0,r.kt)("p",null,"Access \u201c",(0,r.kt)("a",{parentName:"p",href:"https://apisix.h.net%E2%80%9D"},"https://apisix.h.net\u201d")," from a browser and the apisix default page should be presented"),(0,r.kt)("h3",{id:"create-the-load-balancer-definition"},"Create the load balancer definition"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"In the directory ",(0,r.kt)("strong",{parentName:"p"},"\u201c/etc/nginx/conf.d\u201d")," modify the file ",(0,r.kt)("strong",{parentName:"p"},"\u201capisix.conf\u201d")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd /etc/nginx/conf.d\nsudo vi apisix.conf\n")),(0,r.kt)("p",null,"Put in the file this content"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"upstream hcluster {\n    ip_hash;\n    server 192.168.101.22:443;\n    server 192.168.101.23:443;\n    server 192.168.101.24:443;\n}\n\n\nserver {\n\n    listen 443 ssl http2;\n    server_name apisix.h.net;\n    root   /usr/share/nginx/apisix;\n\n    access_log  /var/log/nginx/apisix.access.log;\n    error_log  /var/log/nginx/apisix.error.log;\n\n    ssl_certificate     /home/sysop/H/hservcerts/apisix.crt;\n    ssl_certificate_key /home/sysop/H/hservcerts/apisix.key;\n\n    proxy_busy_buffers_size   512k;\n    proxy_buffers   4 512k;\n    proxy_buffer_size   256k;\n\n    proxy_set_header Host $host;\n    proxy_ssl_server_name on;\n    proxy_ssl_name apisix.h.net;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Forwarded-Proto $scheme;\n\n    location / {\n        proxy_pass https://hcluster;\n    }\n\n    error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")),(0,r.kt)("p",{parentName:"blockquote"},"the lines")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"upstream hcluster {\n    ip_hash;\n    server 192.168.101.22:443;\n    server 192.168.101.23:443;\n    server 192.168.101.24:443;\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"use the internal address of the three kubernetes worker nodes and it is necessary to specify the 443 port to enable https traffic"),(0,r.kt)("p",{parentName:"blockquote"},"The lines")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    proxy_busy_buffers_size   512k;\n    proxy_buffers   4 512k;\n    proxy_buffer_size   256k;\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"are required because, after the Keycloak authentication, the apisix server replyes with the state in the URL."),(0,r.kt)("p",{parentName:"blockquote"},'With the default values nginx replies with a "response too big" error')),(0,r.kt)("p",null,"Restart Nginx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,r.kt)("p",null,"Access \u201c",(0,r.kt)("a",{parentName:"p",href:"https://apisix.h.net%E2%80%9D"},"https://apisix.h.net\u201d")," from a browser. You should receive page not found error because there is no route in Apisix"),(0,r.kt)("h3",{id:"create-apisix-dashboard-route-and-upstream-with-apisix-dashboard"},"Create \u201capisix-dashboard\u201d route and upstream with apisix-dashboard"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hdev"))),(0,r.kt)("p",null,"port forward apisix-dashboard and access it at \u201chttp://localhost:9090\u201d and login with ",(0,r.kt)("strong",{parentName:"p"},'\u201cadmin\u201d / "admin\u201c')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl -n apisix port-forward service/apisix-dashboard 9090:80\n")),(0,r.kt)("p",null,"Find the apisix-dashboard service name and port"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sysop@hdev:~/H/hservcerts$ kubectl get svc -n apisix\nNAME                        TYPE           CLUSTER-IP      EXTERNAL-IP                                                   PORT(S)                      AGE\napisix-etcd-headless        ClusterIP      None            <none>                                                        2379/TCP,2380/TCP            12h\napisix-etcd                 ClusterIP      10.43.75.4      <none>                                                        2379/TCP,2380/TCP            12h\napisix-ingress-controller   ClusterIP      10.43.170.105   <none>                                                        80/TCP                       12h\napisix-dashboard            ClusterIP      10.43.48.202    <none>                                                        80/TCP                       12h\napisix-admin                ClusterIP      10.43.169.123   <none>                                                        9180/TCP                     12h\napisix-gateway              LoadBalancer   10.43.161.47    192.168.101.21,192.168.101.22,192.168.101.23,192.168.101.24   80:30508/TCP,443:32653/TCP   12h\nsysop@hdev:~/H/hservcerts$\n")),(0,r.kt)("p",null,"Create an upstream"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/awmMSYaW_11ad04.png",alt:"ad04"})),(0,r.kt)("p",null,"Set the name to ",(0,r.kt)("strong",{parentName:"p"},"\u201capisix-dashboard\u201d"),", upstream type to ",(0,r.kt)("strong",{parentName:"p"},"\u201cservice discovery\u201d"),", discovery type to ",(0,r.kt)("strong",{parentName:"p"},"\u201cdns\u201d")," and servicename to ",(0,r.kt)("strong",{parentName:"p"},"\u201capisix-dashboard.apisix.svc.cluster.local:80\u201d"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/HAQw19MF_12ad05.png",alt:"ad05"})),(0,r.kt)("p",null,"Then click \u201cNext\u201d and after click \u201cSubmit\u201d"),(0,r.kt)("p",null,"Click \u201cView\u201d to see the json upstream definition"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/2K7p0bZi_13ad06.png",alt:"ad06"})),(0,r.kt)("p",null,"Note the upstream name to be used in the next route definition"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/TduSqV0m_14ad07.png",alt:"ad07"})),(0,r.kt)("p",null,"Now click \u201cCreate\u201d on the \u201cRoute\u201d page"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/fuSqIVlL_15ad08.png",alt:"ad08"})),(0,r.kt)("p",null,'Create a route ("Define api request" - on top): set name to \u201capisix-dashboard\u201d and add a description'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/TEQaia56_16ad09.png",alt:"ad09"})),(0,r.kt)("p",null,'Create a route ("Define api request" - below): set host to ',(0,r.kt)("strong",{parentName:"p"},"\u201capisix.h.net\u201d")," and path to ",(0,r.kt)("strong",{parentName:"p"},"\u201c/*\u201d"),". Then click ",(0,r.kt)("strong",{parentName:"p"},"\u201cNext\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/U2C0nK9H_17ad10.png",alt:"ad10"})),(0,r.kt)("p",null,"Select the previous defined \u201capisix\u201d upstream from the dropdown list. Then click \u201cNext\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/aTCu1mIe_18ad11.png",alt:"ad11"})),(0,r.kt)("p",null,"For now don\u2019t use plugins and click \u201cNext\u201d. Then click \u201cSubmit\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/Z6m7MicN_19ad12.png",alt:"ad12"})),(0,r.kt)("h3",{id:"enable-https-in-apisix"},"Enable https in apisix"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hserv"))),(0,r.kt)("p",null,"Copy the certificates from hserv to hdev. From hserv:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sysop@hserv:~$ cd ~/H\nsysop@hserv:~/H$ rsync -vau --stats ./hservcerts/* hdev.int.h.net://home/sysop/H/hservcerts/\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on ",(0,r.kt)("strong",{parentName:"p"},"hdev"))),(0,r.kt)("p",null,"Port forward apisix-dashboard and access it ah \u201chttp://localhost:9090\u201d and login with ",(0,r.kt)("strong",{parentName:"p"},'\u201cadmin\u201d / "admin\u201c')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl -n apisix port-forward service/apisix-dashboard 9090:80\n")),(0,r.kt)("p",null,"Select the \u201cSSL\u201d page and click Create"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/dEVd2rD6_20ad14.png",alt:"ad14"})),(0,r.kt)("p",null,"Select ",(0,r.kt)("strong",{parentName:"p"},"\u201cWay: Upload\u201d"),", then click ",(0,r.kt)("strong",{parentName:"p"},"\u201cupload certificate\u201d")," and ",(0,r.kt)("strong",{parentName:"p"},"\u201cupload key\u201d"),". Clik \u201cNext\u201d (Take certificate and key files from ",(0,r.kt)("strong",{parentName:"p"},"~/H/hservcerts"),")"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/cBHW3QQH_21ad15.png",alt:"ad15"})),(0,r.kt)("p",null,"Preview the SSL resource and click \u201cSubmit\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/5y67o7w7_22ad16.png",alt:"ad16"})),(0,r.kt)("p",null,"The ssl resource appear in the list (note the SNI values)"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/0QcDTVt7_23ad17.png",alt:"ad17"})),(0,r.kt)("p",null,"Configure the \u201capisix-dashboard\u201d route to enable http to https redirection"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/rxL1HGlY_24ad18.png",alt:"ad18"})),(0,r.kt)("p",null,"Set the ",(0,r.kt)("strong",{parentName:"p"},"\u201cRedirect\u201d")," field to ",(0,r.kt)("strong",{parentName:"p"},"\u201cEnable HTTPS\u201d"),". Then click \u201cNext\u201d until you see \u201cSubmit\u201d. Click \u201cSubmit\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/iD0XRe4A_25ad19.png",alt:"ad19"})),(0,r.kt)("p",null,"View the route configuration and verify that the redirect plugin is enabled"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/8I9QKdZj_26ad20.png",alt:"ad20"})),(0,r.kt)("p",null,"Now from any machine you can access the apisix-dashboard at the url ",(0,r.kt)("strong",{parentName:"p"},"\u201c",(0,r.kt)("a",{parentName:"strong",href:"https://apisix.h.net%E2%80%9D"},"https://apisix.h.net\u201d"))," and verify that the apisix-dashboard login page is showed"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/WYwVhc6V_27ad21.png",alt:"ad21"})),(0,r.kt)("p",null,"Login with \u201cadmin\u201d / \u201cadmin\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/33gBSogM_28ad22.png",alt:"ad22"})),(0,r.kt)("h4",{id:"create-keycloak-definitions-for-openid-connect"},"Create Keycloak Definitions for OpenID-Connect"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on any machine")),(0,r.kt)("p",null,"Working on any machine, access the keycloak console at  \u201c",(0,r.kt)("a",{parentName:"p",href:"https://k6k.h.net%E2%80%9D"},"https://k6k.h.net\u201d"),' and login with \u201cadmin\u201d / "1357Togo\u201c'),(0,r.kt)("p",null,"Click \u201cCreate Realm\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/rgM4S46s_29k6k04.png",alt:"k6k04"})),(0,r.kt)("p",null,"Create a realm named ",(0,r.kt)("strong",{parentName:"p"},"\u201chcluster_admins\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/WGPQt7eY_30k6k05.png",alt:"k6k05"})),(0,r.kt)("p",null,"Create a client named ",(0,r.kt)("strong",{parentName:"p"},"\u201chcadmins\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/nSIDqrMz_31k6k06.png",alt:"k6k06"})),(0,r.kt)("p",null,"Verify that the client protocol is ",(0,r.kt)("strong",{parentName:"p"},"\u201copenid-connect\u201d")," and click \u201cNext\u201d"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/5FMWvLiZ_32k6k07.png",alt:"k6k07"})),(0,r.kt)("p",null,'Set \u201cClient authentication\u201d to "on" (means OIDC type confidential). Click \u201cSave\u201d'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/OPLxpYCZ_33k6k08.png",alt:"k6k08"})),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},"\u201cCient details\u201d"),", ",(0,r.kt)("strong",{parentName:"p"},"\u201cSettings\u201d")," tab, ",(0,r.kt)("strong",{parentName:"p"},"\u201caccess settings\u201d")," section, set ",(0,r.kt)("strong",{parentName:"p"},"\u201cValid redirect URI\u201d")," to ",(0,r.kt)("strong",{parentName:"p"},"\u201c*\u201d"),". Click ",(0,r.kt)("strong",{parentName:"p"},"\u201cSave\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/ZtOy06uu_34k6k09.png",alt:"k6k09"})),(0,r.kt)("p",null,"Create a new user"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/2MPpK4Xw_35k6k10.png",alt:"k6k10"})),(0,r.kt)("p",null,"Set the username to ",(0,r.kt)("strong",{parentName:"p"},"\u201chcadmin\u201d")," and click ",(0,r.kt)("strong",{parentName:"p"},"\u201cCreate\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/28/YEwkpnnp_k6k11.png",alt:"k6k11"})),(0,r.kt)("p",null,"In the ",(0,r.kt)("strong",{parentName:"p"},"\u201cCredentials\u201d")," tab click ",(0,r.kt)("strong",{parentName:"p"},"\u201cSet password\u201d"),' (same procedure for "Reset" password)'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/HzbaXwUN_37k6k12.png",alt:"k6k12"})),(0,r.kt)("p",null,"Set a permanent (Temporary set to Off) password to ",(0,r.kt)("strong",{parentName:"p"},"\u201chcadmin\u201d")," (equal to the username)"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/fS53TVta_38k6k13.png",alt:"k6k13"})),(0,r.kt)("h4",{id:"get-client-id-and-secret"},"Get Client ID and Secret"),(0,r.kt)("p",null,"Select ",(0,r.kt)("strong",{parentName:"p"},"hcadmins")," client. Go to ",(0,r.kt)("strong",{parentName:"p"},"Credentials")," tab; show the Secret and copy the client id and secret to be used in the next steps"),(0,r.kt)("p",null,"client ID: ",(0,r.kt)("strong",{parentName:"p"},"hcadmins")),(0,r.kt)("p",null,"Secret: ",(0,r.kt)("strong",{parentName:"p"},"MoqLUhwgsEDi36II0KuJldKq4YGLHxl3")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/TSporVZx_39k6k14.png",alt:"k6k14"})),(0,r.kt)("p",null,"In the ",(0,r.kt)("strong",{parentName:"p"},"\u201cRealm settings\u201d"),", ",(0,r.kt)("strong",{parentName:"p"},"\u201cGeneral\u201d")," tab click on the link ",(0,r.kt)("strong",{parentName:"p"},"\u201cOpenID Endpoint Configuration\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/MiFQHqS0_40k6k15.png",alt:"k6k15"})),(0,r.kt)("p",null,"This is the shown page"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/IQDtB8NP_41k6k16.png",alt:"k6k16"})),(0,r.kt)("p",null,"Copy the link"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://k6k.h.net/realms/hcluster_admins/.well-known/openid-configuration\n")),(0,r.kt)("p",null,"Prepare a json client definition using the previous copied information"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n    "client_id":"hcadmins",\n    "client_secret":"MoqLUhwgsEDi36II0KuJldKq4YGLHxl3",\n    "discovery":"https://k6k.h.net/realms/hcluster_admins/.well-known/openid-configuration",\n    "scope":"openid profile",\n    "bearer_only":false,\n    "realm":"hcluster_admins",\n    "introspection_endpoint_auth_method":"client_secret_post",\n    "redirect_uri":"https://apisix.h.net/*",\n    "access_token_in_authorization_header":true\n}\n')),(0,r.kt)("h4",{id:"openid-connect-for-apisix-dashboard"},"OpenID-Connect for APISIX Dashboard"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on any machine")),(0,r.kt)("p",null,"Configure the apisix-dashboard route."),(0,r.kt)("p",null,"Go to ",(0,r.kt)("strong",{parentName:"p"},"\u201c3 Plugin config\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/fRBFq9qA_42ad23.png",alt:"ad23"})),(0,r.kt)("p",null,"Click ",(0,r.kt)("strong",{parentName:"p"},"\u201cEnable\u201d"),' on openid-connect plugin (if you have already defined the plugin you\'ll see "Edit" instead of "Enable")'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/yh2HtjSR_43ad24.png",alt:"ad24"})),(0,r.kt)("p",null,"Enable the plugin. Copy the previous defined json definition and click ",(0,r.kt)("strong",{parentName:"p"},"\u201cSubmit\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/DSqrLV7K_44ad25.png",alt:"ad25"})),(0,r.kt)("p",null,'Clik "next" and then clik "Submit" to complete the route configuration'),(0,r.kt)("p",null,'Then "view" the route to see the plugin configuration'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/hFGRuPmq_45ad26.png",alt:"ad26"})),(0,r.kt)("h3",{id:"accessing-the-protected-apisix-dashboard-route"},"Accessing the Protected APISIX Dashboard Route"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Work on any machine")),(0,r.kt)("p",null,"Go to the URL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://apisix.h.net\n")),(0,r.kt)("p",null,'You will be redirected to the Keycloak login page for the "HCLUSTER_ADMINS" realm.\nLogin with the previous defined user "hcadmin" / "hcadmin"'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/fs5u4nNI_46ad27.png",alt:"ad27"})),(0,r.kt)("p",null,'The apisix-dashboard login will be presented. Login with "admin" / "admin"'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/RnoBom2u_47ad28.png",alt:"ad28"})),(0,r.kt)("p",null,"And now you can see the apisix dashboard"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://static.apiseven.com/uploads/2023/01/20/dFEXeiAE_48ad29.png",alt:"ad29"})),(0,r.kt)("h2",{id:"recap"},"Recap"),(0,r.kt)("p",null,"In this article were presented the intruction to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"set up a Certification authority and create key and certificates for various sites"),(0,r.kt)("li",{parentName:"ul"},"set up a nginx server as reverse proxy and load balancer"),(0,r.kt)("li",{parentName:"ul"},"set up a Keycloak server accessible through a nginx reverse proxy"),(0,r.kt)("li",{parentName:"ul"},"set up Apisix in a kubernetes cluster with ingress-controller and apisix-dashboard"),(0,r.kt)("li",{parentName:"ul"},"set up the authentication framework in Keycloak to access the apisix-dashboard"),(0,r.kt)("li",{parentName:"ul"},"set up the nginx load balancer for apisix-dashboard inside kubernetes"),(0,r.kt)("li",{parentName:"ul"},"set up the apisix resources, including openid-connect plugin, to access the apisix-dashboard with authentication provided by the keycloak server")),(0,r.kt)("p",null,"Note that this set up is only for educational purpose. Do not use in production."))}k.isMDXComponent=!0}}]);