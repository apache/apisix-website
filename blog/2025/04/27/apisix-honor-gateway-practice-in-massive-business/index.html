<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">APISIX Gateway Practices in Honor&#x27;s Massive Business | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2025/04/27/apisix-honor-gateway-practice-in-massive-business/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="APISIX Gateway Practices in Honor&#x27;s Massive Business | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="Explore Honor&#x27;s API gateway journey using APISIX, featuring traffic scheduling, rate limiting, circuit breaking, and observability enhancements."><meta data-react-helmet="true" property="og:description" content="Explore Honor&#x27;s API gateway journey using APISIX, featuring traffic scheduling, rate limiting, circuit breaking, and observability enhancements."><meta data-react-helmet="true" name="keywords" content="open source,API gateway,Apache APISIX,Honor,API gateway use case"><meta data-react-helmet="true" property="og:image" content="https://static.api7.ai/uploads/2025/04/27/qq0YIAxK_honor-case-study.webp"><meta data-react-helmet="true" name="twitter:image" content="https://static.api7.ai/uploads/2025/04/27/qq0YIAxK_honor-case-study.webp"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2025-04-27T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/Yilialinn"><meta data-react-helmet="true" property="article:tag" content="Case Studies"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2025/04/27/apisix-honor-gateway-practice-in-massive-business/"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2025/04/27/apisix-honor-gateway-practice-in-massive-business/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2025/04/27/apisix-honor-gateway-practice-in-massive-business/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">ü§î Introducing APISIX AI Gateway ‚Äì Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">‰∏≠ÊñáÂçöÂÆ¢</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">APISIX Gateway Practices in Honor&#x27;s Massive Business</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2025-04-27T00:00:00.000Z" itemprop="datePublished">April 27, 2025</time> ¬∑ <!-- -->19 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><div size="48" color="E2F4E8" class="go994036025"><p color="363548" size="48" class="go1934652954">Ji</p></div></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Jiahao Fu</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><div size="48" color="EEEDFD" class="go2679483636"><p color="4409B9" size="48" class="go1017449453">We</p></div></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Weichuan Xu</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/Yilialinn" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://github.com/Yilialinn.png" alt="Yilia Lin"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Yilialinn" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Yilia Lin</span></a></div><small class="avatar__subtitle" itemprop="description">Technical Writer</small></div></div></div></div></header><meta itemprop="image" content="https://static.api7.ai/uploads/2025/04/27/qq0YIAxK_honor-case-study.webp"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>Authors: Jiahao Fu, Weichuan Xu, Engineers from the PAAS Department at Honor. This article is based on the presentation given by the two engineers at the APISIX Shenzhen Meetup on April 12, 2025.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="about-honor">About Honor<a aria-hidden="true" class="hash-link" href="#about-honor" title="Direct link to heading">‚Äã</a></h2><p>Established in 2013, <a href="https://www.honor.com/global/" target="_blank" rel="noopener noreferrer">Honor</a> is a global leader in smart terminal solutions. Its products are sold in over 100 countries and regions worldwide, with partnerships established with more than 200 operators. Honor operates over 52,000 experience stores and dedicated counters globally, with over 250 million active devices in use.</p><p>As a world-class AI terminal ecosystem company, Honor is dedicated to revolutionizing human-machine interaction. Leveraging its diversified innovative product portfolio, including smartphones, personal computers, tablets, and wearable devices, Honor aims to empower every user to effortlessly enter and enjoy the new intelligent world.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="evolution-and-architecture-of-honors-gateway">Evolution and Architecture of Honor&#x27;s Gateway<a aria-hidden="true" class="hash-link" href="#evolution-and-architecture-of-honors-gateway" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="evolution">Evolution<a aria-hidden="true" class="hash-link" href="#evolution" title="Direct link to heading">‚Äã</a></h3><ul><li><p>Honor began exploring traffic gateway products in 2021, conducting preliminary research on APISIX in Q3, and officially introduced APISIX in Q4 to initiate the construction of its internal traffic gateway platform.</p></li><li><p>In 2022, APISIX was officially deployed in Honor&#x27;s production environment. In Q1, pilot promotion of traffic access for consumer-facing (To C) business began; in Q2, APIs were open and available for deployment platforms, supporting traffic scheduling and container instance reporting. Furthermore, even when the deployment platform was not yet fully built, traffic access and scheduling can be performed by invoking APIs through scripts.</p></li><li><p>In 2023, Q1 saw the completion of APISIX-CP containerization, followed by the launch of APISIX-DP elastic scaling in Q3. By Q4, a single cluster supported over ten million connections, and by year-end, full coverage of cloud services for To C business was achieved.</p></li><li><p>In 2024, APISIX-DP containerization was completed in Q1, the runtime architecture was optimized to version 2.0 in Q2, and in Q4, Honor reached a throughput of 1 million QPS (queries per second) in a single cluster. By year-end, Honor&#x27;s API gateway, built on Apache APISIX, supported all of Honor&#x27;s business projects.</p></li><li><p>To date, the APISIX-based gateway platform within Honor has achieved peak traffic volumes of millions of QPS. Leveraging APISIX&#x27;s extensibility, nearly 100 custom plugins have been developed.</p></li><li><p>Moving forward, Honor&#x27;s technical team will explore the integration of AI with gateways and investigate how to enable automatic service reporting of gateways to Kubernetes.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="honor-gateway-architecture">Honor Gateway Architecture<a aria-hidden="true" class="hash-link" href="#honor-gateway-architecture" title="Direct link to heading">‚Äã</a></h3><p></p><div class="rc-image"><img loading="lazy" alt="Honor Gateway Architecture" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/TZKlAQ73_1-honor-gateway-architecture-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="gateway-architecture">Gateway Architecture<a aria-hidden="true" class="hash-link" href="#gateway-architecture" title="Direct link to heading">‚Äã</a></h4><ol><li><p><strong>Protocols Supported for Internal and External Networks</strong></p><p>Honor&#x27;s gateway architecture is divided into internal and external network access:</p><p>a. <strong>Protocols supported for external network</strong>: QUIC and HTTPS.</p><p>b. <strong>Protocols supported for internal network</strong>: HTTP, HTTPS, and gRPC. Among these, gRPC primarily handles AI-related traffic, with its QPS showing significant growth over the past year.</p></li><li><p><strong>Load Balancer and Proxy Selection</strong></p><p>a. A <strong>load balancer</strong> (LB) is deployed in front of APISIX to connect with both layer 4 and layer 7 traffic in the public clouds.</p><p>b. <strong>Layer 4 proxy</strong>: Initially used to publish all routes, but due to business launch issues that layer 4 proxy could not resolve, the setup was switched to layer 7 proxy.</p></li><li><p><strong>API Clusters and Plugin Marketplace</strong></p><p>a. <strong>API clusters</strong>: Multiple clusters share an etcd instance.</p><p>b. <strong>Plugin marketplace</strong>: Lists common plugins such as authentication, rate limiting, WAF, and traffic labeling.</p><p>c. <strong>Upstream deployment</strong>: Primarily based on containers, with a small number of virtual machines. Containers are connected to the deployment platform, which calls APIs to report traffic and instance information after container deployment.</p></li><li><p><strong>Log Collection and Analysis</strong></p><p>The Prometheus plugin is not used. Instead, logs are collected via Kafka and combined with Elastic Stack for metric analysis and alerting.</p></li><li><p><strong>etcd Load Balancing Optimization</strong></p><p>An additional layer of LB is added in front of etcd to address load imbalance issues when directly connecting to etcd nodes (e.g., excessively high node connection counts).</p></li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="gateway-features">Gateway Features<a aria-hidden="true" class="hash-link" href="#gateway-features" title="Direct link to heading">‚Äã</a></h4><ul><li><p><strong>User Workflow Management</strong>: Covers domain management, certificate management, route registration, and canary release.</p></li><li><p><strong>Plugin Management</strong>: Users upload plugins via the plugin marketplace, and the gateway platform conducts reviews and deployments.</p></li><li><p><strong>Intelligent Deployment</strong>: Shields underlying cloud differences, supporting automated deployment and public cloud adaptation.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="low-loss-upgrades">Low-Loss Upgrades<a aria-hidden="true" class="hash-link" href="#low-loss-upgrades" title="Direct link to heading">‚Äã</a></h4><p>Frequent plugin changes during regular operations raise concerns about downtime. By detaching APISIX nodes via LB to ensure all traffic is fully offline before upgrading, automated low-loss upgrades is achieved.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="elastic-scaling">Elastic Scaling<a aria-hidden="true" class="hash-link" href="#elastic-scaling" title="Direct link to heading">‚Äã</a></h4><p>To handle high-traffic scenarios, the gateway can be rapidly scaled out and promptly recovered via virtual machines, supporting automatic scaling. For example, when CPU usage exceeds a threshold, machines are automatically scaled out and attached to the load balancer.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="plugin-deployment-and-automation">Plugin Deployment and Automation<a aria-hidden="true" class="hash-link" href="#plugin-deployment-and-automation" title="Direct link to heading">‚Äã</a></h4><ul><li><p><strong>Plugin Deployment</strong>: The management plane is connected to the runtime plane, with configurations pushed to CP for containerized deployment.</p></li><li><p><strong>CP and DP Isolation</strong>: CP and DP connect to the etcd cluster, achieving isolation between the management and runtime planes.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="gateway-practice-in-honors-massive-business">Gateway Practice in Honor&#x27;s Massive Business<a aria-hidden="true" class="hash-link" href="#gateway-practice-in-honors-massive-business" title="Direct link to heading">‚Äã</a></h2><p>Initially, we utilized APISIX&#x27;s native plugins. As business grew and requirements evolved, native plugins became insufficient. Consequently, we expanded plugins based on the platform or user-specific needs, resulting in over 100 plugins to date.</p><p align="center"></p><div class="rc-image" style="width:550"><img loading="lazy" alt="Honor Plugin Ecosystem" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/Pk221A8e_2-honor-plugins-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Plugins are categorized into four groups: traffic control, authentication, security, and observability. Since our clusters are predominantly deployed across dual Availability Zones (AZs) to ensure reliability, this setup introduces cross-AZ latency issues. To address this, the gateway facilitates local routing within the same AZ, ensuring traffic is forwarded to the nearest node.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="1-observability-traffic-mirroring">1. Observability: Traffic Mirroring<a aria-hidden="true" class="hash-link" href="#1-observability-traffic-mirroring" title="Direct link to heading">‚Äã</a></h3><p align="center"></p><div class="rc-image" style="width:700"><img loading="lazy" alt="Honor Traffic Mirroring" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/1wt6a77m_3-traffic-mirror-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="request-processing-and-traffic-mirroring">Request Processing and Traffic Mirroring<a aria-hidden="true" class="hash-link" href="#request-processing-and-traffic-mirroring" title="Direct link to heading">‚Äã</a></h4><p>After a request reaches APISIX, the traffic is forwarded to the upstream service. During this process, the request is mirrored to a third-party asset platform. However, this mirroring operation is blocking, meaning that if the recording platform does not return a response, the client&#x27;s request is blocked. If the recording platform experiences a failure, it can severely impact the stability of production traffic. Therefore, instead of using the built-in mirroring features of NGINX or APISIX, we implemented asynchronous processing through a custom plugin.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="asynchronous-traffic-processing-via-custom-plugin">Asynchronous Traffic Processing via Custom Plugin<a aria-hidden="true" class="hash-link" href="#asynchronous-traffic-processing-via-custom-plugin" title="Direct link to heading">‚Äã</a></h4><ol><li><p>When a request arrives: The request is asynchronously saved to a queue.</p></li><li><p>Upstream processing: APISIX forwards the request to the upstream server. Once the upstream response is returned, the client request process concludes.</p></li><li><p>Asynchronous recording: Asynchronous threads extract requests from the queue and send them to the analytics platform for data recording. Since recording requests include timestamps, asynchronous operations do not affect production traffic.</p></li></ol><p align="center"></p><div class="rc-image" style="width:700"><img loading="lazy" alt="Custom Plugin Implementation" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/7jNxZpWR_4-custom-plugin-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="recording-platform-features">Recording Platform Features<a aria-hidden="true" class="hash-link" href="#recording-platform-features" title="Direct link to heading">‚Äã</a></h4><p>The recording platform is responsible for data collection and supports the following functionalities:</p><ul><li><p>Allowing scaling of the traffic up or down during playback.</p></li><li><p>Adding specific headers to replayed requests, thus facilitating end-to-end stress testing.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="queue-and-thread-optimization">Queue and Thread Optimization<a aria-hidden="true" class="hash-link" href="#queue-and-thread-optimization" title="Direct link to heading">‚Äã</a></h4><p>To ensure system performance, we support configuring queue sizes and thread performance parameters. Although asynchronous forwarding does not directly impact formal requests, excessive asynchronous traffic can still increase APISIX&#x27;s CPU load. Therefore, it is recommended to select optimal parameters based on business requirements to balance performance and recording efficiency.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="2-traffic-scheduling-canary-release-plugin">2. Traffic Scheduling: Canary Release Plugin<a aria-hidden="true" class="hash-link" href="#2-traffic-scheduling-canary-release-plugin" title="Direct link to heading">‚Äã</a></h3><p>We have platformized the canary release feature and optimized the canary release plugin.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="optimized-canary-release-plugin">Optimized Canary Release Plugin<a aria-hidden="true" class="hash-link" href="#optimized-canary-release-plugin" title="Direct link to heading">‚Äã</a></h4><p>Traditionally, canary release plugins support traffic distribution based on predefined rules or percentage-based allocations. However, percentage-based routing can lead to inconsistent traffic assignments; for instance, the same request might be routed to different environments at different times, potentially impacting stability in 2C scenarios.</p><p>To address this, a <code>key-hash</code> plugin is introduced in front of the canary release plugin, combining with the canary release plugin to achieve stable traffic percentage allocation. The specific implementation is as follows:</p><ol><li><p>Supports hash calculation based on specific request headers or Cookies.</p></li><li><p>Uses the hash result as input for the canary release plugin to determine traffic allocation percentages.</p></li></ol><p>This ensures consistent and stable traffic allocation, meeting the business requirements of To C scenarios.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="transformed-end-to-end-canary-release-plugin">Transformed End-to-End Canary Release Plugin<a aria-hidden="true" class="hash-link" href="#transformed-end-to-end-canary-release-plugin" title="Direct link to heading">‚Äã</a></h4><p>In the end-to-end canary release scenario, we have transformed the canary release plugin to achieve precise traffic scheduling. As shown in the diagram below, Service A is in a canary state, while Services B and C are in the production environment. To maintain the current traffic flow from Service A to B while directing the traffic of Service C to the canary environment, this goal is achieved through an API gateway. The specific implementation is as follows:</p><p></p><div class="rc-image"><img loading="lazy" alt="End-to-End Canary Release Plugin Transformation" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/HhJNflQZ_5-canary-plugin-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><ol><li><p><strong>Tag Traffic and Insert Request Header</strong></p><p>a. When traffic passes through the APISIX API gateway, it is tagged based on canary release policies.</p><p>b. If the traffic is canary traffic, the gateway inserts a specific request header (e.g., honor-tag:gray) into the request to indicate it as canary traffic.</p></li><li><p><strong>Register and Tag Service</strong></p><p>a. When Service A registers with the registration center, it also registers its canary tag (e.g., gray).</p><p>b. The registration center maintains the mapping between service canary tags and instances.</p></li><li><p><strong>Service-to-Service Scheduling</strong></p><p>a. Service A calling Service B:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">i. After receiving a request, Service A first checks </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> the request contains a canary tag </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e.g., honor-tag:gray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ii. If the request includes a canary tag, Service A retrieves Service B&#x27;s canary instances from the registration center based on the tag and prioritizes scheduling to canary instances.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iii. If Service B has no canary instances, it falls back to scheduling production instances.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>b. Service B calling Service C:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">i. After receiving the canary tag </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e.g., honor-tag:gray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> passed from Service A, Service B retrieves Service C&#x27;s canary instances from the registration center based on the tag.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ii. If Service C has canary instances, the request is scheduled to the canary instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> otherwise, it is scheduled to a production instance.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div></li><li><p><strong>End-to-End Canary Release</strong></p><p>a. Through the transparent transmission of request headers (e.g., honor-tag:gray), the canary tag remains consistent throughout the service chain.</p><p>b. Each node in the service chain makes scheduling decisions based on the canary tag, enabling end-to-end canary release.</p></li></ol><p>Through these transformations, we have achieved precise traffic scheduling for end-to-end canary releases, ensuring consistency and stability of canary traffic across the entire service chain.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="3-rate-limiting-and-security">3. Rate Limiting and Security<a aria-hidden="true" class="hash-link" href="#3-rate-limiting-and-security" title="Direct link to heading">‚Äã</a></h3><p>APISIX offers rich plugins covering single-node rate limiting and distributed rate limiting solutions. Below are optimization practices for the single-node rate-limiting solution.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="31-rate-limiting">3.1 Rate Limiting<a aria-hidden="true" class="hash-link" href="#31-rate-limiting" title="Direct link to heading">‚Äã</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="single-node-rate-limiting">Single-Node Rate Limiting<a aria-hidden="true" class="hash-link" href="#single-node-rate-limiting" title="Direct link to heading">‚Äã</a></h5><p><strong>Background and Challenges</strong></p><p>Initially, when adopting the single-node rate limiting solution, we encountered several challenges.</p><ol><li><p>If users needed to set a global rate limit (e.g., 4,000 QPS), they had to manually coordinate with platform administrators to confirm the number of gateway nodes and allocate the rate limit value accordingly (e.g., 2,000 QPS per node for two nodes). This process was cumbersome and error-prone.</p></li><li><p>In the elastic scaling scenario, when the gateway triggers scaling up or down, there may be a mismatch in the throttling values. For example, the CPU usage reached 80%, triggering an automatic scale-out. Assume each node was initially configured with a 2000 QPS limit; increasing the node count to three would inadvertently raise the total rate limit to 6000 QPS. This could overwhelm backend services, leading to potential system anomalies.</p></li></ol><p align="center"></p><div class="rc-image" style="width:500"><img loading="lazy" alt="Single-Node Rate Limiting" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/GzaePNL2_6-rate-limiting-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><p><strong>Solution</strong></p><p>To address these issues, we implemented the following solutions:</p><p align="center"></p><div class="rc-image" style="width:500"><img loading="lazy" alt="Upgraded Single-Node Rate Limiting Solution" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/9egDM2V0_7-rate-limiting-upgrade-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><ol><li><p><strong>Node Reporting and Maintenance</strong></p><p>a. Implementation: Utilizing the <code>server-info</code> plugin of APISIX, each DP node&#x27;s information, such as hostname, is written to etcd as a leased key at regular intervals.</p><p>b. &quot;Heartbeat Mechanism&quot;: By periodically updating (similar to a heartbeat mechanism), etcd consistently maintains all active DP node information in the API gateway.</p></li><li><p><strong>Dynamic Rate Limiting Calculation</strong></p><p>a. Plugin Development: A new plugin periodically retrieves all the node information from etcd to determine the total number of gateway nodes.</p><p>b. Excluding CP Nodes: Due to control plane nodes do not handle traffic, only count the number of DP nodes.</p><p>c. Dynamic Rate Limit Adjustment: During rate limiting, the plugin dynamically calculates the base rate limit each node should handle, ensuring the rate limit aligns with the actual number of nodes.</p></li><li><p><strong>Performance Optimization</strong></p><p>a. Privileged Process Pulling: Only privileged processes are allowed to periodically retrieve gateway information from etcd, reducing etcd load and minimizing APISIX overhead.</p><p>b. Shared Memory Mechanism: Privileged processes write retrieved data to shared memory, and other processes periodically query shared memory to obtain node information.</p></li><li><p><strong>Plugin Abstraction and Reuse</strong></p><p>a. Common Plugin Abstraction: The dynamic rate limiting optimization capability is abstracted into a common plugin, providing a unified interface.</p><p>b. Plugin Reuse: Many internal plugins (e.g., fixed window rate limiting, custom performance plugins) can query the number of nodes from shared memory and dynamically adjust configurations to meet optimization requirements.</p></li></ol><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="distributed-rate-limiting">Distributed Rate Limiting<a aria-hidden="true" class="hash-link" href="#distributed-rate-limiting" title="Direct link to heading">‚Äã</a></h5><p>The open-source APISIX community also provides a distributed rate-limiting solution.</p><p><strong>Background and Challenges</strong></p><p>When applying the open-source distributed rate limiting solution, we encountered the following key issues:</p><ol><li><p><strong>Redis Performance Bottleneck</strong>: In scenarios where rate limiting is applied using a single key, particularly when the rate limit rule targets an entire route rather than specific route characteristics, the Redis key becomes overly singular. This leads to all requests being directed to the same Redis shard, preventing effective load balancing through horizontal scaling.</p></li><li><p><strong>Network Performance Overhead</strong>: Frequent Redis requests result in a significant increase in CPU usage, with utilization rising by over 50%.</p></li><li><p><strong>Increased Request Latency</strong>: Open-source distributed rate limiting solutions typically require accessing Redis to complete counting before forwarding the request upstream. This process adds 2‚Äì3 milliseconds to the latency of business requests.</p></li></ol><p align="center"></p><div class="rc-image" style="width:500"><img loading="lazy" alt="Distributed Rate Limiting" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/XLwUO4Gc_8-distributed-rate-limiting-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><p><strong>Solution</strong></p><p>To address these issues, we designed the following optimizations:</p><p align="center"></p><div class="rc-image" style="width:500"><img loading="lazy" alt="Upgraded Distributed Rate Limiting Solution" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/J4Ie3Hkg_9-distributed-rate-limiting-upgrade-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><ol><li><p><strong>Introducing Local Counting Cache</strong>:</p><p>a. <strong>Local Counting Mechanism</strong>: When a request arrives, a count is first deducted from the local counting cache. If the count does not reach zero, the request is allowed to proceed.</p><p>b. <strong>Asynchronous Synchronization Mechanism</strong>: The local count is periodically synchronized with Redis asynchronously. The number of requests between two synchronization periods is counted and deducted from Redis. After synchronization, the Redis count overrides the local cache, ensuring consistency in distributed rate limiting.</p></li><li><p><strong>Error Control</strong>: By applying reasonable formulas and parameter configurations, the error rate is controlled within 3‚Äì4%, ensuring rate limiting accuracy meets business requirements.</p></li></ol><p><strong>Applicable Scenarios</strong></p><ul><li><p><strong>High QPS Applications</strong>: This solution is suitable for high QPS applications, significantly reducing Redis performance bottlenecks and network overhead.</p></li><li><p><strong>Low QPS Applications</strong>: For low QPS applications (e.g., a few hundred QPS), the existing distributed rate limiting solution generally meets requirements without additional optimization.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="32-high-reliable-circuit-breaker-plugin">3.2 High-Reliable Circuit Breaker Plugin<a aria-hidden="true" class="hash-link" href="#32-high-reliable-circuit-breaker-plugin" title="Direct link to heading">‚Äã</a></h4><p><strong>Background and Challenges</strong></p><p>Although the open-source community provides a circuit breaker plugin, evaluation revealed it does not meet internal requirements in two aspects:</p><ol><li><p><strong>Lack of Failure Rate Support</strong>: The open-source circuit breaker plugin strategy does not support circuit breaking based on failure rates.</p></li><li><p><strong>State Transition</strong>: The circuit breaker plugin has only on/off states, which may allow a large number of requests to pass during state transitions, exacerbating upstream service degradation and potentially collapsing the gateway due to upstream response timeouts.</p></li></ol><p><strong>Custom Circuit Breaker Plugin</strong></p><p>To address these issues, Honor developed a new circuit breaker plugin based on APISIX. Its design features include:</p><p></p><div class="rc-image"><img loading="lazy" alt="Custom Circuit Breaker Plugin" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/OtD0QeE2_10-circuit-breaking-plugin-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><ol><li><p><strong>Percentage-Based Circuit Breaking Strategy</strong>: Supports circuit breaking based on percentages, offering finer control.</p></li><li><p><strong>Three-State Control Mechanism</strong>:</p><p>a. Closed State: All requests are allowed to pass.</p><p>b. Open State: All requests are rejected until the circuit breaker time expires.</p><p>c. Half-Open State: A limited number of requests are allowed to pass to assess whether upstream services have recovered.</p></li><li><p><strong>Silent Count Mechanism</strong>: The concept of a silent count is introduced to prevent state transitions triggered by a small number of requests. Only when the request count reaches the silent count and the failure rate exceeds the threshold does the state transition to open.</p></li></ol><p><strong>State Transition Process</strong></p><ul><li><p><strong>Closed to Open</strong>: When the request count reaches the silent count and the failure rate exceeds the threshold, the circuit breaker transitions to the open state.</p></li><li><p><strong>Open to Half-Open</strong>: After the circuit break time expires, the state transitions to half-open.</p></li><li><p><strong>Half-Open to Closed</strong>: In the half-open state, if the number of allowed requests reaches the configured value and upstream services recover, the state transitions to closed; if the failure rate remains high or there is no response, it reverts to the open state.</p></li></ul><p><strong>Design Updates Based on Sentinel</strong></p><ul><li><p><strong>Window Mechanism</strong>: Unlike Sentinel&#x27;s sliding window, we adopted a fixed window focused on failure rates within a time period, simplifying implementation and reducing performance overhead.</p></li><li><p><strong>Architecture Adaptation</strong>: To accommodate NGINX&#x27;s multi-process architecture, shared memory was introduced to store state, ensuring consistent behavior across workers and avoiding the complexity and performance costs associated with sliding windows.</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="33-enhance-reliability-with-bypass-waf">3.3 Enhance Reliability with Bypass WAF<a aria-hidden="true" class="hash-link" href="#33-enhance-reliability-with-bypass-waf" title="Direct link to heading">‚Äã</a></h4><p><strong>Limitations of Inline WAF</strong></p><p>As shown in the left architecture diagram, traditional WAFs require modifying DNS records to route traffic to the WAF. After inspecting and filtering the traffic, WAFs forward it back to the origin server. However, this architecture is prone to single points of failure. If the WAF itself encounters a malfunction, it can disrupt the entire traffic flow, adversely affecting business operations.</p><p></p><div class="rc-image"><img loading="lazy" alt="Upgraded Bypass WAF Solution" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/13/RQXL4gUx_11-waf-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><p><strong>Bypass WAF</strong></p><p>To resolve this issue, Honor, in collaboration with <a href="https://api7.ai/" target="_blank" rel="noopener noreferrer">API7.ai</a> and Tencent Cloud, implemented a bypass WAF architecture:</p><ol><li><p><strong>Optimized Traffic Path</strong>: Traffic no longer needs to pass through the WAF; instead, it is directed straight to the APISIX cluster.</p></li><li><p><strong>Traffic Splitting for Detection</strong>: Within the APISIX cluster, a portion of the traffic is forwarded to the WAF for inspection to determine whether it is normal or contains malicious attacks (e.g., egress attacks and command egress attacks).</p></li><li><p><strong>Status Code Response Mechanism</strong>:</p><p>a. If the WAF detects normal traffic, it returns a <code>200</code> status code, allowing the request to pass through to the upstream server.</p><p>b. If the WAF detects malicious attacks, it returns a status code similar to <code>403</code>, rejecting the request.</p></li><li><p><strong>Fault Tolerance</strong>: If the WAF fails, traffic can be directly forwarded to the backend, preventing link interruption due to WAF failure and enhancing overall link reliability.</p></li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="performance-and-cost-optimization">Performance and Cost Optimization<a aria-hidden="true" class="hash-link" href="#performance-and-cost-optimization" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="performance-optimization">Performance Optimization<a aria-hidden="true" class="hash-link" href="#performance-optimization" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="health-checker-optimization">Health Checker Optimization<a aria-hidden="true" class="hash-link" href="#health-checker-optimization" title="Direct link to heading">‚Äã</a></h4><p><strong>Background and Challenges</strong></p><p>In high-traffic internal business scenarios, with over a thousand upstream nodes, frequent rolling updates triggered the destruction and creation of health checkers. This led to significant CPU usage spikes.</p><ol><li><p>Upstream Destruction and Creation: Upon upstream updates, health checkers were destroyed. Health checkers are only probed when client requests arrive; if they do not exist, they are immediately created.</p></li><li><p>Node-by-Node Addition: During creation, all nodes had to be traversed and individually added to the health checker&#x27;s shared memory. This process involved extensive locking operations and memory writes, resulting in significant performance degradation.</p></li></ol><p><strong>Solutions</strong></p><ol><li><p><strong>Delayed Destruction</strong>: During upstream updates, health checkers are temporarily not destroyed but merely lose their references, reducing performance overhead from frequent destruction and creation.</p></li><li><p><strong>Caching Mechanism</strong>: When creating health checkers, they are cached with their creation time recorded. Subsequent requests first check if the health checker exists. If not, the cache is replenished. If not expired, it is directly returned; if expired, it is recreated.</p></li><li><p><strong>Batch Updates</strong>: All upstream nodes are batch-updated to the health checker&#x27;s shared memory, reducing the overhead of node-by-node operations.</p></li><li><p><strong>Concurrency Control</strong>: A concurrency control mechanism is introduced to ensure only one worker is responsible for creating health checkers at any given time, preventing multiple workers from performing the same operation simultaneously and significantly reducing CPU consumption.</p></li></ol><p><strong>Results</strong></p><p>In scenarios involving frequent updates of 2,000 upstream nodes, the optimized approach resulted in only a ~2% increase in CPU usage, a substantial improvement compared to the previous 20% increase. This demonstrates a significant reduction in performance overhead and highlights the effectiveness of the optimization.</p><p></p><div class="rc-image"><img loading="lazy" alt="Health Checker Optimization" class="rc-image-img" src="https://static.api7.ai/uploads/2025/05/14/Y80U5dQy_optimized-health-checker-2.webp"><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="cost-optimization">Cost Optimization<a aria-hidden="true" class="hash-link" href="#cost-optimization" title="Direct link to heading">‚Äã</a></h4><p>Cost optimization primarily focuses on three aspects: traffic compression, static single-line EIP transformation, and gateway scaling.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="traffic-compression">Traffic Compression<a aria-hidden="true" class="hash-link" href="#traffic-compression" title="Direct link to heading">‚Äã</a></h4><p><strong>Background</strong></p><p>Through statistics on gateway costs, approximately three-quarters of the total cost is attributed to traffic costs. Therefore, our optimization efforts first target traffic reduction.</p><p><strong>Solutions</strong></p><p>Honor provides compression plugins such as br and gzip, supporting dynamic compression. These plugins are user-friendly; businesses only need to include a compression identifier in the request, and clients and browsers typically support decompression.</p><p><strong>Results</strong></p><p>In cloud providers&#x27; LB billing models, traffic volume is the primary billing factor. By using compression plugins, LB costs and EIP bandwidth costs can be reduced, with a maximum compression rate exceeding 70%, significantly lowering traffic costs.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="static-single-line-eip-transformation">Static Single-Line EIP Transformation<a aria-hidden="true" class="hash-link" href="#static-single-line-eip-transformation" title="Direct link to heading">‚Äã</a></h4><p><strong>Background</strong></p><p>BGP EIP bandwidth costs are prohibitively high.</p><p><strong>Solutions</strong></p><ol><li><p>Configure a static single-line EIP for gateway clusters, supplemented by a backup BGP EIP.</p></li><li><p>Use DNS intelligent resolution to direct mainstream carrier routes to corresponding single-line EIPs.</p></li></ol><p><strong>Results</strong></p><p>Single-line EIP costs are one-third of BGP EIP costs, saving approximately two-thirds of public network bandwidth expenses.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="gateway-scaling">Gateway Scaling<a aria-hidden="true" class="hash-link" href="#gateway-scaling" title="Direct link to heading">‚Äã</a></h4><p><strong>Optimization</strong></p><p>Implement elastic gateway scaling based on CPU and memory utilization.</p><p><strong>Results</strong></p><p>Ensure resource utilization remains within a reasonable range to avoid resource waste or insufficiency.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">‚Äã</a></h2><p>Since adopting APISIX in 2021, Honor has developed a high-performance, scalable, and reliable API gateway to support the rapid growth of its extensive business through continuous optimization and expansion. The following are the achievements of Honor using Apache APISIX:</p><ul><li><p><strong>Traffic Handling</strong>: Honor&#x27;s API gateway has evolved from pilot deployments to comprehensive coverage, handling peak traffic volumes reaching millions of QPS.</p></li><li><p><strong>Plugins</strong>: To meet diverse business requirements, Honor has developed nearly 100 custom plugins.</p></li><li><p><strong>Architecture Stability and Scalability</strong>: Through optimizations such as internal and external network protocol supports, load balancer upgrades, and plugin marketplace development, the platform&#x27;s stability and scalability have been enhanced.</p></li><li><p><strong>Features</strong>: optimizations such as canary releases, rate limiting, circuit breaking, and bypass WAF architecture ensure precise traffic scheduling and enhance reliability.</p></li><li><p><strong>Performance</strong>: Health checker optimizations and concurrency control significantly lower CPU usage.</p></li><li><p><strong>Cost</strong>: Strategies like traffic compression, EIP transformation, and scaling techniques substantially reduce expenses.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="future-outlook">Future Outlook<a aria-hidden="true" class="hash-link" href="#future-outlook" title="Direct link to heading">‚Äã</a></h2><p>Moving forward, Honor plans to integrate artificial intelligence into its API gateway platform to enhance intelligent traffic management and decision-making processes. Additionally, through innovative approaches such as containerized auto-reporting mechanisms, Honor aims to help internal teams achieve efficient resource management and business deployment in Kubernetes environments.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/case-studies/">Case Studies</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2025/04/30/2025-april-monthly-report/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">2025 Monthly Report (April 01 - April 30)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2025/04/21/host-mcp-server-with-api-gateway/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">From stdio to HTTP SSE: Host Your MCP Server with APISIX API Gateway</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright ¬© 2019-2026 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js"></script>
</body>
</html>