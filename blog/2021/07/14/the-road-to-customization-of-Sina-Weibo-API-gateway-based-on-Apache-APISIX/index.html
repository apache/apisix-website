<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/releases/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/releases/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIX¬Æ --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">The Road to Customized Development of Sina Weibo API Gateway | Apache APISIX¬Æ --  Cloud-Native API Gateway</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org/img/favicon.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org/img/favicon.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" property="og:title" content="The Road to Customized Development of Sina Weibo API Gateway | Apache APISIX¬Æ --  Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="Sina Weibo‚Äôs previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business."><meta data-react-helmet="true" property="og:description" content="Sina Weibo‚Äôs previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business."><meta data-react-helmet="true" name="keywords" content="Apache APISIX,Sina,Weibo,Usser Case,API Gateway"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-07-14T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="User Case"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/css/styles.0ee3ec58.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/runtime~main.ed0e6747.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/main.21312ad3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">ü§î Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ">join #apisix channel</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/security">General</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">FAQ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/FAQ/">Apache APISIX¬Æ</a></li><li><a class="dropdown__link" href="/docs/dashboard/FAQ/">Apache APISIX¬Æ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/FAQ/">Apache APISIX¬Æ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/FAQ/">Apache APISIX¬Æ Helm Chart</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/releases">Releases</a></li><li><a class="dropdown__link" href="/help">Help</a></li></ul></div><a class="navbar__item navbar__link" href="/showcase">Showcase</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/16/weekly-report-1114">Weekly ReportÔΩú11.1-11.4 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/12/apisix-datadog">Cloud Monitoring with Datadog in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/04/skywalking">The observability of Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/03/airwallex-usercase">How Apache APISIX protects Airwallex data sovereignty through the gateway layer</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/02/weekly-report-1031">Weekly ReportÔΩú10.15-10.31 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/29/Extension-guide">Apache APISIX Extensions Guide</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/26/APISIX-Ingress">From 0 to 1, How APISIX Ingress Has Grown and Gained Since Joining The Community</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/22/cert-manager-in-ingress">Tutorial: How to use Cert Manager to manage certificates in Apache APISIX Ingress Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/18/meetup">Webinar | Apache APISIX √ó Apache SkyWalking Online Meetup</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/14/weekly-report-1014">Community WeeklyÔΩú10.1-10.14 Feature Highlight Updates in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/13/celebrating-300-contributors-of-apisix">New milestone for the Apache APISIX community - over 300 contributors worldwide!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/09/apisix-ingress-techblog">A thoughtful tutorial to get started with Apache APISIX Ingress from concept to practice</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/01/openEuler">Apache APISIX community members help openEuler release first community innovation version</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/30/weekly-report">Community WeeklyÔΩúNew committer, feature highlight update in progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/29/release-apache-apisix-2.10">Release Apache APISIX 2.10.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/28/WPS-usercase">WPS has teamed up with Apache APISIX to create a new gateway experience</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/24/youpaicloud-usercase">Why is Apache APISIX Ingress a new option for building container gateways into the UPYUN?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/18/xiaodian-usercase">Apache APISIX helps DIAN to facilitate cloud native solution</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/16/tencent-cloud">Implementing Apache APISIX in Tencent Cloud TI-ONE Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/15/weekly-report">Community WeeklyÔΩúTwo new committers, feature highlight updates in progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/14/youzan">Apache APISIX powers the Youzanyun native PaaS platform for comprehensive micro-service governance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/13/china-mobile-cloud-usercase">How Apache APISIX is implemented in China Mobile Cloud</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/09/how-to-contribute-to-an-OpenSource-without-coding">How can I contribute to an open source project without writing code?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/how-to-use-apisix-auth">Centralized Authentication with Apache APISIX and Advanced Tricks</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/iQIYI-usercase">Based on Apache APISIX, iQIYI API Gateway Update and landing practice</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/06/python-helps-you-quickly-with-Apache-APISIX-development">Python helps you develop Apache APISIX plugin</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/31/Apache APISIX √ó KubeSphere-a-better-gateway-and-K8S-Ingress-Controller">Apache APISIX √ó KubeSphere: Providing a better gateway and K8S Ingress Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/Ingress-Meeting">WebinarÔΩú See you at the Apache APISIX Ingress Community Meeting on Wednesday at 2pm!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/weekly-report">Apache APISIX Community Weekly Report ÔΩú 2021 8.23-8.29</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/27/release-apache-apisix-2.9">Release Apache APISIX 2.9</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Auth-with-Casbin-in-Apache-APISIX">Authorization with Casbin in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">Centralized authentication using the OpenID Connect plug-in for Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua">Why Apache APISIX chose Nginx and Lua to build API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/24/shanghai-meetup-recap">Apache APISIX Meetup in Shanghai</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/ApacheCon-Asia-2021">ApacheCon Asia 2021</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/weekly-report">Apache APISIX Á§æÂå∫Âë®Êä• ÔΩú 2021 8.16-8.22</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/21/shanghai-meetup">August 21 Apache APISIX Meetup Shanghai, welcome to register!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/go-makes-Apache-APISIX-better">Go gives Apache APISIX a run for its money</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/weekly-report">Apache APISIX Á§æÂå∫Âë®Êä• ÔΩú 08-09 ÔΩû 08-15</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/18/Auth-with-Casbin-in-Apache-APISIX">Licensing with Casbin in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/17/interview-airwallex">Apache APISIX in Airwallex | Interview with Yang Li, Head of Airwallex Technology Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/16/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">Using the Apache APISIX OpenID Connect Plugin for Okta Centralized Authentication</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/14/contributors-the-golden-metric-of-openSource-projects">Contributors ‚Äî The Golden Metric of OpenSource Projects</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/12/Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability">Chaos Mesh Helps Apache APISIX Improve System Stability</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/11/interview-TuZhengsong">I issued my first PR in the Apache APISIX community</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/10/apisix-nginx">Apache APISIX Architecture Analysis: How to Dynamically Manage Nginx Clustering?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-China-Mobile-Cloud">Apache APISIX Âú®ÁßªÂä®‰∫ëÁöÑÂ∫îÁî®</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-Quliankeji">ËàçÂºÉ Kong Âíå NginxÔºåApache APISIX Âú®Ë∂£ÈìæÁßëÊäÄ BaaS Âπ≥Âè∞ÁöÑËêΩÂú∞ÂÆûË∑µ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx">How to Improve the Observability of Nginx with Apache APISX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/05/Kong-to-APISIX">Kong-To-APISIX Migration Tool</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/28/release-apache-apisix-2.8">Release Apache APISIX 2.8.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/27/use-of-plugin-orchestration-in-Apache-APISIX">Applying Plugin Orchestration in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/25/apachecon-asia">ApacheCon Asia 2021: Apache APISIX Technical Topics</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/21/Apache-APISIX-Kubernetes">Apache APISIX x Kubernetes: Just RightÔΩúLive</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX">The Road to Customized Development of Sina Weibo API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/06/celebrate-200-contributors">Apache APISIX has over 200 contributors in GitHub main repo! </a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/30/etcd3-support-HTTP-access-perfectly">Does etcd 3 Support HTTP Access Perfectly?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/29/release-apache-apisix-2.7">Release Apache APISIX 2.7.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/28/why-we-need-Apache-APISIX">Why do you need Apache APISIX when you have NGINX and Kong?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast">Deploy Apache APISIX and Apache APISIX Ingress Controller on Rancher</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins">How to Write an Apache APISIX Plugin in Java</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released">The first GA release of Apache APISIX Ingress Controller v1.0 is now available!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/17/Apache-APISIX-Dashboard-Access-Control-Bypass-Vulnerability-Announcement">Apache APISIX Dashboard Access Control Bypass Vulnerability Advisory (CVE-2021-33190)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/16/Chaos-Mesh-helps-Apache-APISIX-improve-stability">Chaos Mesh Helps Apache APISIX Improve Stability</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/10/Apache-APISIX-and-Envoy-performance-comparison">Apache APISIX v.s Envoy: Which Has the Better Performance?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/07/Apache-APISIX-not-affected-by-NGINX-CVE-2021-23017">Apache APISIX not affected by NGINX CVE-2021-23017</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/06/apisix-two-years">Apache APISIX Open Source 2 Year Anniversary!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/03/experience-share-from-Apache-APISIX-committer">Experience sharing from Apache APISIX committer - Interview with Summer of Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/25/Apache APISIX 2.6.0-Release">Apache APISIX 2.6.0-Release Officially Released</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/24/Tencent-Games">ÊîØÊåÅ 10 ‰∫øÊó•ÊµÅÈáèÁöÑÂü∫Á°ÄËÆæÊñΩÔºöÂΩì Apahce APISIX ÈÅá‰∏äËÖæËÆØ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/02/get-front-end-test-coverage-with-cypress">Get Front-End Test Coverage with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/26/install-apache-apisix-from-helm-charts">Install Apache APISIX from Helm Charts</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/11/interview-Apache-APISIX-contributor-Wang-Pengcheng-Senior-Security-Advisor-of-PwC-South-China-Data-Security-and-Privacy-Protection-Team">Apache APISIX Contributor Interview | Pengcheng Wang, Senior Security Consultant, PricewaterhouseCoopers China Data Security &amp; Privacy Team</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/18/first-look-at-kubernetes-service-api">A First Look at Kubernetes Service APIs</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix">Ë¥ùÂ£≥ÊâæÊàøÔºöÂ¶Ç‰ΩïÂü∫‰∫é Apache APISIX Êê≠Âª∫ÁΩëÂÖ≥</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">The Road to Customized Development of Sina Weibo API Gateway</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-07-14T00:00:00.000Z" itemprop="datePublished">July 14, 2021</time> ¬∑ 13 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Yong Nie</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Sina Weibo‚Äôs previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business.</p></blockquote><p>Sina Weibo‚Äôs previous HTTP API gateway was built based on Nginx, and all routing rules were stored in Nginx configuration files, which brought a series of problems: long upgrade steps, inflexibility and difficulty in troubleshooting problems when adding, deleting, changing or tracking services. After some research, we chose the closest expected, cloud-based micro-service API gateway: Apache APISIX, which is dynamic, efficient and stable to meet the rapid response requirements of the business.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="background-information"></a>Background Information<a class="hash-link" href="#background-information" title="Direct link to heading">#</a></h2><p>In Sina Weibo, if an operation engineer wants to create an API service, he/she needs to write it in the Nginx configuration file first, submit it to the git code repository, and wait for other operation engineer responsible for the online checkout to confirm the success of the audit before they can push the deployment to the line, and then brutally notify Nginx to reload it, and only then is the service change successful.</p><p>The whole process is long and inefficient, and cannot meet the trend of low-code DevOps operation and maintenance. Therefore, we expect to have a management backend portal, where operation engineer can operate all the http api routing and other configurations in the UI interface.</p><p><img src="https://user-images.githubusercontent.com/23514812/125594900-d4c01fb7-3af4-4e8c-8779-f3f16b7f0bca.png" alt="Sina Weibo Publish Process"></p><p>After some research, we chose the closest to the expected cloud-based micro-services API gateway: Apache APISIX.</p><ol><li>Based on Nginx, the technology stack is unified before and after the grayscale upgrade, security, stability, etc. are guaranteed.</li><li>Built-in unified control surface, unified management of multiple proxy services.</li><li>Dynamic API call, you can complete the common resource modifications in real time, compared to the traditional Nginx configuration + reload way progress is obvious.</li><li>Rich routing options to meet the needs of Sina Weibo routing.</li><li>Good scalability, support Consul kv.</li><li>Good performance.</li></ol><p><img src="https://user-images.githubusercontent.com/23514812/125596483-aee21ac7-a902-4e44-abc4-8bfda4f51f82.png" alt="Apache APISIX Architecture"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="why-did-we-choose-custom-development"></a>Why Did We Choose Custom Development?<a class="hash-link" href="#why-did-we-choose-custom-development" title="Direct link to heading">#</a></h2><p>In the actual business situation, we cannot use Apache APISIX directly for the following reasons.</p><ol><li>Apache APISIX does not support SaaS multi-tenancy, and there are many upper-layer applications that actually need to be operated and maintained, and each business line development or operation and maintenance student only needs to manage and maintain their own rules, upstreams and other rules, which are not associated with each other.</li><li>When the routing rules are published online, they need fast roll back support if problems arise.</li><li>When creating or editing existing routing rules, we are not so sure about publishing them directly to the wire, and then we need it to be able to support grayscale publishing to a specified gateway instance for simulation or local testing.</li><li>The need for API gateways to be able to support Consul KV-style service registration and discovery mechanisms.</li></ol><p>None of these requirements are currently supported built-in by Apache APISIX, so custom development is the only way to make Apache APISIX truly usable within Weibo.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="what-did-we-change-in-the-control-plane-of-apache-apisix"></a>What Did We Change in the Control Plane of Apache¬†APISIX?<a class="hash-link" href="#what-did-we-change-in-the-control-plane-of-apache-apisix" title="Direct link to heading">#</a></h2><p>For our custom development, we used Apache APISIX version 1.5, and Apache APISIX Dashboard compatible with Apache APISIX version 1.5.</p><p>The goal of custom development is simple and clear, that is, completely zero code, UI, all seven layers of HTTP API service creation, editing, updating, up and down and all other actions must be done on the Dashboard. Therefore, in the actual environment, we forbid development and operation and operation engineer to call APISIX Admin API directly. If we skip the Dashboard and call APISIX Admin API directly, it will lead to the gateway operation not being audited at the UI level, so we cannot take the workflow, and naturally, there is not much security to speak of.</p><p>There is a slightly special case, operations and maintenance need to call the API to complete the bulk import of services, you can call the H5 Dashboard API to complete, so as to comply with the unified workflow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="support-saas-based-services"></a>Support Saas-based Services<a class="hash-link" href="#support-saas-based-services" title="Direct link to heading">#</a></h3><p>A complete database of product lines and business lines is available at the enterprise level, and each specific product line and business line can be represented by a saas_id value. Then, before creating the gateway configuration data for insertion into the ETCD, a saas_id value is plugged in and all the data has a SaaS attribution in terms of logical attributes.</p><p>Users, roles and the actual product line of operation are then associated with the following correspondence.</p><p><img src="https://user-images.githubusercontent.com/23514812/125596630-15444f25-0bcb-4f2f-8fd2-7bef6faf6f4e.png" alt="Users, roles and product association"></p><p>A user can be assigned to undertake different operations and maintenance roles to manage and maintain different product lines of services.</p><p>The administrator role is very easy to understand, the core role of operation and maintenance services, for service addition / deletion / update / check; in addition, we have the concept of read-only users, read-only users are generally used to view the service configuration, view the workflow, debugging and so on.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="add-audit-function"></a>Add Audit Function<a class="hash-link" href="#add-audit-function" title="Direct link to heading">#</a></h3><p><img src="https://user-images.githubusercontent.com/23514812/125596773-6ebbb1f2-1287-418b-a5f0-1fc85c9e8e9f.png" alt="Audit Function1"></p><p>In the open source version, a route can be published directly after it is created or modified.</p><p>In our custom version, after a route is created or modified, it needs to go through an audit workflow before it can be published, which lengthens the process, but we think it is more credible to publish after the authorization is reviewed at the enterprise level.</p><p><img src="https://user-images.githubusercontent.com/23514812/125596844-7e3f057e-1dc4-4c3e-8d91-2b2c3d8e780f.png" alt="Audit Function2"></p><p>When creating routing rules, they must be reviewed by default. To take into account efficiency, when entering new services, you can choose the no-review, fast-publishing channel and click the publish button directly.</p><p><img src="https://user-images.githubusercontent.com/23514812/125596916-e3a7c3e6-7201-4b37-89b5-bacbbb6f4a9d.png" alt="Audit Function3"></p><p>When an important API route has problems after a certain adjustment rule release goes live, you can select the previous version of the routing rule for a quick roll back, with the granularity of a single route roll back that will not affect other routing rules.</p><p>The internal processing flow of a single route roll back is shown in the following figure.</p><p><img src="https://user-images.githubusercontent.com/23514812/125596979-74aa252c-3a84-44e5-a62a-6d9e254de859.png" alt="Audit Function4"></p><p>We need to create version database storage for each release of a single route. This way, when we do a full release after the audit, each release will generate a version number and the corresponding full configuration data; then the version list grows. When we need to roll back, go to the version list and select a corresponding version to rollback; in a sense, the roll back is actually a special form of full release.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="support-grayscale-release"></a>Support Grayscale Release<a class="hash-link" href="#support-grayscale-release" title="Direct link to heading">#</a></h3><p>Our custom-developed grayscale release feature is different from what the community generally understands as grayscale release, and is less risky compared to full deployment. When a change to a routing rule is large, we can choose to publish and take effect only on a specific limited number of gateway instances, instead of publishing and taking effect on all gateway instances, thus reducing the scope of the release, lowering the risk, and enabling fast trial and error.</p><p>Although grayscale release is a low-frequency behavior, there is still a state transition between it and full volume release.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597330-b3dde9ba-28f3-4899-9f4f-53b89131e653.png" alt="Support Grayscale Release1"></p><p>When the percentage of gray release decreases to 0%, it is the state of full release; when the gray release rises to 100%, it is the next full release, and this is its state transition.
The full grayscale publishing feature requires some API support exposed on the gateway instance in addition to the administrative backend support.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598577-bcf2b13d-031a-440c-9480-c68d41d5ca9c.png" alt="Support Grayscale Release2"></p><p>The above screenshot shows the screenshot when operating Grayscale Publishing to select a specific gateway instance.</p><p>The full grayscale publishing feature requires some API support exposed on the gateway instance in addition to the administrative backend support.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597285-cf3c9145-adc6-4fa4-979e-124ea8f376b5.png" alt="Support Grayscale Release3"></p><p>Grayscale publishing API fixed URI, the unified path is /admin/services/gray/{SAAS_ID}/ routes. Different HTTP Method presents different business meanings, POST means create, DELETE means to stop grayscale, GET means to view.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="activation-process"></a>Activation Process<a class="hash-link" href="#activation-process" title="Direct link to heading">#</a></h4><p><img src="https://user-images.githubusercontent.com/23514812/125597454-e4ad004e-9f04-495d-bb93-33c4b9942d4d.png" alt="Activation Process"></p><p>An API is published from the gateway level, and after receiving the data the worker process checks the legitimacy of the data sent, and the legitimate data is broadcast to all worker processes via events. Then the grayscale publishing API is called and the grayscale rules are added and take effect when the next request is processed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="deactivation-process"></a>Deactivation Process<a class="hash-link" href="#deactivation-process" title="Direct link to heading">#</a></h4><p><img src="https://user-images.githubusercontent.com/23514812/125597537-99270698-992a-4f58-91b4-06067f4d44d2.png" alt="Deactivation Process"></p><p>The deactivation process is basically the same as the grayscale distribution process. The API for grayscale distribution is called by the DELETE method and broadcasted to all work processes. If it exists in the route table, delete it and try to restore it from the ETCD. If the grayscale is deactivated, make sure that the original ETCD can be restored without affecting the normal service.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="support-fast-import"></a>Support Fast¬†Import<a class="hash-link" href="#support-fast-import" title="Direct link to heading">#</a></h3><p>In addition to supporting the creation of routes on the management page, many operation engineer are still more accustomed to using scripts to import. We have a large number of HTTP API services, and it would be very time-consuming to manually enter them one by one. If you import through scripts, you can reduce a lot of service migration resistance.</p><p>By exposing the Go Import HTTP API for the management backend, the operation engineer can fill in the assigned token, SaaS ID and related UIDs in the ready-made Bash Script file to import the services into the management backend more quickly. The subsequent operation of importing services still needs to be done in the management backend H5 interface.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597641-54bf1649-0238-4973-8501-48c1cead328e.png" alt="Fast¬†Import"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="what-did-we-change-in-the-data-plane-of-apache-apisix"></a>What Did We Change in the Data Plane of Apache¬†APISIX?<a class="hash-link" href="#what-did-we-change-in-the-data-plane-of-apache-apisix" title="Direct link to heading">#</a></h2><p>Custom development based on the Apache APISIX data surface requires a number of code path rules to be followed. In particular, the code for the Apache APISIX gateway and the custom code are stored in separate paths, and the two work together and can each be iterated independently.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597706-33f97c9a-1e82-43c5-9ed7-e13b051ad9a0.png" alt="Changes in the Data Plane"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="modification-of-installation-package"></a>Modification of Installation Package<a class="hash-link" href="#modification-of-installation-package" title="Direct link to heading">#</a></h3><p>So when packaging, not only custom code, but also dependencies, configuration, etc. all need to be packaged together for distribution. As for the output format, you can either choose Docker or type it into a tarball, as required.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597788-24829253-d6f2-4f65-9799-3fc840a7c970.png" alt="Modification of Installation Package"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="custom-development-of-code"></a>Custom Development of¬†Code<a class="hash-link" href="#custom-development-of-code" title="Direct link to heading">#</a></h3><p>Some custom modules need to be loaded first when they are initialized, so that the code intrusion into Apache APISIX becomes minimal, requiring only modifications to the Nginx.conf file.</p><p><img src="https://user-images.githubusercontent.com/23514812/125597856-6020f223-dfeb-44a1-8a80-896a24a3d8fb.png" alt="Custom Development of¬†Code1"></p><p>For example, if you need to stuff an upstream object with a saas_id attribute field, you can call the following method at initialize time.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598009-75d4aaf7-10b7-476b-af22-97a0630d878c.png" alt="Custom Development of¬†Code2"></p><p>You need to be called in the initworker_by_lua* phase to complete the initialization for similar modifications.</p><p>Another scenario: how to directly rewrite the implementation of a currently existing module. For example, if you have a debug module and now you need to refactor its initialization logic, i.e. rewrite the init_worker function.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598066-fd0da722-7fb0-44a2-99cd-15bf07fd1ad6.png" alt="Custom Development of¬†Code3"></p><p>The advantage of this approach is that it not only keeps the original physical API files intact, but also adds custom API-specific logic rewrites, thus reducing the cost of later code management and bringing great convenience for subsequent upgrades.</p><p>If you have similar needs in a production environment, you can refer to the above approach.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="support-consul-kv"></a>Support Consul¬†KV<a class="hash-link" href="#support-consul-kv" title="Direct link to heading">#</a></h3><p>Currently, most of Weibo services use Consul KV as a service registration and discovery mechanism. Previously, Apache APISIX did not support the Consul KV method of service discovery mechanism, so a <code>consul_kv.lua</code> module needs to be added to the gateway layer, and a UI interface needs to be provided in the management backend as follows.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598115-d72321e4-b886-4e0d-965f-50c06f0f3104.png" alt="Support Consul¬†KV1"></p><p>In the upstream list in the console, everything is filled in at a glance, and the metadata of all registered nodes is automatically presented when the mouse is moved over the registered service address, which greatly facilitates the daily operation of our operation engineers.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598173-0b456929-5c41-4ddc-9675-a80f5129621f.png" alt="Support Consul¬†KV2"></p><p>The <code>consul_kv.lua</code> module is relatively simple to configure at the gateway level, supporting multiple connections to different Consul clusters at the same time, but this is also due to the requirements of the actual environment.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598228-bd02e3ab-3c70-4f2c-8860-3ddee4bb9dcc.png" alt="Support Consul¬†KV3"></p><p>This code has now been merged into the APISIX master branch and is included in version 2.4.</p><p>The module&#x27;s process model uses a subscription publishing model, where each gateway instance has one and only one process that polls multiple Consul service clusters with long connections and broadcasts new data to all business sub-processes as it becomes available.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="problems-encountered-during-customization"></a>Problems Encountered during Customization<a class="hash-link" href="#problems-encountered-during-customization" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="high-costs-for-migration"></a>High Costs for Migration<a class="hash-link" href="#high-costs-for-migration" title="Direct link to heading">#</a></h3><p>At the operation and maintenance level, we are actually facing a problem of migration cost.</p><p>Any new thing appeared, used to replace the existing foundation, will not be a smooth ride, but need to go through a period of time slowly familiar with, improve knowledge, and then keep trial and error, slowly move forward, and gradually eliminate all kinds of doubts in our minds. Only after a period of stable operation and various problems have been solved, will the next step of more rapid replacement phase be entered. There is no doubt that the use of APISIX in Weibo is still in the stage of gradual advancement, and we are still familiarizing ourselves with it, learning it, and gaining a deeper understanding of it, while solving various migration problems in order to find the best practice path.</p><p>For example, during the migration process, you need to import various upstream and routing rules from the Nginx.conf file into the gateway system administration backend one by one, which is a very tedious and manual process.</p><p><img src="https://user-images.githubusercontent.com/23514812/125598279-1fa93710-e5a0-4dc4-b42b-46b02f66f6a8.png" alt="High Costs for Migration"></p><p>At the same time, we will also encounter Nginx various complex variable judgment statements, at present, we mainly find one to solve one, and continue to accumulate experience.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="high-costs-for-upgrades"></a>High Costs for¬†Upgrades<a class="hash-link" href="#high-costs-for-upgrades" title="Direct link to heading">#</a></h3><p>High level of customization, resulting in higher costs for subsequent upgrades. We are currently experiencing the same problem as everyone else, many people should be based on version 1.x Apache APISIX how to upgrade to 2.0, we also have a Dashboard of private custom development, the subsequent upgrade costs should be higher.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="feeding-the-community"></a>Feeding the Community<a class="hash-link" href="#feeding-the-community" title="Direct link to heading">#</a></h3><p>The final part is about the Apache APISIX community. We have been thinking about how to feed features of interest to the Apache APISIX community for everyone to use and modify together.</p><p>It is an objective fact that our custom development is driven primarily by actual internal Weibo requirements, and there is some variation from the evolution driven by the Apache APISIX community. However, excluding code that contains sensitive data, there are always common needs at the code level for more general functionality that the enterprise and open source communities can push together to make more stable and mature. For example, a common Consul KV service discovery module, handling of some highly available profiles, and fixes for other issues.</p><p>These common requirements are typically polished internally for a period of time until they fully satisfy internal requirements, and then gradually submitted to the community open source branch, but this also requires a process.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/user-case">User Case</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/07/21/Apache-APISIX-Kubernetes"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ Apache APISIX x Kubernetes: Just RightÔΩúLive</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/07/06/celebrate-200-contributors"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apache APISIX has over 200 contributors in GitHub main repo!  ¬ª</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-information" class="table-of-contents__link">Background Information</a></li><li><a href="#why-did-we-choose-custom-development" class="table-of-contents__link">Why Did We Choose Custom Development?</a></li><li><a href="#what-did-we-change-in-the-control-plane-of-apache-apisix" class="table-of-contents__link">What Did We Change in the Control Plane of Apache¬†APISIX?</a><ul><li><a href="#support-saas-based-services" class="table-of-contents__link">Support Saas-based Services</a></li><li><a href="#add-audit-function" class="table-of-contents__link">Add Audit Function</a></li><li><a href="#support-grayscale-release" class="table-of-contents__link">Support Grayscale Release</a></li><li><a href="#support-fast-import" class="table-of-contents__link">Support Fast¬†Import</a></li></ul></li><li><a href="#what-did-we-change-in-the-data-plane-of-apache-apisix" class="table-of-contents__link">What Did We Change in the Data Plane of Apache¬†APISIX?</a><ul><li><a href="#modification-of-installation-package" class="table-of-contents__link">Modification of Installation Package</a></li><li><a href="#custom-development-of-code" class="table-of-contents__link">Custom Development of¬†Code</a></li><li><a href="#support-consul-kv" class="table-of-contents__link">Support Consul¬†KV</a></li></ul></li><li><a href="#problems-encountered-during-customization" class="table-of-contents__link">Problems Encountered during Customization</a><ul><li><a href="#high-costs-for-migration" class="table-of-contents__link">High Costs for Migration</a></li><li><a href="#high-costs-for-upgrades" class="table-of-contents__link">High Costs for¬†Upgrades</a></li><li><a href="#feeding-the-community" class="table-of-contents__link">Feeding the Community</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ed0e6747.js"></script>
<script src="/assets/js/main.21312ad3.js"></script>
</body>
</html>