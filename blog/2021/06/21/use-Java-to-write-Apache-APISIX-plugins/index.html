<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/releases/rss.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/releases/atom.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIXÂ® --  Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">How to Write an Apache APISIX Plugin in Java | Apache APISIXÂ® --  Cloud-Native API Gateway</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/favicon.png"><meta data-react-helmet="true" name="twitter:image" content="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/favicon.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" property="og:title" content="How to Write an Apache APISIX Plugin in Java | Apache APISIXÂ® --  Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="Apache APISIX now supports writing plugins in Java! You can now write plugins in a programming language you are familiar with."><meta data-react-helmet="true" property="og:description" content="Apache APISIX now supports writing plugins in Java! You can now write plugins in a programming language you are familiar with."><meta data-react-helmet="true" name="keywords" content="APISIX,Apache APISIX,Java,plugin"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-06-21T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/tzssangglass"><meta data-react-helmet="true" property="article:tag" content="Practical Case"><link data-react-helmet="true" rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/css/styles.0ee3ec58.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/runtime~main.98ecc263.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/main.ae174180.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">ğŸ¤” Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ">join #apisix channel</a>! â­ï¸</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/logo2.svg" alt="Apache APISIXÂ®" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/logo2.svg" alt="Apache APISIXÂ®" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIXÂ®</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIXÂ®ï¸</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIXÂ®ï¸ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIXÂ®ï¸ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIXÂ®ï¸ Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIXÂ®ï¸ Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIXÂ®ï¸ Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIXÂ®ï¸ Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIXÂ®ï¸ Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/security">General</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">FAQ</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/FAQ/">Apache APISIXÂ®</a></li><li><a class="dropdown__link" href="/docs/dashboard/FAQ/">Apache APISIXÂ® Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/FAQ/">Apache APISIXÂ® Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/FAQ/">Apache APISIXÂ® Helm Chart</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/releases">Releases</a></li><li><a class="dropdown__link" href="/help">Help</a></li></ul></div><a class="navbar__item navbar__link" href="/showcase">Showcase</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/18/meetup">ç›´æ’­é¢„å‘Š | Apache APISIX Ã— Apache SkyWalking çº¿ä¸Šåˆ†äº«</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/14/weekly-report-1014">ç¤¾åŒºå‘¨æŠ¥ï½œ10.1-10.14 åŠŸèƒ½äº®ç‚¹æ›´æ–°è¿›è¡Œä¸­</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/13/celebrating-300-contributors-of-apisix">Apache APISIX ç¤¾åŒºæ–°é‡Œç¨‹ç¢‘â€”â€”å…¨çƒè´¡çŒ®è€…çªç ´ 300 ä½ï¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/09/apisix-ingress-techblog">ä¿å§†çº§æ•™ç¨‹ï¼Œä»æ¦‚å¿µåˆ°å®è·µå¸®ä½ å¿«é€Ÿä¸Šæ‰‹ Apache APISIX Ingress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/01/openEuler">Apache APISIX ç¤¾åŒºæˆå‘˜åŠ©åŠ› openEuler å‘å¸ƒç¬¬ä¸€ä¸ªç¤¾åŒºåˆ›æ–°ç‰ˆ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/30/weekly-report">ç¤¾åŒºå‘¨æŠ¥ï½œæ–°æ™‹ committer ä¸€ä½ï¼ŒåŠŸèƒ½äº®ç‚¹æ›´æ–°è¿›è¡Œä¸­</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/29/release-apache-apisix-2.10">Release Apache APISIX 2.10.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/28/WPS-usercase">ç™¾ä¸‡çº§ QPS ä¸šåŠ¡æ–°å® ï¼Œé‡‘å±±åŠå…¬æºæ‰‹ Apache APISIX æ‰“é€ ç½‘å…³å®è·µæ–°ä½“éªŒ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/24/youpaicloud-usercase">Apache APISIX Ingress ä¸ºä½•æˆä¸ºåˆæ‹äº‘æ‰“é€ å®¹å™¨ç½‘å…³çš„æ–°é€‰æ‹©ï¼Ÿ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/18/xiaodian-usercase">Apache APISIX åŠ©åŠ›ä¾¿åˆ©å……ç”µåˆ›é¢†è€…å°ç”µï¼Œå®ç°äº‘åŸç”Ÿæ–¹æ¡ˆ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/16/tencent-cloud">Apache APISIX åœ¨è…¾è®¯äº‘æ™ºèƒ½é’›å¹³å°ä¸­çš„è½åœ°å®è·µ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/15/weekly-report">ç¤¾åŒºå‘¨æŠ¥ï½œæ–°æ™‹ committer ä¸¤ä½ï¼ŒåŠŸèƒ½äº®ç‚¹æ›´æ–°è¿›è¡Œä¸­</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/14/youzan">Apache APISIX åŠ©åŠ›æœ‰èµäº‘åŸç”Ÿ PaaS å¹³å°ï¼Œå®ç°å…¨é¢å¾®æœåŠ¡æ²»ç†</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/13/china-mobile-cloud-usercase">How Apache APISIX is implemented in China Mobile Cloud</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/09/how-to-contribute-to-an-OpenSource-without-coding">ä¸å†™ä»£ç ï¼Œå¦‚ä½•ä¸ºå¼€æºé¡¹ç›®åšè´¡çŒ®ï¼Ÿ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/how-to-use-apisix-auth">ä½¿ç”¨ Apache APISIX è¿›è¡Œé›†ä¸­å¼èº«ä»½è®¤è¯åŠè¿›é˜¶ç©æ³•</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/iQIYI-usercase">åŸºäº Apache APISIXï¼Œçˆ±å¥‡è‰º API ç½‘å…³çš„æ›´æ–°ä¸è½åœ°å®è·µ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/06/python-helps-you-quickly-with-Apache-APISIX-development">Python åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Apache APISIX æ’ä»¶å¼€å‘</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/31/Apache APISIX Ã— KubeSphere-a-better-gateway-and-K8S-Ingress-Controller">Apache APISIX Ã— KubeSphereï¼šæä¾›æ›´å¥½ç”¨çš„ç½‘å…³åŠ K8S Ingress Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/Ingress-Meeting">ç¤¾åŒºä¼šè®®ï½œ å‘¨ä¸‰ä¸‹åˆ 2 ç‚¹ï¼ŒApache APISIX Ingress ç¤¾åŒºä¼šè®®ä¸ä½ ä¸è§ä¸æ•£</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/weekly-report">Apache APISIX ç¤¾åŒºå‘¨æŠ¥ ï½œ 2021 8.23-8.29</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/27/release-apache-apisix-2.9">Release Apache APISIX 2.9</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Auth-with-Casbin-in-Apache-APISIX">Authorization with Casbin in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">ä½¿ç”¨ Apache APISIX çš„ OpenID Connect æ’ä»¶è¿›è¡Œé›†ä¸­èº«ä»½è®¤è¯</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua">Why Apache APISIX chose Nginx and Lua to build API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/24/shanghai-meetup-recap">Apache APISIX Meetup ä¸Šæµ·ç«™å…¨ç¨‹å›é¡¾</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/ApacheCon-Asia-2021">ApacheCon Asia 2021</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/weekly-report">Apache APISIX ç¤¾åŒºå‘¨æŠ¥ ï½œ 2021 8.16-8.22</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/21/shanghai-meetup">8 æœˆ 21 æ—¥ Apache APISIX Meetup ä¸Šæµ·ç«™ï¼Œæ¬¢è¿æŠ¥åå‚åŠ ï¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/go-makes-Apache-APISIX-better">Go è®© Apache APISIX å¦‚è™æ·»ç¿¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/weekly-report">Apache APISIX ç¤¾åŒºå‘¨æŠ¥ ï½œ 08-09 ï½ 08-15</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/18/Auth-with-Casbin-in-Apache-APISIX">åœ¨ Apache APISIX ä¸­ä½¿ç”¨ Casbin è¿›è¡Œæˆæƒ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/17/interview-airwallex">Apache APISIX åœ¨ Airwallex çš„åº”ç”¨ | ä¸“è®¿ Airwallex æŠ€æœ¯å¹³å°è´Ÿè´£äººææ¨</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/16/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">Using the Apache APISIX OpenID Connect Plugin for Okta Centralized Authentication</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/14/contributors-the-golden-metric-of-openSource-projects">Contributors â€” The Golden Metric of OpenSource Projects</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/12/Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability">Chaos Mesh Helps Apache APISIX Improve System Stability</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/11/interview-TuZhengsong">ä»æ–°æ‰‹æ‘å‡ºæ¥ï¼Œæˆ‘åœ¨ Apache APISIX ç¤¾åŒºå‘å‡ºäº†ç¬¬ä¸€ä¸ª PR</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/10/apisix-nginx">Apache APISIX æ¶æ„åˆ†æï¼šå¦‚ä½•åŠ¨æ€ç®¡ç† Nginx é›†ç¾¤ï¼Ÿ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-China-Mobile-Cloud">Apache APISIX åœ¨ç§»åŠ¨äº‘çš„åº”ç”¨</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-Quliankeji">èˆå¼ƒ Kong å’Œ Nginxï¼ŒApache APISIX åœ¨è¶£é“¾ç§‘æŠ€ BaaS å¹³å°çš„è½åœ°å®è·µ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx">å¦‚ä½•åˆ©ç”¨ Apache APISX æå‡ Nginx çš„å¯è§‚æµ‹æ€§</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/05/Kong-to-APISIX">Kong-To-APISIX Migration Tool</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/28/release-apache-apisix-2.8">Release Apache APISIX 2.8.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/27/use-of-plugin-orchestration-in-Apache-APISIX">Applying Plugin Orchestration in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/25/apachecon-asia">ApacheCon Asia 2021ï¼šApache APISIX æŠ€æœ¯è®®é¢˜ä¸€è§ˆ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/21/Apache-APISIX-Kubernetes">Apache APISIX x Kubernetesï¼šæ°åˆ°å¥½å¤„ï½œç›´æ’­é¢„å‘Š</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX">The Road to Customized Development of Sina Weibo API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/06/celebrate-200-contributors">Apache APISIX has over 200 contributors in GitHub main repo! </a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/30/etcd3-support-HTTP-access-perfectly">Does etcd 3 Support HTTP Access Perfectly?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/29/release-apache-apisix-2.7">Release Apache APISIX 2.7.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/28/why-we-need-Apache-APISIX">æœ‰äº† NGINX å’Œ Kongï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast">Deploy Apache APISIX and Apache APISIX Ingress Controller on Rancher</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins">How to Write an Apache APISIX Plugin in Java</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released">Apache APISIX Ingress Controller é¦–ä¸ª GA ç‰ˆæœ¬ v1.0 æ­£å¼å‘å¸ƒï¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/17/Apache-APISIX-Dashboard-Access-Control-Bypass-Vulnerability-Announcement">Apache APISIX Dashboard è®¿é—®æ§åˆ¶ç»•è¿‡æ¼æ´å…¬å‘Šï¼ˆCVE-2021-33190ï¼‰</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/16/Chaos-Mesh-helps-Apache-APISIX-improve-stability">Chaos Mesh åŠ©åŠ› Apache APISIX æå‡ç¨³å®šæ€§</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/10/Apache-APISIX-and-Envoy-performance-comparison">Apache APISIX v.s Envoy: Which Has the Better Performance?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/07/Apache-APISIX-not-affected-by-NGINX-CVE-2021-23017">Apache APISIX not affected by NGINX CVE-2021-23017</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/06/apisix-two-years">Apache APISIX å¼€æº 2 å‘¨å¹´ï¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/03/experience-share-from-Apache-APISIX-committer">æ¥è‡ª Apache APISIX committer çš„ç»éªŒåˆ†äº« â€”â€” ç¼–ç¨‹ä¹‹å¤ä¸“è®¿</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/25/Apache APISIX 2.6.0-Release">Apache APISIX 2.6.0-Release æ­£å¼å‘å¸ƒ</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/24/Tencent-Games">æ”¯æŒ 10 äº¿æ—¥æµé‡çš„åŸºç¡€è®¾æ–½ï¼šå½“ Apahce APISIX é‡ä¸Šè…¾è®¯</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/02/get-front-end-test-coverage-with-cypress">Get Front-End Test Coverage with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/26/install-apache-apisix-from-helm-charts">Install Apache APISIX from Helm Charts</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/11/interview-Apache-APISIX-contributor-Wang-Pengcheng-Senior-Security-Advisor-of-PwC-South-China-Data-Security-and-Privacy-Protection-Team">Apache APISIX è´¡çŒ®è€…ä¸“è®¿ | æ™®åæ°¸é“åå—æ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤å›¢é˜Ÿé«˜çº§å®‰å…¨é¡¾é—®ç‹é¹è¯š</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/18/first-look-at-kubernetes-service-api">åˆæ¢ Kubernetes Service APIs</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix">è´å£³æ‰¾æˆ¿ï¼šå¦‚ä½•åŸºäº Apache APISIX æ­å»ºç½‘å…³</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">How to Write an Apache APISIX Plugin in Java</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-06-21T00:00:00.000Z" itemprop="datePublished">June 21, 2021</time> Â· 6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/tzssangglass" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/30819887?v=4" alt="Zhengsong Tu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tzssangglass" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Zhengsong Tu</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Apache APISIX now supports writing plugins in Java! You can now write plugins in a programming language you are familiar with.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="why-apache-apisix-supports-writing-plugins-in-multiple-programming-languages"></a>Why Apache APISIX Supports Writing Plugins in Multiple Programming Languages?<a class="hash-link" href="#why-apache-apisix-supports-writing-plugins-in-multiple-programming-languages" title="Direct link to heading">#</a></h3><p>Apache APISIX has been supporting customized plugins since the day it was born. But it only supported plugins written in Lua. As a result, developers need to have Lua and OpenResty-related development skills to actually write their own plugins. However, Lua and OpenResty are relatively less popular languages with fewer developers compared to Java and Go. Besides, learning Lua and OpenResty from scratch requires a lot of time and effort.</p><p>During technological selection, the most important consideration for the development team is whether the chosen product matches the team&#x27;s technology stack. The niche technology stack limits Apache APISIX to become the first choice of API Gateway product in many scenarios.</p><p>Now, Apache APISIX supports multi-language development plugins. More importantly, the development ecosystem where the language is supported, so users can use their familiar technology stack to develop Apache APISIX. With Apache APISIX supporting plugins written in Java, for example, users can not only write plugins in Java but also integrate into the Spring Cloud ecosystem and use a wide range of technical components within the ecosystem.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="multiple-programming-languages-architecture-diagram"></a>Multiple Programming Languages Architecture Diagram<a class="hash-link" href="#multiple-programming-languages-architecture-diagram" title="Direct link to heading">#</a></h3><p><img alt="Multiple Programming Languages Architecture Diagram" src="/assets/images/2021-06-21-1-525ff9910f08736d1e3777a630df9ae3.png"></p><p>The left side of the diagram shows the workflow of Apache APISIX. The right side of the diagram is the plugin runner, which is a generic term for projects with multiple programming languages support. The apisix-java-plugin-runner is a plugin runner that supports the Java language.</p><p>When you configure a plugin runner in Apache APISIX, Apache APISIX starts a subprocess to run the plugin runner, which belongs to the same user as the Apache APISIX process. When we restart or reload Apache APISIX, the plugin runner will also be restarted.</p><p>If you configure the ext-plugin-* plugin for a given route, a request hitting that route will trigger Apache APISIX to perform an RPC call to the plugin runner via a Unix socket. The call is broken down into two phases:</p><ul><li>ext-plugin-pre-req: Before executing the Apache APISIX built-in plugin (Lua plugin)</li><li>ext-plugin-post-req: After executing the Apache APISIX built-in plugin (Lua plugin)</li></ul><p>Please configure the timing of the plugin runner execution as needed.
The plugin runner processes the RPC call, creates a simulated request inside it, and then runs the multiple programming languages written a plugin and returns the result to Apache APISIX.</p><p>The order of execution of multiple programming languages plugins is defined in the ext-plugin-* plugin configuration entry. Like other plugins, they can be enabled and redefined on the fly.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="building-development-environment"></a>Building Development Environment<a class="hash-link" href="#building-development-environment" title="Direct link to heading">#</a></h2><p>First, you need to build the Apache APISIX runtime or development environment, please refer to <a href="https://github.com/apache/apisix/blob/master/docs/en/latest/how-to-build.md" target="_blank" rel="noopener noreferrer">Build Apache APISIX</a>, and <a href="https://github.com/apache/apisix-java-plugin-runner/blob/main/docs/development.md" target="_blank" rel="noopener noreferrer">Build apisix-java-plugin-runner</a>.</p><p>Note: Apache APISIX and apisix-java-plugin-runner need to be located on the same instance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="enabling-debug-mode"></a>Enabling DebugÂ Mode<a class="hash-link" href="#enabling-debug-mode" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="configuring-apache-apisix-into-debug-mode"></a>Configuring Apache APISIX into DebugÂ Mode<a class="hash-link" href="#configuring-apache-apisix-into-debug-mode" title="Direct link to heading">#</a></h3><p>When Apache APISIX is configured into debug mode, it is allowed to run external plugins in a debugging manner. Add the following configuration to <code>config.yaml</code> to enable debug mode for Apache APISIX.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ext-plugin:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  path_for_test: /tmp/runner.sock</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The configuration above means that Apache APISIX acts as the client and listens to the Unix Domain Socket link located at <code>/tmp/runner.sock</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="setting-apisix-java-plugin-runner-to-debug-mode"></a>Setting apisix-java-plugin-runner to DebugÂ Mode<a class="hash-link" href="#setting-apisix-java-plugin-runner-to-debug-mode" title="Direct link to heading">#</a></h3><p>Before starting the <code>Mainclass(org.apache.apisix.plugin.runner.PluginRunnerApplication)</code>, you need to configure the user-level environment variables <code>APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock and APISIX_CONF_EXPIRE_TIME=3600</code>.</p><p>If you are using IDEA for development, the configured environment variables are shown below.</p><p><img alt="configured environment" src="/assets/images/2021-06-21-2-c01289c552c1b22596213a57c003252d.png"></p><p>apisix-java-plugin-runner is equivalent to the server side and will actively create the <code>/tmp/runner.sock</code> file at startup and communicate with Apache APISIX on this file for Unix Domain Socket.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="how-to-develop-a-java-plugin-for-apache-apisix"></a>How to Develop a Java Plugin for ApacheÂ APISIX?<a class="hash-link" href="#how-to-develop-a-java-plugin-for-apache-apisix" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="scenario"></a>Scenario<a class="hash-link" href="#scenario" title="Direct link to heading">#</a></h3><p>Let&#x27;s say we have a scenario like this: we need to verify the validity of the token in the request header. The way to verify the token is to carry the token as a parameter in the request and access the SSO fixed interface.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="configuring-apache-apisix"></a>Configuring ApacheÂ APISIX<a class="hash-link" href="#configuring-apache-apisix" title="Direct link to heading">#</a></h3><p>First, name the plugin <code>TokenValidator</code>, and then design the properties. In order to achieve dynamic configuration as far as possible, the properties are designed as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;validate_header&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;validate_url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://www.sso.foo.com/token/validate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;rejected_code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;403&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Start Apache APISIX, then add a new route configuration specifying that the route requires a call to apisix-java-plugin-runner&#x27;s <code>TokenValidator</code> plugin, as shown in the following example.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/apisix/admin/routes/1 -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;</span><span class="token plain"> -X PUT -d &#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;uri&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;/get&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;plugins&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ext-plugin-pre-req&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;conf&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;TokenValidator&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;{</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">validate_header</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">token</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">validate_url</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">https://www.sso.foo.com/token/validate</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">,</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">rejected_code</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">:</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">403</span><span class="token string entity" style="color:#36acaa">\&quot;</span><span class="token string" style="color:#e3116c">}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;upstream&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;nodes&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;httpbin.org:80&quot;</span><span class="token plain">:1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;roundrobin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that the properties of <code>TokenValidator</code> need to be escaped by json and configured as string type (the upstream address here is configured as httpbin.org to simplify the debugging process).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="developing-a-java-plugin"></a>Developing a JavaÂ Plugin<a class="hash-link" href="#developing-a-java-plugin" title="Direct link to heading">#</a></h3><p>Add <code>TokenValidatr.java</code> with the following initial code skeleton In the <code>runner-plugin/src/main/java/org/apache/apisix/plugin/runner/filter</code> directory.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Java"><pre tabindex="0" class="prism-code language-Java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package org.apache.apisix.plugin.runner.filter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.apisix.plugin.runner.HttpRequest;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.apisix.plugin.runner.HttpResponse;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import reactor.core.publisher.Mono;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TokenValidator implements PluginFilter {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String name() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;TokenValidator&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;Void&gt; filter(HttpRequest request, HttpResponse response, PluginFilterChain chain) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return chain.filter(request, response);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This plugin inherits the <code>PluginFilter</code> interface and overrides the <code>name</code> and the <code>filter</code> function. Rewrite the return value of <code>name</code> to be consistent with &quot;name&quot; in the route attribute of APISIX configuration earlier. The complete code is as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Java"><pre tabindex="0" class="prism-code language-Java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package org.apache.apisix.plugin.runner.filter;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.Gson;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.apisix.plugin.runner.HttpRequest;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.apisix.plugin.runner.HttpResponse;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import reactor.core.publisher.Mono;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.HashMap;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TokenValidator implements PluginFilter {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String name() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;TokenValidator&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;Void&gt; filter(HttpRequest request, HttpResponse response, PluginFilterChain chain) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // parse `conf` to json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String configStr = request.getConfig(this);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Gson gson = new Gson();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; conf = new HashMap&lt;&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        conf = gson.fromJson(configStr, conf.getClass());</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // get configuration parameters</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String token = request.getHeader((String) conf.get(&quot;validate_header&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String validate_url = (String) conf.get(&quot;validate_url&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean flag = validate(token, validate_url);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // token verification results</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!flag) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            String rejected_code = (String) conf.get(&quot;rejected_code&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.setStatusCode(Integer.parseInt(rejected_code));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return chain.filter(request, response);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return chain.filter(request, response);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean validate(String token, String validate_url) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        //TODO: improve the validation process</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="testing-the-plugin"></a>Testing theÂ Plugin<a class="hash-link" href="#testing-the-plugin" title="Direct link to heading">#</a></h3><p>The upstream service configured on Apache APISIX is httpbin.org, which allows you to access Apache APISIX, trigger the route, and have Apache APISIX call apisix-java-plugin-runner to execute the TokenValidator plugin and test the functionality of the Java plugin.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;token: 123456&#x27;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:9080/get</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;args&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;headers&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Accept&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Token&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;curl/7.71.1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;X-Amzn-Trace-Id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Root=1-60cb0424-02b5bf804cfeab5252392f96&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;X-Forwarded-Host&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;origin&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;url&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://127.0.0.1/get&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="deploying-the-plugin"></a>Deploying theÂ Plugin<a class="hash-link" href="#deploying-the-plugin" title="Direct link to heading">#</a></h2><p>After the development of the plugin is completed, the deployment operation can be found in referred to <a href="https://github.com/apache/apisix-java-plugin-runner/blob/main/docs/how-it-works.md#run" target="_blank" rel="noopener noreferrer">Deploying apisix-java-plugin-runner</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="video-tutorial"></a>Video Tutorial<a class="hash-link" href="#video-tutorial" title="Direct link to heading">#</a></h2><iframe height="350" width="600" src="https://api7-website-1301662268.file.myqcloud.com/2021-06-21-use-Java-to-write-Apache-APISIX-plugins.mp4" frameborder="0"></iframe></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/practical-case">Practical Case</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Deploy Apache APISIX and Apache APISIX Ingress Controller on Rancher</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apache APISIX Ingress Controller é¦–ä¸ª GA ç‰ˆæœ¬ v1.0 æ­£å¼å‘å¸ƒï¼ Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a><ul><li><a href="#why-apache-apisix-supports-writing-plugins-in-multiple-programming-languages" class="table-of-contents__link">Why Apache APISIX Supports Writing Plugins in Multiple Programming Languages?</a></li><li><a href="#multiple-programming-languages-architecture-diagram" class="table-of-contents__link">Multiple Programming Languages Architecture Diagram</a></li></ul></li><li><a href="#building-development-environment" class="table-of-contents__link">Building Development Environment</a></li><li><a href="#enabling-debug-mode" class="table-of-contents__link">Enabling DebugÂ Mode</a><ul><li><a href="#configuring-apache-apisix-into-debug-mode" class="table-of-contents__link">Configuring Apache APISIX into DebugÂ Mode</a></li><li><a href="#setting-apisix-java-plugin-runner-to-debug-mode" class="table-of-contents__link">Setting apisix-java-plugin-runner to DebugÂ Mode</a></li></ul></li><li><a href="#how-to-develop-a-java-plugin-for-apache-apisix" class="table-of-contents__link">How to Develop a Java Plugin for ApacheÂ APISIX?</a><ul><li><a href="#scenario" class="table-of-contents__link">Scenario</a></li><li><a href="#configuring-apache-apisix" class="table-of-contents__link">Configuring ApacheÂ APISIX</a></li><li><a href="#developing-a-java-plugin" class="table-of-contents__link">Developing a JavaÂ Plugin</a></li><li><a href="#testing-the-plugin" class="table-of-contents__link">Testing theÂ Plugin</a></li></ul></li><li><a href="#deploying-the-plugin" class="table-of-contents__link">Deploying theÂ Plugin</a></li><li><a href="#video-tutorial" class="table-of-contents__link">Video Tutorial</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2019-2021 The Apache Software Foundation. Apache APISIX, APISIXÂ®, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.98ecc263.js"></script>
<script src="/assets/js/main.ae174180.js"></script>
</body>
</html>