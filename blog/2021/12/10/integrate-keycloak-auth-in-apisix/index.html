<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">API Gateway APISIX Integrates Keycloak for Authentication | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2021/12/10/integrate-keycloak-auth-in-apisix/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="API Gateway APISIX Integrates Keycloak for Authentication | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="This article shows you how to use OpenID-Connect protocol and Keycloak for identity authentication in API Gateway Apache APISIX through detailed steps."><meta data-react-helmet="true" property="og:description" content="This article shows you how to use OpenID-Connect protocol and Keycloak for identity authentication in API Gateway Apache APISIX through detailed steps."><meta data-react-helmet="true" name="keywords" content="Apache APISIX,API Gateway,Keycloak,Authentication,Integration"><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/2022/blog/0818/plugins/keycloak.png"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/2022/blog/0818/plugins/keycloak.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-12-10T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/starsz,https://github.com/SylviaBABY"><meta data-react-helmet="true" property="article:tag" content="Plugins,Authentication"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/12/10/integrate-keycloak-auth-in-apisix/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/12/10/integrate-keycloak-auth-in-apisix/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://www.keycloak.org/2021/12/apisix"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">ü§î Introducing APISIX AI Gateway ‚Äì Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">‰∏≠ÊñáÂçöÂÆ¢</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">API Gateway APISIX Integrates Keycloak for Authentication</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2021-12-10T00:00:00.000Z" itemprop="datePublished">December 10, 2021</time> ¬∑ <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/starsz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/25628854?v=4" alt="Xinxin Zhu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/starsz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Xinxin Zhu</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/SylviaBABY" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/39793568?v=4" alt="Sylvia"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/SylviaBABY" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Sylvia</span></a></div><small class="avatar__subtitle" itemprop="description">Technical Writer</small></div></div></div></div></header><meta itemprop="image" content="https://static.apiseven.com/2022/blog/0818/plugins/keycloak.png"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>This article shows you how to use OpenID-Connect protocol and Keycloak for identity authentication in Apache APISIX through detailed steps.</p></blockquote><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.webp, https://static.apiseven.com/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.png" alt="Keycloak-APISIX Integration" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.png" alt="Keycloak-APISIX Integration" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p><a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> is an open source identity and access management solution for modern applications and services. Keycloak supports Single-Sign On, which enables services to interface with Keycloak through protocols such as OpenID Connect, OAuth 2.0, etc. Keycloak also supports integrations with different authentication services, such as Github, Google and Facebook.</p><p>In addition, Keycloak also supports user federation, and can import users through LDAP and Kerberos. For more information about Keycloak, please refer to the <a href="https://www.keycloak.org/about" target="_blank" rel="noopener noreferrer">official documentation</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="how-to-use">How to Use<a aria-hidden="true" class="hash-link" href="#how-to-use" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="environment-preparation">Environment Preparation<a aria-hidden="true" class="hash-link" href="#environment-preparation" title="Direct link to heading">‚Äã</a></h3><p>Make sure that Apache APISIX is started in your environment before proceeding with the following steps.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="start-keycloak">Start Keycloak<a aria-hidden="true" class="hash-link" href="#start-keycloak" title="Direct link to heading">‚Äã</a></h4><p>Here we use <code>docker-compose</code> to start Keycloak with PostgreSQL.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.7&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">12.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">POSTGRES_DB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">keycloak</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jboss/keycloak</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">DB_VENDOR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> POSTGRES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">DB_ADDR</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">DB_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">DB_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">DB_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">KEYCLOAK_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">KEYCLOAK_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">PROXY_ADDRESS_FORWARDING</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8080</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> postgres</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK shell"><pre tabindex="0" class="prism-code language-shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> up</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>After execution, you need to verify that Keycloak and postgres have started successfully.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK shell"><pre tabindex="0" class="prism-code language-shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ps</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="configure-keycloak">Configure Keycloak<a aria-hidden="true" class="hash-link" href="#configure-keycloak" title="Direct link to heading">‚Äã</a></h4><p>After Keycloak is started, use your browser to access &quot;<a href="http://127.0.0.1:8080/auth/admin/%22" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080/auth/admin/&quot;</a> and type the <code>admin/password</code> account password to log in to the administrator console.</p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-a-realm">Create a realm<a aria-hidden="true" class="hash-link" href="#create-a-realm" title="Direct link to heading">‚Äã</a></h5><p>First, you need to create a realm named <code>apisix_test_realm</code>. In Keycloak, a realm is a workspace dedicated to managing projects, and the resources of different realms are isolated from each other.</p><p>The realm in Keycloak is divided into two categories: one is the <code>master realm</code>, which is created when Keycloak is first started and used to manage the admin account and create other realm. the second is the <code>other realm</code>, which is created by the admin in the master realm and can be used to create, manage and use users and applications in this realm. The second category is the other realm, created by admin in the master realm, where users and applications can be created, managed and used. For more details, please refer to the <a href="https://www.keycloak.org/docs/latest/getting_started/index.html#realms-and-users" target="_blank" rel="noopener noreferrer">realm and users section in Keycloak</a>.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.webp, https://static.apiseven.com/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.png" alt="Create realm" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.png" alt="Create realm" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.webp, https://static.apiseven.com/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.png" alt="Edit realm title" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.png" alt="Edit realm title" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-a-client">Create a Client<a aria-hidden="true" class="hash-link" href="#create-a-client" title="Direct link to heading">‚Äã</a></h5><p>The next step is to create the <code>OpenID Connect Client</code>. In Keycloak, Client means a client that is allowed to initiate authentication to Keycloak.</p><p>In this example scenario, <code>Apache APISIX</code> is equivalent to a client that is responsible for initiating authentication requests to Keycloak, so we create a Client with the name <code>apisix</code>. More details about the Client can be found in <a href="https://www.keycloak.org/docs/latest/server_admin/#_oidc_clients" target="_blank" rel="noopener noreferrer">Keycloak OIDC Clients</a>.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.webp, https://static.apiseven.com/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.png" alt="Create OpenID Client" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.png" alt="Create OpenID Client" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.webp, https://static.apiseven.com/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.png" alt="Creat Client title" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.png" alt="Creat Client title" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="configure-the-client">Configure the Client<a aria-hidden="true" class="hash-link" href="#configure-the-client" title="Direct link to heading">‚Äã</a></h5><p>After the Client is created, you need to configure the Apache APISIX access type for the Client.</p><p>In Keycloak, there are three types of Access Type:</p><ol><li><strong>Confidential</strong>: which is used for applications that need to perform browser login, and the client will get the <code>access token</code> through <code>client secret</code>, mostly used in web systems rendered by the server.</li><li><strong>Public</strong>: for applications that need to perform browser login, mostly used in front-end projects implemented using vue and react.</li><li><strong>Bearer-only</strong>: for applications that don&#x27;t need to perform browser login, only allow access with <code>bearer token</code>, mostly used in RESTful API scenarios.</li></ol><p>For more details about Client settings, please refer to <a href="https://www.keycloak.org/docs/latest/server_admin/#advanced-settings" target="_blank" rel="noopener noreferrer">Keycloak OIDC Clients Advanced Settings</a>.</p><p>Since we are using Apache APISIX as the Client on the server side, we can choose either &quot;confidential&quot; Access Type or &quot;Bearer-only&quot; Access Type. For the demonstration below, we are using &quot;confidential&quot; Access Type as an example.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.webp, https://static.apiseven.com/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.png" alt="Set Client type" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.png" alt="Set Client type" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-users">Create Users<a aria-hidden="true" class="hash-link" href="#create-users" title="Direct link to heading">‚Äã</a></h5><p>Keycloak supports interfacing with other third-party user systems, such as Google and Facebook, or importing or manually creating users using LDAP . Here we will use &quot;manually creating users&quot; to demonstrate.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.webp, https://static.apiseven.com/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.png" alt="Create user" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.png" alt="Create user" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.webp, https://static.apiseven.com/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.png" alt="Add user info" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.png" alt="Add user info" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Then set the user&#x27;s password in the Credentials page.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.webp, https://static.apiseven.com/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.png" alt="Set user password" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.png" alt="Set user password" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-routes">Create Routes<a aria-hidden="true" class="hash-link" href="#create-routes" title="Direct link to heading">‚Äã</a></h4><p>After Keycloak is configured, you need to create a route and open the <code>Openid-Connect</code> plugin . For details on the configuration of this plugin, please refer to the <a href="https://apisix.apache.org/docs/apisix/plugins/openid-connect" target="_blank" rel="noopener noreferrer">Apache APISIX OpenID-Connect plugin</a>.</p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="get-client_id-and-client_secret">Get client_id and client_secret<a aria-hidden="true" class="hash-link" href="#get-client_id-and-client_secret" title="Direct link to heading">‚Äã</a></h5><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.webp, https://static.apiseven.com/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.png" alt="Get Client infos" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.png" alt="Get Client infos" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>In the above configuration.</p><ul><li><code>client_id</code> is the name used when creating the Client before, i.e. <code>apisix</code></li><li><code>client_secret</code> should be obtained from Clients-apisix-Credentials, for example: <code>d5c42c50-3e71-4bbbe-aa9e-31083ab29da4</code>.</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="get-the-discovery-configuration">Get the discovery configuration<a aria-hidden="true" class="hash-link" href="#get-the-discovery-configuration" title="Direct link to heading">‚Äã</a></h5><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.webp, https://static.apiseven.com/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.png" alt="Get configuration" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.png" alt="Get configuration" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Go to Realm Settings-General-Endpoints, select the <code>OpenID Endpoint Configuration</code> link and copy the address that the link points to, for example:<code>http://127.0.0.1:8080/auth/realms/apisix_test_realm/.well-known/openid-configuration</code>.</p><h5 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="create-a-route-and-enable-the-plug-in">Create a route and enable the plug-in<a aria-hidden="true" class="hash-link" href="#create-a-route-and-enable-the-plug-in" title="Direct link to heading">‚Äã</a></h5><p>Use the following command to access the Apache APISIX Admin interface to create a route, set the upstream to <code>httpbin.org</code>, and enable the plug-in OpenID Connect for authentication.</p><blockquote><p>Note: If you select <code>bearer-only</code> as the Access Type when creating a Client, you need to set <code>bearer_only</code> to true when configuring the route, so that access to Apache APISIX will not jump to the Keycloak login screen.</p></blockquote><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK shell"><pre tabindex="0" class="prism-code language-shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain">  -XPOST </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:9080/apisix/admin/routes -H </span><span class="token string" style="color:#e3116c">&quot;X-Api-Key: edd1c9f034335f136f87ad84b625c8f1&quot;</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uri&quot;:&quot;/*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;openid-connect&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;client_id&quot;:&quot;apisix&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;client_secret&quot;:&quot;d5c42c50-3e71-4bbe-aa9e-31083ab29da4&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;discovery&quot;:&quot;http://127.0.0.1:8080/auth/realms/apisix_test_realm/.well-known/openid-configuration&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;scope&quot;:&quot;openid profile&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;bearer_only&quot;:false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;realm&quot;:&quot;apisix_test_realm&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;introspection_endpoint_auth_method&quot;:&quot;client_secret_post&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;redirect_uri&quot;:&quot;http://127.0.0.1:9080/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;:&quot;roundrobin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;httpbin.org:80&quot;:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="access-testing">Access Testing<a aria-hidden="true" class="hash-link" href="#access-testing" title="Direct link to heading">‚Äã</a></h3><p>Once the above configuration is complete, we are ready to perform the relevant access tests in Apache APISIX.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="access-apache-apisix">Access Apache APISIX<a aria-hidden="true" class="hash-link" href="#access-apache-apisix" title="Direct link to heading">‚Äã</a></h4><p>Use your browser to access <a href="http://127.0.0.1:9080/image/png" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9080/image/png</a>.</p><p>Since the OpenID-Connect plugin is enabled and <code>bearer-only</code> is set to <code>false</code>, when you access this path for the first time, Apache APISIX will redirect to the login screen configured in <code>apisix_test_realm</code> in Keycloak and make a user login request.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.webp, https://static.apiseven.com/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.png" alt="Login Page" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.png" alt="Login Page" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Enter the User peter created during the Keycloak configuration to complete user login.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="successful-access">Successful access<a aria-hidden="true" class="hash-link" href="#successful-access" title="Direct link to heading">‚Äã</a></h4><p>After a successful login, the browser will again redirect the link to <a href="http://127.0.0.1:9080/image/png" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9080/image/png</a> and will successfully access the image content. The content is identical to that of the upstream <a href="http://httpbin.org/image/png" target="_blank" rel="noopener noreferrer">http://httpbin.org/image/png</a>.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.webp, https://static.apiseven.com/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.png" alt="Access successfully" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.webp, https://static.apiseven.com/apisix-thumbnail/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.png" alt="Access successfully" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="logout">Logout<a aria-hidden="true" class="hash-link" href="#logout" title="Direct link to heading">‚Äã</a></h4><p>After the test, use your browser to access &quot;http:/127.0.0.1:9080/logout&quot; to logout your account.</p><blockquote><p>Note: The logout path can be specified by <code>logout_path</code> in the OpenID-Connect plug-in configuration, the default is <code>logout</code>.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">‚Äã</a></h2><p>This article shows the procedure of using OpenID-Connect protocol and Keycloak for authentication in Apache APISIX. By integrating with Keycloak, Apache APISIX can be configured to authenticate and authenticate users and application services, which greatly reduces the development work involved.</p><p>For more information about the implementation of authentication in Apache APISIX with Okta, see <a href="https://apisix.apache.org/zh/blog/2021/08/16/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication/" target="_blank" rel="noopener noreferrer">this article</a>.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/plugins/">Plugins</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/authentication/">Authentication</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">Monitor APISIX Ingress Controller with Prometheus</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">API Log Monitor with Apache APISIX &amp; RocketMQ</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright ¬© 2019-2026 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js"></script>
</body>
</html>