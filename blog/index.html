<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX™ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX™ Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX™" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/events/rss.xml" title="Apache APISIX™ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/events/atom.xml" title="Apache APISIX™ Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">Blog | Apache APISIX™</title><meta data-react-helmet="true" property="og:title" content="Blog | Apache APISIX™"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="description" content="Apache APISIX is a dynamic, real-time, high-performance Cloud-Native API gateway, based on the Nginx library and etcd."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/styles.6b3ccb20.css">
<link rel="preload" href="/styles.f6196f2d.js" as="script">
<link rel="preload" href="/runtime~main.d0a4354d.js" as="script">
<link rel="preload" href="/main.be0eaecb.js" as="script">
<link rel="preload" href="/1.b3395235.js" as="script">
<link rel="preload" href="/2.05b0df04.js" as="script">
<link rel="preload" href="/4.ce841e81.js" as="script">
<link rel="preload" href="/a6aa9e1f.0a850dbe.js" as="script">
<link rel="preload" href="/2d8fe9ee.8a8bd2e1.js" as="script">
<link rel="preload" href="/e451ae2c.5f322c75.js" as="script">
<link rel="preload" href="/514de2af.7c1bd42f.js" as="script">
<link rel="preload" href="/5bb67ffc.7fd0a4ef.js" as="script">
<link rel="preload" href="/e02da2c5.ce8c61f7.js" as="script">
<link rel="preload" href="/37e3b3ea.dca7b1f0.js" as="script">
<link rel="preload" href="/b2b675dd.24401601.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Apache APISIX™" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Apache APISIX™" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Apache APISIX™</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/subscribe-guide">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/events">Events</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/team">Team</a><a class="navbar__item navbar__link" href="/help">Help</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Apache APISIX™" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="Apache APISIX™" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Apache APISIX™</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/subscribe-guide">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/events">Events</a></li><li class="menu__list-item"><a class="menu__link" href="/downloads">Downloads</a></li><li class="menu__list-item"><a class="menu__link" href="/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/help">Help</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/18/a-first-look-at-kubernetes-service-api">初探 Kubernetes Service APIs</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/22/new-website">New website for Apache APISIX</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></h2><div class="margin-vert--md"><time datetime="2021-02-08T00:00:00.000Z" class="blogPostDate_Ta7i">February 8, 2021  · 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/LiteSun" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/31329157?s=400&amp;u=e81b4bb4db2be162c1fcac6d188f5b0f82f71920&amp;v=4" alt="Yi Sun"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/LiteSun" target="_blank" rel="noreferrer noopener">Yi Sun</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><blockquote><p><a href="https://github.com/LiteSun" target="_blank" rel="noopener noreferrer">@LiteSun</a>, Apache APISIX Committer from <a href="https://www.apiseven.com/" target="_blank" rel="noopener noreferrer">Shenzhen Zhiliu Technology Co.</a></p><p>Source:</p><ul><li><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix</a></li><li><a href="https://github.com/apache/apisix-dashboard" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-dashboard</a></li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>The Apache APISIX Dashboard is designed to make it as easy as possible for users to operate Apache APISIX through a front-end interface, and since the project&#x27;s inception, there have been 552 commits and 10 releases. With such rapid product iteration, it is important to ensure the quality of the open-source product. For this reason, we have introduced an E2E testing module to ensure stable product delivery.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-front-end-e2e"></a>What is Front-End E2E?<a class="hash-link" href="#what-is-front-end-e2e" title="Direct link to heading">#</a></h2><p>E2E, which stands for &quot;End to End&quot;, can be translated as &quot;end-to-end&quot; testing. It mimics user behavior, starting with an entry point and executing actions step-by-step until a job is completed. Sound testing prevents code changes from breaking the original logic.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="why-cypress"></a>Why Cypress<a class="hash-link" href="#why-cypress" title="Direct link to heading">#</a></h2><p>We used Taiko, Puppeteer, TestCafe, and Cypress to write test cases for creating routes during the selection research period, and we used each testing framework to write cases to experience their respective features.</p><p>Taiko is characterized by smart selector, which can intelligently locate the elements that you want to operate based on text content and location relations, and has a low start-up cost, so you can finish the test cases quickly. However, it is not user-friendly when writing test cases. When the user exits the terminal by mistake, all the written test cases are lost, and if you want to run a complete test case, you need to use it together with other test runners, which undoubtedly increases the learning cost for the user.</p><p>Puppeteer has the best performance. However, testing is not the focus of Puppeteer. It is widely used for web crawlers. Our project started with Puppeteer, the official E2E testing framework recommended by ANTD, and after using it for a while we found that Puppeteer did not look so friendly to non-front-end developers and it was hard to get other users involved. When users write test cases, the lack of intelligent element positioning makes the learning curve very high.</p><p>TestCafe is surprisingly easy to install, it has a built-in waiting mechanism so that users don&#x27;t have to actively sleep waiting for page interactions, and it supports concurrent multi-browser testing, which is helpful for multi-browser compatibility testing. The disadvantage is that its debugging process is not so user-friendly, and you have to run a new use case after each test case change. For the developers, they need to have some basic Javascript syntax. Secondly, its running speed is relatively slow for several other frameworks, especially when executing withText () to find elements.</p><p>After a comprehensive comparison, we finally chose Cypress as our front-end E2E framework, listing four main reasons:</p><ol><li>Simple syntax</li></ol><p>The syntax used in Cypress tests is very simple and easy to read and write. With a little practice, you can master creating test cases, which is important for open source projects because it allows the community interested in E2E test cases to participate in writing test cases with minimal learning cost.</p><ol start="2"><li>Easy debugging</li></ol><p>When debugging test cases, we can use Cypress&#x27;s Test Runner, which presents multi-dimensional data that allows us to quickly pinpoint the problem.</p><ul><li>Showing the status of the test case execution, including the number of successes, failures, and runs in progress.</li><li>Displaying the total time spent on the execution of the entire test set.</li><li>A built-in Selector Playground to help locate elements.</li><li>shows each step of execution for each use case and forms a snapshot that can show information about each execution step after it is completed.</li></ul><ol start="3"><li>Active community</li></ol><p>Cypress has a large community of users, and there are always many people inside the community sharing their experiences and ideas.</p><p>This is helpful when encountering problems, and you are likely to encounter problems that others have encountered before. Also, when new features are requested, we can participate in the community by discussing and adding features to Cypress that we want to add, just like we do in the APISIX community: listening to the community and feeding it back.</p><ol start="4"><li>Clear documentation</li></ol><p>Cypress&#x27;s documentation structure is clearer and more comprehensive. In the early stages of use, we were able to quickly introduce Cypress into our project and write our first case based on the official documentation guidelines. In addition, there is a large amount of documentation available on the documentation site that gives users good guidance on what is best practice.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cypress-and-apisix-dashboard"></a>Cypress and APISIX Dashboard<a class="hash-link" href="#cypress-and-apisix-dashboard" title="Direct link to heading">#</a></h2><p>There are currently 49 test cases written for the APISIX Dashboard. We configured the corresponding CI in GitHub Action to ensure that the code passes before each merge to ensure code quality. We share the use of Cypress in APISIX Dashboard with you by referring to Cypress best practices and combining them with our project.</p><p><img src="https://static.apiseven.com/202102/apisix-dashboard-e2e.gif" alt="image"></p><p><img src="https://static.apiseven.com/202102/image.png" alt="image"></p><ol><li>Commonly used functions are encapsulated into commands.</li></ol><p>Take login as an example, login is an essential part of entering the system, so we encapsulate it as a command, so that the login command can be called before each case run.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javaScript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Cypress.Commands.add(&quot;login&quot;, () =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cy.request(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;POST&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;http://127.0.0.1/apisix/admin/user/login&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      username: &quot;user&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      password: &quot;user&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ).then((res) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    expect(res.body.code).to.equal(0);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    localStorage.setItem(&quot;token&quot;, res.body.data.token);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javaScript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">beforeEach(() =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // init login</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   cy.login();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li>Extract the selector and data as public variables.</li></ol><p>To make it more intuitive for the user to understand the meaning of the test code, we extract selcector and data as public variables.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javaScript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const data = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: &#x27;hmac-auth&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deleteSuccess: &#x27;Delete Plugin Successfully&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const domSelector = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    tableCell: &#x27;.ant-table-cell&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    empty: &#x27;.ant-empty-normal&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    refresh: &#x27;.anticon-reload&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    codemirror: &#x27;.CodeMirror&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    switch: &#x27;#disable&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    deleteBtn: &#x27;.ant-btn-dangerous&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="3"><li>Remove cy.wait(someTime)</li></ol><p>We used cy.wait(someTime) in the early days of Cypress, but found that cy.wait(someTime) relies too much on the network environment and the performance of the test machine, which can cause test cases to report errors when the network environment or machine performance is poor. The recommended practice is to use it in conjunction with cy.intercpet() to explicitly specify the network resources to wait for.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-javascript codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">intercept</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://apisix.apache.org/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword module" style="font-style:italic">as</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fetchURL&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@fetchURL&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>At present, APISIX Dashboard has written 49 test cases. In the future, we will continue to enhance the front-end E2E coverage, and require the community to agree to write test cases for each new feature or bugfix submission to ensure the stability of the product.</p><p>Welcome to join us to polish the world-class gateway product.</p><p>Project address: <a href="https://github.com/apache/apisix-dashboard" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-dashboard</a></p></section></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></h2><div class="margin-vert--md"><time datetime="2021-01-21T00:00:00.000Z" class="blogPostDate_Ta7i">January 21, 2021  · 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/tokers" target="_blank" rel="noreferrer noopener"><img src="https://avatars0.githubusercontent.com/u/10428333?s=60&amp;v=4" alt="Chao Zhang"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/tokers" target="_blank" rel="noreferrer noopener">Chao Zhang</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><blockquote><p><a href="https://github.com/tokers" target="_blank" rel="noopener noreferrer">@Chao Zhang</a>, Apache APISIX Comitter from <a href="https://www.apiseven.com/" target="_blank" rel="noopener noreferrer">Shenzhen Zhiliu Technology Co.</a></p><p>Source:</p><ul><li><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix</a></li><li><a href="https://github.com/apache/apisix-helm-chart" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-helm-chart</a></li><li><a href="https://github.com/apache/apisix-ingress-controller" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-ingress-controller</a></li></ul></blockquote><p>This post is based on <a href="https://github.com/apache/apisix-ingress-controller/blob/master/docs/deployments/aws.md" target="_blank" rel="noopener noreferrer">Install Ingress APISIX on Amazon EKS</a>.</p><ul><li></li></ul><p>Amazon Elastic Kubernetes Service (<a href="https://amazonaws-china.com/eks/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc&amp;eks-blogs.sort-by=item.additionalFields.createdDate&amp;eks-blogs.sort-order=desc" target="_blank" rel="noopener noreferrer">Amazon EKS</a>) gives you the flexibility to start, run, and scale Kubernetes applications in the AWS cloud or on-premises. This article explains how to run Ingress APISIX on it.</p><p>Ingress APISIX brings good features (traffic splitting, multiple protocols, authentication and etc) of Apache APISIX to Kubernetes, with a well-designed Controller componment to drive it, which helps users to achieve complex demands for the north-south traffic.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>Before you go ahead, make sure you have an available EKS cluster on Amazon AWS. If you don&#x27;t have one, please create it according to the guide.</p><p>You shall have kubectl tool in your own environment, set the context to your EKS cluster by running:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws eks update-kubeconfig --name </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your eks cluster name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --region </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your region</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>After the Kubernetes cluster is ready, creating the namespace ingress-apisix, all subsequent resources will be created at this namespace.</p><p>kubectl create namespace ingress-apisix</p><p>We use <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> to deploy all components in Ingress APISIX (<a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">Apache APISIX</a> and <a href="https://github.com/apache/apisix-ingress-controller" target="_blank" rel="noopener noreferrer">apisix-ingress-controller</a>), so please also install Helm according to its installation guide. The helm charts for Apache APISIX and apisix-ingress-controller are in apache/apisix-helm-chart and apache/apisix-ingress-controller, clone them to get the charts.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="install-apache-apisix"></a>Install Apache APISIX<a class="hash-link" href="#install-apache-apisix" title="Direct link to heading">#</a></h2><p>Apache APISIX as the proxy plane of apisix-ingress-controller, should be deployed in advance.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /path/to/apisix-helm-chart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> bitnami https://charts.bitnami.com/bitnami</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm dependency update ./chart/apisix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> apisix ./chart/apisix </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --set gateway.type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LoadBalancer </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --set allow.ipList</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{0.0.0.0/0}&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace ingress-apisix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> --namespace ingress-apisix</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The above commands created two Kubernetes Service resources, one is <code>apisix-gateway</code>, which processes the real traffic; another is <code>apisix-admin</code>, which acts as the control plane to process all the configuration changes. Here we created the <code>apisix-gateway</code> as a <code>LoadBalancer</code> type Service, which resorts the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html" target="_blank" rel="noopener noreferrer">AWS Network Balancer</a> to expose it to the Internet. You can find the load balancer hostname by the following command:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> apisix-gateway </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--namespace ingress-apisix </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-o </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">jsonpath</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{.status.loadBalancer.ingress[].hostname}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> Another thing should be concerned that the <code>allow.ipList</code> field should be customized according to the <a href="https://amazonaws-china.com/premiumsupport/knowledge-center/eks-multiple-cidr-ranges/" target="_blank" rel="noopener noreferrer">EKS CIDR Ranges</a> in your EKS cluster, so that the apisix-ingress-controller can be authorized by Apache APISIX (for the resources pushing).</p><p>See value.yaml](<a href="https://github.com/apache/apisix-helm-chart/blob/master/chart/apisix/values.yaml" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-helm-chart/blob/master/chart/apisix/values.yaml</a>) to learn all the configuration items if you have other requirements.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="install-apisix-ingress-controller"></a>Install apisix-ingress-controller<a class="hash-link" href="#install-apisix-ingress-controller" title="Direct link to heading">#</a></h2><p>After Apache APISIX is deployed successfully, now it&#x27;s time to install the controller component.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /path/to/apisix-ingress-controller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># install base resources, e.g. ServiceAccount.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> ingress-apisix-base -n ingress-apisix ./charts/base</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># install apisix-ingress-controller</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> ingress-apisix ./charts/ingress-apisix </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --set ingressController.image.tag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dev </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --set ingressController.config.apisix.baseURL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">http://apisix-admin:9180/apisix/admin </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --set ingressController.config.apisix.adminKey</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">YOUR ADMIN KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace ingress-apisix</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The ingress-apisix-base chart installed some basic dependencies for apisix-ingress-controller, such as ServiceAccount, its exclusive CRDs and etc.</p><p>The ingress-apisix chart guides us how to install the controller itself, you can change the image tag to the desired release version, also the value of <code>ingressController.config.apisix.adminKey</code> in abovementioned commands should be filled according to your pratical usage (and be sure the admin key is same as the on in Apache APISIX deployment). See <a href="https://github.com/apache/apisix-ingress-controller/blob/master/charts/ingress-apisix/values.yaml" target="_blank" rel="noopener noreferrer">value.yaml</a> to learn all the configuration items if you have other requirements.</p><p>Now try to open your EKS console, choosing your cluster and clicking the Workloads tag, you shall see all pods of Apache APISIX, etcd and apisix-ingress-controller are ready.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="test"></a>Test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h2><p>Now we have deployed all components in Ingress APISIX, it&#x27;s important to check whether it runs well. We will deploy a httpbin service and ask Apache APISIX to route all requests with Host <code>&quot;local.httpbin.org&quot;</code> to it.</p><p>The first step we should do is created the httpbin workload and expose it.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl run httpbin --image kennethreitz/httpbin --port </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl expose pod httpbin --port </span><span class="token number" style="color:rgb(247, 140, 108)">80</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In order to let Apache APISIX routes requests correctly, we need create an ApisixRoute resource to drive it.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ar-httpbin.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apisix.apache.org/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ApisixRoute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: httpserver-route</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - host: local.httpbin.org</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    http:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      paths:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - backend:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          serviceName: httpbin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          servicePort: </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        path: /*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The above ApisixRoute resource asks Apache APISIX to route requests which Host header is <code>&quot;local.httpbin.org&quot;</code> to the httpbin backend (the one we just created).</p><p>Now try to apply it, note the service and the ApisixRoute resource should be put in the same namespace., crossing namespaces is not allowed in apisix-ingress-controller.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f ar-httpbin.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Test it by a simple curl call from a place where the Apache APISIX service is reachable.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">apisix-gateway-ip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">apisix-gateway-port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">/headers -s -H </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Host: local.httpbin.org&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;headers&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Accept&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*/*&quot;</span><span class="token plain">,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Host&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;httpbin.org&quot;</span><span class="token plain">,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;User-Agent&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;curl/7.64.1&quot;</span><span class="token plain">,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;X-Amzn-Trace-Id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Root=1-5ffc3273-2928e0844e19c9810d1bbd8a&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If the Serivce type is <code>ClusterIP,</code> you have to login to a pod in the EKS cluster, then accessing Apache APISIX with its <code>ClusterIP</code> or Service FQDN. If it was exposed (no matter <code>NodePort</code> or <code>LoadBalancer</code>), just accessing its outside reachable endpoint.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="see-also"></a>See Also<a class="hash-link" href="#see-also" title="Direct link to heading">#</a></h2><ul><li><a href="https://www.apiseven.com/zh/blog/a-first-look-at-kubernetes-service-api" target="_blank" rel="noopener noreferrer">https://www.apiseven.com/zh/blog/a-first-look-at-kubernetes-service-api</a></li><li><a href="https://www.apiseven.com/zh/blog/another-way-to-implement-envoy-filter" target="_blank" rel="noopener noreferrer">https://www.apiseven.com/zh/blog/another-way-to-implement-envoy-filter</a></li></ul></section></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog/2020/12/18/a-first-look-at-kubernetes-service-api">初探 Kubernetes Service APIs</a></h2><div class="margin-vert--md"><time datetime="2020-12-18T00:00:00.000Z" class="blogPostDate_Ta7i">December 18, 2020  · 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/gxthrj" target="_blank" rel="noreferrer noopener"><img src="https://avatars2.githubusercontent.com/u/4413028?s=400&amp;u=e140a6d2bf19c426da6498b8888edc96509be649&amp;v=4" alt="Wei Jin"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/gxthrj" target="_blank" rel="noreferrer noopener">Wei Jin</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><blockquote><p><a href="https://github.com/gxthrj" target="_blank" rel="noopener noreferrer">@gxthrj</a>, Apache APISIX PMC &amp; Apache apisix-ingress-controller Founder from <a href="https://www.apiseven.com/" target="_blank" rel="noopener noreferrer">Shenzhen Zhiliu Technology Co.</a></p><p>Source:</p><ul><li><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix</a></li><li><a href="https://github.com/apache/apisix-ingress-controller" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-ingress-controller</a></li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="前言"></a>前言<a class="hash-link" href="#前言" title="Direct link to heading">#</a></h2><p>笔者是 Apache APISIX PMC，也是 Apache APISIX Ingress Controller Founder，通过调研和社区交流，打算在 Apache APISIX Ingress Controller 的后期版本中逐步支持 Kubernetes Service APIs.</p><p>我们知道 Kubernetes 为了将集群内部服务暴露出去，有多种方案实现，其中一个比较受大众推崇的就是 Ingress。Ingress 作为一种对外暴露服务的标准，有相当多的第三方实现，每种实现都有各自的技术栈 和 所依赖的网关的影子，相互之间并不兼容。</p><p>为了统一各种 Ingress 的实现，便于 Kubernetes 上统一管理，<a href="https://github.com/kubernetes/community/tree/master/sig-network" target="_blank" rel="noopener noreferrer">SIG-NETWORK</a> 社区推出了<a href="https://kubernetes-sigs.github.io/service-apis/" target="_blank" rel="noopener noreferrer">Kubernetes Service APIs</a> 一套标准实现，称为第二代 Ingress 。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="主题描述"></a>主题描述<a class="hash-link" href="#主题描述" title="Direct link to heading">#</a></h2><p>本文从几个问题入手，对 Kubernetes Service APIs 的基本概念进行介绍。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="介绍"></a>介绍<a class="hash-link" href="#介绍" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="kubernetes-service-apis-号称第二代-ingress-技术，到底在哪些方面优于第一代？"></a>Kubernetes Service APIs 号称第二代 Ingress 技术，到底在哪些方面优于第一代？<a class="hash-link" href="#kubernetes-service-apis-号称第二代-ingress-技术，到底在哪些方面优于第一代？" title="Direct link to heading">#</a></h3><p>Kubernetes Service APIs 设计之初，目标并没有局限在 Ingress， 而是为了增强 service networking，着重通过以下几点来增强：表达性、扩展性、RBAC。</p><ol><li>更强的表达能力，例如 可以根据 header 、weighting 来管理流量</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-text codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: HTTPRoute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: networking.x-k8s.io/v1alpha1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">matches:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - path:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      value: &quot;/foo&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    headers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      values:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        version: &quot;2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - path:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      value: &quot;/v2/foo&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li>增强了扩展能力，Service APIs 提出多层 API 的概念，各层独立暴露接口，方便其他自定义资源与 API 对接，做到更细粒度（API 粒度）的控制。</li></ol><p><img src="https://kubernetes-sigs.github.io/service-apis/images/api-model.png" alt="api-model"></p><ol start="3"><li>面向角色 RBAC：多层 API 的实现，其中一个思想就是从使用者的角度去设计资源对象。这些资源最终会与 Kubernetes 上运行应用程序的常见角色进行映射。</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="kubernetes-service-apis-抽象出了哪些资源对象？"></a>Kubernetes Service APIs 抽象出了哪些资源对象？<a class="hash-link" href="#kubernetes-service-apis-抽象出了哪些资源对象？" title="Direct link to heading">#</a></h2><p>Kubernetes Service APIs 基于使用者角色，将定义了以下几种资源：</p><p>GatewayClass, Gateway, Route</p><ol><li>GatewayClass 定义了一组具有通用配置和行为的网关类型</li></ol><ul><li><p>与 Gateway 的关系，类似 ingress 中的 ingress.class annotation；</p></li><li><p>GatewayClass 定义了一组共享相同配置和行为的网关。每个 GatewayClass 将由单个 controller 处理，controller 与 GatewayClass 是一对多的关系；</p></li><li><p>GatewayClass 是 cluster 资源。必须至少定义一个 GatewayClass 才能具有功能网关。</p></li></ul><ol start="2"><li>Gateway 请求一个可以将流量转换为群集内服务的点。</li></ol><ul><li><p>作用：把集群外的流量引入集群内部。这个才是真正的 ingress 实体；</p></li><li><p>它定义了对特定 LB 配置的请求，该配置也是 GatewayClass 的配置和行为的实现；</p></li><li><p>Gateway 资源可以由操作员直接创建，也可以由处理 GatewayClass 的 controller 创建；</p></li><li><p>Gateway 与 Route 是多对多的关系；</p></li></ul><ol start="3"><li>Route 描述了通过网关的流量如何映射到服务。</li></ol><p><img src="https://kubernetes-sigs.github.io/service-apis/images/schema-uml.svg" alt="schema-uml"></p><p>另外，Kubernetes Service APIs 为了能够灵活的配置后端服务，特地定义了一个 BackendPolicy 资源对象。</p><p>通过 BackendPolicy 对象，可以配置 TLS、健康检查 以及指定后端服务类型，比如 service 还是 pod。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="kubernetes-service-apis-的推行会带来哪些改变？"></a>Kubernetes Service APIs 的推行会带来哪些改变？<a class="hash-link" href="#kubernetes-service-apis-的推行会带来哪些改变？" title="Direct link to heading">#</a></h2><p>Kubernetes Service APIs 作为一种实现标准，带来了以下改变：</p><ol><li><p>通用性： 可以有多种实现，就像 ingress 有多种实现一样，可以根据网关的特点去自定义 ingress controller，但是他们都有一致的配置结构。一种数据结构，可以配置多种 ingress controller。</p></li><li><p>Class 概念：GatewayClasses 可以配置不同负载均衡实现的类型。这些类 class 使用户可以轻松而明确地了解哪些功能可以用作资源模型本身。</p></li><li><p>共享网关：通过允许独立的路由资源 HTTPRoute 绑定到同一个 GatewayClass，它们可以共享负载平衡器和 VIP。按照使用者分层，这使得团队可以安全地共享基础结构，而无需关心下层 Gateway 的具体实现。</p></li><li><p>带类型的后端引用: 使用带类型的后端引用，路由可以引用 Kubernetes Services，也可以引用任何类型的设计为网关后端的 Kubernetes 资源，比如 pod，又或者是 statefulset 比如 DB， 甚至是可访问的集群外部资源。</p></li><li><p>跨命名空间引用：跨不同命名空间的路由可以绑定到 Gateway。允许跨命名空间的互相访问。同时也可以限制某个 Gateway 下的 Route 可以访问的命名空间范围。</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="目前有哪些-ingress-实现了-kubernetes-service-apis-？"></a>目前有哪些 ingress 实现了 Kubernetes Service APIs ？<a class="hash-link" href="#目前有哪些-ingress-实现了-kubernetes-service-apis-？" title="Direct link to heading">#</a></h2><p>目前已知的从代码层面能看到对 Kubernetes Service APIs 资源对象支持的 Ingress 有 Contour, ingress-gce。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="kubernetes-service-apis-如何管理资源读写权限？"></a>Kubernetes Service APIs 如何管理资源读写权限？<a class="hash-link" href="#kubernetes-service-apis-如何管理资源读写权限？" title="Direct link to heading">#</a></h2><p>Kubernetes Service APIs 按照使用者的维度分为 3 个角色</p><ol><li><p>基础设施提供方 GatewayClass</p></li><li><p>集群操作人员 Gateway</p></li><li><p>应用开发者 Route</p></li></ol><p>RBAC（基于角色的访问控制）是用于 Kubernetes 授权的标准。允许用户配置谁可以对特定范围内的资源执行操作。 RBAC 可用于启用上面定义的每个角色。</p><p>在大多数情况下，希望所有角色都可以读取所有资源</p><p>三层模型的写权限如下。</p><table><thead><tr><th></th><th>GatewayClass</th><th>Gateway</th><th>Route</th></tr></thead><tbody><tr><td>Infrastructure Provider</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Cluster Operators</td><td>No</td><td>Yes</td><td>Yes</td></tr><tr><td>Application Developers</td><td>No</td><td>No</td><td>Yes</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="kubernetes-service-apis-有哪些扩展点？"></a>Kubernetes Service APIs 有哪些扩展点？<a class="hash-link" href="#kubernetes-service-apis-有哪些扩展点？" title="Direct link to heading">#</a></h2><p>网关的需求非常丰富，同一个场景实现的方式多种多样，各有利弊。Kubernetes Service APIs 提炼出 多层 资源对象，同时也预留了一些扩展点。</p><p>目前 Kubernetes Service APIs 的扩展点基本集中在 Route 上：</p><ul><li><p>RouteMatch 可以扩展 Route 匹配规则。</p></li><li><p>specify Backend 可以扩展特定类型的 后端服务， 除了上面提到的 Kubernetes 资源外，还可以扩展比如 文件系统，函数表达式等。</p></li><li><p>Route filter 可以在 Route 的生命周期中增加扩展点，处理 request/response 。</p></li><li><p>Custom Route 以上扩展点都不能满足时，可以完全自定义一个 Route。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h2><p>本文通过提问的方式，对 Kubernetes Service APIs 做了一些基本介绍，从整体来看，Kubernetes Service APIs 提炼了很多 ingress 的最佳实践，比如表达能力的增强，其实就是扩展了 Route 的能力，再比如 BackendPolicy 对象，可以为 upstream 指定几乎所有的 Kubernetes 后端资源。当然，项目初期也有不足的地方，目前 Kubernetes Service APIs 虽然已经从大的层面上规定了资源对象，但资源对象内部还有不少细节需要讨论之后再确定，以防止可能出现的冲突场景，结构上存在一定变数。</p><hr><p>参考:</p><ul><li><a href="https://kubernetes-sigs.github.io/service-apis/" target="_blank" rel="noopener noreferrer">https://kubernetes-sigs.github.io/service-apis/</a></li><li><a href="https://www.apiseven.com/zh/blog/a-first-look-at-kubernetes-service-api" target="_blank" rel="noopener noreferrer">https://www.apiseven.com/zh/blog/a-first-look-at-kubernetes-service-api</a></li></ul></section></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></h2><div class="margin-vert--md"><time datetime="2020-12-16T00:00:00.000Z" class="blogPostDate_Ta7i">December 16, 2020  · 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/nic-chen" target="_blank" rel="noreferrer noopener"><img src="https://avatars0.githubusercontent.com/u/33000667" alt="nic-chen"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/nic-chen" target="_blank" rel="noreferrer noopener">nic-chen</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><blockquote><p><a href="https://github.com/nic-chen" target="_blank" rel="noopener noreferrer">@nic-chen</a>, Apache APISIX PMC from <a href="https://www.apiseven.com/" target="_blank" rel="noopener noreferrer">Shenzhen Zhiliu Technology Co.</a></p><p>Source: <a href="https://www.apiseven.com/en/blog/another-way-to-implement-envoy-filter" target="_blank" rel="noopener noreferrer">https://www.apiseven.com/en/blog/another-way-to-implement-envoy-filter</a></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ways-to-implement-envoy-filter"></a>Ways to implement Envoy filter<a class="hash-link" href="#ways-to-implement-envoy-filter" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="envoy-filter"></a>Envoy filter<a class="hash-link" href="#envoy-filter" title="Direct link to heading">#</a></h3><p>Envoy is an L7 proxy and communication bus designed for large modern service oriented architectures.
A pluggable filter chain mechanism allows filters to be written to perform different tasks and inserted into the main server.</p><p><img src="https://static.apiseven.com/filters.png" alt="Envoy filter"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="expansion-method"></a>Expansion method<a class="hash-link" href="#expansion-method" title="Direct link to heading">#</a></h3><p>The existing filters may not meet the user&#x27;s custom requirements. In this case, Envoy needs to be extended. Customize new filters according to the existing filter chain to achieve customization requirements.</p><p>Developers can extend Envoy in three ways:</p><table><thead><tr><th align="center"></th><th align="center">Getting Started difficulty</th><th align="center">stability</th><th align="center">development efficiency</th><th align="center">Deploy and compile</th></tr></thead><tbody><tr><td align="center">C++</td><td align="center">high</td><td align="center">stable</td><td align="center">low</td><td align="center">long time to compile</td></tr><tr><td align="center">Lua</td><td align="center">low</td><td align="center">stable</td><td align="center">High</td><td align="center">no need to compile, deploy directly</td></tr><tr><td align="center">WASM</td><td align="center">high-medium</td><td align="center">on the fence</td><td align="center">depends on language</td><td align="center">compilation time depends on language</td></tr></tbody></table><ol><li>Using C++ to extend</li></ol><p>In this way, C++ code is written directly on the basis of Envoy for functional enhancement. After implementing a custom filter, the new binary file is recompiled to complete the upgrade. There are two problems with this way:</p><ul><li><p>Limited by the C++ language, difficulty of getting started, scarcity of developers.</p></li><li><p>Increasing the complexity of deployment, operation and maintenance, and upgrades. Envoy will become heavier and heavier, and every change requires recompiling the binary file, which is not conducive to iteration and management.</p></li></ul><ol start="2"><li>Using Lua to extend</li></ol><p>Lua is born to be embedded in the application, so as to provide flexible extension and customization features for application, and is widely used.</p><p>Lua Filter allows Lua scripts to be run in the request and response process. The main features currently supported include: inspection of headers, body, and trailers while streaming in either the request flow, response flow;modification of headers and trailers;blocking and buffering the full request/response body for inspection;performing an outbound async HTTP call to an upstream host;performing a direct response and skipping further filter iteration, etc.</p><p>At present, many people directly distribute Lua code in configuration, which is not conducive to code organization and management, and it is difficult to share with others to form an ecosystem.</p><ol start="3"><li>Using WASM extension</li></ol><p>Developers can write filters in their own programming language, compile them into WASM format using tools, and embed them into Envoy to run.</p><p>It currently supports few languages, and using these languages ​​to extend is still not that simple. On the other hand, many people still have reservations about WASM and may not directly use it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="apache-apisix-solution"></a>Apache APISIX solution<a class="hash-link" href="#apache-apisix-solution" title="Direct link to heading">#</a></h2><p>Based on the above analysis, we could see that Lua is very suitable for extending Envoy, and it is easy to learn, and the development efficiency is extremely high. Because it is embedded in Envoy, there is no additional network overhead, and the performance is good.</p><p><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">Apache APISIX</a> community proposes its own solution based on Lua, which is to provide a powerful and flexible basic library to implement all plugins of Apache APISIX and plugins that will be developed in the future to run on Envoy. Developers could also develop their own customized plugins based on this basic library.</p><p>Apache APISIX is a dynamic, real-time, high-performance API gateway, based on the Nginx library and Lua. Apache APISIX provides rich traffic management features such as load balancing, dynamic upstream, canary release, circuit breaking, authentication, observability, and more.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h3><p>Please check the repo for specific code and how to run: <a href="https://github.com/api7/envoy-apisix" target="_blank" rel="noopener noreferrer">https://github.com/api7/envoy-apisix</a></p><p>The relevant configuration of Envoy is as follows:</p><p>Define a Filter:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">http_filters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> entry.lua</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">typed_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">source_codes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">entry.lua</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">filename</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /apisix/entry.lua</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Enable the Filter for a route and configure it with metadata:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">match</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">prefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/foo&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">route</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cluster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> web_service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">typed_per_filter_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">envoy.filters.http.lua</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">&quot;@type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> type.googleapis.com/envoy.extensions.filters.http.lua.v3.LuaPerRoute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> entry.lua</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">filter_metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">envoy.filters.http.lua</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">plugins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">blocker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">conf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">rejected_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">403</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">block_rules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> root.exe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> root.m+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-does-it-work"></a>How does it work<a class="hash-link" href="#how-does-it-work" title="Direct link to heading">#</a></h3><p>We don&#x27;t need to make major changes to Envoy, only some optimizations that are suitable for public needs.</p><p>We shield platform differences for the plugin layer. All interfaces that need to be used are abstracted in the underlying framework, which we call apisix.core, so that all plugins can run on Envoy and Apache APISIX at the same time.</p><p><img src="https://static.apiseven.com/main.png" alt="Architecture diagram"></p><p>We use the previous example to show how the plugin runs:</p><p><img src="https://static.apiseven.com/workflow.png" alt="Plugin workflow"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="first-step-read-configuration"></a>First step, read configuration<a class="hash-link" href="#first-step-read-configuration" title="Direct link to heading">#</a></h4><p>We configure through metadata to determine what plugins need to run on each route and what configuration is for each plugin.
In the example, we configured plugin <code>uri-blocker</code> for the route whose prefix is ​​<code>/foo</code>, as well as the block rule of the plugin and the response status when a block is required.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="second-step-parse-request"></a>Second step, parse request<a class="hash-link" href="#second-step-parse-request" title="Direct link to heading">#</a></h4><p>We encapsulated the client request data into <code>ctx</code> so that it can be used directly in the entire process.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="third-step-run-the-plugin"></a>Third step, run the plugin<a class="hash-link" href="#third-step-run-the-plugin" title="Direct link to heading">#</a></h4><p>We determine whether we need to block this request by matching the configured rules and the obtained uri. If a block is needed, we call <code>respond</code> to directly respond, otherwise we let it go.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="future-outlook"></a>Future outlook<a class="hash-link" href="#future-outlook" title="Direct link to heading">#</a></h2><p>More and more APISIX plugins are available to run on Envoy, and finally all APISIX plugins (Even that will be developed in the future) will be available to run on Envoy.</p><p>At the same time, we hope that we could work with the Envoy community in the direction of Lua Filter, optimize and improve Lua Filter, enhance the expansion capabilities of Envoy, and reduce the difficulty of Envoy expansion.</p></section></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog/2020/08/22/new-website">New website for Apache APISIX</a></h2><div class="margin-vert--md"><time datetime="2020-08-22T00:00:00.000Z" class="blogPostDate_Ta7i">August 22, 2020  · 1 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/juzhiyuan" target="_blank" rel="noreferrer noopener"><img src="https://avatars3.githubusercontent.com/u/2106987?s=460&amp;u=f92e880ce95fe1fee18becd0a803f5401eb4ee7f&amp;v=4" alt="juzhiyuan"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/juzhiyuan" target="_blank" rel="noreferrer noopener">juzhiyuan</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>We are just refactored out website for Apache APISIX by using <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">docusaurus</a>.</p></section><footer class="row margin-vert--lg"><div class="col text--right"><a aria-label="Read more about New website for Apache APISIX" href="/blog/2020/08/22/new-website"><strong>Read More</strong></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">ASF</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://apisix.slack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Apache Software Foundation" src="/img/asf_logo_wide_small.png"></a></div><div class="footer__copyright">Copyright © 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX™, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/styles.f6196f2d.js"></script>
<script src="/runtime~main.d0a4354d.js"></script>
<script src="/main.be0eaecb.js"></script>
<script src="/1.b3395235.js"></script>
<script src="/2.05b0df04.js"></script>
<script src="/4.ce841e81.js"></script>
<script src="/a6aa9e1f.0a850dbe.js"></script>
<script src="/2d8fe9ee.8a8bd2e1.js"></script>
<script src="/e451ae2c.5f322c75.js"></script>
<script src="/514de2af.7c1bd42f.js"></script>
<script src="/5bb67ffc.7fd0a4ef.js"></script>
<script src="/e02da2c5.ce8c61f7.js"></script>
<script src="/37e3b3ea.dca7b1f0.js"></script>
<script src="/b2b675dd.24401601.js"></script>
</body>
</html>