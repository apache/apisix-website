<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">Make your security policy auditable | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2023/03/02/security-policy-auditable/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Make your security policy auditable | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="Last week, I wrote about putting the right feature at the right place. I used rate limiting as an example, moving it from a library inside the application to the API Gateway. Today, I&#x27;ll use another example: authentication and authorization.
"><meta data-react-helmet="true" property="og:description" content="Last week, I wrote about putting the right feature at the right place. I used rate limiting as an example, moving it from a library inside the application to the API Gateway. Today, I&#x27;ll use another example: authentication and authorization.
"><meta data-react-helmet="true" name="keywords" content="Cross-cutting concerns,Architecture,Security,Spring Security,Solutions Architecture"><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/uploads/2023/06/08/pzULiHZO_opa-horizontal-color.svg"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/uploads/2023/06/08/pzULiHZO_opa-horizontal-color.svg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2023-03-02T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/nfrankel"><meta data-react-helmet="true" property="article:tag" content="Ecosystem"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2023/03/02/security-policy-auditable/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2023/03/02/security-policy-auditable/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://blog.frankel.ch/security-policy-auditable/"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">ü§î Introducing APISIX AI Gateway ‚Äì Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">‰∏≠ÊñáÂçöÂÆ¢</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Make your security policy auditable</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2023-03-02T00:00:00.000Z" itemprop="datePublished">March 2, 2023</time> ¬∑ <!-- -->9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/nfrankel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/752258" alt="Nicolas Fr√§nkel"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nfrankel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nicolas Fr√§nkel</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><meta itemprop="image" content="https://static.apiseven.com/uploads/2023/06/08/pzULiHZO_opa-horizontal-color.svg"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>Last week, I wrote about <a href="https://blog.frankel.ch/right-feature-right-place/" target="_blank" rel="noopener noreferrer">putting the right feature at the right place</a>. I used rate limiting as an example, moving it from a library inside the application to the API Gateway. Today, I&#x27;ll use another example: authentication and authorization.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="securing-a-spring-boot-application">Securing a Spring Boot application<a aria-hidden="true" class="hash-link" href="#securing-a-spring-boot-application" title="Direct link to heading">‚Äã</a></h2><p>I&#x27;ll keep using Spring Boot in the following because I&#x27;m familiar with it. The Spring Boot application offers a REST endpoint to check employees&#x27; salaries.</p><p>The specific use case is taken from the Open Policy Agent site (more later):</p><blockquote><p>Create a policy that allows users to request their own salary as well as the salary of their direct subordinates.</p></blockquote><p>We need a way to:</p><ol><li>Authenticate an HTTP request as coming from a known user</li><li>Check whether the user has access to the salary data</li></ol><p>In any other case, return a <code>401</code>.</p><p>I&#x27;ll pass an authentication token in the request to keep things simple. I won&#x27;t rely on a dedicated authentication/authorization backend, such as Keycloak, but it should be a similar approach if you do.</p><p>To enable Spring Security on the app, we need to add the Spring Boot Security Starter.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK xml"><pre tabindex="0" class="prism-code language-xml codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>We also need to enable Spring Security to work its magic:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class SecureBootApplication</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>With those two steps in place, we can start securing the application according to the above requirement:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">internal fun security() = beans {                                       //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val http = ref&lt;HttpSecurity&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            authorizeRequests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                authorize(&quot;/finance/salary/**&quot;, authenticated)          //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            addFilterBefore&lt;UsernamePasswordAuthenticationFilter&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                TokenAuthenticationFilter(ref())                        //3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            httpBasic { disable() }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            csrf { disable() }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logout { disable() }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sessionManagement {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sessionCreationPolicy = SessionCreationPolicy.STATELESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bean { TokenAuthenticationManager(ref(), ref()) }                   //4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Use the Kotlin Beans DSL - because I can</li><li>Only allow access to the endpoint to authenticated users</li><li>Add a filter in the filter chain to replace regular authentication</li><li>Add a custom authentication manager</li></ol><p>Requests look like the following:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Authorization: xyz&#x27;</span><span class="token plain">  localhost:9080/finance/salary/bob</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>The filter extracts from the request the necessary data used to decide whether to allow the request or not:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">internal class TokenAuthenticationFilter(authManager: AuthenticationManager) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AbstractAuthenticationProcessingFilter(&quot;/finance/salary/**&quot;, authManager) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun attemptAuthentication(req: HttpServletRequest, resp: HttpServletResponse): Authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val header = req.getHeader(&quot;Authorization&quot;)                   //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val path = req.servletPath.split(&#x27;/&#x27;)                         //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val token = KeyToken(header, path)                            //3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return authenticationManager.authenticate(token)              //4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // override fun successfulAuthentication(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Get the authentication token</li><li>Get the path</li><li>Wrap it under a dedicated structure</li><li>Try to authenticate the token</li></ol><p>In turn, the manager tries to authenticate the token:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">internal class TokenAuthenticationManager(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val accountRepo: AccountRepository,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val employeeRepo: EmployeeRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) : AuthenticationManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override fun authenticate(authentication: Authentication): Authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val token = authentication.credentials as String? ?:                       //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw BadCredentialsException(&quot;No token passed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val account = accountRepo.findByPassword(token).orElse(null) ?:            //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw BadCredentialsException(&quot;Invalid token&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val path = authentication.details as List&lt;String&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val accountId = account.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val segment = path.last()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (segment == accountId) return authentication.withPrincipal(accountId)   //3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val employee = employeeRepo.findById(segment).orElse(null)                 //4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val managerUserName = employee?.manager?.userName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (managerUserName != null &amp;&amp; managerUserName == accountId)               //5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return authentication.withPrincipal(accountId)                         //5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw InsufficientAuthenticationException(&quot;Incorrect token&quot;)               //6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Get the authorization token passed from the filter</li><li>Try to find the account that has this token. For simplicity&#x27;s sake, the token is stored in plain text without hashing</li><li>If the account tries to access its data, allow it</li><li>If not, we must load the hierarchy from another repo.</li><li>If the account attempts to access data from an employee they manage, allow it.</li><li>Else, deny it.</li></ol><p>The whole flow can be summarized as the following:</p><p></p><div class="rc-image"><img loading="lazy" alt="Spring Security Obfuscated Flow" class="rc-image-img" src="http://www.plantuml.com/plantuml/svg/VL9DIyD04BtlhnXoKh6qYgVYHui6AuYLfj3pT3CbmNHtsGzh_VMwsOIbA-QGXFbuyzwRoSnOrDRj6uRSIWtEa0Oqa476k1HMomPGgJOrLofZ9LhSeY50pgKJreHI5yGwq5uryaWK6l8-oZnH_OcMMYxM4exkFSaKdlCrZ7UrGC5fRB11VHmVAXaXg1JpSde0huX_mDpPIkhw6sqjnMbpIQVOniARF0KyC0YsRqUZC5MJTLh0pUIAKME80NISlUSf5Fbh_hY62zWiybKEx_EYs2nNJt07Vbpax01XH628gI0kRUmrXemVDw0Fe5COSCk3WABTMy3zWxoUJ7mvOdk7yMf_BBxqvW2YmTZV5gBBD5_I02Ivvw8cZPfNnpFZjbANjK1BvX8Kskey4U1XAKLCXgKKSKgodC7r90iQEaBe5IMBN__sJw8gXk7th-gIO2UbtSelDli5k7tp0m00"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Now, we can try some requests.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Authorization: bob&#x27;</span><span class="token plain"> localhost:9080/finance/salary/bob</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p><code>bob</code> asks for his own salary, and it works.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Authorization: bob&#x27;</span><span class="token plain"> localhost:9080/finance/salary/alice</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p><code>bob</code> asks for the salary of one of his subordinates, and it works as well.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;Authorization: bob&#x27;</span><span class="token plain"> localhost:9080/finance/salary/alice</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p><code>alice</code> asks for her manager&#x27;s salary, which is not allowed.</p><p>The code above works perfectly but has one big issue: there&#x27;s no way to audit the logic. One must know Kotlin and how Spring Security works to ensure the implementation is sound.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="introducing-open-policy-agent">Introducing Open Policy Agent<a aria-hidden="true" class="hash-link" href="#introducing-open-policy-agent" title="Direct link to heading">‚Äã</a></h2><p>Open Policy Agent, or OPA for short, describes itself as &quot;Policy-based control for cloud native environments&quot;.</p><blockquote><p>Stop using a different policy language, policy model, and policy API for every product and service you use. Use OPA for a unified toolset and framework for policy across the cloud native stack.</p><p>Whether for one service or for all your services, use OPA to decouple policy from the service&#x27;s code so you can release, analyze, and review policies (which security and compliance teams love) without sacrificing availability or performance.</p><p>-- <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">OPA Website</a></p></blockquote><p>In short, OPA allows writing policies and offers a CLI and a daemon app to evaluate them.</p><p>You write policies in a specific interpreted language named <a href="https://www.openpolicyagent.org/docs/latest/policy-language/" target="_blank" rel="noopener noreferrer">Rego</a>, and I must admit it&#x27;s not fun. Anyway, here&#x27;s our above policy written in &quot;clear&quot; text:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK rego"><pre tabindex="0" class="prism-code language-rego codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">package ch.frankel.blog.secureboot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employees := data.hierarchy                                 #1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default allow := false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Allow users to get their own salaries.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input.path == [&quot;finance&quot;, &quot;salary&quot;, input.user]         #2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Allow managers to get their subordinates&#x27; salaries.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    some username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input.path = [&quot;finance&quot;, &quot;salary&quot;, username]            #3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    employees[input.user][_] == username                    #3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Get the employee hierarchy somehow (see below)</li><li>If the account requests their salary, allow access</li><li>If the account requests the salary of a subordinate, allow access</li></ol><p>I used two variables in the above snippet: <code>input</code> and <code>data</code>. <code>input</code> is the payload that the application sends to OPA. It should be in JSON format and has the following form:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK json"><pre tabindex="0" class="prism-code language-json codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;finance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;salary&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;alice&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;user&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bob&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="more-open-policy-agent-goodness">More Open Policy Agent goodness<a aria-hidden="true" class="hash-link" href="#more-open-policy-agent-goodness" title="Direct link to heading">‚Äã</a></h2><p>However, OPA can&#x27;t decide on the input alone, as it doesn&#x27;t know the employee&#x27;s hierarchy. One approach would be to load the hierarchy data on the app and send it to OPA. A more robust approach is to let OPA access external data to separate responsibilities cleanly. OPA offers <a href="https://www.openpolicyagent.org/docs/latest/external-data/" target="_blank" rel="noopener noreferrer">many options</a> to achieve it. Here, I pretend to extract data from the <code>Employee</code> database, bundle it together with the policy file, serve the bundle via HTTP, and configure OPA to load it at regular intervals.</p><p></p><div class="rc-image"><img loading="lazy" alt="Bundle refresh" class="rc-image-img" src="http://www.plantuml.com/plantuml/svg/VLB1JiCm3BtdAwoUG6BZNb6q8are7DZ4E71D6tUDb3MLauwDhwTf6ZLK6wSwVlQpttDNndAotL4nNbfDW6TBFk86adLu9Knmomjk45gjP7aPuDqGHXWUMwKlYCPtXrV2IjrOqWfqomTekyiJLkYk4PnwhbOQUHw0lELbZP3lDllDLyHSzAKAMPR1YukcDHe1hWYop2cG9svn4i6KrYta5WWFdU84ih589wuCYvGkdaUs52gqPVqNcqJTWCCZXRVzzbrMbwc3mPMTGE2rR4pgV4f7pNT-juU9zNwYTOLnwzDYuNi9RKVDIE57nXqbeOizF9ljascewPFwXFHDqkADtR4HxZ8VM16QUYG85mb3_xc5Wzra_n-ayBh-X4VFOiRlqd9Q7duYvRwOZTzuSK8kFAUp8v1UiS93ONmmpelmhi-SdlleXCzIjHG8bTQsq6UswWkwe_e5"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Note that you shouldn&#x27;t use Apache APISIX only to serve static files. But since I&#x27;ll be using it in the next evolution of my architecture, I want to avoid having a separate HTTP server to simplify the system.</p><p>Now that we moved the decision logic to OPA, we can replace our code with a request to the OPA service. The new version of the authentication manager is:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">internal class OpaAuthenticationManager(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val accountRepo: AccountRepository,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val opaWebClient: WebClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) : AuthenticationManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun authenticate(authentication: Authentication): Authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val token = authentication.credentials as String? ?:                       //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw BadCredentialsException(&quot;No token passed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val account = accountRepo.findByPassword(token).orElse(null) ?:             //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw BadCredentialsException(&quot;Invalid token&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val path = authentication.details as List&lt;String&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val decision = opaWebClient.post()                                         //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .accept(MediaType.APPLICATION_JSON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .contentType(MediaType.APPLICATION_JSON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .bodyValue(OpaInput(DataInput(account.id, path)))                      //3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .exchangeToMono { it.bodyToMono(DecisionOutput::class.java) }          //4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .block() ?: DecisionOutput(ResultOutput(false))                        //5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (decision.result.allow) return authentication.withPrincipal(account.id) //6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else throw InsufficientAuthenticationException(&quot;OPA disallow&quot;)             //6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Keep the initial <em>authentication</em> logic</li><li>Replace the authorization with a call to the OPA service</li><li>Serialize the data to conform to the JSON input that the OPA policy expects</li><li>Deserialize the result</li><li>If something is wrong, the default should be to disallow</li><li>Abide by OPA&#x27;s result</li></ol><p>The flow is now the following:</p><p></p><div class="rc-image"><img loading="lazy" alt="Spring Security flow with OPA" class="rc-image-img" src="http://www.plantuml.com/plantuml/svg/VLB1RXCn4BtxAvxs18YGW3X551h12eHGKpMLUk7YsbDYuNeisqifNyzEt5ZPgirXlPetyzuRF_aq5vtASEkLDeKJXam9EgD3f-BOSSP57GfqZ3ju5MEdh2xwMcU2DeQ7K79jFHITCXnAOW-EUjTPdwywqNT_TA6TXP83iu-YkyJN_XBp6nTqC3JFskjqFx_RSgF8b1g_HZ1RCh-n6igMa_kdY-Cm7ROqvVg2CvuIFYdKstwOpQfgeZAaWFUBjufy9WLKptRD9JRzZ_xp9LxXwbj_qUDyjTbShI--u0GYrpptX2eX3eUGfQS6zpjMHEIEx0SyR0WSvlAB0YNH_RvPdy65E9GwSnY60DDy3dKuwYKo1VjYHtyvuKjN0FctuMPgoRZiE43UXlqPEDGLNYEoT-OUEbZ8stbQqz8Zg8KdTRl-tkLPZYzjvasYF8proOXwlfDGdutrtM8XxHRiyVW12bRLKxvfe59EdllMMS8DSxdcl-fq90ot_Zy0"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>At this point, we moved the authorization logic from the code to OPA.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="moving-authentication-to-the-api-gateway">Moving authentication to the API Gateway<a aria-hidden="true" class="hash-link" href="#moving-authentication-to-the-api-gateway" title="Direct link to heading">‚Äã</a></h2><p>The next and final step is to move the <em>authentication</em> logic The obvious candidate is the API Gateway since we set Apache APISIX in the previous step. In general, we should use the capabilities of the API Gateway as much as possible and fall back to libraries for the rest.</p><p>Apache APISIX has multiple authentication plugins available. Because I used a bearer token, I&#x27;ll use <a href="https://apisix.apache.org/docs/apisix/plugins/key-auth/" target="_blank" rel="noopener noreferrer">key-auth</a>. Let&#x27;s create our users, or in Apache APISIX terms, <em>consumers</em>:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">consumers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key-auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  alice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> betty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key-auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  betty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key-auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  bob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> charlie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key-auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  charlie</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>Now, we can protect the Spring Boot upstream:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /finance/salary*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">upstream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> roundrobin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">&quot;boot:8080&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key-auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">header</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Authorization                    </span><span class="token comment" style="color:#999988;font-style:italic">#1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">proxy-rewrite</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">set</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">X-Account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $consumer_name            </span><span class="token comment" style="color:#999988;font-style:italic">#2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Authenticate with <code>key-auth</code> and the <code>Authorization</code> header</li><li>Sets the consumer id in the <code>X-Account</code> HTTP header for the upstream</li></ol><p>APISIX guarantees that requests that reach the Spring Boot app are authenticated. The code only needs to call the OPA service and follow the decision. We can entirely remove Spring Security and replace it with a <em>simple</em> filter:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">bean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val repo = ref&lt;EmployeeRepository&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val props = ref&lt;AppProperties&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val opaWebClient = WebClient.create(props.opaEndpoint)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filter { req, next -&gt; validateOpa(opaWebClient, req, next) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GET(&quot;/finance/salary/{user_name}&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal fun validateOpa(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opaWebClient: WebClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    req: ServerRequest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    next: (ServerRequest) -&gt; ServerResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">): ServerResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val httpReq = req.servletRequest()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val account = httpReq.getHeader(&quot;X-Account&quot;)                           //1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val path = httpReq.servletPath.split(&#x27;/&#x27;).filter { it.isNotBlank() }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val decision = opaWebClient.post()                                     //2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .accept(MediaType.APPLICATION_JSON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .contentType(MediaType.APPLICATION_JSON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .bodyValue(OpaInput(DataInput(account, path)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .exchangeToMono { it.bodyToMono(DecisionOutput::class.java) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .block() ?: DecisionOutput(ResultOutput(false))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return if (decision.result.allow) next(req)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else ServerResponse.status(HttpStatus.UNAUTHORIZED).build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><ol><li>Get the account name from the API Gateway</li><li>Nothing changes afterward</li></ol><p>The final flow is the following:</p><p></p><div class="rc-image"><img loading="lazy" alt="Final flow without Spring Security" class="rc-image-img" src="http://www.plantuml.com/plantuml/svg/TL5DJp8n4BxtLqpszBw921fFH0KEnk01IF3WmSlG3cwJqZRz4FZtbhBMtIpiORlppFEndPdwW2x4dMB8Wt4GFJb03nLKR6EY5kYEW5PwUSZmp2Al2MQh-Nh-KJ5kT7169OPjslOFD1Opk5pDgfEz_CP0EO7bcC5pupo6rvTt66wbHirfw56brE6-DaNL4DdvQ2inXffqa3onUdH1FGCLO652HoOc3CuNVnmCYh6Z49s6Xz4T8-M9GNhQyVRgNsTgAzWsMbk4NwJ9dPflw-K2fBOnN1O9kkPZB8x1anR_iln_Lv-w6KXd8PTGGJnTmsZOe2VngTDNzhW1QvJaHq0jG630ovw2UX1QcsUNwj_1bPIh6XKAvzQHZwb-IgWo-qacT7PYY-_zQ9JRPIbzNbbSvcd1pk_kC5jbDc2r50HROyB67DWq2U9E_G00"><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="conclusion">Conclusion<a aria-hidden="true" class="hash-link" href="#conclusion" title="Direct link to heading">‚Äã</a></h2><p>Everything looks like a nail when all you&#x27;ve got is a hammer. Developers&#x27; mighty hammer of choice is code. I&#x27;ve written tons of code to solve problems, and later on, I&#x27;ve used even more libraries to solve even more problems. As you evolve from developer to architect, you increase the number of tools you have. In this regard, code is only one tool among many. Your organization has many infrastructure tools you can leverage to develop solutions at minimal costs.</p><p>In this post, I&#x27;ve shown how you can leverage OPA and Apache APISIX to move your authentication and authorization logic from the code to the infrastructure. The former allows you to audit your security policies, the latter coherence among all your upstream across all tech stacks.</p><p>The complete source code for this post can be found on <a href="https://github.com/ajavageek/secure-boot" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><p><strong>To go further:</strong></p><ul><li><a href="https://docs.spring.io/spring-security/reference/index.html" target="_blank" rel="noopener noreferrer">Spring Security</a></li><li><a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">Open Policy Agent</a></li><li><a href="https://www.openpolicyagent.org/docs/latest/management-bundles/" target="_blank" rel="noopener noreferrer">OPA Bundles</a></li><li><a href="https://play.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">Rego playground</a></li><li><a href="https://www.baeldung.com/spring-security-authorization-opa" target="_blank" rel="noopener noreferrer">Spring Security Authorization with OPA</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/ecosystem/">Ecosystem</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2023/03/09/authenticate-openid-connect/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">Authenticate with OpenID Connect and Apache APISIX</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2023/03/02/weekly-report-0226/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">Biweekly Report (Feb 13 - Feb 26)</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright ¬© 2019-2026 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js"></script>
</body>
</html>