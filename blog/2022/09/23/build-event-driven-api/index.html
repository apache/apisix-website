<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX® -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">Building event-driven API services using CQRS, API Gateway and Serverless | Apache APISIX® -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2022/09/23/build-event-driven-api/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Building event-driven API services using CQRS, API Gateway and Serverless | Apache APISIX® -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="This blog post explores how to build event-driven API Services using these 3 well-known patterns to build a highly scalable and distributed system."><meta data-react-helmet="true" property="og:description" content="This blog post explores how to build event-driven API Services using these 3 well-known patterns to build a highly scalable and distributed system."><meta data-react-helmet="true" name="keywords" content="API Gateway,Apache APISIX,API,Event driven,CQRS,Serverless"><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/2022/11/01/63612aab60c8d.png"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/2022/11/01/63612aab60c8d.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-09-23T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/Boburmirzo"><meta data-react-helmet="true" property="article:tag" content="Ecosystem"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2022/09/23/build-event-driven-api/"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2022/09/23/build-event-driven-api/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2022/09/23/build-event-driven-api/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.57eaa0fa.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.84c0a2cc.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">🤔 Introducing APISIX AI Gateway – Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX®</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX®️</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX®️ Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX®️ Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX®️ Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX®️ Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX®️ Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX®️ Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX®️ Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">中文博客</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Building event-driven API services using CQRS, API Gateway and Serverless</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-09-23T00:00:00.000Z" itemprop="datePublished">September 23, 2022</time> · <!-- -->8 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/Boburmirzo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/14247607" alt="Bobur Umurzokov"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Boburmirzo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Bobur Umurzokov</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><meta itemprop="image" content="https://static.apiseven.com/2022/11/01/63612aab60c8d.png"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>This blog post explores how to build event-driven API Services using these 3 well-known patterns to build a highly scalable and distributed system. We will break down each concept and understand the role of each in our particular approach.</p></blockquote><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/24/632e047d6835c.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/24/632e047d6835c.webp, https://static.apiseven.com/2022/09/24/632e047d6835c.jpg" alt="Event Driven Api Services" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/24/632e047d6835c.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/24/632e047d6835c.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/24/632e047d6835c.jpg" alt="Event Driven Api Services" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/24/632e047d6835c.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Developing API services using <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs" target="_blank" rel="noopener noreferrer">CQRS</a>, <a href="https://apisix.apache.org/docs/apisix/terminology/api-gateway/" target="_blank" rel="noopener noreferrer">API Gateway</a> and <a href="https://learn.microsoft.com/en-us/dotnet/architecture/serverless/serverless-architecture" target="_blank" rel="noopener noreferrer">Serverless</a> combine three patterns, using the <strong>command query responsibility separation</strong> (<em>CQRS</em>) pattern, the <strong>event sourcing pattern</strong>, and the <strong>API Gateway</strong> pattern. The CQRS pattern separates the responsibilities of the command and query models. The event sourcing pattern takes advantage of asynchronous <a href="https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/event-driven" target="_blank" rel="noopener noreferrer">event-driven</a> communication to improve the overall user experience. Furthermore, an API gateway should also be implemented as a resource router, thus preventing API consumers from having to deal with different URLs depending on the action being performed.</p><p>Although the three concepts are independent, they complement each other well. This blog post explores how to build event-driven API Services using these <strong>3 well-known patterns</strong> to build a highly scalable and <a href="https://en.wikipedia.org/wiki/Distributed_computing" target="_blank" rel="noopener noreferrer">distributed system</a>. We will break down each concept and understand the role of each in our particular approach.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="the-event-driven-architecture">The event-driven architecture<a aria-hidden="true" class="hash-link" href="#the-event-driven-architecture" title="Direct link to heading">​</a></h2><p>An <strong>event-driven architecture</strong> makes use of events to trigger and communicate between decoupled services.  Each service publishes an event whenever it updates its data. Other services subscribe to events. When an event is received, a service updates its data.</p><p>This architecture has several benefits such as you completely <strong>decoupling</strong> producer and consumer services.  If one service has a failure, the rest will keep running. Consumers can respond to events immediately as they arrive. It adds <strong>agility</strong> as well. If you want to add another service, you can just have it subscribe to an event and have it generate new events of its own. The existing services don’t know or care that this has happened, so there’s no impact on them.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6bb3090.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/20/63289f6bb3090.webp, https://static.apiseven.com/2022/09/20/63289f6bb3090.png" alt="Event driven diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/20/63289f6bb3090.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6bb3090.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6bb3090.png" alt="Event driven diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6bb3090.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="why-not-use-simply-crud">Why not use simply CRUD<a aria-hidden="true" class="hash-link" href="#why-not-use-simply-crud" title="Direct link to heading">​</a></h2><p>Usually, we use the same data model to query and update a database that is similar to the basic <strong>CRUD</strong> operations (<strong>“CREATE”, “READ”, “UPDATE”, and “DELETE”</strong>) and it is the most straightforward way of dealing with data manipulation. We can build API services by following this simple principle. Any tool or framework that advertises itself as a quick method to bring your application to the market. But modern applications involve more complex business processes with workflows, validation, and business logic that are difficult to express using the classic CRUD paradigm.</p><p>Some of the following challenges you can think of:</p><ul><li><p>⛔️ Since for both read and write operations, and the same DTO or data transfer object are used, there’s a chance that read and write operations will be out of sync.</p></li><li><p>⛔️ The application can perform a majority of reading queries (for example, searches) where your logic is not optimized for only read operations.</p></li><li><p>⛔️ As both read and write activities are permitted, security and permissions become more complicated to manage.</p></li><li><p>⛔️ Different data representations are required in order to address the multiple API consumer needs.</p></li></ul><p>As a result of these difficulties, a new set of data manipulation patterns known as <strong>CQRS</strong> has arisen to enhance the classic CRUD methodology.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="cqrs">CQRS<a aria-hidden="true" class="hash-link" href="#cqrs" title="Direct link to heading">​</a></h2><p><strong>CQRS</strong> stands for <em>Command and Query Responsibility Segregation</em>, a pattern that separates reads and writes into different models, using commands to update data, and queries to read data.</p><blockquote><p>This CQRS pattern, as it is known today, was first introduced by <em>Greg Young</em> and was inspired by <em>Bertrand Meyer&#x27;s</em> command-query separation principle. Since its introduction, the pattern has gained a lot of popularity, and several resources can be found online describing its many flavors. This <a href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf" target="_blank" rel="noopener noreferrer">link</a> is a good source describing <em>Young&#x27;s</em> original thinking behind the pattern.</p></blockquote><p>This pattern helps, as instead of having a standard service and storage supporting traditional CRUD operations, <strong>query and upsert</strong> (updates or creates) responsibilities are split (segregated) into different services, each with its own storage. Technically, this can be implemented in HTTP so that the <strong>Command API</strong> is implemented exclusively with POST routes (The write side uses a schema that is optimized for updates), while the <strong>Query API</strong> is implemented exclusively with GET routes (The read side can use a schema that is optimized for queries) as it is illustrated in the below diagram.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6ad9d61.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/20/63289f6ad9d61.webp, https://static.apiseven.com/2022/09/20/63289f6ad9d61.png" alt="CQRS pattern example diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/20/63289f6ad9d61.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6ad9d61.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6ad9d61.png" alt="CQRS pattern example diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/20/63289f6ad9d61.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>This pattern is typically combined with yet another <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/event-sourcing" target="_blank" rel="noopener noreferrer"><strong>event sourcing pattern</strong></a>, as it ensures that all changes made through Command API, are reflected in the read storage as well. The problem with the CQRS scenario, the read storage won&#x27;t be immediately updated as part of one transaction (for example, as in the CRUD API service case because CRUD systems perform update operations directly against a data store). As a result, the query part will be not aware of the latest changes. Such a delay in storage reflecting the latest state of a resource is referred to as eventual consistency.  The event sourcing pattern is very useful because it enables different systems to consume resource state changes as a series of events in the log via an Event Hub capability as you can see in the below diagram.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca2abbc.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/20/6328a7ca2abbc.webp, https://static.apiseven.com/2022/09/20/6328a7ca2abbc.png" alt="Event sourcing with CQRS diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/20/6328a7ca2abbc.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca2abbc.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca2abbc.png" alt="Event sourcing with CQRS diagram" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca2abbc.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The diagram also shows the product&#x27;s query operations performed against the read-only storage and the product&#x27;s command operations persisted in an Event Hub capability. They are then picked up by another service called <strong>Upsert service</strong> responsible for upserting (create, update, and logical deletes) the read storage. Once an upsert action takes place, an event is generated that can be consumed by other services interested in any changes of state in product records.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="api-gateway">API Gateway<a aria-hidden="true" class="hash-link" href="#api-gateway" title="Direct link to heading">​</a></h2><p><strong>Command and Query services APIs</strong> can be managed via lightweight, independently deployable, and scalable <strong>API gateways</strong> that can run anywhere that allow developers to manage API endpoints. They can handle extremely large volumes, as they run on highly scalable platforms, for example, <a href="https://apisix.apache.org/" target="_blank" rel="noopener noreferrer">Apache APISIX</a>, <a href="https://docs.konghq.com/" target="_blank" rel="noopener noreferrer">Kong</a>, <a href="https://tyk.io/" target="_blank" rel="noopener noreferrer">Tyk</a>, and <a href="https://www.getambassador.io/" target="_blank" rel="noopener noreferrer">Ambassador</a> to name a few.</p><p>API Gateway can help with the challenges that you meet with implementing standard policies (for example, <em>authorization, throttling, and rate limiting</em>) for APIs. As an <strong>API Gateway</strong> acts as a central proxy to route all incoming requests from your clients to intended destinations (backend services).</p><p>You can utilize the API Gateway to expose a <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener noreferrer">REST API</a> in front of an event-driven integration. The below diagram illustrates the pattern first and foremost by showing how an API gateway implements resourcing routing to route read calls to the product&#x27;s query service and upsert calls to the product&#x27;s command service.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a93c92d67.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/20/6328a93c92d67.webp, https://static.apiseven.com/2022/09/20/6328a93c92d67.png" alt="Building event-driven API services using CQRS, API Gateway and Serverless (2).png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/20/6328a93c92d67.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a93c92d67.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a93c92d67.png" alt="Building event-driven API services using CQRS, API Gateway and Serverless (2).png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a93c92d67.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="serverless-event-processing">Serverless event processing<a aria-hidden="true" class="hash-link" href="#serverless-event-processing" title="Direct link to heading">​</a></h2><p>We can create our consumer services by using <strong>Serverless functions</strong>. <a href="https://en.wikipedia.org/wiki/Serverless_computing" target="_blank" rel="noopener noreferrer">Serverless</a> is a popular event-driven architectural style that is rapidly gaining traction when building and operating cloud-native applications. Serverless platforms can be categorized into two broad categories, Function as a <em>Service (FaaS)</em> and <em>Backend as a Service (BaaS)</em>. The FaaS method allows customers to build, deploy, run, and manage their applications without managing the underlying infrastructure. When events arrive at the Event Hub, a new serverless (a piece of code or a function) is triggered to handle the event as it is shown in the next diagram.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca42d26.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/2022/09/20/6328a7ca42d26.webp, https://static.apiseven.com/2022/09/20/6328a7ca42d26.png" alt="Serverless, CQRS, Event sourcing and API Gateway" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/2022/09/20/6328a7ca42d26.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca42d26.webp, https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca42d26.png" alt="Serverless, CQRS, Event sourcing and API Gateway" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/2022/09/20/6328a7ca42d26.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>There are many FaaS providers in the market and each platform has unique scenarios in which it shines. The largest cloud companies (<a href="https://aws.amazon.com/" target="_blank" rel="noopener noreferrer">AWS</a>, <a href="https://azure.microsoft.com/en-us/" target="_blank" rel="noopener noreferrer">Azure</a>, <a href="https://cloud.google.com/" target="_blank" rel="noopener noreferrer">Google</a>) provide solutions (<a href="https://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">AWS Lambda</a>, <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-overview" target="_blank" rel="noopener noreferrer">Azure Functions</a>, and <a href="https://cloud.google.com/functions" target="_blank" rel="noopener noreferrer">Google Cloud Function</a> respectively) that are meant to fit nearly every situation with generic cloud products.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="conclusion">Conclusion<a aria-hidden="true" class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>The blog post demonstrated shortly how to build event-driven API services by using some well-known patterns that is flexible to change and more easily decomposed.</p><p>Despite some notable advantages the approach has, there are also some disadvantages as well. It increases the complexity of implementation, especially when compared with traditional CRUD services.</p><p>Since our example is based on traditional REST APIs all use HTTP as the transport and protocol layer, the situation is much more complex when it comes to event-driven APIs. However, the same approach can also be applied to multiple different protocols (for example, <a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener noreferrer">WebSockets</a>, <a href="https://mqtt.org/" target="_blank" rel="noopener noreferrer">MQTT</a>, or <a href="https://en.wikipedia.org/wiki/Server-sent_events" target="_blank" rel="noopener noreferrer">SSE</a>) depending on the capabilities offered by the API gateway chosen (<em>For example, <a href="https://apisix.apache.org/" target="_blank" rel="noopener noreferrer">Apache APISIX</a> supports the proxy of <a href="https://apisix.apache.org/docs/apisix/plugins/grpc-web/" target="_blank" rel="noopener noreferrer">gRPC Web</a> protocol by means of its plug-in</em>) how it handles conversions from one protocol to another.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="related-resources">Related resources<a aria-hidden="true" class="hash-link" href="#related-resources" title="Direct link to heading">​</a></h3><p>➔ <a href="https://martinfowler.com/articles/201701-event-driven.html" target="_blank" rel="noopener noreferrer">What do you mean by “Event-Driven”?</a>.</p><p>➔ <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cqrs" target="_blank" rel="noopener noreferrer">Command Query Responsibility Segregation</a>.</p><p>➔ <a href="https://learn.microsoft.com/en-us/dotnet/architecture/serverless/serverless-architecture" target="_blank" rel="noopener noreferrer">Serverless architecture</a>.</p><p>➔ <a href="https://apisix.apache.org/docs/apisix/terminology/api-gateway/" target="_blank" rel="noopener noreferrer">API Gateway</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="recommended-content">Recommended content<a aria-hidden="true" class="hash-link" href="#recommended-content" title="Direct link to heading">​</a></h3><p>➔ Watch Video Tutorial:</p><ul><li><p><a href="https://youtu.be/dUOjJkb61so" target="_blank" rel="noopener noreferrer">Getting Started with Apache APISIX</a>.</p></li><li><p><a href="https://youtu.be/hMFjhwLMtQ8" target="_blank" rel="noopener noreferrer">APIs security with Apache APISIX</a>.</p></li><li><p><a href="https://youtu.be/aWzo0ysH__c" target="_blank" rel="noopener noreferrer">Implementing resilient applications with API Gateway (Circuit breaker)</a>.</p></li></ul><p>➔ Read the blog posts:</p><ul><li><p><a href="https://dev.to/apisix/implementing-resilient-applications-with-api-gateway-health-check-338c" target="_blank" rel="noopener noreferrer">Implementing resilient applications with API Gateway (Health Check)</a>.</p></li><li><p><a href="https://dev.to/apisix/overview-of-apache-apisix-api-gateway-plugins-2m8o" target="_blank" rel="noopener noreferrer">Overview of Apache APISIX API Gateway Plugins</a>.</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="community️">Community⤵️<a aria-hidden="true" class="hash-link" href="#community️" title="Direct link to heading">​</a></h3><ul><li>🙋 <a href="https://apisix.apache.org/docs/general/join/" target="_blank" rel="noopener noreferrer">Join the Apache APISIX Community</a></li><li>🐦 <a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li><li>📝 <a href="https://join.slack.com/t/the-asf/shared_invite/zt-vlfbf7ch-HkbNHiU_uDlcH_RvaHv9gQ" target="_blank" rel="noopener noreferrer">Find us on Slack</a></li><li>📧 <a href="/blog/2022/09/23/build-event-driven-api/dev@apisix.apache.org/">Mail to us</a> with your questions.</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/ecosystem/">Ecosystem</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/09/28/rust-loves-apisix/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">Apache APISIX loves Rust!</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/09/13/why-is-apache-apisix-the-best-api-gateway/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">Why Is Apache APISIX the Best API Gateway?</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright © 2019-2025 The Apache Software Foundation. Apache APISIX, APISIX®, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.57eaa0fa.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.84c0a2cc.js"></script>
</body>
</html>