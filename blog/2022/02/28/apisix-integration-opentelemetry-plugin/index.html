<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2022/02/28/apisix-integration-opentelemetry-plugin/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="This article introduces you to the API Gateway Apache APISIX `opentelemetry` plugin concept and how to enable and deploy the `opentelemetry` plugin."><meta data-react-helmet="true" property="og:description" content="This article introduces you to the API Gateway Apache APISIX `opentelemetry` plugin concept and how to enable and deploy the `opentelemetry` plugin."><meta data-react-helmet="true" name="keywords" content="Apache APISIX,API Gateway,OpenTelemetry,Observability,Ecosystem"><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/2022/blog/0818/plugins/opentelemetry.png"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/2022/blog/0818/plugins/opentelemetry.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-02-28T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/dmsolr,https://github.com/hf400159"><meta data-react-helmet="true" property="article:tag" content="Plugins,Ecosystem"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2022/02/28/apisix-integration-opentelemetry-plugin/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2022/02/28/apisix-integration-opentelemetry-plugin/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://opentelemetry.io/blog/2022/apisix/"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">ü§î Introducing APISIX AI Gateway ‚Äì Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">‰∏≠ÊñáÂçöÂÆ¢</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-02-28T00:00:00.000Z" itemprop="datePublished">February 28, 2022</time> ¬∑ <!-- -->8 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/dmsolr" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/29735230?v=4" alt="Haochao Zhuang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dmsolr" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Haochao Zhuang</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a href="https://github.com/hf400159" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_KCbV" src="https://avatars.githubusercontent.com/u/97138894?v=4" alt="Fei Han"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/hf400159" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Fei Han</span></a></div><small class="avatar__subtitle" itemprop="description">Technical Writer</small></div></div></div></div></header><meta itemprop="image" content="https://static.apiseven.com/2022/blog/0818/plugins/opentelemetry.png"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>This article introduces you to the Apache APISIX <code>opentelemetry</code> plugin concept and how to enable and deploy the <code>opentelemetry</code> plugin.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="background-information">Background Information<a aria-hidden="true" class="hash-link" href="#background-information" title="Direct link to heading">‚Äã</a></h2><p>Apache APISIX is a dynamic, real-time, high-performance API gateway that provides rich traffic management features such as load balancing, dynamic upstream, canary release, circuit breaking, authentication, observability, and more. It not only has many useful plugins, but also supports plugin dynamic change and hot swap.</p><p>OpenTelemetry is an open source telemetry data acquisition and processing system. It not only provides various SDKS for application side telemetry data collection and reporting, but also data collection side for data receiving, processing and exporting. Export to any or more OpenTelemetry backends, such as Jaeger, Zipkin, and OpenCensus, by configuration. You can view the list of plug-ins that have adapted the OpenTelemetry Collector in the opentelemetry collector contrib  library.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.webp, https://static.apiseven.com/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.png" alt="error/OpenTelemetry" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.png" alt="error/OpenTelemetry" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="plugin-introduction">Plugin Introduction<a aria-hidden="true" class="hash-link" href="#plugin-introduction" title="Direct link to heading">‚Äã</a></h2><p>The <code>opentelemetry</code> plugin of Apache APISIX implements Tracing data collection based on OpenTelemetry native standard (<a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp-request" target="_blank" rel="noopener noreferrer">OTLP/HTTP</a>), and sends it to OpenTelemetry Collector through HTTP protocol. This feature will be supported online in Apache APISIX 2.13.0.</p><p>Since the Agent/SDK of OpenTelemetry has nothing to do with the back-end implementation, when the application integrates the Agent/SDK of OpenTelemetry, the user can easily and freely change the observability backend service without any perception on the application side, such as switching from Zipkin into Jaeger.</p><p>The <code>opentelemetry</code>plug-in integrates the OpenTelemetry Agent/SDK in Apache APISIX, which can collect traced requests, generate trace and forward them to the OpenTelemetry Collector.</p><p>The <code>opentelemetry</code> plugin is located on the Agent side in the above figure, but currently only supports the <code>trace</code> part, and does not support the <code>logs</code> and <code>metrics</code> protocols of OpenTelemetry.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="how-to-use">How to Use<a aria-hidden="true" class="hash-link" href="#how-to-use" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="enable-plugin">Enable Plugin<a aria-hidden="true" class="hash-link" href="#enable-plugin" title="Direct link to heading">‚Äã</a></h3><p>You need to enable <code>opentelemetry</code> plugin and modify collector configuration in <code>conf/config.yaml</code> configuration file.</p><p>It is assumed that you have already deployed the OpenTelemetry Collector and enabled the <a href="https://github.com/open-telemetry/opentelemetry-collector/blob/main/receiver/otlpreceiver/README.md" target="_blank" rel="noopener noreferrer">OTLP HTTP Receiver</a>.</p><blockquote><p>If you have not completed the deployment, you can refer to the Scenario Example section in the next section to complete the deployment of OpenTelemetry Collector.</p></blockquote><p>The default port of the OTLP HTTP Receiver is <code>4318</code>, and the address of <code>collector</code> is the HTTP Receiver address of the OpenTelemetry Collector. For related fields, please refer to the <a href="https://apisix.apache.org/zh/docs/apisix/next/plugins/opentelemetry/" target="_blank" rel="noopener noreferrer">Apache APISIX official documentation</a>.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK YAML"><pre tabindex="0" class="prism-code language-YAML codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... # Other plugins that have been enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- opentelemetry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugin_attr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opentelemetry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  trace_id_source: x-request-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service.name: APISIX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  collector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address: 127.0.0.1:4318 # OTLP HTTP Receiver address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request_timeout: 3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="method-1-bind-the-plugin-to-the-specified-route">Method 1: Bind the plugin to the specified route<a aria-hidden="true" class="hash-link" href="#method-1-bind-the-plugin-to-the-specified-route" title="Direct link to heading">‚Äã</a></h4><p>In order to show the test effect more conveniently, <code>sampler</code> is temporarily set to full sampling in the example to ensure that <code>trace</code> data is generated after each request is traced, so that you can view <code>trace</code> related data on the Web UI. You can also set relevant parameters according to the actual situation.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-X PUT -d &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;uri&quot;: &quot;/get&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;opentelemetry&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sampler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;name&quot;: &quot;always_on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;upstream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;roundrobin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;nodes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;httpbin.org:80&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="method-2-set-global-rules">Method 2: Set Global Rules<a aria-hidden="true" class="hash-link" href="#method-2-set-global-rules" title="Direct link to heading">‚Äã</a></h4><p>You can also enable <code>opentelemetry</code> plugin through the Apache APISIX Plugins feature. After the global configuration is complete, you still need to create the route, otherwise it will not be possible to test.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">curl &#x27;http://127.0.0.1:9080/apisix/admin/global_rules/1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-H &#x27;X-API-KEY:  edd1c9f034335f136f87ad84b625c8f1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-X PUT -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;opentelemetry&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sampler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;name&quot;: &quot;always_on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="method-3-customize-labels-for-span-through-additional_attributes">Method 3: Customize labels for Span through <code>additional_attributes</code><a aria-hidden="true" class="hash-link" href="#method-3-customize-labels-for-span-through-additional_attributes" title="Direct link to heading">‚Äã</a></h4><p>For the configuration of <code>sampler</code> and <code>additional_attributes</code>, you can refer to the <a href="https://apisix.apache.org/docs/apisix/next/plugins/opentelemetry/#attributes" target="_blank" rel="noopener noreferrer">Apache APISIX official documentation</a>, where <code>additional_attributes</code> is a series of <code>Key:Value</code> key value pairs, you can use it to customize the label for Span, and can follow Span to display on the Web UI. Add <code>route_id</code> and <code>http_x-custom-ot-key</code> to the span of a route through <code>additional_attributes</code>, you can refer to the following configuration:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1001 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-X PUT -d &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;uri&quot;: &quot;/put&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;opentelemetry&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;sampler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;name&quot;: &quot;always_on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;additional_attributes&quot;:[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;route_id&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;http_x-custom-ot-key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;upstream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;roundrobin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;nodes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;httpbin.org:80&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="test-example">Test Example<a aria-hidden="true" class="hash-link" href="#test-example" title="Direct link to heading">‚Äã</a></h3><p>You can enable <code>opentelemetry</code> plugin in any of the above three methods. The following example uses the example of method three to create a route. After the creation is successful, you can refer to the following commands to access the route:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT -H `x-custom-ot-key: test-ot-val` http://127.0.0.1:9080/put</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>After the access is successful, you can see the details of the span similar to <code>/put</code> in the Jaeger UI, and you can see that the custom tags in the route are displayed in the Tags list: <code>http_x-custom-ot-key</code> and <code>route_id</code>.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.webp, https://static.apiseven.com/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.png" alt="error/Span details.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.png" alt="error/Span details.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>You need to note that the <code>additional_attributes</code> configuration is set to take values from Apache APISIX and Nginx variables as <code>attribute</code> values, so <code>additional_attributes</code> must be a valid Apache APISIX or Nginx variable. It also includes HTTP Header, but when fetching <code>http_header</code>, you need to add <code>http_</code> as the prefix of the variable name. If the variable does not exist, the <code>tag</code> will not be displayed.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="scenario-example">Scenario Example<a aria-hidden="true" class="hash-link" href="#scenario-example" title="Direct link to heading">‚Äã</a></h3><p>This scenario example deploys Collector, Jaeger, and Zipkin as backend services by simply modifying the official example of OpenTelemetry Collector, and starts two sample applications (Client and Server), where Server provides an HTTP service, and Client will cyclically call the server provided by the server. HTTP interface, resulting in a call chain consisting of two spans.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="step-1-deploy-opentelemetry">Step 1: Deploy OpenTelemetry<a aria-hidden="true" class="hash-link" href="#step-1-deploy-opentelemetry" title="Direct link to heading">‚Äã</a></h4><p>The following uses <code>docker-compose</code> as an example. For other deployments, please refer to the <a href="https://opentelemetry.io/docs/collector/getting-started/" target="_blank" rel="noopener noreferrer">OpenTelemetry official documentation</a>.</p><p>You can refer to the following command to deploy:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/open-telemetry/opentelemetry-collector-contrib.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd opentelemetry-collector-contrib/examples/demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>Enter <code>http://127.0.0.1:16886</code> (Jaeger UI) or <code>http://127.0.0.1:9411/zipkin</code> (Zipkin UI) in the browser. If it can be accessed normally, the deployment is successful.</p><p>The following figure shows an example of successful access:</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.webp, https://static.apiseven.com/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.png" alt="error/Jaeger example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.png" alt="error/Jaeger example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.webp, https://static.apiseven.com/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.png" alt="error/Zipkin example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.png" alt="error/Zipkin example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="step-2-configure-the-test-environment">Step 2: Configure the Test Environment<a aria-hidden="true" class="hash-link" href="#step-2-configure-the-test-environment" title="Direct link to heading">‚Äã</a></h4><p>The Apache APISIX service is introduced, and the topology of the final application is shown in the following figure:</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.webp, https://static.apiseven.com/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.png" alt="error/Architecture diagram.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.png" alt="error/Architecture diagram.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The Trace data reporting process is as follows. Among them, since Apache APISIX is deployed separately and not in the network of docker-compose, Apache APISIX accesses the OTLP HTTP Receiver of OpenTelemetry Collector through the locally mapped port (<code>127.0.0.1:4138</code>).</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.webp, https://static.apiseven.com/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.png" alt="error/Trace data reporting process.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.png" alt="error/Trace data reporting process.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>You need to make sure you have enabled the <code>opentelemetry</code> plugin and reload Apache APISIX.</p><ol><li><p>You can refer to the following example to create a route and enable the <code>opentelemetry</code> plugin for sampling:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -X PUT -d &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;uri&quot;: &quot;/hello&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;opentelemetry&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;sampler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;name&quot;: &quot;always_on&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;upstream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;roundrobin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nodes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;127.0.0.1:7080&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div></li><li><p>Modify the <code>./examples/demo/otel-collector-config.yaml</code> file and add the OTLP HTTP Receiver as follows:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK Shell"><pre tabindex="0" class="prism-code language-Shell codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  otlp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      grpc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      http:${ip:port}   # add OTLP HTTP ReceiverÔºådefault port is 4318</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div></li><li><p>Modify <code>docker-compose.yaml</code>.</p></li></ol><p>You need to modify the configuration file, change the interface address of Client calling Server to the address of Apache APISIX, and map the ports of OTLP HTTP Receiver and Server services to local.</p><p>The following example is the complete docker-compose.yaml after the configuration is modified:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK YAML"><pre tabindex="0" class="prism-code language-YAML codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">version: &quot;2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Jaeger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jaeger-all-in-one:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: jaegertracing/all-in-one:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;16686:16686&quot; # jaeger ui port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;14268&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;14250&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Zipkin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zipkin-all-in-one:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: openzipkin/zipkin:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;9411:9411&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">otel-collector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: ${OTELCOL_IMG}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  command: [&quot;--config=/etc/otel-collector-config.yaml&quot;, &quot;${OTELCOL_ARGS}&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;1888:1888&quot;   # pprof extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;8888:8888&quot;   # Prometheus metrics exposed by the collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;8889:8889&quot;   # Prometheus exporter metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;13133:13133&quot; # health_check extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;4317&quot;        # OTLP gRPC receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;4318:4318&quot;   # Add OTLP HTTP Receiver port mapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;55670:55679&quot; # zpages extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - jaeger-all-in-one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - zipkin-all-in-one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">demo-client:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerfile: Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: ./client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - DEMO_SERVER_ENDPOINT=http://172.17.0.1:9080/hello # APISIX address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - demo-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">demo-server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerfile: Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: ./server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;7080:7080&quot; # Map the Server port to the host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - otel-collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container_name: prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: prom/prometheus:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ./prometheus.yaml:/etc/prometheus/prometheus.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;9090:9090&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>It should be noted that demo-client.environment.DEMO_SERVER_ENDPOINT needs to be changed to your Apache APISIX address, and ensure that it can be accessed normally in the container.</p><p>Of course, you can also deploy Apache APISIX through <code>docker-compose.yaml</code>. For details, please refer to the <a href="https://github.com/apache/apisix-docker/blob/master/docs/en/latest/example.md" target="_blank" rel="noopener noreferrer">Apache APISIX official documentation</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="step-3-test">Step 3: Test<a aria-hidden="true" class="hash-link" href="#step-3-test" title="Direct link to heading">‚Äã</a></h4><p>After the redeployment is completed, you can access the Jaeger UI or Zipkin UI to see that the Span of APISIX is included in the Trace, as shown below:</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.webp, https://static.apiseven.com/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.png" alt="error/Jaeger example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.png" alt="error/Jaeger example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.webp, https://static.apiseven.com/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.png" alt="error/Zipkin example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.webp, https://static.apiseven.com/apisix-thumbnail/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.png" alt="error/Zipkin example.png" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="disable-plugin">Disable Plugin<a aria-hidden="true" class="hash-link" href="#disable-plugin" title="Direct link to heading">‚Äã</a></h2><p>If you do not need trace collection of a route temporarily, you only need to modify the route configuration and delete the related configuration of <code>opentelemetry</code> under <code>plugins</code> in the configuration.</p><p>You can only remove the configuration of the <code>opentelemetry</code> global plugin if you enabled it globally by binding Global Rules.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">‚Äã</a></h2><p>After Apache APISIX integrates OpenTelemetry, it can easily connect with most mainstream Trace systems on the market with the help of OpenTelemetry&#x27;s rich plug-ins. In addition, Apache APISIX has also implemented SkyWalking and Zipkin native standard protocol plug-ins, and is also actively cooperating with major communities to create a more powerful ecosystem.</p><p>Apache APISIX is also currently working on additional plugins to support integration with more services, so if you&#x27;re interested, feel free to start a discussion thread in our GitHub Discussion or communicate via the mailing list.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="related-articles">Related articles<a aria-hidden="true" class="hash-link" href="#related-articles" title="Direct link to heading">‚Äã</a></h2><ul><li><p><a href="https://apisix.apache.org/blog/2021/11/04/skywalking/" target="_blank" rel="noopener noreferrer">The observability of Apache APISIX</a></p></li><li><p><a href="https://apisix.apache.org/blog/2022/02/10/apisix-splunk-integration/" target="_blank" rel="noopener noreferrer">Integrating Splunk HTTP Event Collector with API Gateway</a></p></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/plugins/">Plugins</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/ecosystem/">Ecosystem</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/03/01/apisix-integration-public-api-plugin/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">API Gateway Apache APISIX provides enhancements on API Management</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/02/25/consul-api-gateway/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">How to Integrate API Gateway and Consul?</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright ¬© 2019-2026 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js"></script>
</body>
</html>