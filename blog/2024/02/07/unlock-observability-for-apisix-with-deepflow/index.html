<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway" href="/opensearch.xml">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Apache APISIX","url":"https://apisix.apache.org"}</script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="24b59d9a-682e-4c3d-9e83-bf2ee85cdc19" data-project-name="APISIX" data-project-color="#E8442E" data-project-logo="https://static.apiseven.com/202202/apache-apisix.png" data-modal-disclaimer="This is a custom LLM for APISIX with access to all developer documentation, GitHub issues and discussions." data-modal-example-questions="How to set up canary release in APISIX?,How to develop a custom APISIX plugin?,How to use custom NGINX configuration in APISIX?,How to configure mTLS between clients and APISIX?,How to only allow a specific APISIX consumer to access special services or routes?" async></script><title data-react-helmet="true">Unlock All-in-One Observability for APISIX with DeepFlow | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway</title><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2024/02/07/unlock-observability-for-apisix-with-deepflow/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Unlock All-in-One Observability for APISIX with DeepFlow | Apache APISIX¬Æ -- Cloud-Native API Gateway and AI Gateway"><meta data-react-helmet="true" name="description" content="This article aims to elucidate how to leverage DeepFlow&#x27;s zero-code feature based on eBPF to construct an observability solution for APISIX."><meta data-react-helmet="true" property="og:description" content="This article aims to elucidate how to leverage DeepFlow&#x27;s zero-code feature based on eBPF to construct an observability solution for APISIX."><meta data-react-helmet="true" name="keywords" content="APISIX,DeepFlow,Observability"><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/uploads/2024/02/07/nQJ5SWsx_deepflow-cover-en.jpeg"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/uploads/2024/02/07/nQJ5SWsx_deepflow-cover-en.jpeg"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2024-02-07T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="Ecosystem"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2024/02/07/unlock-observability-for-apisix-with-deepflow/"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2024/02/07/unlock-observability-for-apisix-with-deepflow/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2024/02/07/unlock-observability-for-apisix-with-deepflow/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Bold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Light.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-Demi.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://static.apiseven.com/202202/MaisonNeue-ExtraBold.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.9943cb19.css">
<!-- Matomo from the ASF -->
<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>
<!-- End Matomo Code -->
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">ü§î Introducing APISIX AI Gateway ‚Äì Built for LLMs and AI workloads. <a target="_blank" rel="noopener noreferrer" href="/ai-gateway/"> Learn More</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a target="_parent" class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" target="_parent" href="/docs/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/docs/apisix/getting-started/">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" target="_parent" href="/docs/apisix/next/dashboard/">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" target="_parent" href="/docs/ingress-controller/overview/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" target="_parent" href="/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" target="_parent" href="/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" target="_parent" href="/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_parent" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a class="navbar__item navbar__link" target="_parent" href="/downloads/">Downloads</a><a class="navbar__item navbar__link" target="_parent" href="/help/">Help</a><a class="navbar__item navbar__link" target="_parent" href="/team/">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_parent" href="/showcase/">Showcase</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/code-samples/">Code Samples</a></li><li><a class="dropdown__link" target="_parent" href="/plugins/">PluginHub</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/join/">Community</a></li><li><a class="dropdown__link" target="_parent" href="/docs/general/events/">Events</a></li><li><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer" class="dropdown__link">Roadmap</a></li></ul></div><a href="/zh/blog" target="_parent" rel="noopener noreferrer" class="localizedBlogLink_W2zh">‰∏≠ÊñáÂçöÂÆ¢</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_SGhp"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="sticky-outer-wrapper placeholder_iq-X"><div class="sticky-inner-wrapper" style="position:relative;top:0px;z-index:199"><div class="tagsHeader_HGHP"><a target="_parent" href="/blog/tags/case-studies/">Case Studies</a><a target="_parent" href="/blog/tags/ecosystem/">Ecosystem</a><a target="_parent" href="/blog/tags/authentication/">Authentication</a><a target="_parent" href="/blog/tags/plugins/">Plugins</a><a target="_parent" href="/blog/tags/community/">Community</a><a target="_parent" href="/blog/tags/vulnerabilities/">Vulnerabilities</a></div></div></div><div class="container margin-vert--lg"><div class="row" style="justify-content:center"><div class="col col--9"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Unlock All-in-One Observability for APISIX with DeepFlow</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2024-02-07T00:00:00.000Z" itemprop="datePublished">February 7, 2024</time> ¬∑ <!-- -->12 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><div size="48" color="F7F9FC" class="go3995501668"><p color="060A23" size="48" class="go2202902509">Qi</p></div></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Qian Li</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_dGI0"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><div size="48" color="E8DEF6" class="go276133137"><p color="420790" size="48" class="go1003245435">Bi</p></div></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bin Peng</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><meta itemprop="image" content="https://static.apiseven.com/uploads/2024/02/07/nQJ5SWsx_deepflow-cover-en.jpeg"><div class="markdown" itemprop="articleBody"><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><blockquote><p>This article aims to elucidate how to leverage DeepFlow&#x27;s zero-code feature based on eBPF to construct an observability solution for APISIX.</p></blockquote><p>With the growing emphasis on the observability of application components, Apache APISIX has introduced a plugin mechanism to enrich observability signals. However, these data are scattered across multiple stacks, creating data silos. <strong>This article aims to elucidate how to leverage DeepFlow&#x27;s zero-code feature based on eBPF to construct an observability solution for APISIX.</strong> On this basis, it integrates the rich data sources of existing APISIX plugins to eliminate data silos and build an all-in-one platform for comprehensive observability of the APISIX gateway.</p><p>Through DeepFlow, APISIX can achieve comprehensive observability from traffic monitoring and tracing analysis to performance optimization, eliminating data dispersion and providing a centralized view. This accelerates fault diagnosis and performance tuning, making the work of DevOps and SRE teams more efficient. <strong>This article will focus on how APISIX&#x27;s tracing data, metric data, access logs, and performance profiling data can be integrated with DeepFlow.</strong></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/klRaMpb4_deepflow-1.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/klRaMpb4_deepflow-1.webp, https://static.apiseven.com/uploads/2024/02/07/klRaMpb4_deepflow-1.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/klRaMpb4_deepflow-1.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/klRaMpb4_deepflow-1.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/klRaMpb4_deepflow-1.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/klRaMpb4_deepflow-1.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="1-install-apisix-and-deepflow">1. Install APISIX and DeepFlow<a aria-hidden="true" class="hash-link" href="#1-install-apisix-and-deepflow" title="Direct link to heading">‚Äã</a></h2><p>For convenience, this article describes deploying both DeepFlow and APISIX as Kubernetes services, with the entire deployment process taking approximately 5 minutes. For detailed deployment steps, refer to the <a href="https://deepflow.io/docs/ce-install/all-in-one/" target="_blank" rel="noopener noreferrer">DeepFlow</a> and <a href="https://apisix.apache.org/docs/apisix/3.2/installation-guide/" target="_blank" rel="noopener noreferrer">APISIX</a> official deployment documentation.</p><p>Note: To leverage DeepFlow&#x27;s observability capabilities that utilize eBPF technology, your host&#x27;s <strong>Linux kernel must be version 4.14 or higher</strong>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="2-distributed-tracing">2. Distributed Tracing<a aria-hidden="true" class="hash-link" href="#2-distributed-tracing" title="Direct link to heading">‚Äã</a></h2><p>There are two approaches to implementing distributed tracing for APISIX and backend services using DeepFlow: Firstly, DeepFlow leverages eBPF to enable out-of-the-box, RPC-level distributed tracing for APISIX and backend services, requiring no code changes. Secondly, if backend services have APM (Application Performance Monitoring) tools like OpenTelemetry or SkyWalking enabled, you can integrate all tracing data into DeepFlow using the APISIX Tracers plugin. This enables comprehensive, end-to-end tracing at the application function level.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/hA587UwF_deepflow-2.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/hA587UwF_deepflow-2.webp, https://static.apiseven.com/uploads/2024/02/07/hA587UwF_deepflow-2.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/hA587UwF_deepflow-2.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/hA587UwF_deepflow-2.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/hA587UwF_deepflow-2.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/hA587UwF_deepflow-2.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="21-deepflow-ebpf-autotracing">2.1 DeepFlow eBPF AutoTracing<a aria-hidden="true" class="hash-link" href="#21-deepflow-ebpf-autotracing" title="Direct link to heading">‚Äã</a></h3><p><strong>DeepFlow offers out-of-the-box distributed tracing (AutoTracing) that requires no APISIX plugins or code changes to be enabled.</strong> It only necessitates deploying the deepflow-agent on the server where APISIX is located. In Grafana, find the <a href="https://ce-demo.deepflow.yunshan.net/d/Distributed_Tracing/distributed-tracing?orgId=1" target="_blank" rel="noopener noreferrer">Distributed Tracing Dashboard provided by DeepFlow</a>, where you can initiate a trace on a specific request and see the end-to-end trace of that request in both APISIX and its backend services, as illustrated below:</p><ul><li>(1): Accesses the APISIX gateway service on the K8s Node NIC via nodeport.</li><li>(2): Enters the NIC of the POD corresponding to the APISIX gateway service.</li><li>(3): Goes into the OpenResty process within the APISIX gateway service.</li><li>(4): The request is forwarded to the backend service by the OpenResty process.</li><li>(5): Forwarded by the NIC of the POD corresponding to the APISIX gateway service.</li><li>(6)/(7): Forwarded to the backend service.</li></ul><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/XNkYJZ13_deepflow-3.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/XNkYJZ13_deepflow-3.webp, https://static.apiseven.com/uploads/2024/02/07/XNkYJZ13_deepflow-3.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/XNkYJZ13_deepflow-3.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/XNkYJZ13_deepflow-3.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/XNkYJZ13_deepflow-3.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/XNkYJZ13_deepflow-3.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="22-deepflow-ebpf--opentelemetry">2.2 DeepFlow eBPF + OpenTelemetry<a aria-hidden="true" class="hash-link" href="#22-deepflow-ebpf--opentelemetry" title="Direct link to heading">‚Äã</a></h3><p>This approach involves APISIX generating trace data using the OpenTelemetry plugin, while the backend service also has APM capabilities and can convert generated trace data into the OpenTelemetry format. When APISIX and backend services both send trace data to DeepFlow, it can create a comprehensive trace-tree without any blind spots, incorporating APM application SPAN, eBPF system SPAN, and cBPF network SPAN.</p><p>This method is ideal for achieving function-level distributed tracing inside the application process or when the backend service uses a thread pool for call handling, which may disrupt DeepFlow AutoTracing.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="221-deploy-backend-services-with-apm-enabled">2.2.1 Deploy Backend Services with APM Enabled<a aria-hidden="true" class="hash-link" href="#221-deploy-backend-services-with-apm-enabled" title="Direct link to heading">‚Äã</a></h4><p>To demonstrate the full tracing effect, we first deploy a demo application behind the APISIX gateway that supports OpenTelemetry. The deployment of the Demo application can refer to: &quot;<a href="https://deepflow.io/docs/integration/input/tracing/opentelemetry/#experience-based-on-the-spring-boot-demo" target="_blank" rel="noopener noreferrer">DeepFlow Demo - One-click deployment of a WebShop application composed of five microservices written in Spring Boot</a>&quot;. Create a route on APISIX to access the backend service, with the access domain being <code>apisix.deepflow.demo</code>.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apisix.apache.org/v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ApisixRoute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: deepflow-apisix-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: deepflow-otel-spring-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: deepflow-apisix-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      match:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - apisix.deepflow.demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        paths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token string" style="color:#e3116c">&quot;/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      backends:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - serviceName: web-shop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          servicePort: </span><span class="token number" style="color:#36acaa">18090</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="222-enable-the-opentelemetry-plugin-in-apisix">2.2.2 Enable the OpenTelemetry Plugin in APISIX<a aria-hidden="true" class="hash-link" href="#222-enable-the-opentelemetry-plugin-in-apisix" title="Direct link to heading">‚Äã</a></h4><p>Add OpenTelemetry plugins to the APISIX configuration:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## vim ./apisix/.values.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - opentelemetry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pluginAttrs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  opentelemetry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      service.name: APISIX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">## Send data to deepflow-agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">## Of course, you can also send it to otel-collector for processing, and then have otel-collector forward it to deepflow-agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      address: deepflow-agent.deepflow.svc.cluster.local/api/v1/otel/trace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      request_timeout: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## After adding, update helm upgrade --install -n apisix apisix ./apisix</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>Enable OpenTelemetry functionality for a specific route:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## View router id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Find the router id for the domain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -s http://10.109.77.186:9180/apisix/admin/routes -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: This is apisix-admin token&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jq</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Enable the otel feature for a specific route</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://10.109.77.186:9180/apisix/admin/routes -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: This is apisix-admin token&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;name&quot;: &quot;deepflow-apisix-demo&quot;,            ## Assign a name to this route</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;methods&quot;: [&quot;GET&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uris&quot;: [&quot;/*&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;opentelemetry&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;sampler&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;name&quot;: &quot;always_on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;additional_attributes&quot;: [        ## Customize tags for span through `additional_attributes`</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">                &quot;deepflow=demo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,                 ## Round Robin Load Balancing</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {                            ## Upstream Address</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;10.1.23.200:18090&quot;: 1            ## Service access address: Upstream ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="223-using-deepflow-to-integrate-opentelemetry-traces">2.2.3 Using DeepFlow to Integrate OpenTelemetry Traces<a aria-hidden="true" class="hash-link" href="#223-using-deepflow-to-integrate-opentelemetry-traces" title="Direct link to heading">‚Äã</a></h4><p>The integration of OpenTelemetry Span data through DeepFlow Agent is enabled by default and requires no additional configuration.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## View the default configuration of deepflow-agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## deepflow-ctl agent-group-config example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## This parameter controls whether to enable receiving data from external sources, including Prometheus, Telegraf, OpenTelemetry, and SkyWalking.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Data Integration Socket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Default: 1. Options: 0 (disabled), 1 (enabled).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Note: Whether to enable receiving external data sources such as Prometheus,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##   Telegraf, OpenTelemetry, and SkyWalking.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#external_agent_http_proxy_enabled: 1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="224-opentelemetry-integration-showcase">2.2.4 OpenTelemetry Integration Showcase<a aria-hidden="true" class="hash-link" href="#224-opentelemetry-integration-showcase" title="Direct link to heading">‚Äã</a></h4><p>We initiate a command from the client to access the WebShop service:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&quot;Host: apisix.deepflow.demo&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.1</span><span class="token plain">.23.200:44640/shop/full-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Here, the IP is the K8s cluster node IP, and port 44640 is the NodePort exposed by APISIX 9180.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>Open the <a href="https://ce-demo.deepflow.yunshan.net/d/Distributed_Tracing/distributed-tracing?orgId=1" target="_blank" rel="noopener noreferrer">Distributed Tracing Dashboard provided by DeepFlow</a> in Grafana, find the corresponding request, and initiate tracing. You&#x27;ll be able to see traces from both APISIX and the backend services. Moreover, the application SPANs generated by APM and the network SPANs and system SPANs generated by DeepFlow are all comprehensively associated on one flame graph:</p><blockquote><p>Note: In the flame graph, &quot;A&quot; represents the application SPAN generated by APM, while &quot;N&quot; and &quot;S&quot; represent the network SPAN and system SPAN generated by DeepFlow, respectively.</p></blockquote><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/UqbPnqST_deepflow-4.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/UqbPnqST_deepflow-4.webp, https://static.apiseven.com/uploads/2024/02/07/UqbPnqST_deepflow-4.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/UqbPnqST_deepflow-4.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/UqbPnqST_deepflow-4.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/UqbPnqST_deepflow-4.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/UqbPnqST_deepflow-4.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="3-performance-metrics">3. Performance Metrics<a aria-hidden="true" class="hash-link" href="#3-performance-metrics" title="Direct link to heading">‚Äã</a></h2><p>DeepFlow offers immediate insights into metrics, featuring detailed RED (Rate, Error, Duration) performance metrics at the endpoint level, along with comprehensive TCP network performance metrics, including throughput, retransmissions, zero window, and connection anomalies. Metrics from APISIX, including HTTP status codes, bandwidth, connections, and latency, captured by Metrics-type plugins like Prometheus and node-status, can also be integrated into DeepFlow. This data, detailing both instance and route granularity, is viewable on the APISIX-provided Grafana Dashboard.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/moFwGgPH_deepflow-5.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/moFwGgPH_deepflow-5.webp, https://static.apiseven.com/uploads/2024/02/07/moFwGgPH_deepflow-5.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/moFwGgPH_deepflow-5.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/moFwGgPH_deepflow-5.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/moFwGgPH_deepflow-5.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/moFwGgPH_deepflow-5.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="31-out-of-the-box-ebpf-metrics">3.1 Out-of-the-Box eBPF Metrics<a aria-hidden="true" class="hash-link" href="#31-out-of-the-box-ebpf-metrics" title="Direct link to heading">‚Äã</a></h3><p>Once the deepflow-agent is deployed on the server hosting APISIX, it automatically gathers highly detailed application and network level metrics. This includes metrics such as request rates, response latencies, and error statuses for specific clients or endpoints, as well as TCP connection setup times, connection anomalies, and more. Detailed metrics can be found on <a href="https://deepflow.io/docs/features/universal-map/metrics-and-operators/" target="_blank" rel="noopener noreferrer">the DeepFlow official website in the metrics section</a>. By opening the <strong>Application - K8s Ingress Dashboard</strong> provided by DeepFlow in Grafana, you can view application layer performance metrics related to APISIX. Similarly, network-related metrics can be viewed in the <strong>Network - K8s Pod</strong> Dashboard.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/lbVMAzAa_deepflow-6.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/lbVMAzAa_deepflow-6.webp, https://static.apiseven.com/uploads/2024/02/07/lbVMAzAa_deepflow-6.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/lbVMAzAa_deepflow-6.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/lbVMAzAa_deepflow-6.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/lbVMAzAa_deepflow-6.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/lbVMAzAa_deepflow-6.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3615sk3K_deepflow-7.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/3615sk3K_deepflow-7.webp, https://static.apiseven.com/uploads/2024/02/07/3615sk3K_deepflow-7.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/3615sk3K_deepflow-7.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3615sk3K_deepflow-7.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3615sk3K_deepflow-7.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3615sk3K_deepflow-7.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="32-enable-the-prometheus-plugin-in-apisix">3.2 Enable the Prometheus Plugin in APISIX<a aria-hidden="true" class="hash-link" href="#32-enable-the-prometheus-plugin-in-apisix" title="Direct link to heading">‚Äã</a></h3><p>Add the Prometheus plugin to the APISIX configuration:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## vim ./apisix/.values.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pluginAttrs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prometheus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    export_uri: /metrics    </span><span class="token comment" style="color:#999988;font-style:italic">## The default URI is `/apisix/prometheus/metrics`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    export_addr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ip: </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0           </span><span class="token comment" style="color:#999988;font-style:italic">## Scrape Address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      port: </span><span class="token number" style="color:#36acaa">9091</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">## Default port 9091</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      http_status:  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        extra_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - upstream_addr: </span><span class="token variable" style="color:#36acaa">$upstream_addr</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">## For example, add an upstream server address (the variable here is an NGINX variable)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - upstream_status: </span><span class="token variable" style="color:#36acaa">$upstream_status</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## For example, add the status of an upstream server (the variable here is an NGINX variable)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 </span><span class="token comment" style="color:#999988;font-style:italic">## APISIX Built-in Variables: https://apisix.apache.org/docs/apisix/3.2/apisix-variable/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 </span><span class="token comment" style="color:#999988;font-style:italic">## NGINX Built-in VariablesÔºöhttps://nginx.org/en/docs/varindex.html</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>Enable Prometheus plugin:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Note: Since the otel feature has been enabled above, here we need to enable Prometheus on top of the otel functionality.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://10.109.77.186:9180/apisix/admin/routes/</span><span class="token variable" style="color:#36acaa">$router_id</span><span class="token plain"> -H </span><span class="token string" style="color:#e3116c">&#x27;X-API-KEY: $apisix-admin token&#x27;</span><span class="token plain"> -X PUT -d </span><span class="token string" style="color:#e3116c">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;name&quot;: &quot;deepflow-apisix-demo&quot;,       ## Assign a name to this route</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;methods&quot;: [&quot;GET&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;uris&quot;: [&quot;/*&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;plugins&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;prometheus&quot;:{                    ## Enable Prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;prefer_name&quot;: true           ## When set to &quot;true,&quot; the Prometheus metrics will display the route/service name instead of the ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;upstream&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;type&quot;: &quot;roundrobin&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;nodes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            &quot;10.1.23.200:18090&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="33-collect-apisix-metrics-with-prometheus">3.3 Collect APISIX Metrics with Prometheus<a aria-hidden="true" class="hash-link" href="#33-collect-apisix-metrics-with-prometheus" title="Direct link to heading">‚Äã</a></h3><p>Collecting APISIX metrics using Prometheus (example given using Prometheus CRD deployment method):</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Collecting via ServiceMonitor Method (Prometheus deployed in Kubernetes as a CRD)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## The APISIX `values.yaml` file provides the corresponding module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceMonitor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Whether to enable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Which namespace to create in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      namespace: </span><span class="token string" style="color:#e3116c">&quot;apisix&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## ServiceMonitor name, defaults to fullname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Scrape interval</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interval: 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## URI where metrics are exposed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path: /metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Prefix for the scraped metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metricPrefix: apisix_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Scrape port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containerPort: </span><span class="token number" style="color:#36acaa">9091</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Add labels</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## For this deployment, the project uses kube-prometheus; use this label for kube-prometheus to recognize the ServiceMonitor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app.kubernetes.io/part-of: kube-prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><p>At this point, a Prometheus backend service is required to collect the metrics generated by APISIX plugins. Therefore, it is necessary to deploy a <code>prometheus-server</code> first. However, since these metrics do not rely on prometheus-server for storage, it is possible to deploy a prometheus-server in agent mode or use a lighter weight grafana-agent instead. Assuming that prometheus-server has been deployed, enabling <code>RemoteWrite</code> will send metric data to DeepFlow:</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## https://deepflow.io/docs/zh/integration/input/metrics/prometheus/#ÈÖçÁΩÆ-remote-write</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Sending to DeepFlow via kube-prometheus (adding remote write in the YAML manifest)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: monitoring.coreos.com/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: k8s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enableRemoteWriteReceiver: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remoteWrite:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## Note: Here should be the deepflow-agent service address, which needs to be specified according to the actual location.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - url: </span><span class="token string" style="color:#e3116c">&quot;http://deepflow-agent.deepflow.svc.cluster.local/api/v1/prometheus&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="34-integrating-prometheus-metrics-with-deepflow">3.4 Integrating Prometheus Metrics with DeepFlow<a aria-hidden="true" class="hash-link" href="#34-integrating-prometheus-metrics-with-deepflow" title="Direct link to heading">‚Äã</a></h3><p>Integrating Prometheus metrics through deepflow-agent is enabled by default and requires no additional configuration.</p><div class="codeBlockContainer_5tM7"><div class="codeBlockContent_VFOK bash"><pre tabindex="0" class="prism-code language-bash codeBlock_sqlf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Aq39"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## View the default configuration of deepflow-agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## deepflow-ctl agent-group-config example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## This parameter controls whether to accept data from external sources, including Prometheus, Telegraf, OpenTelemetry, and SkyWalking.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Data Integration Socket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Default: 1. Options: 0 (disabled), 1 (enabled).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Note: Whether to enable receiving external data sources such as Prometheus,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##   Telegraf, OpenTelemetry, and SkyWalking.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#external_agent_http_proxy_enabled: 1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_gLFX clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="35-prometheus-integration-showcase">3.5 Prometheus Integration Showcase<a aria-hidden="true" class="hash-link" href="#35-prometheus-integration-showcase" title="Direct link to heading">‚Äã</a></h3><p>Since DeepFlow supports PromQL, you only need to change the data-source in the <a href="https://github.com/apache/apisix/blob/master/docs/assets/other/json/apisix-grafana-dashboard.json" target="_blank" rel="noopener noreferrer">Grafana dashboard</a> provided by APISIX to DeepFlow. This way, you can view the rich performance metrics natively provided by APISIX. For instructions on how to use these metrics, refer to <a href="https://apisix.apache.org/docs/apisix/plugins/prometheus/" target="_blank" rel="noopener noreferrer">the official documentation regarding the Prometheus plugin</a>.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3S4sUpX2_deepflow-8.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/3S4sUpX2_deepflow-8.webp, https://static.apiseven.com/uploads/2024/02/07/3S4sUpX2_deepflow-8.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/3S4sUpX2_deepflow-8.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3S4sUpX2_deepflow-8.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3S4sUpX2_deepflow-8.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/3S4sUpX2_deepflow-8.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="4-access-logs-and-continuous-profiling">4. Access Logs and Continuous Profiling<a aria-hidden="true" class="hash-link" href="#4-access-logs-and-continuous-profiling" title="Direct link to heading">‚Äã</a></h2><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.webp, https://static.apiseven.com/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/7KO1FcJL_deepflow-8.1.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>For access logs, there is no need for APISIX to be modified in any way. Simply deploying deepflow-agent on the server where APISIX is located. By opening the <a href="https://ce-demo.deepflow.yunshan.net/d/Application_Request_Log/application-request-log?orgId=1" target="_blank" rel="noopener noreferrer">Application - Request Log Dashboard provided by DeepFlow</a> in Grafana, you can view the access logs, which include header information from both the Request and Response. Additionally, you can analyze the response latency and error codes for each request.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/4bOa7VKs_deepflow-9.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/4bOa7VKs_deepflow-9.webp, https://static.apiseven.com/uploads/2024/02/07/4bOa7VKs_deepflow-9.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/4bOa7VKs_deepflow-9.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/4bOa7VKs_deepflow-9.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/4bOa7VKs_deepflow-9.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/4bOa7VKs_deepflow-9.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><p>DeepFlow also utilizes eBPF to capture function call stacks of applications, a feature available in the enterprise edition. This functionality enables the generation of an On-CPU Profile for the APISIX process, detailing the function call stack. It encompasses not just application functions but also the time spent in libraries and kernel syscalls.</p><p></p><div type="image/webp" placeholdersrc="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/KveTMwaQ_deepflow-10.webp" class="rc-image"><img loading="lazy" srcset="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/KveTMwaQ_deepflow-10.webp, https://static.apiseven.com/uploads/2024/02/07/KveTMwaQ_deepflow-10.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-webp/uploads/2024/02/07/KveTMwaQ_deepflow-10.webp"><div aria-hidden="true" class="rc-image-placeholder"><div class="rc-image"><img srcset="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/KveTMwaQ_deepflow-10.webp, https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/KveTMwaQ_deepflow-10.jpeg" alt="Integrating APISIX with DeepFlow" class="rc-image-img" src="https://static.apiseven.com/apisix-thumbnail/uploads/2024/02/07/KveTMwaQ_deepflow-10.webp"></div></div><div class="rc-image-mask">Click to Preview</div></div><p></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="5-what-is-apisix">5. What is APISIX<a aria-hidden="true" class="hash-link" href="#5-what-is-apisix" title="Direct link to heading">‚Äã</a></h2><p><a href="https://apisix.apache.org/" target="_blank" rel="noopener noreferrer">Apache APISIX</a> is a dynamic, real-time, high-performance open-source API gateway that provides rich traffic management functions such as load balancing, dynamic upstream, canary release, circuit breaking, authentication, and observability. Being built based on NGINX and LuaJIT, Apache APISIX has ultra-high performance with a single-core QPS of up to 23,000 and an average delay of only 0.2 milliseconds. It can solve problems in traditional architecture, and at the same time adapt to the needs of the cloud-native era.</p><p>As an API gateway, Apache APISIX has a wide range of application scenarios. It can be applied to scenarios such as gateways, Kubernetes Ingress Controller, and service mesh, and can help enterprises quickly and safely process API and microservice traffic. At present, it has been tested and highly recognized by worldwide enterprises and organizations such as Zoom, Airwallex, Lotus Cars, vivo, and European Factory Platform.</p><p>Open-sourced and donated by API7.ai to Apache Software Foundation in 2019, Apache APISIX is now the most active API gateway project on GitHub addressing 1 Trillion+ API calls per day, which is still growing.</p><p>GitHub addressÔºö<a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="6-what-is-deepflow">6. What is DeepFlow<a aria-hidden="true" class="hash-link" href="#6-what-is-deepflow" title="Direct link to heading">‚Äã</a></h2><p>DeepFlow, an open-source observability project, aims to deliver comprehensive observability for complex cloud infrastructures and cloud-native applications. Utilizing eBPF technology, it offers application performance metrics, distributed tracing, and continuous profiling with zero-code instrumentation, thanks to its integration of smart-encoding technology for full-stack correlation. DeepFlow enables automatic deep observability for cloud-native applications, easing developers&#x27; workload and equipping DevOps/SRE teams with advanced monitoring and diagnostic tools that span from code to infrastructure.</p><p>GitHub addressÔºö<a href="https://github.com/deepflowio/deepflow" target="_blank" rel="noopener noreferrer">https://github.com/deepflowio/deepflow</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/ecosystem/">Ecosystem</a></li></ul></div></footer></article><section class="shareSection_OUzq"><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="reddit" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="31" fill="#ff4500"></circle><path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white"></path></svg></button></div></section><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2024/02/13/apisix-owasp-coraza-core-ruleset/"><div class="pagination-nav__sublabel sublabel_M5Gs">Newer Post</div><div class="pagination-nav__label">Hardening Apache APISIX with the OWASP&#x27;s Coraza and Core Ruleset</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2024/01/31/bi-weekly-report/"><div class="pagination-nav__sublabel sublabel_M5Gs">Older Post</div><div class="pagination-nav__label">Biweekly Report (January 15 - January 28)</div></a></div></nav></div></div></div></div><footer class="container_N-4m"><div class="linksRow_U0oR"><div class="linksCol_R6VE"><div>ASF</div><ul><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span></span><span>Foundation</span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer"><span></span><span>License</span></a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer"><span></span><span>Events</span></a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer"><span></span><span>Security</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer"><span></span><span>Sponsorship</span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer"><span></span><span>Thanks</span></a></li></ul></div><div class="linksCol_R6VE"><div>Community</div><ul><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer"><span></span><span>GitHub</span></a></li><li class="footer__item"><a href="/docs/general/join/"><span></span><span>Slack</span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer"><span></span><span>Twitter</span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer"><span></span><span>YouTube</span></a></li></ul></div><div class="linksCol_R6VE"><div>More</div><ul><li class="footer__item"><a target="_parent" href="/blog/"><span></span><span>Blog</span></a></li><li class="footer__item"><a target="_parent" href="/showcase/"><span></span><span>Showcase</span></a></li><li class="footer__item"><a target="_parent" href="/plugins/"><span></span><span>Plugin Hub</span></a></li><li class="footer__item"><a href="https://github.com/apache/apisix/milestones" target="_parent" rel="noopener noreferrer"><span></span><span>Roadmap</span></a></li></ul></div></div><div class="copyright_Bdi1"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer"><span style="display:inline-block;width:231.25px;height:40px"></span></a><div>Copyright ¬© 2019-2026 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.4bbc9839.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.a516b59b.js"></script>
</body>
</html>